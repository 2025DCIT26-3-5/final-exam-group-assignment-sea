function nC(T,R){for(var z=0;z<R.length;z++){const N=R[z];if(typeof N!="string"&&!Array.isArray(N)){for(const X in N)if(X!=="default"&&!(X in T)){const J=Object.getOwnPropertyDescriptor(N,X);J&&Object.defineProperty(T,X,J.get?J:{enumerable:!0,get:()=>N[X]})}}}return Object.freeze(Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}))}(function(){const R=document.createElement("link").relList;if(R&&R.supports&&R.supports("modulepreload"))return;for(const X of document.querySelectorAll('link[rel="modulepreload"]'))N(X);new MutationObserver(X=>{for(const J of X)if(J.type==="childList")for(const re of J.addedNodes)re.tagName==="LINK"&&re.rel==="modulepreload"&&N(re)}).observe(document,{childList:!0,subtree:!0});function z(X){const J={};return X.integrity&&(J.integrity=X.integrity),X.referrerPolicy&&(J.referrerPolicy=X.referrerPolicy),X.crossOrigin==="use-credentials"?J.credentials="include":X.crossOrigin==="anonymous"?J.credentials="omit":J.credentials="same-origin",J}function N(X){if(X.ep)return;X.ep=!0;const J=z(X);fetch(X.href,J)}})();function Yv(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}var dv={exports:{}},cg={},fv={exports:{}},vr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ab;function iC(){if(ab)return vr;ab=1;var T=Symbol.for("react.element"),R=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),J=Symbol.for("react.provider"),re=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),ae=Symbol.for("react.memo"),Me=Symbol.for("react.lazy"),oe=Symbol.iterator;function Oe(rt){return rt===null||typeof rt!="object"?null:(rt=oe&&rt[oe]||rt["@@iterator"],typeof rt=="function"?rt:null)}var je={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},st=Object.assign,Ce={};function Be(rt,Ut,Gt){this.props=rt,this.context=Ut,this.refs=Ce,this.updater=Gt||je}Be.prototype.isReactComponent={},Be.prototype.setState=function(rt,Ut){if(typeof rt!="object"&&typeof rt!="function"&&rt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,rt,Ut,"setState")},Be.prototype.forceUpdate=function(rt){this.updater.enqueueForceUpdate(this,rt,"forceUpdate")};function Xe(){}Xe.prototype=Be.prototype;function ot(rt,Ut,Gt){this.props=rt,this.context=Ut,this.refs=Ce,this.updater=Gt||je}var Ke=ot.prototype=new Xe;Ke.constructor=ot,st(Ke,Be.prototype),Ke.isPureReactComponent=!0;var Ct=Array.isArray,tt=Object.prototype.hasOwnProperty,Nt={current:null},jt={key:!0,ref:!0,__self:!0,__source:!0};function Mt(rt,Ut,Gt){var gn,jn={},oi=null,cn=null;if(Ut!=null)for(gn in Ut.ref!==void 0&&(cn=Ut.ref),Ut.key!==void 0&&(oi=""+Ut.key),Ut)tt.call(Ut,gn)&&!jt.hasOwnProperty(gn)&&(jn[gn]=Ut[gn]);var wn=arguments.length-2;if(wn===1)jn.children=Gt;else if(1<wn){for(var xn=Array(wn),kn=0;kn<wn;kn++)xn[kn]=arguments[kn+2];jn.children=xn}if(rt&&rt.defaultProps)for(gn in wn=rt.defaultProps,wn)jn[gn]===void 0&&(jn[gn]=wn[gn]);return{$$typeof:T,type:rt,key:oi,ref:cn,props:jn,_owner:Nt.current}}function Rn(rt,Ut){return{$$typeof:T,type:rt.type,key:Ut,ref:rt.ref,props:rt.props,_owner:rt._owner}}function Kn(rt){return typeof rt=="object"&&rt!==null&&rt.$$typeof===T}function Ti(rt){var Ut={"=":"=0",":":"=2"};return"$"+rt.replace(/[=:]/g,function(Gt){return Ut[Gt]})}var pi=/\/+/g;function dn(rt,Ut){return typeof rt=="object"&&rt!==null&&rt.key!=null?Ti(""+rt.key):Ut.toString(36)}function mi(rt,Ut,Gt,gn,jn){var oi=typeof rt;(oi==="undefined"||oi==="boolean")&&(rt=null);var cn=!1;if(rt===null)cn=!0;else switch(oi){case"string":case"number":cn=!0;break;case"object":switch(rt.$$typeof){case T:case R:cn=!0}}if(cn)return cn=rt,jn=jn(cn),rt=gn===""?"."+dn(cn,0):gn,Ct(jn)?(Gt="",rt!=null&&(Gt=rt.replace(pi,"$&/")+"/"),mi(jn,Ut,Gt,"",function(kn){return kn})):jn!=null&&(Kn(jn)&&(jn=Rn(jn,Gt+(!jn.key||cn&&cn.key===jn.key?"":(""+jn.key).replace(pi,"$&/")+"/")+rt)),Ut.push(jn)),1;if(cn=0,gn=gn===""?".":gn+":",Ct(rt))for(var wn=0;wn<rt.length;wn++){oi=rt[wn];var xn=gn+dn(oi,wn);cn+=mi(oi,Ut,Gt,xn,jn)}else if(xn=Oe(rt),typeof xn=="function")for(rt=xn.call(rt),wn=0;!(oi=rt.next()).done;)oi=oi.value,xn=gn+dn(oi,wn++),cn+=mi(oi,Ut,Gt,xn,jn);else if(oi==="object")throw Ut=String(rt),Error("Objects are not valid as a React child (found: "+(Ut==="[object Object]"?"object with keys {"+Object.keys(rt).join(", ")+"}":Ut)+"). If you meant to render a collection of children, use an array instead.");return cn}function Hn(rt,Ut,Gt){if(rt==null)return rt;var gn=[],jn=0;return mi(rt,gn,"","",function(oi){return Ut.call(Gt,oi,jn++)}),gn}function Wt(rt){if(rt._status===-1){var Ut=rt._result;Ut=Ut(),Ut.then(function(Gt){(rt._status===0||rt._status===-1)&&(rt._status=1,rt._result=Gt)},function(Gt){(rt._status===0||rt._status===-1)&&(rt._status=2,rt._result=Gt)}),rt._status===-1&&(rt._status=0,rt._result=Ut)}if(rt._status===1)return rt._result.default;throw rt._result}var Jt={current:null},nt={transition:null},mn={ReactCurrentDispatcher:Jt,ReactCurrentBatchConfig:nt,ReactCurrentOwner:Nt};function sn(){throw Error("act(...) is not supported in production builds of React.")}return vr.Children={map:Hn,forEach:function(rt,Ut,Gt){Hn(rt,function(){Ut.apply(this,arguments)},Gt)},count:function(rt){var Ut=0;return Hn(rt,function(){Ut++}),Ut},toArray:function(rt){return Hn(rt,function(Ut){return Ut})||[]},only:function(rt){if(!Kn(rt))throw Error("React.Children.only expected to receive a single React element child.");return rt}},vr.Component=Be,vr.Fragment=z,vr.Profiler=X,vr.PureComponent=ot,vr.StrictMode=N,vr.Suspense=he,vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mn,vr.act=sn,vr.cloneElement=function(rt,Ut,Gt){if(rt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+rt+".");var gn=st({},rt.props),jn=rt.key,oi=rt.ref,cn=rt._owner;if(Ut!=null){if(Ut.ref!==void 0&&(oi=Ut.ref,cn=Nt.current),Ut.key!==void 0&&(jn=""+Ut.key),rt.type&&rt.type.defaultProps)var wn=rt.type.defaultProps;for(xn in Ut)tt.call(Ut,xn)&&!jt.hasOwnProperty(xn)&&(gn[xn]=Ut[xn]===void 0&&wn!==void 0?wn[xn]:Ut[xn])}var xn=arguments.length-2;if(xn===1)gn.children=Gt;else if(1<xn){wn=Array(xn);for(var kn=0;kn<xn;kn++)wn[kn]=arguments[kn+2];gn.children=wn}return{$$typeof:T,type:rt.type,key:jn,ref:oi,props:gn,_owner:cn}},vr.createContext=function(rt){return rt={$$typeof:re,_currentValue:rt,_currentValue2:rt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},rt.Provider={$$typeof:J,_context:rt},rt.Consumer=rt},vr.createElement=Mt,vr.createFactory=function(rt){var Ut=Mt.bind(null,rt);return Ut.type=rt,Ut},vr.createRef=function(){return{current:null}},vr.forwardRef=function(rt){return{$$typeof:s,render:rt}},vr.isValidElement=Kn,vr.lazy=function(rt){return{$$typeof:Me,_payload:{_status:-1,_result:rt},_init:Wt}},vr.memo=function(rt,Ut){return{$$typeof:ae,type:rt,compare:Ut===void 0?null:Ut}},vr.startTransition=function(rt){var Ut=nt.transition;nt.transition={};try{rt()}finally{nt.transition=Ut}},vr.unstable_act=sn,vr.useCallback=function(rt,Ut){return Jt.current.useCallback(rt,Ut)},vr.useContext=function(rt){return Jt.current.useContext(rt)},vr.useDebugValue=function(){},vr.useDeferredValue=function(rt){return Jt.current.useDeferredValue(rt)},vr.useEffect=function(rt,Ut){return Jt.current.useEffect(rt,Ut)},vr.useId=function(){return Jt.current.useId()},vr.useImperativeHandle=function(rt,Ut,Gt){return Jt.current.useImperativeHandle(rt,Ut,Gt)},vr.useInsertionEffect=function(rt,Ut){return Jt.current.useInsertionEffect(rt,Ut)},vr.useLayoutEffect=function(rt,Ut){return Jt.current.useLayoutEffect(rt,Ut)},vr.useMemo=function(rt,Ut){return Jt.current.useMemo(rt,Ut)},vr.useReducer=function(rt,Ut,Gt){return Jt.current.useReducer(rt,Ut,Gt)},vr.useRef=function(rt){return Jt.current.useRef(rt)},vr.useState=function(rt){return Jt.current.useState(rt)},vr.useSyncExternalStore=function(rt,Ut,Gt){return Jt.current.useSyncExternalStore(rt,Ut,Gt)},vr.useTransition=function(){return Jt.current.useTransition()},vr.version="18.3.1",vr}var lb;function j_(){return lb||(lb=1,fv.exports=iC()),fv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cb;function rC(){if(cb)return cg;cb=1;var T=j_(),R=Symbol.for("react.element"),z=Symbol.for("react.fragment"),N=Object.prototype.hasOwnProperty,X=T.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function re(s,he,ae){var Me,oe={},Oe=null,je=null;ae!==void 0&&(Oe=""+ae),he.key!==void 0&&(Oe=""+he.key),he.ref!==void 0&&(je=he.ref);for(Me in he)N.call(he,Me)&&!J.hasOwnProperty(Me)&&(oe[Me]=he[Me]);if(s&&s.defaultProps)for(Me in he=s.defaultProps,he)oe[Me]===void 0&&(oe[Me]=he[Me]);return{$$typeof:R,type:s,key:Oe,ref:je,props:oe,_owner:X.current}}return cg.Fragment=z,cg.jsx=re,cg.jsxs=re,cg}var ub;function oC(){return ub||(ub=1,dv.exports=rC()),dv.exports}var $=oC(),p_={},pv={exports:{}},jl={},mv={exports:{}},gv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hb;function sC(){return hb||(hb=1,(function(T){function R(nt,mn){var sn=nt.length;nt.push(mn);e:for(;0<sn;){var rt=sn-1>>>1,Ut=nt[rt];if(0<X(Ut,mn))nt[rt]=mn,nt[sn]=Ut,sn=rt;else break e}}function z(nt){return nt.length===0?null:nt[0]}function N(nt){if(nt.length===0)return null;var mn=nt[0],sn=nt.pop();if(sn!==mn){nt[0]=sn;e:for(var rt=0,Ut=nt.length,Gt=Ut>>>1;rt<Gt;){var gn=2*(rt+1)-1,jn=nt[gn],oi=gn+1,cn=nt[oi];if(0>X(jn,sn))oi<Ut&&0>X(cn,jn)?(nt[rt]=cn,nt[oi]=sn,rt=oi):(nt[rt]=jn,nt[gn]=sn,rt=gn);else if(oi<Ut&&0>X(cn,sn))nt[rt]=cn,nt[oi]=sn,rt=oi;else break e}}return mn}function X(nt,mn){var sn=nt.sortIndex-mn.sortIndex;return sn!==0?sn:nt.id-mn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var J=performance;T.unstable_now=function(){return J.now()}}else{var re=Date,s=re.now();T.unstable_now=function(){return re.now()-s}}var he=[],ae=[],Me=1,oe=null,Oe=3,je=!1,st=!1,Ce=!1,Be=typeof setTimeout=="function"?setTimeout:null,Xe=typeof clearTimeout=="function"?clearTimeout:null,ot=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ke(nt){for(var mn=z(ae);mn!==null;){if(mn.callback===null)N(ae);else if(mn.startTime<=nt)N(ae),mn.sortIndex=mn.expirationTime,R(he,mn);else break;mn=z(ae)}}function Ct(nt){if(Ce=!1,Ke(nt),!st)if(z(he)!==null)st=!0,Wt(tt);else{var mn=z(ae);mn!==null&&Jt(Ct,mn.startTime-nt)}}function tt(nt,mn){st=!1,Ce&&(Ce=!1,Xe(Mt),Mt=-1),je=!0;var sn=Oe;try{for(Ke(mn),oe=z(he);oe!==null&&(!(oe.expirationTime>mn)||nt&&!Ti());){var rt=oe.callback;if(typeof rt=="function"){oe.callback=null,Oe=oe.priorityLevel;var Ut=rt(oe.expirationTime<=mn);mn=T.unstable_now(),typeof Ut=="function"?oe.callback=Ut:oe===z(he)&&N(he),Ke(mn)}else N(he);oe=z(he)}if(oe!==null)var Gt=!0;else{var gn=z(ae);gn!==null&&Jt(Ct,gn.startTime-mn),Gt=!1}return Gt}finally{oe=null,Oe=sn,je=!1}}var Nt=!1,jt=null,Mt=-1,Rn=5,Kn=-1;function Ti(){return!(T.unstable_now()-Kn<Rn)}function pi(){if(jt!==null){var nt=T.unstable_now();Kn=nt;var mn=!0;try{mn=jt(!0,nt)}finally{mn?dn():(Nt=!1,jt=null)}}else Nt=!1}var dn;if(typeof ot=="function")dn=function(){ot(pi)};else if(typeof MessageChannel<"u"){var mi=new MessageChannel,Hn=mi.port2;mi.port1.onmessage=pi,dn=function(){Hn.postMessage(null)}}else dn=function(){Be(pi,0)};function Wt(nt){jt=nt,Nt||(Nt=!0,dn())}function Jt(nt,mn){Mt=Be(function(){nt(T.unstable_now())},mn)}T.unstable_IdlePriority=5,T.unstable_ImmediatePriority=1,T.unstable_LowPriority=4,T.unstable_NormalPriority=3,T.unstable_Profiling=null,T.unstable_UserBlockingPriority=2,T.unstable_cancelCallback=function(nt){nt.callback=null},T.unstable_continueExecution=function(){st||je||(st=!0,Wt(tt))},T.unstable_forceFrameRate=function(nt){0>nt||125<nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Rn=0<nt?Math.floor(1e3/nt):5},T.unstable_getCurrentPriorityLevel=function(){return Oe},T.unstable_getFirstCallbackNode=function(){return z(he)},T.unstable_next=function(nt){switch(Oe){case 1:case 2:case 3:var mn=3;break;default:mn=Oe}var sn=Oe;Oe=mn;try{return nt()}finally{Oe=sn}},T.unstable_pauseExecution=function(){},T.unstable_requestPaint=function(){},T.unstable_runWithPriority=function(nt,mn){switch(nt){case 1:case 2:case 3:case 4:case 5:break;default:nt=3}var sn=Oe;Oe=nt;try{return mn()}finally{Oe=sn}},T.unstable_scheduleCallback=function(nt,mn,sn){var rt=T.unstable_now();switch(typeof sn=="object"&&sn!==null?(sn=sn.delay,sn=typeof sn=="number"&&0<sn?rt+sn:rt):sn=rt,nt){case 1:var Ut=-1;break;case 2:Ut=250;break;case 5:Ut=1073741823;break;case 4:Ut=1e4;break;default:Ut=5e3}return Ut=sn+Ut,nt={id:Me++,callback:mn,priorityLevel:nt,startTime:sn,expirationTime:Ut,sortIndex:-1},sn>rt?(nt.sortIndex=sn,R(ae,nt),z(he)===null&&nt===z(ae)&&(Ce?(Xe(Mt),Mt=-1):Ce=!0,Jt(Ct,sn-rt))):(nt.sortIndex=Ut,R(he,nt),st||je||(st=!0,Wt(tt))),nt},T.unstable_shouldYield=Ti,T.unstable_wrapCallback=function(nt){var mn=Oe;return function(){var sn=Oe;Oe=mn;try{return nt.apply(this,arguments)}finally{Oe=sn}}}})(gv)),gv}var db;function aC(){return db||(db=1,mv.exports=sC()),mv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fb;function lC(){if(fb)return jl;fb=1;var T=j_(),R=aC();function z(d){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+d,w=1;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var N=new Set,X={};function J(d,m){re(d,m),re(d+"Capture",m)}function re(d,m){for(X[d]=m,d=0;d<m.length;d++)N.add(m[d])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),he=Object.prototype.hasOwnProperty,ae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Me={},oe={};function Oe(d){return he.call(oe,d)?!0:he.call(Me,d)?!1:ae.test(d)?oe[d]=!0:(Me[d]=!0,!1)}function je(d,m,w,M){if(w!==null&&w.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return M?!1:w!==null?!w.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function st(d,m,w,M){if(m===null||typeof m>"u"||je(d,m,w,M))return!0;if(M)return!1;if(w!==null)switch(w.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function Ce(d,m,w,M,B,W,ce){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=M,this.attributeNamespace=B,this.mustUseProperty=w,this.propertyName=d,this.type=m,this.sanitizeURL=W,this.removeEmptyString=ce}var Be={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){Be[d]=new Ce(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var m=d[0];Be[m]=new Ce(m,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){Be[d]=new Ce(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){Be[d]=new Ce(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){Be[d]=new Ce(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){Be[d]=new Ce(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){Be[d]=new Ce(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){Be[d]=new Ce(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){Be[d]=new Ce(d,5,!1,d.toLowerCase(),null,!1,!1)});var Xe=/[\-:]([a-z])/g;function ot(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var m=d.replace(Xe,ot);Be[m]=new Ce(m,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var m=d.replace(Xe,ot);Be[m]=new Ce(m,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var m=d.replace(Xe,ot);Be[m]=new Ce(m,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){Be[d]=new Ce(d,1,!1,d.toLowerCase(),null,!1,!1)}),Be.xlinkHref=new Ce("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){Be[d]=new Ce(d,1,!1,d.toLowerCase(),null,!0,!0)});function Ke(d,m,w,M){var B=Be.hasOwnProperty(m)?Be[m]:null;(B!==null?B.type!==0:M||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(st(m,w,B,M)&&(w=null),M||B===null?Oe(m)&&(w===null?d.removeAttribute(m):d.setAttribute(m,""+w)):B.mustUseProperty?d[B.propertyName]=w===null?B.type===3?!1:"":w:(m=B.attributeName,M=B.attributeNamespace,w===null?d.removeAttribute(m):(B=B.type,w=B===3||B===4&&w===!0?"":""+w,M?d.setAttributeNS(M,m,w):d.setAttribute(m,w))))}var Ct=T.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tt=Symbol.for("react.element"),Nt=Symbol.for("react.portal"),jt=Symbol.for("react.fragment"),Mt=Symbol.for("react.strict_mode"),Rn=Symbol.for("react.profiler"),Kn=Symbol.for("react.provider"),Ti=Symbol.for("react.context"),pi=Symbol.for("react.forward_ref"),dn=Symbol.for("react.suspense"),mi=Symbol.for("react.suspense_list"),Hn=Symbol.for("react.memo"),Wt=Symbol.for("react.lazy"),Jt=Symbol.for("react.offscreen"),nt=Symbol.iterator;function mn(d){return d===null||typeof d!="object"?null:(d=nt&&d[nt]||d["@@iterator"],typeof d=="function"?d:null)}var sn=Object.assign,rt;function Ut(d){if(rt===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);rt=m&&m[1]||""}return`
`+rt+d}var Gt=!1;function gn(d,m){if(!d||Gt)return"";Gt=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(kt){var M=kt}Reflect.construct(d,[],m)}else{try{m.call()}catch(kt){M=kt}d.call(m.prototype)}else{try{throw Error()}catch(kt){M=kt}d()}}catch(kt){if(kt&&M&&typeof kt.stack=="string"){for(var B=kt.stack.split(`
`),W=M.stack.split(`
`),ce=B.length-1,Fe=W.length-1;1<=ce&&0<=Fe&&B[ce]!==W[Fe];)Fe--;for(;1<=ce&&0<=Fe;ce--,Fe--)if(B[ce]!==W[Fe]){if(ce!==1||Fe!==1)do if(ce--,Fe--,0>Fe||B[ce]!==W[Fe]){var Ze=`
`+B[ce].replace(" at new "," at ");return d.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",d.displayName)),Ze}while(1<=ce&&0<=Fe);break}}}finally{Gt=!1,Error.prepareStackTrace=w}return(d=d?d.displayName||d.name:"")?Ut(d):""}function jn(d){switch(d.tag){case 5:return Ut(d.type);case 16:return Ut("Lazy");case 13:return Ut("Suspense");case 19:return Ut("SuspenseList");case 0:case 2:case 15:return d=gn(d.type,!1),d;case 11:return d=gn(d.type.render,!1),d;case 1:return d=gn(d.type,!0),d;default:return""}}function oi(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case jt:return"Fragment";case Nt:return"Portal";case Rn:return"Profiler";case Mt:return"StrictMode";case dn:return"Suspense";case mi:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case Ti:return(d.displayName||"Context")+".Consumer";case Kn:return(d._context.displayName||"Context")+".Provider";case pi:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Hn:return m=d.displayName||null,m!==null?m:oi(d.type)||"Memo";case Wt:m=d._payload,d=d._init;try{return oi(d(m))}catch{}}return null}function cn(d){var m=d.type;switch(d.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=m.render,d=d.displayName||d.name||"",m.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oi(m);case 8:return m===Mt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function wn(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function xn(d){var m=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function kn(d){var m=xn(d)?"checked":"value",w=Object.getOwnPropertyDescriptor(d.constructor.prototype,m),M=""+d[m];if(!d.hasOwnProperty(m)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var B=w.get,W=w.set;return Object.defineProperty(d,m,{configurable:!0,get:function(){return B.call(this)},set:function(ce){M=""+ce,W.call(this,ce)}}),Object.defineProperty(d,m,{enumerable:w.enumerable}),{getValue:function(){return M},setValue:function(ce){M=""+ce},stopTracking:function(){d._valueTracker=null,delete d[m]}}}}function _i(d){d._valueTracker||(d._valueTracker=kn(d))}function Ji(d){if(!d)return!1;var m=d._valueTracker;if(!m)return!0;var w=m.getValue(),M="";return d&&(M=xn(d)?d.checked?"true":"false":d.value),d=M,d!==w?(m.setValue(d),!0):!1}function Gi(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function yo(d,m){var w=m.checked;return sn({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??d._wrapperState.initialChecked})}function Es(d,m){var w=m.defaultValue==null?"":m.defaultValue,M=m.checked!=null?m.checked:m.defaultChecked;w=wn(m.value!=null?m.value:w),d._wrapperState={initialChecked:M,initialValue:w,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function vo(d,m){m=m.checked,m!=null&&Ke(d,"checked",m,!1)}function Pr(d,m){vo(d,m);var w=wn(m.value),M=m.type;if(w!=null)M==="number"?(w===0&&d.value===""||d.value!=w)&&(d.value=""+w):d.value!==""+w&&(d.value=""+w);else if(M==="submit"||M==="reset"){d.removeAttribute("value");return}m.hasOwnProperty("value")?Is(d,m.type,w):m.hasOwnProperty("defaultValue")&&Is(d,m.type,wn(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(d.defaultChecked=!!m.defaultChecked)}function Cr(d,m,w){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var M=m.type;if(!(M!=="submit"&&M!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+d._wrapperState.initialValue,w||m===d.value||(d.value=m),d.defaultValue=m}w=d.name,w!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,w!==""&&(d.name=w)}function Is(d,m,w){(m!=="number"||Gi(d.ownerDocument)!==d)&&(w==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+w&&(d.defaultValue=""+w))}var Ca=Array.isArray;function Gs(d,m,w,M){if(d=d.options,m){m={};for(var B=0;B<w.length;B++)m["$"+w[B]]=!0;for(w=0;w<d.length;w++)B=m.hasOwnProperty("$"+d[w].value),d[w].selected!==B&&(d[w].selected=B),B&&M&&(d[w].defaultSelected=!0)}else{for(w=""+wn(w),m=null,B=0;B<d.length;B++){if(d[B].value===w){d[B].selected=!0,M&&(d[B].defaultSelected=!0);return}m!==null||d[B].disabled||(m=d[B])}m!==null&&(m.selected=!0)}}function to(d,m){if(m.dangerouslySetInnerHTML!=null)throw Error(z(91));return sn({},m,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ds(d,m){var w=m.value;if(w==null){if(w=m.children,m=m.defaultValue,w!=null){if(m!=null)throw Error(z(92));if(Ca(w)){if(1<w.length)throw Error(z(93));w=w[0]}m=w}m==null&&(m=""),w=m}d._wrapperState={initialValue:wn(w)}}function So(d,m){var w=wn(m.value),M=wn(m.defaultValue);w!=null&&(w=""+w,w!==d.value&&(d.value=w),m.defaultValue==null&&d.defaultValue!==w&&(d.defaultValue=w)),M!=null&&(d.defaultValue=""+M)}function Ma(d){var m=d.textContent;m===d._wrapperState.initialValue&&m!==""&&m!==null&&(d.value=m)}function Pa(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function As(d,m){return d==null||d==="http://www.w3.org/1999/xhtml"?Pa(m):d==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Cs,Eo=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,w,M,B){MSApp.execUnsafeLocalFunction(function(){return d(m,w,M,B)})}:d})(function(d,m){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=m;else{for(Cs=Cs||document.createElement("div"),Cs.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=Cs.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;m.firstChild;)d.appendChild(m.firstChild)}});function qo(d,m){if(m){var w=d.firstChild;if(w&&w===d.lastChild&&w.nodeType===3){w.nodeValue=m;return}}d.textContent=m}var $s={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Hs=["Webkit","ms","Moz","O"];Object.keys($s).forEach(function(d){Hs.forEach(function(m){m=m+d.charAt(0).toUpperCase()+d.substring(1),$s[m]=$s[d]})});function Ul(d,m,w){return m==null||typeof m=="boolean"||m===""?"":w||typeof m!="number"||m===0||$s.hasOwnProperty(d)&&$s[d]?(""+m).trim():m+"px"}function no(d,m){d=d.style;for(var w in m)if(m.hasOwnProperty(w)){var M=w.indexOf("--")===0,B=Ul(w,m[w],M);w==="float"&&(w="cssFloat"),M?d.setProperty(w,B):d[w]=B}}var Zo=sn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _l(d,m){if(m){if(Zo[d]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(z(137,d));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(z(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(z(61))}if(m.style!=null&&typeof m.style!="object")throw Error(z(62))}}function Ra(d,m){if(d.indexOf("-")===-1)return typeof m.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fs=null;function Ro(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Ms=null,ka=null,Ps=null;function lr(d){if(d=Vu(d)){if(typeof Ms!="function")throw Error(z(280));var m=d.stateNode;m&&(m=jh(m),Ms(d.stateNode,d.type,m))}}function ei(d){ka?Ps?Ps.push(d):Ps=[d]:ka=d}function io(){if(ka){var d=ka,m=Ps;if(Ps=ka=null,lr(d),m)for(d=0;d<m.length;d++)lr(m[d])}}function Yr(d,m){return d(m)}function Wr(){}var Wa=!1;function ct(d,m,w){if(Wa)return d(m,w);Wa=!0;try{return Yr(d,m,w)}finally{Wa=!1,(ka!==null||Ps!==null)&&(Wr(),io())}}function qr(d,m){var w=d.stateNode;if(w===null)return null;var M=jh(w);if(M===null)return null;w=M[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(M=!M.disabled)||(d=d.type,M=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!M;break e;default:d=!1}if(d)return null;if(w&&typeof w!="function")throw Error(z(231,m,typeof w));return w}var yl=!1;if(s)try{var co={};Object.defineProperty(co,"passive",{get:function(){yl=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{yl=!1}function ti(d,m,w,M,B,W,ce,Fe,Ze){var kt=Array.prototype.slice.call(arguments,3);try{m.apply(w,kt)}catch(en){this.onError(en)}}var ro=!1,Ws=null,qa=!1,Lc=null,De={onError:function(d){ro=!0,Ws=d}};function H(d,m,w,M,B,W,ce,Fe,Ze){ro=!1,Ws=null,ti.apply(De,arguments)}function K(d,m,w,M,B,W,ce,Fe,Ze){if(H.apply(this,arguments),ro){if(ro){var kt=Ws;ro=!1,Ws=null}else throw Error(z(198));qa||(qa=!0,Lc=kt)}}function se(d){var m=d,w=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,(m.flags&4098)!==0&&(w=m.return),d=m.return;while(d)}return m.tag===3?w:null}function Se(d){if(d.tag===13){var m=d.memoizedState;if(m===null&&(d=d.alternate,d!==null&&(m=d.memoizedState)),m!==null)return m.dehydrated}return null}function we(d){if(se(d)!==d)throw Error(z(188))}function Pe(d){var m=d.alternate;if(!m){if(m=se(d),m===null)throw Error(z(188));return m!==d?null:d}for(var w=d,M=m;;){var B=w.return;if(B===null)break;var W=B.alternate;if(W===null){if(M=B.return,M!==null){w=M;continue}break}if(B.child===W.child){for(W=B.child;W;){if(W===w)return we(B),d;if(W===M)return we(B),m;W=W.sibling}throw Error(z(188))}if(w.return!==M.return)w=B,M=W;else{for(var ce=!1,Fe=B.child;Fe;){if(Fe===w){ce=!0,w=B,M=W;break}if(Fe===M){ce=!0,M=B,w=W;break}Fe=Fe.sibling}if(!ce){for(Fe=W.child;Fe;){if(Fe===w){ce=!0,w=W,M=B;break}if(Fe===M){ce=!0,M=W,w=B;break}Fe=Fe.sibling}if(!ce)throw Error(z(189))}}if(w.alternate!==M)throw Error(z(190))}if(w.tag!==3)throw Error(z(188));return w.stateNode.current===w?d:m}function Ge(d){return d=Pe(d),d!==null?ze(d):null}function ze(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var m=ze(d);if(m!==null)return m;d=d.sibling}return null}var Ve=R.unstable_scheduleCallback,yt=R.unstable_cancelCallback,lt=R.unstable_shouldYield,Xt=R.unstable_requestPaint,Qt=R.unstable_now,$t=R.unstable_getCurrentPriorityLevel,Vn=R.unstable_ImmediatePriority,Un=R.unstable_UserBlockingPriority,Fn=R.unstable_NormalPriority,xi=R.unstable_LowPriority,xr=R.unstable_IdlePriority,Rr=null,ir=null;function Kr(d){if(ir&&typeof ir.onCommitFiberRoot=="function")try{ir.onCommitFiberRoot(Rr,d,void 0,(d.current.flags&128)===128)}catch{}}var Zi=Math.clz32?Math.clz32:Qi,Ei=Math.log,wr=Math.LN2;function Qi(d){return d>>>=0,d===0?32:31-(Ei(d)/wr|0)|0}var ri=64,br=4194304;function uo(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Io(d,m){var w=d.pendingLanes;if(w===0)return 0;var M=0,B=d.suspendedLanes,W=d.pingedLanes,ce=w&268435455;if(ce!==0){var Fe=ce&~B;Fe!==0?M=uo(Fe):(W&=ce,W!==0&&(M=uo(W)))}else ce=w&~B,ce!==0?M=uo(ce):W!==0&&(M=uo(W));if(M===0)return 0;if(m!==0&&m!==M&&(m&B)===0&&(B=M&-M,W=m&-m,B>=W||B===16&&(W&4194240)!==0))return m;if((M&4)!==0&&(M|=w&16),m=d.entangledLanes,m!==0)for(d=d.entanglements,m&=M;0<m;)w=31-Zi(m),B=1<<w,M|=d[w],m&=~B;return M}function Rs(d,m){switch(d){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dc(d,m){for(var w=d.suspendedLanes,M=d.pingedLanes,B=d.expirationTimes,W=d.pendingLanes;0<W;){var ce=31-Zi(W),Fe=1<<ce,Ze=B[ce];Ze===-1?((Fe&w)===0||(Fe&M)!==0)&&(B[ce]=Rs(Fe,m)):Ze<=m&&(d.expiredLanes|=Fe),W&=~Fe}}function ho(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function qs(){var d=ri;return ri<<=1,(ri&4194240)===0&&(ri=64),d}function Oo(d){for(var m=[],w=0;31>w;w++)m.push(d);return m}function Zs(d,m,w){d.pendingLanes|=m,m!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,m=31-Zi(m),d[m]=w}function xo(d,m){var w=d.pendingLanes&~m;d.pendingLanes=m,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=m,d.mutableReadLanes&=m,d.entangledLanes&=m,m=d.entanglements;var M=d.eventTimes;for(d=d.expirationTimes;0<w;){var B=31-Zi(w),W=1<<B;m[B]=0,M[B]=-1,d[B]=-1,w&=~W}}function Gl(d,m){var w=d.entangledLanes|=m;for(d=d.entanglements;w;){var M=31-Zi(w),B=1<<M;B&m|d[M]&m&&(d[M]|=m),w&=~B}}var mr=0;function xh(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var wh,bu,Tu,Za,ps,da=!1,Xs=[],Fo=null,ns=null,ks=null,Xa=new Map,dc=new Map,Ys=[],Cd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kf(d,m){switch(d){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":ns=null;break;case"mouseover":case"mouseout":ks=null;break;case"pointerover":case"pointerout":Xa.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":dc.delete(m.pointerId)}}function $l(d,m,w,M,B,W){return d===null||d.nativeEvent!==W?(d={blockedOn:m,domEventName:w,eventSystemFlags:M,nativeEvent:W,targetContainers:[B]},m!==null&&(m=Vu(m),m!==null&&bu(m)),d):(d.eventSystemFlags|=M,m=d.targetContainers,B!==null&&m.indexOf(B)===-1&&m.push(B),d)}function Ks(d,m,w,M,B){switch(m){case"focusin":return Fo=$l(Fo,d,m,w,M,B),!0;case"dragenter":return ns=$l(ns,d,m,w,M,B),!0;case"mouseover":return ks=$l(ks,d,m,w,M,B),!0;case"pointerover":var W=B.pointerId;return Xa.set(W,$l(Xa.get(W)||null,d,m,w,M,B)),!0;case"gotpointercapture":return W=B.pointerId,dc.set(W,$l(dc.get(W)||null,d,m,w,M,B)),!0}return!1}function bh(d){var m=vc(d.target);if(m!==null){var w=se(m);if(w!==null){if(m=w.tag,m===13){if(m=Se(w),m!==null){d.blockedOn=m,ps(d.priority,function(){Tu(w)});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){d.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}d.blockedOn=null}function vl(d){if(d.blockedOn!==null)return!1;for(var m=d.targetContainers;0<m.length;){var w=Fc(d.domEventName,d.eventSystemFlags,m[0],d.nativeEvent);if(w===null){w=d.nativeEvent;var M=new w.constructor(w.type,w);fs=M,w.target.dispatchEvent(M),fs=null}else return m=Vu(w),m!==null&&bu(m),d.blockedOn=w,!1;m.shift()}return!0}function xl(d,m,w){vl(d)&&w.delete(m)}function _m(){da=!1,Fo!==null&&vl(Fo)&&(Fo=null),ns!==null&&vl(ns)&&(ns=null),ks!==null&&vl(ks)&&(ks=null),Xa.forEach(xl),dc.forEach(xl)}function Su(d,m){d.blockedOn===m&&(d.blockedOn=null,da||(da=!0,R.unstable_scheduleCallback(R.unstable_NormalPriority,_m)))}function Hl(d){function m(B){return Su(B,d)}if(0<Xs.length){Su(Xs[0],d);for(var w=1;w<Xs.length;w++){var M=Xs[w];M.blockedOn===d&&(M.blockedOn=null)}}for(Fo!==null&&Su(Fo,d),ns!==null&&Su(ns,d),ks!==null&&Su(ks,d),Xa.forEach(m),dc.forEach(m),w=0;w<Ys.length;w++)M=Ys[w],M.blockedOn===d&&(M.blockedOn=null);for(;0<Ys.length&&(w=Ys[0],w.blockedOn===null);)bh(w),w.blockedOn===null&&Ys.shift()}var ci=Ct.ReactCurrentBatchConfig,Oc=!0;function zf(d,m,w,M){var B=mr,W=ci.transition;ci.transition=null;try{mr=1,Md(d,m,w,M)}finally{mr=B,ci.transition=W}}function Tp(d,m,w,M){var B=mr,W=ci.transition;ci.transition=null;try{mr=4,Md(d,m,w,M)}finally{mr=B,ci.transition=W}}function Md(d,m,w,M){if(Oc){var B=Fc(d,m,w,M);if(B===null)Dh(d,m,M,Ya,w),kf(d,M);else if(Ks(B,d,m,w,M))M.stopPropagation();else if(kf(d,M),m&4&&-1<Cd.indexOf(d)){for(;B!==null;){var W=Vu(B);if(W!==null&&wh(W),W=Fc(d,m,w,M),W===null&&Dh(d,m,M,Ya,w),W===B)break;B=W}B!==null&&M.stopPropagation()}else Dh(d,m,M,null,w)}}var Ya=null;function Fc(d,m,w,M){if(Ya=null,d=Ro(M),d=vc(d),d!==null)if(m=se(d),m===null)d=null;else if(w=m.tag,w===13){if(d=Se(m),d!==null)return d;d=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;d=null}else m!==d&&(d=null);return Ya=d,null}function Eu(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($t()){case Vn:return 1;case Un:return 4;case Fn:case xi:return 16;case xr:return 536870912;default:return 16}default:return 16}}var wl=null,Iu=null,fa=null;function Au(){if(fa)return fa;var d,m=Iu,w=m.length,M,B="value"in wl?wl.value:wl.textContent,W=B.length;for(d=0;d<w&&m[d]===B[d];d++);var ce=w-d;for(M=1;M<=ce&&m[w-M]===B[W-M];M++);return fa=B.slice(d,1<M?1-M:void 0)}function Cu(d){var m=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&m===13&&(d=13)):d=m,d===10&&(d=13),32<=d||d===13?d:0}function Ka(){return!0}function fc(){return!1}function kr(d){function m(w,M,B,W,ce){this._reactName=w,this._targetInst=B,this.type=M,this.nativeEvent=W,this.target=ce,this.currentTarget=null;for(var Fe in d)d.hasOwnProperty(Fe)&&(w=d[Fe],this[Fe]=w?w(W):W[Fe]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Ka:fc,this.isPropagationStopped=fc,this}return sn(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Ka)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Ka)},persist:function(){},isPersistent:Ka}),m}var Wl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bc=kr(Wl),ms=sn({},Wl,{view:0,detail:0}),Vi=kr(ms),Pd,Rd,Mu,bn=sn({},ms,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dr,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Mu&&(Mu&&d.type==="mousemove"?(Pd=d.screenX-Mu.screenX,Rd=d.screenY-Mu.screenY):Rd=Pd=0,Mu=d),Pd)},movementY:function(d){return"movementY"in d?d.movementY:Rd}}),kd=kr(bn),Th=sn({},bn,{dataTransfer:0}),za=kr(Th),Pu=sn({},ms,{relatedTarget:0}),pa=kr(Pu),un=sn({},Wl,{animationName:0,elapsedTime:0,pseudoElement:0}),yi=kr(un),$i=sn({},Wl,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),zs=kr($i),bl=sn({},Wl,{data:0}),Oi=kr(bl),zd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Eh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xo(d){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(d):(d=Eh[d])?!!m[d]:!1}function Dr(){return Xo}var ym=sn({},ms,{key:function(d){if(d.key){var m=zd[d.key]||d.key;if(m!=="Unidentified")return m}return d.type==="keypress"?(d=Cu(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Sh[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dr,charCode:function(d){return d.type==="keypress"?Cu(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Cu(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),pc=kr(ym),Lf=sn({},bn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ru=kr(Lf),Ld=sn({},ms,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dr}),Df=kr(Ld),Dd=sn({},Wl,{propertyName:0,elapsedTime:0,pseudoElement:0}),gs=kr(Dd),ql=sn({},bn,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),_s=kr(ql),Nc=[9,13,27,32],mc=s&&"CompositionEvent"in window,Zr=null;s&&"documentMode"in document&&(Zr=document.documentMode);var La=s&&"TextEvent"in window&&!Zr,Tl=s&&(!mc||Zr&&8<Zr&&11>=Zr),oo=" ",Od=!1;function Da(d,m){switch(d){case"keyup":return Nc.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ja(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var On=!1;function an(d,m){switch(d){case"compositionend":return Ja(m);case"keypress":return m.which!==32?null:(Od=!0,oo);case"textInput":return d=m.data,d===oo&&Od?null:d;default:return null}}function Fd(d,m){if(On)return d==="compositionend"||!mc&&Da(d,m)?(d=Au(),fa=Iu=wl=null,On=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Tl&&m.locale!=="ko"?null:m.data;default:return null}}var Pn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jc(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m==="input"?!!Pn[d.type]:m==="textarea"}function Ih(d,m,w,M){ei(M),m=ui(m,"onChange"),0<m.length&&(w=new Bc("onChange","change",null,w,M),d.push({event:w,listeners:m}))}var In=null,Js=null;function Of(d){Jl(d,0)}function Vc(d){var m=nl(d);if(Ji(m))return d}function ys(d,m){if(d==="change")return m}var Ah=!1;if(s){var fo;if(s){var ku="oninput"in document;if(!ku){var Oa=document.createElement("div");Oa.setAttribute("oninput","return;"),ku=typeof Oa.oninput=="function"}fo=ku}else fo=!1;Ah=fo&&(!document.documentMode||9<document.documentMode)}function Bd(){In&&(In.detachEvent("onpropertychange",Zl),Js=In=null)}function Zl(d){if(d.propertyName==="value"&&Vc(Js)){var m=[];Ih(m,Js,d,Ro(d)),ct(Of,m)}}function Fa(d,m,w){d==="focusin"?(Bd(),In=m,Js=w,In.attachEvent("onpropertychange",Zl)):d==="focusout"&&Bd()}function Ch(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Vc(Js)}function vm(d,m){if(d==="click")return Vc(m)}function zu(d,m){if(d==="input"||d==="change")return Vc(m)}function Mh(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var Ls=typeof Object.is=="function"?Object.is:Mh;function ma(d,m){if(Ls(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var w=Object.keys(d),M=Object.keys(m);if(w.length!==M.length)return!1;for(M=0;M<w.length;M++){var B=w[M];if(!he.call(m,B)||!Ls(d[B],m[B]))return!1}return!0}function Xl(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Sp(d,m){var w=Xl(d);d=0;for(var M;w;){if(w.nodeType===3){if(M=d+w.textContent.length,d<=m&&M>=m)return{node:w,offset:m-d};d=M}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=Xl(w)}}function Nd(d,m){return d&&m?d===m?!0:d&&d.nodeType===3?!1:m&&m.nodeType===3?Nd(d,m.parentNode):"contains"in d?d.contains(m):d.compareDocumentPosition?!!(d.compareDocumentPosition(m)&16):!1:!1}function Ep(){for(var d=window,m=Gi();m instanceof d.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)d=m.contentWindow;else break;m=Gi(d.document)}return m}function jd(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m&&(m==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||m==="textarea"||d.contentEditable==="true")}function Ip(d){var m=Ep(),w=d.focusedElem,M=d.selectionRange;if(m!==w&&w&&w.ownerDocument&&Nd(w.ownerDocument.documentElement,w)){if(M!==null&&jd(w)){if(m=M.start,d=M.end,d===void 0&&(d=m),"selectionStart"in w)w.selectionStart=m,w.selectionEnd=Math.min(d,w.value.length);else if(d=(m=w.ownerDocument||document)&&m.defaultView||window,d.getSelection){d=d.getSelection();var B=w.textContent.length,W=Math.min(M.start,B);M=M.end===void 0?W:Math.min(M.end,B),!d.extend&&W>M&&(B=M,M=W,W=B),B=Sp(w,W);var ce=Sp(w,M);B&&ce&&(d.rangeCount!==1||d.anchorNode!==B.node||d.anchorOffset!==B.offset||d.focusNode!==ce.node||d.focusOffset!==ce.offset)&&(m=m.createRange(),m.setStart(B.node,B.offset),d.removeAllRanges(),W>M?(d.addRange(m),d.extend(ce.node,ce.offset)):(m.setEnd(ce.node,ce.offset),d.addRange(m)))}}for(m=[],d=w;d=d.parentNode;)d.nodeType===1&&m.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<m.length;w++)d=m[w],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ff=s&&"documentMode"in document&&11>=document.documentMode,ga=null,Vd=null,Lu=null,Du=!1;function Yl(d,m,w){var M=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Du||ga==null||ga!==Gi(M)||(M=ga,"selectionStart"in M&&jd(M)?M={start:M.selectionStart,end:M.selectionEnd}:(M=(M.ownerDocument&&M.ownerDocument.defaultView||window).getSelection(),M={anchorNode:M.anchorNode,anchorOffset:M.anchorOffset,focusNode:M.focusNode,focusOffset:M.focusOffset}),Lu&&ma(Lu,M)||(Lu=M,M=ui(Vd,"onSelect"),0<M.length&&(m=new Bc("onSelect","select",null,m,w),d.push({event:m,listeners:M}),m.target=ga)))}function gc(d,m){var w={};return w[d.toLowerCase()]=m.toLowerCase(),w["Webkit"+d]="webkit"+m,w["Moz"+d]="moz"+m,w}var is={animationend:gc("Animation","AnimationEnd"),animationiteration:gc("Animation","AnimationIteration"),animationstart:gc("Animation","AnimationStart"),transitionend:gc("Transition","TransitionEnd")},Ud={},Uc={};s&&(Uc=document.createElement("div").style,"AnimationEvent"in window||(delete is.animationend.animation,delete is.animationiteration.animation,delete is.animationstart.animation),"TransitionEvent"in window||delete is.transitionend.transition);function Kl(d){if(Ud[d])return Ud[d];if(!is[d])return d;var m=is[d],w;for(w in m)if(m.hasOwnProperty(w)&&w in Uc)return Ud[d]=m[w];return d}var Gd=Kl("animationend"),Ph=Kl("animationiteration"),Qs=Kl("animationstart"),Rh=Kl("transitionend"),Pt=new Map,$d="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qa(d,m){Pt.set(d,m),J(m,[d])}for(var Ou=0;Ou<$d.length;Ou++){var kh=$d[Ou],zh=kh.toLowerCase(),Sl=kh[0].toUpperCase()+kh.slice(1);Qa(zh,"on"+Sl)}Qa(Gd,"onAnimationEnd"),Qa(Ph,"onAnimationIteration"),Qa(Qs,"onAnimationStart"),Qa("dblclick","onDoubleClick"),Qa("focusin","onFocus"),Qa("focusout","onBlur"),Qa(Rh,"onTransitionEnd"),re("onMouseEnter",["mouseout","mouseover"]),re("onMouseLeave",["mouseout","mouseover"]),re("onPointerEnter",["pointerout","pointerover"]),re("onPointerLeave",["pointerout","pointerover"]),J("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),J("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),J("onBeforeInput",["compositionend","keypress","textInput","paste"]),J("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),J("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),J("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$c=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gc));function _c(d,m,w){var M=d.type||"unknown-event";d.currentTarget=w,K(M,m,void 0,d),d.currentTarget=null}function Jl(d,m){m=(m&4)!==0;for(var w=0;w<d.length;w++){var M=d[w],B=M.event;M=M.listeners;e:{var W=void 0;if(m)for(var ce=M.length-1;0<=ce;ce--){var Fe=M[ce],Ze=Fe.instance,kt=Fe.currentTarget;if(Fe=Fe.listener,Ze!==W&&B.isPropagationStopped())break e;_c(B,Fe,kt),W=Ze}else for(ce=0;ce<M.length;ce++){if(Fe=M[ce],Ze=Fe.instance,kt=Fe.currentTarget,Fe=Fe.listener,Ze!==W&&B.isPropagationStopped())break e;_c(B,Fe,kt),W=Ze}}}if(qa)throw d=Lc,qa=!1,Lc=null,d}function Or(d,m){var w=m[ju];w===void 0&&(w=m[ju]=new Set);var M=d+"__bubble";w.has(M)||(Bf(m,d,2,!1),w.add(M))}function Hd(d,m,w){var M=0;m&&(M|=4),Bf(w,d,M,m)}var Hc="_reactListening"+Math.random().toString(36).slice(2);function Lh(d){if(!d[Hc]){d[Hc]=!0,N.forEach(function(w){w!=="selectionchange"&&($c.has(w)||Hd(w,!1,d),Hd(w,!0,d))});var m=d.nodeType===9?d:d.ownerDocument;m===null||m[Hc]||(m[Hc]=!0,Hd("selectionchange",!1,m))}}function Bf(d,m,w,M){switch(Eu(m)){case 1:var B=zf;break;case 4:B=Tp;break;default:B=Md}w=B.bind(null,m,w,d),B=void 0,!yl||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(B=!0),M?B!==void 0?d.addEventListener(m,w,{capture:!0,passive:B}):d.addEventListener(m,w,!0):B!==void 0?d.addEventListener(m,w,{passive:B}):d.addEventListener(m,w,!1)}function Dh(d,m,w,M,B){var W=M;if((m&1)===0&&(m&2)===0&&M!==null)e:for(;;){if(M===null)return;var ce=M.tag;if(ce===3||ce===4){var Fe=M.stateNode.containerInfo;if(Fe===B||Fe.nodeType===8&&Fe.parentNode===B)break;if(ce===4)for(ce=M.return;ce!==null;){var Ze=ce.tag;if((Ze===3||Ze===4)&&(Ze=ce.stateNode.containerInfo,Ze===B||Ze.nodeType===8&&Ze.parentNode===B))return;ce=ce.return}for(;Fe!==null;){if(ce=vc(Fe),ce===null)return;if(Ze=ce.tag,Ze===5||Ze===6){M=W=ce;continue e}Fe=Fe.parentNode}}M=M.return}ct(function(){var kt=W,en=Ro(w),ln=[];e:{var rn=Pt.get(d);if(rn!==void 0){var zn=Bc,Bn=d;switch(d){case"keypress":if(Cu(w)===0)break e;case"keydown":case"keyup":zn=pc;break;case"focusin":Bn="focus",zn=pa;break;case"focusout":Bn="blur",zn=pa;break;case"beforeblur":case"afterblur":zn=pa;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":zn=kd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":zn=za;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":zn=Df;break;case Gd:case Ph:case Qs:zn=yi;break;case Rh:zn=gs;break;case"scroll":zn=Vi;break;case"wheel":zn=_s;break;case"copy":case"cut":case"paste":zn=zs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":zn=Ru}var Nn=(m&4)!==0,Lr=!Nn&&d==="scroll",bt=Nn?rn!==null?rn+"Capture":null:rn;Nn=[];for(var at=kt,Et;at!==null;){Et=at;var vn=Et.stateNode;if(Et.tag===5&&vn!==null&&(Et=vn,bt!==null&&(vn=qr(at,bt),vn!=null&&Nn.push(Ba(at,vn,Et)))),Lr)break;at=at.return}0<Nn.length&&(rn=new zn(rn,Bn,null,w,en),ln.push({event:rn,listeners:Nn}))}}if((m&7)===0){e:{if(rn=d==="mouseover"||d==="pointerover",zn=d==="mouseout"||d==="pointerout",rn&&w!==fs&&(Bn=w.relatedTarget||w.fromElement)&&(vc(Bn)||Bn[tl]))break e;if((zn||rn)&&(rn=en.window===en?en:(rn=en.ownerDocument)?rn.defaultView||rn.parentWindow:window,zn?(Bn=w.relatedTarget||w.toElement,zn=kt,Bn=Bn?vc(Bn):null,Bn!==null&&(Lr=se(Bn),Bn!==Lr||Bn.tag!==5&&Bn.tag!==6)&&(Bn=null)):(zn=null,Bn=kt),zn!==Bn)){if(Nn=kd,vn="onMouseLeave",bt="onMouseEnter",at="mouse",(d==="pointerout"||d==="pointerover")&&(Nn=Ru,vn="onPointerLeave",bt="onPointerEnter",at="pointer"),Lr=zn==null?rn:nl(zn),Et=Bn==null?rn:nl(Bn),rn=new Nn(vn,at+"leave",zn,w,en),rn.target=Lr,rn.relatedTarget=Et,vn=null,vc(en)===kt&&(Nn=new Nn(bt,at+"enter",Bn,w,en),Nn.target=Et,Nn.relatedTarget=Lr,vn=Nn),Lr=vn,zn&&Bn)t:{for(Nn=zn,bt=Bn,at=0,Et=Nn;Et;Et=Fu(Et))at++;for(Et=0,vn=bt;vn;vn=Fu(vn))Et++;for(;0<at-Et;)Nn=Fu(Nn),at--;for(;0<Et-at;)bt=Fu(bt),Et--;for(;at--;){if(Nn===bt||bt!==null&&Nn===bt.alternate)break t;Nn=Fu(Nn),bt=Fu(bt)}Nn=null}else Nn=null;zn!==null&&Ap(ln,rn,zn,Nn,!1),Bn!==null&&Lr!==null&&Ap(ln,Lr,Bn,Nn,!0)}}e:{if(rn=kt?nl(kt):window,zn=rn.nodeName&&rn.nodeName.toLowerCase(),zn==="select"||zn==="input"&&rn.type==="file")var ii=ys;else if(jc(rn))if(Ah)ii=zu;else{ii=Ch;var Si=Fa}else(zn=rn.nodeName)&&zn.toLowerCase()==="input"&&(rn.type==="checkbox"||rn.type==="radio")&&(ii=vm);if(ii&&(ii=ii(d,kt))){Ih(ln,ii,w,en);break e}Si&&Si(d,rn,kt),d==="focusout"&&(Si=rn._wrapperState)&&Si.controlled&&rn.type==="number"&&Is(rn,"number",rn.value)}switch(Si=kt?nl(kt):window,d){case"focusin":(jc(Si)||Si.contentEditable==="true")&&(ga=Si,Vd=kt,Lu=null);break;case"focusout":Lu=Vd=ga=null;break;case"mousedown":Du=!0;break;case"contextmenu":case"mouseup":case"dragend":Du=!1,Yl(ln,w,en);break;case"selectionchange":if(Ff)break;case"keydown":case"keyup":Yl(ln,w,en)}var Mi;if(mc)e:{switch(d){case"compositionstart":var Bi="onCompositionStart";break e;case"compositionend":Bi="onCompositionEnd";break e;case"compositionupdate":Bi="onCompositionUpdate";break e}Bi=void 0}else On?Da(d,w)&&(Bi="onCompositionEnd"):d==="keydown"&&w.keyCode===229&&(Bi="onCompositionStart");Bi&&(Tl&&w.locale!=="ko"&&(On||Bi!=="onCompositionStart"?Bi==="onCompositionEnd"&&On&&(Mi=Au()):(wl=en,Iu="value"in wl?wl.value:wl.textContent,On=!0)),Si=ui(kt,Bi),0<Si.length&&(Bi=new Oi(Bi,d,null,w,en),ln.push({event:Bi,listeners:Si}),Mi?Bi.data=Mi:(Mi=Ja(w),Mi!==null&&(Bi.data=Mi)))),(Mi=La?an(d,w):Fd(d,w))&&(kt=ui(kt,"onBeforeInput"),0<kt.length&&(en=new Oi("onBeforeInput","beforeinput",null,w,en),ln.push({event:en,listeners:kt}),en.data=Mi))}Jl(ln,m)})}function Ba(d,m,w){return{instance:d,listener:m,currentTarget:w}}function ui(d,m){for(var w=m+"Capture",M=[];d!==null;){var B=d,W=B.stateNode;B.tag===5&&W!==null&&(B=W,W=qr(d,w),W!=null&&M.unshift(Ba(d,W,B)),W=qr(d,m),W!=null&&M.push(Ba(d,W,B))),d=d.return}return M}function Fu(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function Ap(d,m,w,M,B){for(var W=m._reactName,ce=[];w!==null&&w!==M;){var Fe=w,Ze=Fe.alternate,kt=Fe.stateNode;if(Ze!==null&&Ze===M)break;Fe.tag===5&&kt!==null&&(Fe=kt,B?(Ze=qr(w,W),Ze!=null&&ce.unshift(Ba(w,Ze,Fe))):B||(Ze=qr(w,W),Ze!=null&&ce.push(Ba(w,Ze,Fe)))),w=w.return}ce.length!==0&&d.push({event:m,listeners:ce})}var xm=/\r\n?/g,Nf=/\u0000|\uFFFD/g;function Cp(d){return(typeof d=="string"?d:""+d).replace(xm,`
`).replace(Nf,"")}function or(d,m,w){if(m=Cp(m),Cp(d)!==m&&w)throw Error(z(425))}function Wd(){}var qd=null,Oh=null;function Bu(d,m){return d==="textarea"||d==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Fh=typeof setTimeout=="function"?setTimeout:void 0,Wc=typeof clearTimeout=="function"?clearTimeout:void 0,qc=typeof Promise=="function"?Promise:void 0,Bh=typeof queueMicrotask=="function"?queueMicrotask:typeof qc<"u"?function(d){return qc.resolve(null).then(d).catch(Nu)}:Fh;function Nu(d){setTimeout(function(){throw d})}function Zd(d,m){var w=m,M=0;do{var B=w.nextSibling;if(d.removeChild(w),B&&B.nodeType===8)if(w=B.data,w==="/$"){if(M===0){d.removeChild(B),Hl(m);return}M--}else w!=="$"&&w!=="$?"&&w!=="$!"||M++;w=B}while(w);Hl(m)}function El(d){for(;d!=null;d=d.nextSibling){var m=d.nodeType;if(m===1||m===3)break;if(m===8){if(m=d.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return d}function jf(d){d=d.previousSibling;for(var m=0;d;){if(d.nodeType===8){var w=d.data;if(w==="$"||w==="$!"||w==="$?"){if(m===0)return d;m--}else w==="/$"&&m++}d=d.previousSibling}return null}var el=Math.random().toString(36).slice(2),_a="__reactFiber$"+el,yc="__reactProps$"+el,tl="__reactContainer$"+el,ju="__reactEvents$"+el,Nh="__reactListeners$"+el,Mp="__reactHandles$"+el;function vc(d){var m=d[_a];if(m)return m;for(var w=d.parentNode;w;){if(m=w[tl]||w[_a]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(d=jf(d);d!==null;){if(w=d[_a])return w;d=jf(d)}return m}d=w,w=d.parentNode}return null}function Vu(d){return d=d[_a]||d[tl],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function nl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(z(33))}function jh(d){return d[yc]||null}var Vf=[],Uu=-1;function xc(d){return{current:d}}function Vr(d){0>Uu||(d.current=Vf[Uu],Vf[Uu]=null,Uu--)}function Fr(d,m){Uu++,Vf[Uu]=d.current,d.current=m}var Il={},Yo=xc(Il),Ds=xc(!1),Al=Il;function Ql(d,m){var w=d.type.contextTypes;if(!w)return Il;var M=d.stateNode;if(M&&M.__reactInternalMemoizedUnmaskedChildContext===m)return M.__reactInternalMemoizedMaskedChildContext;var B={},W;for(W in w)B[W]=m[W];return M&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=m,d.__reactInternalMemoizedMaskedChildContext=B),B}function Bo(d){return d=d.childContextTypes,d!=null}function wc(){Vr(Ds),Vr(Yo)}function Uf(d,m,w){if(Yo.current!==Il)throw Error(z(168));Fr(Yo,m),Fr(Ds,w)}function ea(d,m,w){var M=d.stateNode;if(m=m.childContextTypes,typeof M.getChildContext!="function")return w;M=M.getChildContext();for(var B in M)if(!(B in m))throw Error(z(108,cn(d)||"Unknown",B));return sn({},w,M)}function Zc(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Il,Al=Yo.current,Fr(Yo,d),Fr(Ds,Ds.current),!0}function Gu(d,m,w){var M=d.stateNode;if(!M)throw Error(z(169));w?(d=ea(d,m,Al),M.__reactInternalMemoizedMergedChildContext=d,Vr(Ds),Vr(Yo),Fr(Yo,d)):Vr(Ds),Fr(Ds,w)}var rs=null,Xc=!1,$u=!1;function Xd(d){rs===null?rs=[d]:rs.push(d)}function Hu(d){Xc=!0,Xd(d)}function Na(){if(!$u&&rs!==null){$u=!0;var d=0,m=mr;try{var w=rs;for(mr=1;d<w.length;d++){var M=w[d];do M=M(!0);while(M!==null)}rs=null,Xc=!1}catch(B){throw rs!==null&&(rs=rs.slice(d+1)),Ve(Vn,Na),B}finally{mr=m,$u=!1}}return null}var Cl=[],ec=0,Wu=null,qu=0,ta=[],os=0,Yc=null,tc=1,Ml="";function bc(d,m){Cl[ec++]=qu,Cl[ec++]=Wu,Wu=d,qu=m}function Vh(d,m,w){ta[os++]=tc,ta[os++]=Ml,ta[os++]=Yc,Yc=d;var M=tc;d=Ml;var B=32-Zi(M)-1;M&=~(1<<B),w+=1;var W=32-Zi(m)+B;if(30<W){var ce=B-B%5;W=(M&(1<<ce)-1).toString(32),M>>=ce,B-=ce,tc=1<<32-Zi(m)+B|w<<B|M,Ml=W+d}else tc=1<<W|w<<B|M,Ml=d}function Gf(d){d.return!==null&&(bc(d,1),Vh(d,1,0))}function Zu(d){for(;d===Wu;)Wu=Cl[--ec],Cl[ec]=null,qu=Cl[--ec],Cl[ec]=null;for(;d===Yc;)Yc=ta[--os],ta[os]=null,Ml=ta[--os],ta[os]=null,tc=ta[--os],ta[os]=null}var Os=null,na=null,zr=!1,ya=null;function Yd(d,m){var w=An(5,null,null,0);w.elementType="DELETED",w.stateNode=m,w.return=d,m=d.deletions,m===null?(d.deletions=[w],d.flags|=16):m.push(w)}function $f(d,m){switch(d.tag){case 5:var w=d.type;return m=m.nodeType!==1||w.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(d.stateNode=m,Os=d,na=El(m.firstChild),!0):!1;case 6:return m=d.pendingProps===""||m.nodeType!==3?null:m,m!==null?(d.stateNode=m,Os=d,na=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(w=Yc!==null?{id:tc,overflow:Ml}:null,d.memoizedState={dehydrated:m,treeContext:w,retryLane:1073741824},w=An(18,null,null,0),w.stateNode=m,w.return=d,d.child=w,Os=d,na=null,!0):!1;default:return!1}}function Uh(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Pl(d){if(zr){var m=na;if(m){var w=m;if(!$f(d,m)){if(Uh(d))throw Error(z(418));m=El(w.nextSibling);var M=Os;m&&$f(d,m)?Yd(M,w):(d.flags=d.flags&-4097|2,zr=!1,Os=d)}}else{if(Uh(d))throw Error(z(418));d.flags=d.flags&-4097|2,zr=!1,Os=d}}}function Tc(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Os=d}function Kc(d){if(d!==Os)return!1;if(!zr)return Tc(d),zr=!0,!1;var m;if((m=d.tag!==3)&&!(m=d.tag!==5)&&(m=d.type,m=m!=="head"&&m!=="body"&&!Bu(d.type,d.memoizedProps)),m&&(m=na)){if(Uh(d))throw Hf(),Error(z(418));for(;m;)Yd(d,m),m=El(m.nextSibling)}if(Tc(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(z(317));e:{for(d=d.nextSibling,m=0;d;){if(d.nodeType===8){var w=d.data;if(w==="/$"){if(m===0){na=El(d.nextSibling);break e}m--}else w!=="$"&&w!=="$!"&&w!=="$?"||m++}d=d.nextSibling}na=null}}else na=Os?El(d.stateNode.nextSibling):null;return!0}function Hf(){for(var d=na;d;)d=El(d.nextSibling)}function va(){na=Os=null,zr=!1}function Gh(d){ya===null?ya=[d]:ya.push(d)}var $h=Ct.ReactCurrentBatchConfig;function Xu(d,m,w){if(d=w.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(z(309));var M=w.stateNode}if(!M)throw Error(z(147,d));var B=M,W=""+d;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===W?m.ref:(m=function(ce){var Fe=B.refs;ce===null?delete Fe[W]:Fe[W]=ce},m._stringRef=W,m)}if(typeof d!="string")throw Error(z(284));if(!w._owner)throw Error(z(290,d))}return d}function Hh(d,m){throw d=Object.prototype.toString.call(m),Error(z(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d))}function Wh(d){var m=d._init;return m(d._payload)}function qh(d){function m(bt,at){if(d){var Et=bt.deletions;Et===null?(bt.deletions=[at],bt.flags|=16):Et.push(at)}}function w(bt,at){if(!d)return null;for(;at!==null;)m(bt,at),at=at.sibling;return null}function M(bt,at){for(bt=new Map;at!==null;)at.key!==null?bt.set(at.key,at):bt.set(at.index,at),at=at.sibling;return bt}function B(bt,at){return bt=Kt(bt,at),bt.index=0,bt.sibling=null,bt}function W(bt,at,Et){return bt.index=Et,d?(Et=bt.alternate,Et!==null?(Et=Et.index,Et<at?(bt.flags|=2,at):Et):(bt.flags|=2,at)):(bt.flags|=1048576,at)}function ce(bt){return d&&bt.alternate===null&&(bt.flags|=2),bt}function Fe(bt,at,Et,vn){return at===null||at.tag!==6?(at=ji(Et,bt.mode,vn),at.return=bt,at):(at=B(at,Et),at.return=bt,at)}function Ze(bt,at,Et,vn){var ii=Et.type;return ii===jt?en(bt,at,Et.props.children,vn,Et.key):at!==null&&(at.elementType===ii||typeof ii=="object"&&ii!==null&&ii.$$typeof===Wt&&Wh(ii)===at.type)?(vn=B(at,Et.props),vn.ref=Xu(bt,at,Et),vn.return=bt,vn):(vn=wi(Et.type,Et.key,Et.props,null,bt.mode,vn),vn.ref=Xu(bt,at,Et),vn.return=bt,vn)}function kt(bt,at,Et,vn){return at===null||at.tag!==4||at.stateNode.containerInfo!==Et.containerInfo||at.stateNode.implementation!==Et.implementation?(at=Fi(Et,bt.mode,vn),at.return=bt,at):(at=B(at,Et.children||[]),at.return=bt,at)}function en(bt,at,Et,vn,ii){return at===null||at.tag!==7?(at=Mn(Et,bt.mode,vn,ii),at.return=bt,at):(at=B(at,Et),at.return=bt,at)}function ln(bt,at,Et){if(typeof at=="string"&&at!==""||typeof at=="number")return at=ji(""+at,bt.mode,Et),at.return=bt,at;if(typeof at=="object"&&at!==null){switch(at.$$typeof){case tt:return Et=wi(at.type,at.key,at.props,null,bt.mode,Et),Et.ref=Xu(bt,null,at),Et.return=bt,Et;case Nt:return at=Fi(at,bt.mode,Et),at.return=bt,at;case Wt:var vn=at._init;return ln(bt,vn(at._payload),Et)}if(Ca(at)||mn(at))return at=Mn(at,bt.mode,Et,null),at.return=bt,at;Hh(bt,at)}return null}function rn(bt,at,Et,vn){var ii=at!==null?at.key:null;if(typeof Et=="string"&&Et!==""||typeof Et=="number")return ii!==null?null:Fe(bt,at,""+Et,vn);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case tt:return Et.key===ii?Ze(bt,at,Et,vn):null;case Nt:return Et.key===ii?kt(bt,at,Et,vn):null;case Wt:return ii=Et._init,rn(bt,at,ii(Et._payload),vn)}if(Ca(Et)||mn(Et))return ii!==null?null:en(bt,at,Et,vn,null);Hh(bt,Et)}return null}function zn(bt,at,Et,vn,ii){if(typeof vn=="string"&&vn!==""||typeof vn=="number")return bt=bt.get(Et)||null,Fe(at,bt,""+vn,ii);if(typeof vn=="object"&&vn!==null){switch(vn.$$typeof){case tt:return bt=bt.get(vn.key===null?Et:vn.key)||null,Ze(at,bt,vn,ii);case Nt:return bt=bt.get(vn.key===null?Et:vn.key)||null,kt(at,bt,vn,ii);case Wt:var Si=vn._init;return zn(bt,at,Et,Si(vn._payload),ii)}if(Ca(vn)||mn(vn))return bt=bt.get(Et)||null,en(at,bt,vn,ii,null);Hh(at,vn)}return null}function Bn(bt,at,Et,vn){for(var ii=null,Si=null,Mi=at,Bi=at=0,ts=null;Mi!==null&&Bi<Et.length;Bi++){Mi.index>Bi?(ts=Mi,Mi=null):ts=Mi.sibling;var Ir=rn(bt,Mi,Et[Bi],vn);if(Ir===null){Mi===null&&(Mi=ts);break}d&&Mi&&Ir.alternate===null&&m(bt,Mi),at=W(Ir,at,Bi),Si===null?ii=Ir:Si.sibling=Ir,Si=Ir,Mi=ts}if(Bi===Et.length)return w(bt,Mi),zr&&bc(bt,Bi),ii;if(Mi===null){for(;Bi<Et.length;Bi++)Mi=ln(bt,Et[Bi],vn),Mi!==null&&(at=W(Mi,at,Bi),Si===null?ii=Mi:Si.sibling=Mi,Si=Mi);return zr&&bc(bt,Bi),ii}for(Mi=M(bt,Mi);Bi<Et.length;Bi++)ts=zn(Mi,bt,Bi,Et[Bi],vn),ts!==null&&(d&&ts.alternate!==null&&Mi.delete(ts.key===null?Bi:ts.key),at=W(ts,at,Bi),Si===null?ii=ts:Si.sibling=ts,Si=ts);return d&&Mi.forEach(function(lu){return m(bt,lu)}),zr&&bc(bt,Bi),ii}function Nn(bt,at,Et,vn){var ii=mn(Et);if(typeof ii!="function")throw Error(z(150));if(Et=ii.call(Et),Et==null)throw Error(z(151));for(var Si=ii=null,Mi=at,Bi=at=0,ts=null,Ir=Et.next();Mi!==null&&!Ir.done;Bi++,Ir=Et.next()){Mi.index>Bi?(ts=Mi,Mi=null):ts=Mi.sibling;var lu=rn(bt,Mi,Ir.value,vn);if(lu===null){Mi===null&&(Mi=ts);break}d&&Mi&&lu.alternate===null&&m(bt,Mi),at=W(lu,at,Bi),Si===null?ii=lu:Si.sibling=lu,Si=lu,Mi=ts}if(Ir.done)return w(bt,Mi),zr&&bc(bt,Bi),ii;if(Mi===null){for(;!Ir.done;Bi++,Ir=Et.next())Ir=ln(bt,Ir.value,vn),Ir!==null&&(at=W(Ir,at,Bi),Si===null?ii=Ir:Si.sibling=Ir,Si=Ir);return zr&&bc(bt,Bi),ii}for(Mi=M(bt,Mi);!Ir.done;Bi++,Ir=Et.next())Ir=zn(Mi,bt,Bi,Ir.value,vn),Ir!==null&&(d&&Ir.alternate!==null&&Mi.delete(Ir.key===null?Bi:Ir.key),at=W(Ir,at,Bi),Si===null?ii=Ir:Si.sibling=Ir,Si=Ir);return d&&Mi.forEach(function(Tg){return m(bt,Tg)}),zr&&bc(bt,Bi),ii}function Lr(bt,at,Et,vn){if(typeof Et=="object"&&Et!==null&&Et.type===jt&&Et.key===null&&(Et=Et.props.children),typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case tt:e:{for(var ii=Et.key,Si=at;Si!==null;){if(Si.key===ii){if(ii=Et.type,ii===jt){if(Si.tag===7){w(bt,Si.sibling),at=B(Si,Et.props.children),at.return=bt,bt=at;break e}}else if(Si.elementType===ii||typeof ii=="object"&&ii!==null&&ii.$$typeof===Wt&&Wh(ii)===Si.type){w(bt,Si.sibling),at=B(Si,Et.props),at.ref=Xu(bt,Si,Et),at.return=bt,bt=at;break e}w(bt,Si);break}else m(bt,Si);Si=Si.sibling}Et.type===jt?(at=Mn(Et.props.children,bt.mode,vn,Et.key),at.return=bt,bt=at):(vn=wi(Et.type,Et.key,Et.props,null,bt.mode,vn),vn.ref=Xu(bt,at,Et),vn.return=bt,bt=vn)}return ce(bt);case Nt:e:{for(Si=Et.key;at!==null;){if(at.key===Si)if(at.tag===4&&at.stateNode.containerInfo===Et.containerInfo&&at.stateNode.implementation===Et.implementation){w(bt,at.sibling),at=B(at,Et.children||[]),at.return=bt,bt=at;break e}else{w(bt,at);break}else m(bt,at);at=at.sibling}at=Fi(Et,bt.mode,vn),at.return=bt,bt=at}return ce(bt);case Wt:return Si=Et._init,Lr(bt,at,Si(Et._payload),vn)}if(Ca(Et))return Bn(bt,at,Et,vn);if(mn(Et))return Nn(bt,at,Et,vn);Hh(bt,Et)}return typeof Et=="string"&&Et!==""||typeof Et=="number"?(Et=""+Et,at!==null&&at.tag===6?(w(bt,at.sibling),at=B(at,Et),at.return=bt,bt=at):(w(bt,at),at=ji(Et,bt.mode,vn),at.return=bt,bt=at),ce(bt)):w(bt,at)}return Lr}var Jc=qh(!0),Wf=qh(!1),xa=xc(null),Kd=null,Yu=null,Jd=null;function Qd(){Jd=Yu=Kd=null}function Ku(d){var m=xa.current;Vr(xa),d._currentValue=m}function Qc(d,m,w){for(;d!==null;){var M=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,M!==null&&(M.childLanes|=m)):M!==null&&(M.childLanes&m)!==m&&(M.childLanes|=m),d===w)break;d=d.return}}function wa(d,m){Kd=d,Jd=Yu=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&m)!==0&&(cs=!0),d.firstContext=null)}function ss(d){var m=d._currentValue;if(Jd!==d)if(d={context:d,memoizedValue:m,next:null},Yu===null){if(Kd===null)throw Error(z(308));Yu=d,Kd.dependencies={lanes:0,firstContext:d}}else Yu=Yu.next=d;return m}var ba=null;function Zh(d){ba===null?ba=[d]:ba.push(d)}function Xh(d,m,w,M){var B=m.interleaved;return B===null?(w.next=w,Zh(m)):(w.next=B.next,B.next=w),m.interleaved=w,No(d,M)}function No(d,m){d.lanes|=m;var w=d.alternate;for(w!==null&&(w.lanes|=m),w=d,d=d.return;d!==null;)d.childLanes|=m,w=d.alternate,w!==null&&(w.childLanes|=m),w=d,d=d.return;return w.tag===3?w.stateNode:null}var Rl=!1;function ef(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qf(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function ia(d,m){return{eventTime:d,lane:m,tag:0,payload:null,callback:null,next:null}}function ra(d,m,w){var M=d.updateQueue;if(M===null)return null;if(M=M.shared,(Sr&2)!==0){var B=M.pending;return B===null?m.next=m:(m.next=B.next,B.next=m),M.pending=m,No(d,w)}return B=M.interleaved,B===null?(m.next=m,Zh(M)):(m.next=B.next,B.next=m),M.interleaved=m,No(d,w)}function qt(d,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194240)!==0)){var M=m.lanes;M&=d.pendingLanes,w|=M,m.lanes=w,Gl(d,w)}}function Ju(d,m){var w=d.updateQueue,M=d.alternate;if(M!==null&&(M=M.updateQueue,w===M)){var B=null,W=null;if(w=w.firstBaseUpdate,w!==null){do{var ce={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};W===null?B=W=ce:W=W.next=ce,w=w.next}while(w!==null);W===null?B=W=m:W=W.next=m}else B=W=m;w={baseState:M.baseState,firstBaseUpdate:B,lastBaseUpdate:W,shared:M.shared,effects:M.effects},d.updateQueue=w;return}d=w.lastBaseUpdate,d===null?w.firstBaseUpdate=m:d.next=m,w.lastBaseUpdate=m}function ja(d,m,w,M){var B=d.updateQueue;Rl=!1;var W=B.firstBaseUpdate,ce=B.lastBaseUpdate,Fe=B.shared.pending;if(Fe!==null){B.shared.pending=null;var Ze=Fe,kt=Ze.next;Ze.next=null,ce===null?W=kt:ce.next=kt,ce=Ze;var en=d.alternate;en!==null&&(en=en.updateQueue,Fe=en.lastBaseUpdate,Fe!==ce&&(Fe===null?en.firstBaseUpdate=kt:Fe.next=kt,en.lastBaseUpdate=Ze))}if(W!==null){var ln=B.baseState;ce=0,en=kt=Ze=null,Fe=W;do{var rn=Fe.lane,zn=Fe.eventTime;if((M&rn)===rn){en!==null&&(en=en.next={eventTime:zn,lane:0,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null});e:{var Bn=d,Nn=Fe;switch(rn=m,zn=w,Nn.tag){case 1:if(Bn=Nn.payload,typeof Bn=="function"){ln=Bn.call(zn,ln,rn);break e}ln=Bn;break e;case 3:Bn.flags=Bn.flags&-65537|128;case 0:if(Bn=Nn.payload,rn=typeof Bn=="function"?Bn.call(zn,ln,rn):Bn,rn==null)break e;ln=sn({},ln,rn);break e;case 2:Rl=!0}}Fe.callback!==null&&Fe.lane!==0&&(d.flags|=64,rn=B.effects,rn===null?B.effects=[Fe]:rn.push(Fe))}else zn={eventTime:zn,lane:rn,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null},en===null?(kt=en=zn,Ze=ln):en=en.next=zn,ce|=rn;if(Fe=Fe.next,Fe===null){if(Fe=B.shared.pending,Fe===null)break;rn=Fe,Fe=rn.next,rn.next=null,B.lastBaseUpdate=rn,B.shared.pending=null}}while(!0);if(en===null&&(Ze=ln),B.baseState=Ze,B.firstBaseUpdate=kt,B.lastBaseUpdate=en,m=B.shared.interleaved,m!==null){B=m;do ce|=B.lane,B=B.next;while(B!==m)}else W===null&&(B.shared.lanes=0);lc|=ce,d.lanes=ce,d.memoizedState=ln}}function nc(d,m,w){if(d=m.effects,m.effects=null,d!==null)for(m=0;m<d.length;m++){var M=d[m],B=M.callback;if(B!==null){if(M.callback=null,M=w,typeof B!="function")throw Error(z(191,B));B.call(M)}}}var yn={},oa=xc(yn),eu=xc(yn),Qu=xc(yn);function kl(d){if(d===yn)throw Error(z(174));return d}function eh(d,m){switch(Fr(Qu,m),Fr(eu,d),Fr(oa,yn),d=m.nodeType,d){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:As(null,"");break;default:d=d===8?m.parentNode:m,m=d.namespaceURI||null,d=d.tagName,m=As(m,d)}Vr(oa),Fr(oa,m)}function ic(){Vr(oa),Vr(eu),Vr(Qu)}function tf(d){kl(Qu.current);var m=kl(oa.current),w=As(m,d.type);m!==w&&(Fr(eu,d),Fr(oa,w))}function il(d){eu.current===d&&(Vr(oa),Vr(eu))}var po=xc(0);function as(d){for(var m=d;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Yh=[];function Ko(){for(var d=0;d<Yh.length;d++)Yh[d]._workInProgressVersionPrimary=null;Yh.length=0}var Va=Ct.ReactCurrentDispatcher,tu=Ct.ReactCurrentBatchConfig,zl=0,Xr=null,mo=null,jo=null,Ua=!1,Xi=!1,Sc=0,Zf=0;function ls(){throw Error(z(321))}function nf(d,m){if(m===null)return!1;for(var w=0;w<m.length&&w<d.length;w++)if(!Ls(d[w],m[w]))return!1;return!0}function rf(d,m,w,M,B,W){if(zl=W,Xr=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Va.current=d===null||d.memoizedState===null?Lp:Ac,d=w(M,B),Xi){W=0;do{if(Xi=!1,Sc=0,25<=W)throw Error(z(301));W+=1,jo=mo=null,m.updateQueue=null,Va.current=rh,d=w(M,B)}while(Xi)}if(Va.current=ni,m=mo!==null&&mo.next!==null,zl=0,jo=mo=Xr=null,Ua=!1,m)throw Error(z(300));return d}function of(){var d=Sc!==0;return Sc=0,d}function vs(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jo===null?Xr.memoizedState=jo=d:jo=jo.next=d,jo}function Jo(){if(mo===null){var d=Xr.alternate;d=d!==null?d.memoizedState:null}else d=mo.next;var m=jo===null?Xr.memoizedState:jo.next;if(m!==null)jo=m,mo=d;else{if(d===null)throw Error(z(310));mo=d,d={memoizedState:mo.memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},jo===null?Xr.memoizedState=jo=d:jo=jo.next=d}return jo}function Tt(d,m){return typeof m=="function"?m(d):m}function Dt(d){var m=Jo(),w=m.queue;if(w===null)throw Error(z(311));w.lastRenderedReducer=d;var M=mo,B=M.baseQueue,W=w.pending;if(W!==null){if(B!==null){var ce=B.next;B.next=W.next,W.next=ce}M.baseQueue=B=W,w.pending=null}if(B!==null){W=B.next,M=M.baseState;var Fe=ce=null,Ze=null,kt=W;do{var en=kt.lane;if((zl&en)===en)Ze!==null&&(Ze=Ze.next={lane:0,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null}),M=kt.hasEagerState?kt.eagerState:d(M,kt.action);else{var ln={lane:en,action:kt.action,hasEagerState:kt.hasEagerState,eagerState:kt.eagerState,next:null};Ze===null?(Fe=Ze=ln,ce=M):Ze=Ze.next=ln,Xr.lanes|=en,lc|=en}kt=kt.next}while(kt!==null&&kt!==W);Ze===null?ce=M:Ze.next=Fe,Ls(M,m.memoizedState)||(cs=!0),m.memoizedState=M,m.baseState=ce,m.baseQueue=Ze,w.lastRenderedState=M}if(d=w.interleaved,d!==null){B=d;do W=B.lane,Xr.lanes|=W,lc|=W,B=B.next;while(B!==d)}else B===null&&(w.lanes=0);return[m.memoizedState,w.dispatch]}function rc(d){var m=Jo(),w=m.queue;if(w===null)throw Error(z(311));w.lastRenderedReducer=d;var M=w.dispatch,B=w.pending,W=m.memoizedState;if(B!==null){w.pending=null;var ce=B=B.next;do W=d(W,ce.action),ce=ce.next;while(ce!==B);Ls(W,m.memoizedState)||(cs=!0),m.memoizedState=W,m.baseQueue===null&&(m.baseState=W),w.lastRenderedState=W}return[W,M]}function Tr(){}function Le(d,m){var w=Xr,M=Jo(),B=m(),W=!Ls(M.memoizedState,B);if(W&&(M.memoizedState=B,cs=!0),M=M.queue,th(rl.bind(null,w,M,d),[d]),M.getSnapshot!==m||W||jo!==null&&jo.memoizedState.tag&1){if(w.flags|=2048,Ll(9,Kh.bind(null,w,M,B,m),void 0,null),Qo===null)throw Error(z(349));(zl&30)!==0||Xf(w,m,B)}return B}function Xf(d,m,w){d.flags|=16384,d={getSnapshot:m,value:w},m=Xr.updateQueue,m===null?(m={lastEffect:null,stores:null},Xr.updateQueue=m,m.stores=[d]):(w=m.stores,w===null?m.stores=[d]:w.push(d))}function Kh(d,m,w,M){m.value=w,m.getSnapshot=M,Jh(m)&&Ec(d)}function rl(d,m,w){return w(function(){Jh(m)&&Ec(d)})}function Jh(d){var m=d.getSnapshot;d=d.value;try{var w=m();return!Ls(d,w)}catch{return!0}}function Ec(d){var m=No(d,1);m!==null&&j(m,d,1,-1)}function Yf(d){var m=vs();return typeof d=="function"&&(d=d()),m.memoizedState=m.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tt,lastRenderedState:d},m.queue=d,d=d.dispatch=kp.bind(null,Xr,d),[m.memoizedState,d]}function Ll(d,m,w,M){return d={tag:d,create:m,destroy:w,deps:M,next:null},m=Xr.updateQueue,m===null?(m={lastEffect:null,stores:null},Xr.updateQueue=m,m.lastEffect=d.next=d):(w=m.lastEffect,w===null?m.lastEffect=d.next=d:(M=w.next,w.next=d,d.next=M,m.lastEffect=d)),d}function Pp(){return Jo().memoizedState}function sf(d,m,w,M){var B=vs();Xr.flags|=d,B.memoizedState=Ll(1|m,w,void 0,M===void 0?null:M)}function Qh(d,m,w,M){var B=Jo();M=M===void 0?null:M;var W=void 0;if(mo!==null){var ce=mo.memoizedState;if(W=ce.destroy,M!==null&&nf(M,ce.deps)){B.memoizedState=Ll(m,w,W,M);return}}Xr.flags|=d,B.memoizedState=Ll(1|m,w,W,M)}function ed(d,m){return sf(8390656,8,d,m)}function th(d,m){return Qh(2048,8,d,m)}function td(d,m){return Qh(4,2,d,m)}function nd(d,m){return Qh(4,4,d,m)}function nh(d,m){if(typeof m=="function")return d=d(),m(d),function(){m(null)};if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function Ic(d,m,w){return w=w!=null?w.concat([d]):null,Qh(4,4,nh.bind(null,m,d),w)}function Ta(){}function Kf(d,m){var w=Jo();m=m===void 0?null:m;var M=w.memoizedState;return M!==null&&m!==null&&nf(m,M[1])?M[0]:(w.memoizedState=[d,m],d)}function Jf(d,m){var w=Jo();m=m===void 0?null:m;var M=w.memoizedState;return M!==null&&m!==null&&nf(m,M[1])?M[0]:(d=d(),w.memoizedState=[d,m],d)}function Qf(d,m,w){return(zl&21)===0?(d.baseState&&(d.baseState=!1,cs=!0),d.memoizedState=w):(Ls(w,m)||(w=qs(),Xr.lanes|=w,lc|=w,d.baseState=!0),m)}function Rp(d,m){var w=mr;mr=w!==0&&4>w?w:4,d(!0);var M=tu.transition;tu.transition={};try{d(!1),m()}finally{mr=w,tu.transition=M}}function ol(){return Jo().memoizedState}function xs(d,m,w){var M=V(d);if(w={lane:M,action:w,hasEagerState:!1,eagerState:null,next:null},ih(d))zp(m,w);else if(w=Xh(d,m,w,M),w!==null){var B=D();j(w,d,M,B),cr(w,m,M)}}function kp(d,m,w){var M=V(d),B={lane:M,action:w,hasEagerState:!1,eagerState:null,next:null};if(ih(d))zp(m,B);else{var W=d.alternate;if(d.lanes===0&&(W===null||W.lanes===0)&&(W=m.lastRenderedReducer,W!==null))try{var ce=m.lastRenderedState,Fe=W(ce,w);if(B.hasEagerState=!0,B.eagerState=Fe,Ls(Fe,ce)){var Ze=m.interleaved;Ze===null?(B.next=B,Zh(m)):(B.next=Ze.next,Ze.next=B),m.interleaved=B;return}}catch{}finally{}w=Xh(d,m,B,M),w!==null&&(B=D(),j(w,d,M,B),cr(w,m,M))}}function ih(d){var m=d.alternate;return d===Xr||m!==null&&m===Xr}function zp(d,m){Xi=Ua=!0;var w=d.pending;w===null?m.next=m:(m.next=w.next,w.next=m),d.pending=m}function cr(d,m,w){if((w&4194240)!==0){var M=m.lanes;M&=d.pendingLanes,w|=M,m.lanes=w,Gl(d,w)}}var ni={readContext:ss,useCallback:ls,useContext:ls,useEffect:ls,useImperativeHandle:ls,useInsertionEffect:ls,useLayoutEffect:ls,useMemo:ls,useReducer:ls,useRef:ls,useState:ls,useDebugValue:ls,useDeferredValue:ls,useTransition:ls,useMutableSource:ls,useSyncExternalStore:ls,useId:ls,unstable_isNewReconciler:!1},Lp={readContext:ss,useCallback:function(d,m){return vs().memoizedState=[d,m===void 0?null:m],d},useContext:ss,useEffect:ed,useImperativeHandle:function(d,m,w){return w=w!=null?w.concat([d]):null,sf(4194308,4,nh.bind(null,m,d),w)},useLayoutEffect:function(d,m){return sf(4194308,4,d,m)},useInsertionEffect:function(d,m){return sf(4,2,d,m)},useMemo:function(d,m){var w=vs();return m=m===void 0?null:m,d=d(),w.memoizedState=[d,m],d},useReducer:function(d,m,w){var M=vs();return m=w!==void 0?w(m):m,M.memoizedState=M.baseState=m,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:m},M.queue=d,d=d.dispatch=xs.bind(null,Xr,d),[M.memoizedState,d]},useRef:function(d){var m=vs();return d={current:d},m.memoizedState=d},useState:Yf,useDebugValue:Ta,useDeferredValue:function(d){return vs().memoizedState=d},useTransition:function(){var d=Yf(!1),m=d[0];return d=Rp.bind(null,d[1]),vs().memoizedState=d,[m,d]},useMutableSource:function(){},useSyncExternalStore:function(d,m,w){var M=Xr,B=vs();if(zr){if(w===void 0)throw Error(z(407));w=w()}else{if(w=m(),Qo===null)throw Error(z(349));(zl&30)!==0||Xf(M,m,w)}B.memoizedState=w;var W={value:w,getSnapshot:m};return B.queue=W,ed(rl.bind(null,M,W,d),[d]),M.flags|=2048,Ll(9,Kh.bind(null,M,W,w,m),void 0,null),w},useId:function(){var d=vs(),m=Qo.identifierPrefix;if(zr){var w=Ml,M=tc;w=(M&~(1<<32-Zi(M)-1)).toString(32)+w,m=":"+m+"R"+w,w=Sc++,0<w&&(m+="H"+w.toString(32)),m+=":"}else w=Zf++,m=":"+m+"r"+w.toString(32)+":";return d.memoizedState=m},unstable_isNewReconciler:!1},Ac={readContext:ss,useCallback:Kf,useContext:ss,useEffect:th,useImperativeHandle:Ic,useInsertionEffect:td,useLayoutEffect:nd,useMemo:Jf,useReducer:Dt,useRef:Pp,useState:function(){return Dt(Tt)},useDebugValue:Ta,useDeferredValue:function(d){var m=Jo();return Qf(m,mo.memoizedState,d)},useTransition:function(){var d=Dt(Tt)[0],m=Jo().memoizedState;return[d,m]},useMutableSource:Tr,useSyncExternalStore:Le,useId:ol,unstable_isNewReconciler:!1},rh={readContext:ss,useCallback:Kf,useContext:ss,useEffect:th,useImperativeHandle:Ic,useInsertionEffect:td,useLayoutEffect:nd,useMemo:Jf,useReducer:rc,useRef:Pp,useState:function(){return rc(Tt)},useDebugValue:Ta,useDeferredValue:function(d){var m=Jo();return mo===null?m.memoizedState=d:Qf(m,mo.memoizedState,d)},useTransition:function(){var d=rc(Tt)[0],m=Jo().memoizedState;return[d,m]},useMutableSource:Tr,useSyncExternalStore:Le,useId:ol,unstable_isNewReconciler:!1};function ws(d,m){if(d&&d.defaultProps){m=sn({},m),d=d.defaultProps;for(var w in d)m[w]===void 0&&(m[w]=d[w]);return m}return m}function sl(d,m,w,M){m=d.memoizedState,w=w(M,m),w=w==null?m:sn({},m,w),d.memoizedState=w,d.lanes===0&&(d.updateQueue.baseState=w)}var oh={isMounted:function(d){return(d=d._reactInternals)?se(d)===d:!1},enqueueSetState:function(d,m,w){d=d._reactInternals;var M=D(),B=V(d),W=ia(M,B);W.payload=m,w!=null&&(W.callback=w),m=ra(d,W,B),m!==null&&(j(m,d,B,M),qt(m,d,B))},enqueueReplaceState:function(d,m,w){d=d._reactInternals;var M=D(),B=V(d),W=ia(M,B);W.tag=1,W.payload=m,w!=null&&(W.callback=w),m=ra(d,W,B),m!==null&&(j(m,d,B,M),qt(m,d,B))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var w=D(),M=V(d),B=ia(w,M);B.tag=2,m!=null&&(B.callback=m),m=ra(d,B,M),m!==null&&(j(m,d,M,w),qt(m,d,M))}};function af(d,m,w,M,B,W,ce){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(M,W,ce):m.prototype&&m.prototype.isPureReactComponent?!ma(w,M)||!ma(B,W):!0}function lf(d,m,w){var M=!1,B=Il,W=m.contextType;return typeof W=="object"&&W!==null?W=ss(W):(B=Bo(m)?Al:Yo.current,M=m.contextTypes,W=(M=M!=null)?Ql(d,B):Il),m=new m(w,W),d.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=oh,d.stateNode=m,m._reactInternals=d,M&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=B,d.__reactInternalMemoizedMaskedChildContext=W),m}function id(d,m,w,M){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,M),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,M),m.state!==d&&oh.enqueueReplaceState(m,m.state,null)}function Fs(d,m,w,M){var B=d.stateNode;B.props=w,B.state=d.memoizedState,B.refs={},ef(d);var W=m.contextType;typeof W=="object"&&W!==null?B.context=ss(W):(W=Bo(m)?Al:Yo.current,B.context=Ql(d,W)),B.state=d.memoizedState,W=m.getDerivedStateFromProps,typeof W=="function"&&(sl(d,m,W,w),B.state=d.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(m=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),m!==B.state&&oh.enqueueReplaceState(B,B.state,null),ja(d,w,B,M),B.state=d.memoizedState),typeof B.componentDidMount=="function"&&(d.flags|=4194308)}function ko(d,m){try{var w="",M=m;do w+=jn(M),M=M.return;while(M);var B=w}catch(W){B=`
Error generating stack: `+W.message+`
`+W.stack}return{value:d,source:m,stack:B,digest:null}}function oc(d,m,w){return{value:d,source:null,stack:w??null,digest:m??null}}function sh(d,m){try{console.error(m.value)}catch(w){setTimeout(function(){throw w})}}var ep=typeof WeakMap=="function"?WeakMap:Map;function cf(d,m,w){w=ia(-1,w),w.tag=3,w.payload={element:null};var M=m.value;return w.callback=function(){c||(c=!0,f=M),sh(d,m)},w}function sc(d,m,w){w=ia(-1,w),w.tag=3;var M=d.type.getDerivedStateFromError;if(typeof M=="function"){var B=m.value;w.payload=function(){return M(B)},w.callback=function(){sh(d,m)}}var W=d.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(w.callback=function(){sh(d,m),typeof M!="function"&&(g===null?g=new Set([this]):g.add(this));var ce=m.stack;this.componentDidCatch(m.value,{componentStack:ce!==null?ce:""})}),w}function rd(d,m,w){var M=d.pingCache;if(M===null){M=d.pingCache=new ep;var B=new Set;M.set(m,B)}else B=M.get(m),B===void 0&&(B=new Set,M.set(m,B));B.has(w)||(B.add(w),d=At.bind(null,d,m,w),m.then(d,d))}function sa(d){do{var m;if((m=d.tag===13)&&(m=d.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return d;d=d.return}while(d!==null);return null}function od(d,m,w,M,B){return(d.mode&1)===0?(d===m?d.flags|=65536:(d.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(m=ia(-1,1),m.tag=2,ra(w,m,1))),w.lanes|=1),d):(d.flags|=65536,d.lanes=B,d)}var uf=Ct.ReactCurrentOwner,cs=!1;function us(d,m,w,M){m.child=d===null?Wf(m,null,w,M):Jc(m,d.child,w,M)}function Jr(d,m,w,M,B){w=w.render;var W=m.ref;return wa(m,B),M=rf(d,m,w,M,W,B),w=of(),d!==null&&!cs?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~B,ll(d,m,B)):(zr&&w&&Gf(m),m.flags|=1,us(d,m,M,B),m.child)}function nu(d,m,w,M,B){if(d===null){var W=w.type;return typeof W=="function"&&!si(W)&&W.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(m.tag=15,m.type=W,hf(d,m,W,M,B)):(d=wi(w.type,null,M,m,m.mode,B),d.ref=m.ref,d.return=m,m.child=d)}if(W=d.child,(d.lanes&B)===0){var ce=W.memoizedProps;if(w=w.compare,w=w!==null?w:ma,w(ce,M)&&d.ref===m.ref)return ll(d,m,B)}return m.flags|=1,d=Kt(W,M),d.ref=m.ref,d.return=m,m.child=d}function hf(d,m,w,M,B){if(d!==null){var W=d.memoizedProps;if(ma(W,M)&&d.ref===m.ref)if(cs=!1,m.pendingProps=M=W,(d.lanes&B)!==0)(d.flags&131072)!==0&&(cs=!0);else return m.lanes=d.lanes,ll(d,m,B)}return sd(d,m,w,M,B)}function df(d,m,w){var M=m.pendingProps,B=M.children,W=d!==null?d.memoizedState:null;if(M.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fr(ac,so),so|=w;else{if((w&1073741824)===0)return d=W!==null?W.baseLanes|w:w,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:d,cachePool:null,transitions:null},m.updateQueue=null,Fr(ac,so),so|=d,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},M=W!==null?W.baseLanes:w,Fr(ac,so),so|=M}else W!==null?(M=W.baseLanes|w,m.memoizedState=null):M=w,Fr(ac,so),so|=M;return us(d,m,B,w),m.child}function Cc(d,m){var w=m.ref;(d===null&&w!==null||d!==null&&d.ref!==w)&&(m.flags|=512,m.flags|=2097152)}function sd(d,m,w,M,B){var W=Bo(w)?Al:Yo.current;return W=Ql(m,W),wa(m,B),w=rf(d,m,w,M,W,B),M=of(),d!==null&&!cs?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~B,ll(d,m,B)):(zr&&M&&Gf(m),m.flags|=1,us(d,m,w,B),m.child)}function ff(d,m,w,M,B){if(Bo(w)){var W=!0;Zc(m)}else W=!1;if(wa(m,B),m.stateNode===null)ud(d,m),lf(m,w,M),Fs(m,w,M,B),M=!0;else if(d===null){var ce=m.stateNode,Fe=m.memoizedProps;ce.props=Fe;var Ze=ce.context,kt=w.contextType;typeof kt=="object"&&kt!==null?kt=ss(kt):(kt=Bo(w)?Al:Yo.current,kt=Ql(m,kt));var en=w.getDerivedStateFromProps,ln=typeof en=="function"||typeof ce.getSnapshotBeforeUpdate=="function";ln||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Fe!==M||Ze!==kt)&&id(m,ce,M,kt),Rl=!1;var rn=m.memoizedState;ce.state=rn,ja(m,M,ce,B),Ze=m.memoizedState,Fe!==M||rn!==Ze||Ds.current||Rl?(typeof en=="function"&&(sl(m,w,en,M),Ze=m.memoizedState),(Fe=Rl||af(m,w,Fe,M,rn,Ze,kt))?(ln||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(m.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=M,m.memoizedState=Ze),ce.props=M,ce.state=Ze,ce.context=kt,M=Fe):(typeof ce.componentDidMount=="function"&&(m.flags|=4194308),M=!1)}else{ce=m.stateNode,qf(d,m),Fe=m.memoizedProps,kt=m.type===m.elementType?Fe:ws(m.type,Fe),ce.props=kt,ln=m.pendingProps,rn=ce.context,Ze=w.contextType,typeof Ze=="object"&&Ze!==null?Ze=ss(Ze):(Ze=Bo(w)?Al:Yo.current,Ze=Ql(m,Ze));var zn=w.getDerivedStateFromProps;(en=typeof zn=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Fe!==ln||rn!==Ze)&&id(m,ce,M,Ze),Rl=!1,rn=m.memoizedState,ce.state=rn,ja(m,M,ce,B);var Bn=m.memoizedState;Fe!==ln||rn!==Bn||Ds.current||Rl?(typeof zn=="function"&&(sl(m,w,zn,M),Bn=m.memoizedState),(kt=Rl||af(m,w,kt,M,rn,Bn,Ze)||!1)?(en||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(M,Bn,Ze),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(M,Bn,Ze)),typeof ce.componentDidUpdate=="function"&&(m.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Fe===d.memoizedProps&&rn===d.memoizedState||(m.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Fe===d.memoizedProps&&rn===d.memoizedState||(m.flags|=1024),m.memoizedProps=M,m.memoizedState=Bn),ce.props=M,ce.state=Bn,ce.context=Ze,M=kt):(typeof ce.componentDidUpdate!="function"||Fe===d.memoizedProps&&rn===d.memoizedState||(m.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Fe===d.memoizedProps&&rn===d.memoizedState||(m.flags|=1024),M=!1)}return Mc(d,m,w,M,W,B)}function Mc(d,m,w,M,B,W){Cc(d,m);var ce=(m.flags&128)!==0;if(!M&&!ce)return B&&Gu(m,w,!1),ll(d,m,W);M=m.stateNode,uf.current=m;var Fe=ce&&typeof w.getDerivedStateFromError!="function"?null:M.render();return m.flags|=1,d!==null&&ce?(m.child=Jc(m,d.child,null,W),m.child=Jc(m,null,Fe,W)):us(d,m,Fe,W),m.memoizedState=M.state,B&&Gu(m,w,!0),m.child}function al(d){var m=d.stateNode;m.pendingContext?Uf(d,m.pendingContext,m.pendingContext!==m.context):m.context&&Uf(d,m.context,!1),eh(d,m.containerInfo)}function bs(d,m,w,M,B){return va(),Gh(B),m.flags|=256,us(d,m,w,M),m.child}var Dl={dehydrated:null,treeContext:null,retryLane:0};function ad(d){return{baseLanes:d,cachePool:null,transitions:null}}function ld(d,m,w){var M=m.pendingProps,B=po.current,W=!1,ce=(m.flags&128)!==0,Fe;if((Fe=ce)||(Fe=d!==null&&d.memoizedState===null?!1:(B&2)!==0),Fe?(W=!0,m.flags&=-129):(d===null||d.memoizedState!==null)&&(B|=1),Fr(po,B&1),d===null)return Pl(m),d=m.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((m.mode&1)===0?m.lanes=1:d.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(ce=M.children,d=M.fallback,W?(M=m.mode,W=m.child,ce={mode:"hidden",children:ce},(M&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=ce):W=Ai(ce,M,0,null),d=Mn(d,M,w,null),W.return=m,d.return=m,W.sibling=d,m.child=W,m.child.memoizedState=ad(w),m.memoizedState=Dl,d):cd(m,ce));if(B=d.memoizedState,B!==null&&(Fe=B.dehydrated,Fe!==null))return pf(d,m,ce,M,Fe,B,w);if(W){W=M.fallback,ce=m.mode,B=d.child,Fe=B.sibling;var Ze={mode:"hidden",children:M.children};return(ce&1)===0&&m.child!==B?(M=m.child,M.childLanes=0,M.pendingProps=Ze,m.deletions=null):(M=Kt(B,Ze),M.subtreeFlags=B.subtreeFlags&14680064),Fe!==null?W=Kt(Fe,W):(W=Mn(W,ce,w,null),W.flags|=2),W.return=m,M.return=m,M.sibling=W,m.child=M,M=W,W=m.child,ce=d.child.memoizedState,ce=ce===null?ad(w):{baseLanes:ce.baseLanes|w,cachePool:null,transitions:ce.transitions},W.memoizedState=ce,W.childLanes=d.childLanes&~w,m.memoizedState=Dl,M}return W=d.child,d=W.sibling,M=Kt(W,{mode:"visible",children:M.children}),(m.mode&1)===0&&(M.lanes=w),M.return=m,M.sibling=null,d!==null&&(w=m.deletions,w===null?(m.deletions=[d],m.flags|=16):w.push(d)),m.child=M,m.memoizedState=null,M}function cd(d,m){return m=Ai({mode:"visible",children:m},d.mode,0,null),m.return=d,d.child=m}function iu(d,m,w,M){return M!==null&&Gh(M),Jc(m,d.child,null,w),d=cd(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function pf(d,m,w,M,B,W,ce){if(w)return m.flags&256?(m.flags&=-257,M=oc(Error(z(422))),iu(d,m,ce,M)):m.memoizedState!==null?(m.child=d.child,m.flags|=128,null):(W=M.fallback,B=m.mode,M=Ai({mode:"visible",children:M.children},B,0,null),W=Mn(W,B,ce,null),W.flags|=2,M.return=m,W.return=m,M.sibling=W,m.child=M,(m.mode&1)!==0&&Jc(m,d.child,null,ce),m.child.memoizedState=ad(ce),m.memoizedState=Dl,W);if((m.mode&1)===0)return iu(d,m,ce,null);if(B.data==="$!"){if(M=B.nextSibling&&B.nextSibling.dataset,M)var Fe=M.dgst;return M=Fe,W=Error(z(419)),M=oc(W,M,void 0),iu(d,m,ce,M)}if(Fe=(ce&d.childLanes)!==0,cs||Fe){if(M=Qo,M!==null){switch(ce&-ce){case 4:B=2;break;case 16:B=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:B=32;break;case 536870912:B=268435456;break;default:B=0}B=(B&(M.suspendedLanes|ce))!==0?0:B,B!==0&&B!==W.retryLane&&(W.retryLane=B,No(d,B),j(M,d,B,-1))}return $e(),M=oc(Error(z(421))),iu(d,m,ce,M)}return B.data==="$?"?(m.flags|=128,m.child=d.child,m=tn.bind(null,d),B._reactRetry=m,null):(d=W.treeContext,na=El(B.nextSibling),Os=m,zr=!0,ya=null,d!==null&&(ta[os++]=tc,ta[os++]=Ml,ta[os++]=Yc,tc=d.id,Ml=d.overflow,Yc=m),m=cd(m,M.children),m.flags|=4096,m)}function tp(d,m,w){d.lanes|=m;var M=d.alternate;M!==null&&(M.lanes|=m),Qc(d.return,m,w)}function ah(d,m,w,M,B){var W=d.memoizedState;W===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:M,tail:w,tailMode:B}:(W.isBackwards=m,W.rendering=null,W.renderingStartTime=0,W.last=M,W.tail=w,W.tailMode=B)}function np(d,m,w){var M=m.pendingProps,B=M.revealOrder,W=M.tail;if(us(d,m,M.children,w),M=po.current,(M&2)!==0)M=M&1|2,m.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&tp(d,w,m);else if(d.tag===19)tp(d,w,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}M&=1}if(Fr(po,M),(m.mode&1)===0)m.memoizedState=null;else switch(B){case"forwards":for(w=m.child,B=null;w!==null;)d=w.alternate,d!==null&&as(d)===null&&(B=w),w=w.sibling;w=B,w===null?(B=m.child,m.child=null):(B=w.sibling,w.sibling=null),ah(m,!1,B,w,W);break;case"backwards":for(w=null,B=m.child,m.child=null;B!==null;){if(d=B.alternate,d!==null&&as(d)===null){m.child=B;break}d=B.sibling,B.sibling=w,w=B,B=d}ah(m,!0,w,null,W);break;case"together":ah(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function ud(d,m){(m.mode&1)===0&&d!==null&&(d.alternate=null,m.alternate=null,m.flags|=2)}function ll(d,m,w){if(d!==null&&(m.dependencies=d.dependencies),lc|=m.lanes,(w&m.childLanes)===0)return null;if(d!==null&&m.child!==d.child)throw Error(z(153));if(m.child!==null){for(d=m.child,w=Kt(d,d.pendingProps),m.child=w,w.return=m;d.sibling!==null;)d=d.sibling,w=w.sibling=Kt(d,d.pendingProps),w.return=m;w.sibling=null}return m.child}function mf(d,m,w){switch(m.tag){case 3:al(m),va();break;case 5:tf(m);break;case 1:Bo(m.type)&&Zc(m);break;case 4:eh(m,m.stateNode.containerInfo);break;case 10:var M=m.type._context,B=m.memoizedProps.value;Fr(xa,M._currentValue),M._currentValue=B;break;case 13:if(M=m.memoizedState,M!==null)return M.dehydrated!==null?(Fr(po,po.current&1),m.flags|=128,null):(w&m.child.childLanes)!==0?ld(d,m,w):(Fr(po,po.current&1),d=ll(d,m,w),d!==null?d.sibling:null);Fr(po,po.current&1);break;case 19:if(M=(w&m.childLanes)!==0,(d.flags&128)!==0){if(M)return np(d,m,w);m.flags|=128}if(B=m.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),Fr(po,po.current),M)break;return null;case 22:case 23:return m.lanes=0,df(d,m,w)}return ll(d,m,w)}var ip,hd,gf,rp;ip=function(d,m){for(var w=m.child;w!==null;){if(w.tag===5||w.tag===6)d.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===m)break;for(;w.sibling===null;){if(w.return===null||w.return===m)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},hd=function(){},gf=function(d,m,w,M){var B=d.memoizedProps;if(B!==M){d=m.stateNode,kl(oa.current);var W=null;switch(w){case"input":B=yo(d,B),M=yo(d,M),W=[];break;case"select":B=sn({},B,{value:void 0}),M=sn({},M,{value:void 0}),W=[];break;case"textarea":B=to(d,B),M=to(d,M),W=[];break;default:typeof B.onClick!="function"&&typeof M.onClick=="function"&&(d.onclick=Wd)}_l(w,M);var ce;w=null;for(kt in B)if(!M.hasOwnProperty(kt)&&B.hasOwnProperty(kt)&&B[kt]!=null)if(kt==="style"){var Fe=B[kt];for(ce in Fe)Fe.hasOwnProperty(ce)&&(w||(w={}),w[ce]="")}else kt!=="dangerouslySetInnerHTML"&&kt!=="children"&&kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&kt!=="autoFocus"&&(X.hasOwnProperty(kt)?W||(W=[]):(W=W||[]).push(kt,null));for(kt in M){var Ze=M[kt];if(Fe=B?.[kt],M.hasOwnProperty(kt)&&Ze!==Fe&&(Ze!=null||Fe!=null))if(kt==="style")if(Fe){for(ce in Fe)!Fe.hasOwnProperty(ce)||Ze&&Ze.hasOwnProperty(ce)||(w||(w={}),w[ce]="");for(ce in Ze)Ze.hasOwnProperty(ce)&&Fe[ce]!==Ze[ce]&&(w||(w={}),w[ce]=Ze[ce])}else w||(W||(W=[]),W.push(kt,w)),w=Ze;else kt==="dangerouslySetInnerHTML"?(Ze=Ze?Ze.__html:void 0,Fe=Fe?Fe.__html:void 0,Ze!=null&&Fe!==Ze&&(W=W||[]).push(kt,Ze)):kt==="children"?typeof Ze!="string"&&typeof Ze!="number"||(W=W||[]).push(kt,""+Ze):kt!=="suppressContentEditableWarning"&&kt!=="suppressHydrationWarning"&&(X.hasOwnProperty(kt)?(Ze!=null&&kt==="onScroll"&&Or("scroll",d),W||Fe===Ze||(W=[])):(W=W||[]).push(kt,Ze))}w&&(W=W||[]).push("style",w);var kt=W;(m.updateQueue=kt)&&(m.flags|=4)}},rp=function(d,m,w,M){w!==M&&(m.flags|=4)};function Pc(d,m){if(!zr)switch(d.tailMode){case"hidden":m=d.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?d.tail=null:w.sibling=null;break;case"collapsed":w=d.tail;for(var M=null;w!==null;)w.alternate!==null&&(M=w),w=w.sibling;M===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:M.sibling=null}}function zo(d){var m=d.alternate!==null&&d.alternate.child===d.child,w=0,M=0;if(m)for(var B=d.child;B!==null;)w|=B.lanes|B.childLanes,M|=B.subtreeFlags&14680064,M|=B.flags&14680064,B.return=d,B=B.sibling;else for(B=d.child;B!==null;)w|=B.lanes|B.childLanes,M|=B.subtreeFlags,M|=B.flags,B.return=d,B=B.sibling;return d.subtreeFlags|=M,d.childLanes=w,m}function Dp(d,m,w){var M=m.pendingProps;switch(Zu(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zo(m),null;case 1:return Bo(m.type)&&wc(),zo(m),null;case 3:return M=m.stateNode,ic(),Vr(Ds),Vr(Yo),Ko(),M.pendingContext&&(M.context=M.pendingContext,M.pendingContext=null),(d===null||d.child===null)&&(Kc(m)?m.flags|=4:d===null||d.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,ya!==null&&(ie(ya),ya=null))),hd(d,m),zo(m),null;case 5:il(m);var B=kl(Qu.current);if(w=m.type,d!==null&&m.stateNode!=null)gf(d,m,w,M,B),d.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!M){if(m.stateNode===null)throw Error(z(166));return zo(m),null}if(d=kl(oa.current),Kc(m)){M=m.stateNode,w=m.type;var W=m.memoizedProps;switch(M[_a]=m,M[yc]=W,d=(m.mode&1)!==0,w){case"dialog":Or("cancel",M),Or("close",M);break;case"iframe":case"object":case"embed":Or("load",M);break;case"video":case"audio":for(B=0;B<Gc.length;B++)Or(Gc[B],M);break;case"source":Or("error",M);break;case"img":case"image":case"link":Or("error",M),Or("load",M);break;case"details":Or("toggle",M);break;case"input":Es(M,W),Or("invalid",M);break;case"select":M._wrapperState={wasMultiple:!!W.multiple},Or("invalid",M);break;case"textarea":ds(M,W),Or("invalid",M)}_l(w,W),B=null;for(var ce in W)if(W.hasOwnProperty(ce)){var Fe=W[ce];ce==="children"?typeof Fe=="string"?M.textContent!==Fe&&(W.suppressHydrationWarning!==!0&&or(M.textContent,Fe,d),B=["children",Fe]):typeof Fe=="number"&&M.textContent!==""+Fe&&(W.suppressHydrationWarning!==!0&&or(M.textContent,Fe,d),B=["children",""+Fe]):X.hasOwnProperty(ce)&&Fe!=null&&ce==="onScroll"&&Or("scroll",M)}switch(w){case"input":_i(M),Cr(M,W,!0);break;case"textarea":_i(M),Ma(M);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(M.onclick=Wd)}M=B,m.updateQueue=M,M!==null&&(m.flags|=4)}else{ce=B.nodeType===9?B:B.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Pa(w)),d==="http://www.w3.org/1999/xhtml"?w==="script"?(d=ce.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof M.is=="string"?d=ce.createElement(w,{is:M.is}):(d=ce.createElement(w),w==="select"&&(ce=d,M.multiple?ce.multiple=!0:M.size&&(ce.size=M.size))):d=ce.createElementNS(d,w),d[_a]=m,d[yc]=M,ip(d,m,!1,!1),m.stateNode=d;e:{switch(ce=Ra(w,M),w){case"dialog":Or("cancel",d),Or("close",d),B=M;break;case"iframe":case"object":case"embed":Or("load",d),B=M;break;case"video":case"audio":for(B=0;B<Gc.length;B++)Or(Gc[B],d);B=M;break;case"source":Or("error",d),B=M;break;case"img":case"image":case"link":Or("error",d),Or("load",d),B=M;break;case"details":Or("toggle",d),B=M;break;case"input":Es(d,M),B=yo(d,M),Or("invalid",d);break;case"option":B=M;break;case"select":d._wrapperState={wasMultiple:!!M.multiple},B=sn({},M,{value:void 0}),Or("invalid",d);break;case"textarea":ds(d,M),B=to(d,M),Or("invalid",d);break;default:B=M}_l(w,B),Fe=B;for(W in Fe)if(Fe.hasOwnProperty(W)){var Ze=Fe[W];W==="style"?no(d,Ze):W==="dangerouslySetInnerHTML"?(Ze=Ze?Ze.__html:void 0,Ze!=null&&Eo(d,Ze)):W==="children"?typeof Ze=="string"?(w!=="textarea"||Ze!=="")&&qo(d,Ze):typeof Ze=="number"&&qo(d,""+Ze):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(X.hasOwnProperty(W)?Ze!=null&&W==="onScroll"&&Or("scroll",d):Ze!=null&&Ke(d,W,Ze,ce))}switch(w){case"input":_i(d),Cr(d,M,!1);break;case"textarea":_i(d),Ma(d);break;case"option":M.value!=null&&d.setAttribute("value",""+wn(M.value));break;case"select":d.multiple=!!M.multiple,W=M.value,W!=null?Gs(d,!!M.multiple,W,!1):M.defaultValue!=null&&Gs(d,!!M.multiple,M.defaultValue,!0);break;default:typeof B.onClick=="function"&&(d.onclick=Wd)}switch(w){case"button":case"input":case"select":case"textarea":M=!!M.autoFocus;break e;case"img":M=!0;break e;default:M=!1}}M&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return zo(m),null;case 6:if(d&&m.stateNode!=null)rp(d,m,d.memoizedProps,M);else{if(typeof M!="string"&&m.stateNode===null)throw Error(z(166));if(w=kl(Qu.current),kl(oa.current),Kc(m)){if(M=m.stateNode,w=m.memoizedProps,M[_a]=m,(W=M.nodeValue!==w)&&(d=Os,d!==null))switch(d.tag){case 3:or(M.nodeValue,w,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&or(M.nodeValue,w,(d.mode&1)!==0)}W&&(m.flags|=4)}else M=(w.nodeType===9?w:w.ownerDocument).createTextNode(M),M[_a]=m,m.stateNode=M}return zo(m),null;case 13:if(Vr(po),M=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(zr&&na!==null&&(m.mode&1)!==0&&(m.flags&128)===0)Hf(),va(),m.flags|=98560,W=!1;else if(W=Kc(m),M!==null&&M.dehydrated!==null){if(d===null){if(!W)throw Error(z(318));if(W=m.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(z(317));W[_a]=m}else va(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;zo(m),W=!1}else ya!==null&&(ie(ya),ya=null),W=!0;if(!W)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=w,m):(M=M!==null,M!==(d!==null&&d.memoizedState!==null)&&M&&(m.child.flags|=8192,(m.mode&1)!==0&&(d===null||(po.current&1)!==0?Vo===0&&(Vo=3):$e())),m.updateQueue!==null&&(m.flags|=4),zo(m),null);case 4:return ic(),hd(d,m),d===null&&Lh(m.stateNode.containerInfo),zo(m),null;case 10:return Ku(m.type._context),zo(m),null;case 17:return Bo(m.type)&&wc(),zo(m),null;case 19:if(Vr(po),W=m.memoizedState,W===null)return zo(m),null;if(M=(m.flags&128)!==0,ce=W.rendering,ce===null)if(M)Pc(W,!1);else{if(Vo!==0||d!==null&&(d.flags&128)!==0)for(d=m.child;d!==null;){if(ce=as(d),ce!==null){for(m.flags|=128,Pc(W,!1),M=ce.updateQueue,M!==null&&(m.updateQueue=M,m.flags|=4),m.subtreeFlags=0,M=w,w=m.child;w!==null;)W=w,d=M,W.flags&=14680066,ce=W.alternate,ce===null?(W.childLanes=0,W.lanes=d,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=ce.childLanes,W.lanes=ce.lanes,W.child=ce.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=ce.memoizedProps,W.memoizedState=ce.memoizedState,W.updateQueue=ce.updateQueue,W.type=ce.type,d=ce.dependencies,W.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),w=w.sibling;return Fr(po,po.current&1|2),m.child}d=d.sibling}W.tail!==null&&Qt()>t&&(m.flags|=128,M=!0,Pc(W,!1),m.lanes=4194304)}else{if(!M)if(d=as(ce),d!==null){if(m.flags|=128,M=!0,w=d.updateQueue,w!==null&&(m.updateQueue=w,m.flags|=4),Pc(W,!0),W.tail===null&&W.tailMode==="hidden"&&!ce.alternate&&!zr)return zo(m),null}else 2*Qt()-W.renderingStartTime>t&&w!==1073741824&&(m.flags|=128,M=!0,Pc(W,!1),m.lanes=4194304);W.isBackwards?(ce.sibling=m.child,m.child=ce):(w=W.last,w!==null?w.sibling=ce:m.child=ce,W.last=ce)}return W.tail!==null?(m=W.tail,W.rendering=m,W.tail=m.sibling,W.renderingStartTime=Qt(),m.sibling=null,w=po.current,Fr(po,M?w&1|2:w&1),m):(zo(m),null);case 22:case 23:return le(),M=m.memoizedState!==null,d!==null&&d.memoizedState!==null!==M&&(m.flags|=8192),M&&(m.mode&1)!==0?(so&1073741824)!==0&&(zo(m),m.subtreeFlags&6&&(m.flags|=8192)):zo(m),null;case 24:return null;case 25:return null}throw Error(z(156,m.tag))}function wm(d,m){switch(Zu(m),m.tag){case 1:return Bo(m.type)&&wc(),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return ic(),Vr(Ds),Vr(Yo),Ko(),d=m.flags,(d&65536)!==0&&(d&128)===0?(m.flags=d&-65537|128,m):null;case 5:return il(m),null;case 13:if(Vr(po),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(z(340));va()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return Vr(po),null;case 4:return ic(),null;case 10:return Ku(m.type._context),null;case 22:case 23:return le(),null;case 24:return null;default:return null}}var dd=!1,ki=!1,_f=typeof WeakSet=="function"?WeakSet:Set,Zn=null;function lh(d,m){var w=d.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(M){Lt(d,m,M)}else w.current=null}function op(d,m,w){try{w()}catch(M){Lt(d,m,M)}}var ch=!1;function sp(d,m){if(qd=Oc,d=Ep(),jd(d)){if("selectionStart"in d)var w={start:d.selectionStart,end:d.selectionEnd};else e:{w=(w=d.ownerDocument)&&w.defaultView||window;var M=w.getSelection&&w.getSelection();if(M&&M.rangeCount!==0){w=M.anchorNode;var B=M.anchorOffset,W=M.focusNode;M=M.focusOffset;try{w.nodeType,W.nodeType}catch{w=null;break e}var ce=0,Fe=-1,Ze=-1,kt=0,en=0,ln=d,rn=null;t:for(;;){for(var zn;ln!==w||B!==0&&ln.nodeType!==3||(Fe=ce+B),ln!==W||M!==0&&ln.nodeType!==3||(Ze=ce+M),ln.nodeType===3&&(ce+=ln.nodeValue.length),(zn=ln.firstChild)!==null;)rn=ln,ln=zn;for(;;){if(ln===d)break t;if(rn===w&&++kt===B&&(Fe=ce),rn===W&&++en===M&&(Ze=ce),(zn=ln.nextSibling)!==null)break;ln=rn,rn=ln.parentNode}ln=zn}w=Fe===-1||Ze===-1?null:{start:Fe,end:Ze}}else w=null}w=w||{start:0,end:0}}else w=null;for(Oh={focusedElem:d,selectionRange:w},Oc=!1,Zn=m;Zn!==null;)if(m=Zn,d=m.child,(m.subtreeFlags&1028)!==0&&d!==null)d.return=m,Zn=d;else for(;Zn!==null;){m=Zn;try{var Bn=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Bn!==null){var Nn=Bn.memoizedProps,Lr=Bn.memoizedState,bt=m.stateNode,at=bt.getSnapshotBeforeUpdate(m.elementType===m.type?Nn:ws(m.type,Nn),Lr);bt.__reactInternalSnapshotBeforeUpdate=at}break;case 3:var Et=m.stateNode.containerInfo;Et.nodeType===1?Et.textContent="":Et.nodeType===9&&Et.documentElement&&Et.removeChild(Et.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(z(163))}}catch(vn){Lt(m,m.return,vn)}if(d=m.sibling,d!==null){d.return=m.return,Zn=d;break}Zn=m.return}return Bn=ch,ch=!1,Bn}function ru(d,m,w){var M=m.updateQueue;if(M=M!==null?M.lastEffect:null,M!==null){var B=M=M.next;do{if((B.tag&d)===d){var W=B.destroy;B.destroy=void 0,W!==void 0&&op(m,w,W)}B=B.next}while(B!==M)}}function ou(d,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var w=m=m.next;do{if((w.tag&d)===d){var M=w.create;w.destroy=M()}w=w.next}while(w!==m)}}function cl(d){var m=d.ref;if(m!==null){var w=d.stateNode;switch(d.tag){case 5:d=w;break;default:d=w}typeof m=="function"?m(d):m.current=d}}function fd(d){var m=d.alternate;m!==null&&(d.alternate=null,fd(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&(delete m[_a],delete m[yc],delete m[ju],delete m[Nh],delete m[Mp])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Qr(d){return d.tag===5||d.tag===3||d.tag===4}function ul(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Qr(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function su(d,m,w){var M=d.tag;if(M===5||M===6)d=d.stateNode,m?w.nodeType===8?w.parentNode.insertBefore(d,m):w.insertBefore(d,m):(w.nodeType===8?(m=w.parentNode,m.insertBefore(d,w)):(m=w,m.appendChild(d)),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=Wd));else if(M!==4&&(d=d.child,d!==null))for(su(d,m,w),d=d.sibling;d!==null;)su(d,m,w),d=d.sibling}function uh(d,m,w){var M=d.tag;if(M===5||M===6)d=d.stateNode,m?w.insertBefore(d,m):w.appendChild(d);else if(M!==4&&(d=d.child,d!==null))for(uh(d,m,w),d=d.sibling;d!==null;)uh(d,m,w),d=d.sibling}var Ao=null,hl=!1;function Ga(d,m,w){for(w=w.child;w!==null;)pd(d,m,w),w=w.sibling}function pd(d,m,w){if(ir&&typeof ir.onCommitFiberUnmount=="function")try{ir.onCommitFiberUnmount(Rr,w)}catch{}switch(w.tag){case 5:ki||lh(w,m);case 6:var M=Ao,B=hl;Ao=null,Ga(d,m,w),Ao=M,hl=B,Ao!==null&&(hl?(d=Ao,w=w.stateNode,d.nodeType===8?d.parentNode.removeChild(w):d.removeChild(w)):Ao.removeChild(w.stateNode));break;case 18:Ao!==null&&(hl?(d=Ao,w=w.stateNode,d.nodeType===8?Zd(d.parentNode,w):d.nodeType===1&&Zd(d,w),Hl(d)):Zd(Ao,w.stateNode));break;case 4:M=Ao,B=hl,Ao=w.stateNode.containerInfo,hl=!0,Ga(d,m,w),Ao=M,hl=B;break;case 0:case 11:case 14:case 15:if(!ki&&(M=w.updateQueue,M!==null&&(M=M.lastEffect,M!==null))){B=M=M.next;do{var W=B,ce=W.destroy;W=W.tag,ce!==void 0&&((W&2)!==0||(W&4)!==0)&&op(w,m,ce),B=B.next}while(B!==M)}Ga(d,m,w);break;case 1:if(!ki&&(lh(w,m),M=w.stateNode,typeof M.componentWillUnmount=="function"))try{M.props=w.memoizedProps,M.state=w.memoizedState,M.componentWillUnmount()}catch(Fe){Lt(w,m,Fe)}Ga(d,m,w);break;case 21:Ga(d,m,w);break;case 22:w.mode&1?(ki=(M=ki)||w.memoizedState!==null,Ga(d,m,w),ki=M):Ga(d,m,w);break;default:Ga(d,m,w)}}function Op(d){var m=d.updateQueue;if(m!==null){d.updateQueue=null;var w=d.stateNode;w===null&&(w=d.stateNode=new _f),m.forEach(function(M){var B=Yt.bind(null,d,M);w.has(M)||(w.add(M),M.then(B,B))})}}function aa(d,m){var w=m.deletions;if(w!==null)for(var M=0;M<w.length;M++){var B=w[M];try{var W=d,ce=m,Fe=ce;e:for(;Fe!==null;){switch(Fe.tag){case 5:Ao=Fe.stateNode,hl=!1;break e;case 3:Ao=Fe.stateNode.containerInfo,hl=!0;break e;case 4:Ao=Fe.stateNode.containerInfo,hl=!0;break e}Fe=Fe.return}if(Ao===null)throw Error(z(160));pd(W,ce,B),Ao=null,hl=!1;var Ze=B.alternate;Ze!==null&&(Ze.return=null),B.return=null}catch(kt){Lt(B,m,kt)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)yf(m,d),m=m.sibling}function yf(d,m){var w=d.alternate,M=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(aa(m,d),la(d),M&4){try{ru(3,d,d.return),ou(3,d)}catch(Nn){Lt(d,d.return,Nn)}try{ru(5,d,d.return)}catch(Nn){Lt(d,d.return,Nn)}}break;case 1:aa(m,d),la(d),M&512&&w!==null&&lh(w,w.return);break;case 5:if(aa(m,d),la(d),M&512&&w!==null&&lh(w,w.return),d.flags&32){var B=d.stateNode;try{qo(B,"")}catch(Nn){Lt(d,d.return,Nn)}}if(M&4&&(B=d.stateNode,B!=null)){var W=d.memoizedProps,ce=w!==null?w.memoizedProps:W,Fe=d.type,Ze=d.updateQueue;if(d.updateQueue=null,Ze!==null)try{Fe==="input"&&W.type==="radio"&&W.name!=null&&vo(B,W),Ra(Fe,ce);var kt=Ra(Fe,W);for(ce=0;ce<Ze.length;ce+=2){var en=Ze[ce],ln=Ze[ce+1];en==="style"?no(B,ln):en==="dangerouslySetInnerHTML"?Eo(B,ln):en==="children"?qo(B,ln):Ke(B,en,ln,kt)}switch(Fe){case"input":Pr(B,W);break;case"textarea":So(B,W);break;case"select":var rn=B._wrapperState.wasMultiple;B._wrapperState.wasMultiple=!!W.multiple;var zn=W.value;zn!=null?Gs(B,!!W.multiple,zn,!1):rn!==!!W.multiple&&(W.defaultValue!=null?Gs(B,!!W.multiple,W.defaultValue,!0):Gs(B,!!W.multiple,W.multiple?[]:"",!1))}B[yc]=W}catch(Nn){Lt(d,d.return,Nn)}}break;case 6:if(aa(m,d),la(d),M&4){if(d.stateNode===null)throw Error(z(162));B=d.stateNode,W=d.memoizedProps;try{B.nodeValue=W}catch(Nn){Lt(d,d.return,Nn)}}break;case 3:if(aa(m,d),la(d),M&4&&w!==null&&w.memoizedState.isDehydrated)try{Hl(m.containerInfo)}catch(Nn){Lt(d,d.return,Nn)}break;case 4:aa(m,d),la(d);break;case 13:aa(m,d),la(d),B=d.child,B.flags&8192&&(W=B.memoizedState!==null,B.stateNode.isHidden=W,!W||B.alternate!==null&&B.alternate.memoizedState!==null||(l=Qt())),M&4&&Op(d);break;case 22:if(en=w!==null&&w.memoizedState!==null,d.mode&1?(ki=(kt=ki)||en,aa(m,d),ki=kt):aa(m,d),la(d),M&8192){if(kt=d.memoizedState!==null,(d.stateNode.isHidden=kt)&&!en&&(d.mode&1)!==0)for(Zn=d,en=d.child;en!==null;){for(ln=Zn=en;Zn!==null;){switch(rn=Zn,zn=rn.child,rn.tag){case 0:case 11:case 14:case 15:ru(4,rn,rn.return);break;case 1:lh(rn,rn.return);var Bn=rn.stateNode;if(typeof Bn.componentWillUnmount=="function"){M=rn,w=rn.return;try{m=M,Bn.props=m.memoizedProps,Bn.state=m.memoizedState,Bn.componentWillUnmount()}catch(Nn){Lt(M,w,Nn)}}break;case 5:lh(rn,rn.return);break;case 22:if(rn.memoizedState!==null){Fl(ln);continue}}zn!==null?(zn.return=rn,Zn=zn):Fl(ln)}en=en.sibling}e:for(en=null,ln=d;;){if(ln.tag===5){if(en===null){en=ln;try{B=ln.stateNode,kt?(W=B.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(Fe=ln.stateNode,Ze=ln.memoizedProps.style,ce=Ze!=null&&Ze.hasOwnProperty("display")?Ze.display:null,Fe.style.display=Ul("display",ce))}catch(Nn){Lt(d,d.return,Nn)}}}else if(ln.tag===6){if(en===null)try{ln.stateNode.nodeValue=kt?"":ln.memoizedProps}catch(Nn){Lt(d,d.return,Nn)}}else if((ln.tag!==22&&ln.tag!==23||ln.memoizedState===null||ln===d)&&ln.child!==null){ln.child.return=ln,ln=ln.child;continue}if(ln===d)break e;for(;ln.sibling===null;){if(ln.return===null||ln.return===d)break e;en===ln&&(en=null),ln=ln.return}en===ln&&(en=null),ln.sibling.return=ln.return,ln=ln.sibling}}break;case 19:aa(m,d),la(d),M&4&&Op(d);break;case 21:break;default:aa(m,d),la(d)}}function la(d){var m=d.flags;if(m&2){try{e:{for(var w=d.return;w!==null;){if(Qr(w)){var M=w;break e}w=w.return}throw Error(z(160))}switch(M.tag){case 5:var B=M.stateNode;M.flags&32&&(qo(B,""),M.flags&=-33);var W=ul(d);uh(d,W,B);break;case 3:case 4:var ce=M.stateNode.containerInfo,Fe=ul(d);su(d,Fe,ce);break;default:throw Error(z(161))}}catch(Ze){Lt(d,d.return,Ze)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function md(d,m,w){Zn=d,au(d)}function au(d,m,w){for(var M=(d.mode&1)!==0;Zn!==null;){var B=Zn,W=B.child;if(B.tag===22&&M){var ce=B.memoizedState!==null||dd;if(!ce){var Fe=B.alternate,Ze=Fe!==null&&Fe.memoizedState!==null||ki;Fe=dd;var kt=ki;if(dd=ce,(ki=Ze)&&!kt)for(Zn=B;Zn!==null;)ce=Zn,Ze=ce.child,ce.tag===22&&ce.memoizedState!==null?Bl(B):Ze!==null?(Ze.return=ce,Zn=Ze):Bl(B);for(;W!==null;)Zn=W,au(W),W=W.sibling;Zn=B,dd=Fe,ki=kt}Ol(d)}else(B.subtreeFlags&8772)!==0&&W!==null?(W.return=B,Zn=W):Ol(d)}}function Ol(d){for(;Zn!==null;){var m=Zn;if((m.flags&8772)!==0){var w=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:ki||ou(5,m);break;case 1:var M=m.stateNode;if(m.flags&4&&!ki)if(w===null)M.componentDidMount();else{var B=m.elementType===m.type?w.memoizedProps:ws(m.type,w.memoizedProps);M.componentDidUpdate(B,w.memoizedState,M.__reactInternalSnapshotBeforeUpdate)}var W=m.updateQueue;W!==null&&nc(m,W,M);break;case 3:var ce=m.updateQueue;if(ce!==null){if(w=null,m.child!==null)switch(m.child.tag){case 5:w=m.child.stateNode;break;case 1:w=m.child.stateNode}nc(m,ce,w)}break;case 5:var Fe=m.stateNode;if(w===null&&m.flags&4){w=Fe;var Ze=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Ze.autoFocus&&w.focus();break;case"img":Ze.src&&(w.src=Ze.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var kt=m.alternate;if(kt!==null){var en=kt.memoizedState;if(en!==null){var ln=en.dehydrated;ln!==null&&Hl(ln)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(z(163))}ki||m.flags&512&&cl(m)}catch(rn){Lt(m,m.return,rn)}}if(m===d){Zn=null;break}if(w=m.sibling,w!==null){w.return=m.return,Zn=w;break}Zn=m.return}}function Fl(d){for(;Zn!==null;){var m=Zn;if(m===d){Zn=null;break}var w=m.sibling;if(w!==null){w.return=m.return,Zn=w;break}Zn=m.return}}function Bl(d){for(;Zn!==null;){var m=Zn;try{switch(m.tag){case 0:case 11:case 15:var w=m.return;try{ou(4,m)}catch(Ze){Lt(m,w,Ze)}break;case 1:var M=m.stateNode;if(typeof M.componentDidMount=="function"){var B=m.return;try{M.componentDidMount()}catch(Ze){Lt(m,B,Ze)}}var W=m.return;try{cl(m)}catch(Ze){Lt(m,W,Ze)}break;case 5:var ce=m.return;try{cl(m)}catch(Ze){Lt(m,ce,Ze)}}}catch(Ze){Lt(m,m.return,Ze)}if(m===d){Zn=null;break}var Fe=m.sibling;if(Fe!==null){Fe.return=m.return,Zn=Fe;break}Zn=m.return}}var Rc=Math.ceil,ca=Ct.ReactCurrentDispatcher,ap=Ct.ReactCurrentOwner,$a=Ct.ReactCurrentBatchConfig,Sr=0,Qo=null,wo=null,gr=0,so=0,ac=xc(0),Vo=0,Nl=null,lc=0,Bs=0,ua=0,dl=null,Uo=null,l=0,t=1/0,r=null,c=!1,f=null,g=null,_=!1,v=null,b=0,I=0,C=null,O=-1,L=0;function D(){return(Sr&6)!==0?Qt():O!==-1?O:O=Qt()}function V(d){return(d.mode&1)===0?1:(Sr&2)!==0&&gr!==0?gr&-gr:$h.transition!==null?(L===0&&(L=qs()),L):(d=mr,d!==0||(d=window.event,d=d===void 0?16:Eu(d.type)),d)}function j(d,m,w,M){if(50<I)throw I=0,C=null,Error(z(185));Zs(d,w,M),((Sr&2)===0||d!==Qo)&&(d===Qo&&((Sr&2)===0&&(Bs|=w),Vo===4&&ye(d,gr)),Z(d,M),w===1&&Sr===0&&(m.mode&1)===0&&(t=Qt()+500,Xc&&Na()))}function Z(d,m){var w=d.callbackNode;Dc(d,m);var M=Io(d,d===Qo?gr:0);if(M===0)w!==null&&yt(w),d.callbackNode=null,d.callbackPriority=0;else if(m=M&-M,d.callbackPriority!==m){if(w!=null&&yt(w),m===1)d.tag===0?Hu(pe.bind(null,d)):Xd(pe.bind(null,d)),Bh(function(){(Sr&6)===0&&Na()}),w=null;else{switch(xh(M)){case 1:w=Vn;break;case 4:w=Un;break;case 16:w=Fn;break;case 536870912:w=xr;break;default:w=Fn}w=Ht(w,q.bind(null,d))}d.callbackPriority=m,d.callbackNode=w}}function q(d,m){if(O=-1,L=0,(Sr&6)!==0)throw Error(z(327));var w=d.callbackNode;if(dt()&&d.callbackNode!==w)return null;var M=Io(d,d===Qo?gr:0);if(M===0)return null;if((M&30)!==0||(M&d.expiredLanes)!==0||m)m=He(d,M);else{m=M;var B=Sr;Sr|=2;var W=Ae();(Qo!==d||gr!==m)&&(r=null,t=Qt()+500,xe(d,m));do try{xt();break}catch(Fe){Re(d,Fe)}while(!0);Qd(),ca.current=W,Sr=B,wo!==null?m=0:(Qo=null,gr=0,m=Vo)}if(m!==0){if(m===2&&(B=ho(d),B!==0&&(M=B,m=ee(d,B))),m===1)throw w=Nl,xe(d,0),ye(d,M),Z(d,Qt()),w;if(m===6)ye(d,M);else{if(B=d.current.alternate,(M&30)===0&&!te(B)&&(m=He(d,M),m===2&&(W=ho(d),W!==0&&(M=W,m=ee(d,W))),m===1))throw w=Nl,xe(d,0),ye(d,M),Z(d,Qt()),w;switch(d.finishedWork=B,d.finishedLanes=M,m){case 0:case 1:throw Error(z(345));case 2:We(d,Uo,r);break;case 3:if(ye(d,M),(M&130023424)===M&&(m=l+500-Qt(),10<m)){if(Io(d,0)!==0)break;if(B=d.suspendedLanes,(B&M)!==M){D(),d.pingedLanes|=d.suspendedLanes&B;break}d.timeoutHandle=Fh(We.bind(null,d,Uo,r),m);break}We(d,Uo,r);break;case 4:if(ye(d,M),(M&4194240)===M)break;for(m=d.eventTimes,B=-1;0<M;){var ce=31-Zi(M);W=1<<ce,ce=m[ce],ce>B&&(B=ce),M&=~W}if(M=B,M=Qt()-M,M=(120>M?120:480>M?480:1080>M?1080:1920>M?1920:3e3>M?3e3:4320>M?4320:1960*Rc(M/1960))-M,10<M){d.timeoutHandle=Fh(We.bind(null,d,Uo,r),M);break}We(d,Uo,r);break;case 5:We(d,Uo,r);break;default:throw Error(z(329))}}}return Z(d,Qt()),d.callbackNode===w?q.bind(null,d):null}function ee(d,m){var w=dl;return d.current.memoizedState.isDehydrated&&(xe(d,m).flags|=256),d=He(d,m),d!==2&&(m=Uo,Uo=w,m!==null&&ie(m)),d}function ie(d){Uo===null?Uo=d:Uo.push.apply(Uo,d)}function te(d){for(var m=d;;){if(m.flags&16384){var w=m.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var M=0;M<w.length;M++){var B=w[M],W=B.getSnapshot;B=B.value;try{if(!Ls(W(),B))return!1}catch{return!1}}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function ye(d,m){for(m&=~ua,m&=~Bs,d.suspendedLanes|=m,d.pingedLanes&=~m,d=d.expirationTimes;0<m;){var w=31-Zi(m),M=1<<w;d[w]=-1,m&=~M}}function pe(d){if((Sr&6)!==0)throw Error(z(327));dt();var m=Io(d,0);if((m&1)===0)return Z(d,Qt()),null;var w=He(d,m);if(d.tag!==0&&w===2){var M=ho(d);M!==0&&(m=M,w=ee(d,M))}if(w===1)throw w=Nl,xe(d,0),ye(d,m),Z(d,Qt()),w;if(w===6)throw Error(z(345));return d.finishedWork=d.current.alternate,d.finishedLanes=m,We(d,Uo,r),Z(d,Qt()),null}function ge(d,m){var w=Sr;Sr|=1;try{return d(m)}finally{Sr=w,Sr===0&&(t=Qt()+500,Xc&&Na())}}function ue(d){v!==null&&v.tag===0&&(Sr&6)===0&&dt();var m=Sr;Sr|=1;var w=$a.transition,M=mr;try{if($a.transition=null,mr=1,d)return d()}finally{mr=M,$a.transition=w,Sr=m,(Sr&6)===0&&Na()}}function le(){so=ac.current,Vr(ac)}function xe(d,m){d.finishedWork=null,d.finishedLanes=0;var w=d.timeoutHandle;if(w!==-1&&(d.timeoutHandle=-1,Wc(w)),wo!==null)for(w=wo.return;w!==null;){var M=w;switch(Zu(M),M.tag){case 1:M=M.type.childContextTypes,M!=null&&wc();break;case 3:ic(),Vr(Ds),Vr(Yo),Ko();break;case 5:il(M);break;case 4:ic();break;case 13:Vr(po);break;case 19:Vr(po);break;case 10:Ku(M.type._context);break;case 22:case 23:le()}w=w.return}if(Qo=d,wo=d=Kt(d.current,null),gr=so=m,Vo=0,Nl=null,ua=Bs=lc=0,Uo=dl=null,ba!==null){for(m=0;m<ba.length;m++)if(w=ba[m],M=w.interleaved,M!==null){w.interleaved=null;var B=M.next,W=w.pending;if(W!==null){var ce=W.next;W.next=B,M.next=ce}w.pending=M}ba=null}return d}function Re(d,m){do{var w=wo;try{if(Qd(),Va.current=ni,Ua){for(var M=Xr.memoizedState;M!==null;){var B=M.queue;B!==null&&(B.pending=null),M=M.next}Ua=!1}if(zl=0,jo=mo=Xr=null,Xi=!1,Sc=0,ap.current=null,w===null||w.return===null){Vo=1,Nl=m,wo=null;break}e:{var W=d,ce=w.return,Fe=w,Ze=m;if(m=gr,Fe.flags|=32768,Ze!==null&&typeof Ze=="object"&&typeof Ze.then=="function"){var kt=Ze,en=Fe,ln=en.tag;if((en.mode&1)===0&&(ln===0||ln===11||ln===15)){var rn=en.alternate;rn?(en.updateQueue=rn.updateQueue,en.memoizedState=rn.memoizedState,en.lanes=rn.lanes):(en.updateQueue=null,en.memoizedState=null)}var zn=sa(ce);if(zn!==null){zn.flags&=-257,od(zn,ce,Fe,W,m),zn.mode&1&&rd(W,kt,m),m=zn,Ze=kt;var Bn=m.updateQueue;if(Bn===null){var Nn=new Set;Nn.add(Ze),m.updateQueue=Nn}else Bn.add(Ze);break e}else{if((m&1)===0){rd(W,kt,m),$e();break e}Ze=Error(z(426))}}else if(zr&&Fe.mode&1){var Lr=sa(ce);if(Lr!==null){(Lr.flags&65536)===0&&(Lr.flags|=256),od(Lr,ce,Fe,W,m),Gh(ko(Ze,Fe));break e}}W=Ze=ko(Ze,Fe),Vo!==4&&(Vo=2),dl===null?dl=[W]:dl.push(W),W=ce;do{switch(W.tag){case 3:W.flags|=65536,m&=-m,W.lanes|=m;var bt=cf(W,Ze,m);Ju(W,bt);break e;case 1:Fe=Ze;var at=W.type,Et=W.stateNode;if((W.flags&128)===0&&(typeof at.getDerivedStateFromError=="function"||Et!==null&&typeof Et.componentDidCatch=="function"&&(g===null||!g.has(Et)))){W.flags|=65536,m&=-m,W.lanes|=m;var vn=sc(W,Fe,m);Ju(W,vn);break e}}W=W.return}while(W!==null)}Ee(w)}catch(ii){m=ii,wo===w&&w!==null&&(wo=w=w.return);continue}break}while(!0)}function Ae(){var d=ca.current;return ca.current=ni,d===null?ni:d}function $e(){(Vo===0||Vo===3||Vo===2)&&(Vo=4),Qo===null||(lc&268435455)===0&&(Bs&268435455)===0||ye(Qo,gr)}function He(d,m){var w=Sr;Sr|=2;var M=Ae();(Qo!==d||gr!==m)&&(r=null,xe(d,m));do try{it();break}catch(B){Re(d,B)}while(!0);if(Qd(),Sr=w,ca.current=M,wo!==null)throw Error(z(261));return Qo=null,gr=0,Vo}function it(){for(;wo!==null;)Ne(wo)}function xt(){for(;wo!==null&&!lt();)Ne(wo)}function Ne(d){var m=Bt(d.alternate,d,so);d.memoizedProps=d.pendingProps,m===null?Ee(d):wo=m,ap.current=null}function Ee(d){var m=d;do{var w=m.alternate;if(d=m.return,(m.flags&32768)===0){if(w=Dp(w,m,so),w!==null){wo=w;return}}else{if(w=wm(w,m),w!==null){w.flags&=32767,wo=w;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Vo=6,wo=null;return}}if(m=m.sibling,m!==null){wo=m;return}wo=m=d}while(m!==null);Vo===0&&(Vo=5)}function We(d,m,w){var M=mr,B=$a.transition;try{$a.transition=null,mr=1,Ue(d,m,w,M)}finally{$a.transition=B,mr=M}return null}function Ue(d,m,w,M){do dt();while(v!==null);if((Sr&6)!==0)throw Error(z(327));w=d.finishedWork;var B=d.finishedLanes;if(w===null)return null;if(d.finishedWork=null,d.finishedLanes=0,w===d.current)throw Error(z(177));d.callbackNode=null,d.callbackPriority=0;var W=w.lanes|w.childLanes;if(xo(d,W),d===Qo&&(wo=Qo=null,gr=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||_||(_=!0,Ht(Fn,function(){return dt(),null})),W=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||W){W=$a.transition,$a.transition=null;var ce=mr;mr=1;var Fe=Sr;Sr|=4,ap.current=null,sp(d,w),yf(w,d),Ip(Oh),Oc=!!qd,Oh=qd=null,d.current=w,md(w),Xt(),Sr=Fe,mr=ce,$a.transition=W}else d.current=w;if(_&&(_=!1,v=d,b=B),W=d.pendingLanes,W===0&&(g=null),Kr(w.stateNode),Z(d,Qt()),m!==null)for(M=d.onRecoverableError,w=0;w<m.length;w++)B=m[w],M(B.value,{componentStack:B.stack,digest:B.digest});if(c)throw c=!1,d=f,f=null,d;return(b&1)!==0&&d.tag!==0&&dt(),W=d.pendingLanes,(W&1)!==0?d===C?I++:(I=0,C=d):I=0,Na(),null}function dt(){if(v!==null){var d=xh(b),m=$a.transition,w=mr;try{if($a.transition=null,mr=16>d?16:d,v===null)var M=!1;else{if(d=v,v=null,b=0,(Sr&6)!==0)throw Error(z(331));var B=Sr;for(Sr|=4,Zn=d.current;Zn!==null;){var W=Zn,ce=W.child;if((Zn.flags&16)!==0){var Fe=W.deletions;if(Fe!==null){for(var Ze=0;Ze<Fe.length;Ze++){var kt=Fe[Ze];for(Zn=kt;Zn!==null;){var en=Zn;switch(en.tag){case 0:case 11:case 15:ru(8,en,W)}var ln=en.child;if(ln!==null)ln.return=en,Zn=ln;else for(;Zn!==null;){en=Zn;var rn=en.sibling,zn=en.return;if(fd(en),en===kt){Zn=null;break}if(rn!==null){rn.return=zn,Zn=rn;break}Zn=zn}}}var Bn=W.alternate;if(Bn!==null){var Nn=Bn.child;if(Nn!==null){Bn.child=null;do{var Lr=Nn.sibling;Nn.sibling=null,Nn=Lr}while(Nn!==null)}}Zn=W}}if((W.subtreeFlags&2064)!==0&&ce!==null)ce.return=W,Zn=ce;else e:for(;Zn!==null;){if(W=Zn,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:ru(9,W,W.return)}var bt=W.sibling;if(bt!==null){bt.return=W.return,Zn=bt;break e}Zn=W.return}}var at=d.current;for(Zn=at;Zn!==null;){ce=Zn;var Et=ce.child;if((ce.subtreeFlags&2064)!==0&&Et!==null)Et.return=ce,Zn=Et;else e:for(ce=at;Zn!==null;){if(Fe=Zn,(Fe.flags&2048)!==0)try{switch(Fe.tag){case 0:case 11:case 15:ou(9,Fe)}}catch(ii){Lt(Fe,Fe.return,ii)}if(Fe===ce){Zn=null;break e}var vn=Fe.sibling;if(vn!==null){vn.return=Fe.return,Zn=vn;break e}Zn=Fe.return}}if(Sr=B,Na(),ir&&typeof ir.onPostCommitFiberRoot=="function")try{ir.onPostCommitFiberRoot(Rr,d)}catch{}M=!0}return M}finally{mr=w,$a.transition=m}}return!1}function Rt(d,m,w){m=ko(w,m),m=cf(d,m,1),d=ra(d,m,1),m=D(),d!==null&&(Zs(d,1,m),Z(d,m))}function Lt(d,m,w){if(d.tag===3)Rt(d,d,w);else for(;m!==null;){if(m.tag===3){Rt(m,d,w);break}else if(m.tag===1){var M=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof M.componentDidCatch=="function"&&(g===null||!g.has(M))){d=ko(w,d),d=sc(m,d,1),m=ra(m,d,1),d=D(),m!==null&&(Zs(m,1,d),Z(m,d));break}}m=m.return}}function At(d,m,w){var M=d.pingCache;M!==null&&M.delete(m),m=D(),d.pingedLanes|=d.suspendedLanes&w,Qo===d&&(gr&w)===w&&(Vo===4||Vo===3&&(gr&130023424)===gr&&500>Qt()-l?xe(d,0):ua|=w),Z(d,m)}function wt(d,m){m===0&&((d.mode&1)===0?m=1:(m=br,br<<=1,(br&130023424)===0&&(br=4194304)));var w=D();d=No(d,m),d!==null&&(Zs(d,m,w),Z(d,w))}function tn(d){var m=d.memoizedState,w=0;m!==null&&(w=m.retryLane),wt(d,w)}function Yt(d,m){var w=0;switch(d.tag){case 13:var M=d.stateNode,B=d.memoizedState;B!==null&&(w=B.retryLane);break;case 19:M=d.stateNode;break;default:throw Error(z(314))}M!==null&&M.delete(m),wt(d,w)}var Bt;Bt=function(d,m,w){if(d!==null)if(d.memoizedProps!==m.pendingProps||Ds.current)cs=!0;else{if((d.lanes&w)===0&&(m.flags&128)===0)return cs=!1,mf(d,m,w);cs=(d.flags&131072)!==0}else cs=!1,zr&&(m.flags&1048576)!==0&&Vh(m,qu,m.index);switch(m.lanes=0,m.tag){case 2:var M=m.type;ud(d,m),d=m.pendingProps;var B=Ql(m,Yo.current);wa(m,w),B=rf(null,m,M,d,B,w);var W=of();return m.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,Bo(M)?(W=!0,Zc(m)):W=!1,m.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,ef(m),B.updater=oh,m.stateNode=B,B._reactInternals=m,Fs(m,M,d,w),m=Mc(null,m,M,!0,W,w)):(m.tag=0,zr&&W&&Gf(m),us(null,m,B,w),m=m.child),m;case 16:M=m.elementType;e:{switch(ud(d,m),d=m.pendingProps,B=M._init,M=B(M._payload),m.type=M,B=m.tag=Ri(M),d=ws(M,d),B){case 0:m=sd(null,m,M,d,w);break e;case 1:m=ff(null,m,M,d,w);break e;case 11:m=Jr(null,m,M,d,w);break e;case 14:m=nu(null,m,M,ws(M.type,d),w);break e}throw Error(z(306,M,""))}return m;case 0:return M=m.type,B=m.pendingProps,B=m.elementType===M?B:ws(M,B),sd(d,m,M,B,w);case 1:return M=m.type,B=m.pendingProps,B=m.elementType===M?B:ws(M,B),ff(d,m,M,B,w);case 3:e:{if(al(m),d===null)throw Error(z(387));M=m.pendingProps,W=m.memoizedState,B=W.element,qf(d,m),ja(m,M,null,w);var ce=m.memoizedState;if(M=ce.element,W.isDehydrated)if(W={element:M,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},m.updateQueue.baseState=W,m.memoizedState=W,m.flags&256){B=ko(Error(z(423)),m),m=bs(d,m,M,w,B);break e}else if(M!==B){B=ko(Error(z(424)),m),m=bs(d,m,M,w,B);break e}else for(na=El(m.stateNode.containerInfo.firstChild),Os=m,zr=!0,ya=null,w=Wf(m,null,M,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(va(),M===B){m=ll(d,m,w);break e}us(d,m,M,w)}m=m.child}return m;case 5:return tf(m),d===null&&Pl(m),M=m.type,B=m.pendingProps,W=d!==null?d.memoizedProps:null,ce=B.children,Bu(M,B)?ce=null:W!==null&&Bu(M,W)&&(m.flags|=32),Cc(d,m),us(d,m,ce,w),m.child;case 6:return d===null&&Pl(m),null;case 13:return ld(d,m,w);case 4:return eh(m,m.stateNode.containerInfo),M=m.pendingProps,d===null?m.child=Jc(m,null,M,w):us(d,m,M,w),m.child;case 11:return M=m.type,B=m.pendingProps,B=m.elementType===M?B:ws(M,B),Jr(d,m,M,B,w);case 7:return us(d,m,m.pendingProps,w),m.child;case 8:return us(d,m,m.pendingProps.children,w),m.child;case 12:return us(d,m,m.pendingProps.children,w),m.child;case 10:e:{if(M=m.type._context,B=m.pendingProps,W=m.memoizedProps,ce=B.value,Fr(xa,M._currentValue),M._currentValue=ce,W!==null)if(Ls(W.value,ce)){if(W.children===B.children&&!Ds.current){m=ll(d,m,w);break e}}else for(W=m.child,W!==null&&(W.return=m);W!==null;){var Fe=W.dependencies;if(Fe!==null){ce=W.child;for(var Ze=Fe.firstContext;Ze!==null;){if(Ze.context===M){if(W.tag===1){Ze=ia(-1,w&-w),Ze.tag=2;var kt=W.updateQueue;if(kt!==null){kt=kt.shared;var en=kt.pending;en===null?Ze.next=Ze:(Ze.next=en.next,en.next=Ze),kt.pending=Ze}}W.lanes|=w,Ze=W.alternate,Ze!==null&&(Ze.lanes|=w),Qc(W.return,w,m),Fe.lanes|=w;break}Ze=Ze.next}}else if(W.tag===10)ce=W.type===m.type?null:W.child;else if(W.tag===18){if(ce=W.return,ce===null)throw Error(z(341));ce.lanes|=w,Fe=ce.alternate,Fe!==null&&(Fe.lanes|=w),Qc(ce,w,m),ce=W.sibling}else ce=W.child;if(ce!==null)ce.return=W;else for(ce=W;ce!==null;){if(ce===m){ce=null;break}if(W=ce.sibling,W!==null){W.return=ce.return,ce=W;break}ce=ce.return}W=ce}us(d,m,B.children,w),m=m.child}return m;case 9:return B=m.type,M=m.pendingProps.children,wa(m,w),B=ss(B),M=M(B),m.flags|=1,us(d,m,M,w),m.child;case 14:return M=m.type,B=ws(M,m.pendingProps),B=ws(M.type,B),nu(d,m,M,B,w);case 15:return hf(d,m,m.type,m.pendingProps,w);case 17:return M=m.type,B=m.pendingProps,B=m.elementType===M?B:ws(M,B),ud(d,m),m.tag=1,Bo(M)?(d=!0,Zc(m)):d=!1,wa(m,w),lf(m,M,B),Fs(m,M,B,w),Mc(null,m,M,!0,d,w);case 19:return np(d,m,w);case 22:return df(d,m,w)}throw Error(z(156,m.tag))};function Ht(d,m){return Ve(d,m)}function _n(d,m,w,M){this.tag=d,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=M,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function An(d,m,w,M){return new _n(d,m,w,M)}function si(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Ri(d){if(typeof d=="function")return si(d)?1:0;if(d!=null){if(d=d.$$typeof,d===pi)return 11;if(d===Hn)return 14}return 2}function Kt(d,m){var w=d.alternate;return w===null?(w=An(d.tag,m,d.key,d.mode),w.elementType=d.elementType,w.type=d.type,w.stateNode=d.stateNode,w.alternate=d,d.alternate=w):(w.pendingProps=m,w.type=d.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=d.flags&14680064,w.childLanes=d.childLanes,w.lanes=d.lanes,w.child=d.child,w.memoizedProps=d.memoizedProps,w.memoizedState=d.memoizedState,w.updateQueue=d.updateQueue,m=d.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=d.sibling,w.index=d.index,w.ref=d.ref,w}function wi(d,m,w,M,B,W){var ce=2;if(M=d,typeof d=="function")si(d)&&(ce=1);else if(typeof d=="string")ce=5;else e:switch(d){case jt:return Mn(w.children,B,W,m);case Mt:ce=8,B|=8;break;case Rn:return d=An(12,w,m,B|2),d.elementType=Rn,d.lanes=W,d;case dn:return d=An(13,w,m,B),d.elementType=dn,d.lanes=W,d;case mi:return d=An(19,w,m,B),d.elementType=mi,d.lanes=W,d;case Jt:return Ai(w,B,W,m);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Kn:ce=10;break e;case Ti:ce=9;break e;case pi:ce=11;break e;case Hn:ce=14;break e;case Wt:ce=16,M=null;break e}throw Error(z(130,d==null?d:typeof d,""))}return m=An(ce,w,m,B),m.elementType=d,m.type=M,m.lanes=W,m}function Mn(d,m,w,M){return d=An(7,d,M,m),d.lanes=w,d}function Ai(d,m,w,M){return d=An(22,d,M,m),d.elementType=Jt,d.lanes=w,d.stateNode={isHidden:!1},d}function ji(d,m,w){return d=An(6,d,null,m),d.lanes=w,d}function Fi(d,m,w){return m=An(4,d.children!==null?d.children:[],d.key,m),m.lanes=w,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}function Ii(d,m,w,M,B){this.tag=m,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Oo(0),this.expirationTimes=Oo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oo(0),this.identifierPrefix=M,this.onRecoverableError=B,this.mutableSourceEagerHydrationData=null}function Gn(d,m,w,M,B,W,ce,Fe,Ze){return d=new Ii(d,m,w,Fe,Ze),m===1?(m=1,W===!0&&(m|=8)):m=0,W=An(3,null,null,m),d.current=W,W.stateNode=d,W.memoizedState={element:M,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},ef(W),d}function zi(d,m,w){var M=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nt,key:M==null?null:""+M,children:d,containerInfo:m,implementation:w}}function _r(d){if(!d)return Il;d=d._reactInternals;e:{if(se(d)!==d||d.tag!==1)throw Error(z(170));var m=d;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(Bo(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(z(171))}if(d.tag===1){var w=d.type;if(Bo(w))return ea(d,w,m)}return m}function ur(d,m,w,M,B,W,ce,Fe,Ze){return d=Gn(w,M,!0,d,B,W,ce,Fe,Ze),d.context=_r(null),w=d.current,M=D(),B=V(w),W=ia(M,B),W.callback=m??null,ra(w,W,B),d.current.lanes=B,Zs(d,B,M),Z(d,M),d}function Ci(d,m,w,M){var B=m.current,W=D(),ce=V(B);return w=_r(w),m.context===null?m.context=w:m.pendingContext=w,m=ia(W,ce),m.payload={element:d},M=M===void 0?null:M,M!==null&&(m.callback=M),d=ra(B,m,ce),d!==null&&(j(d,B,ce,W),qt(d,B,ce)),ce}function hi(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Wn(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var w=d.retryLane;d.retryLane=w!==0&&w<m?w:m}}function tr(d,m){Wn(d,m),(d=d.alternate)&&Wn(d,m)}function Mr(){return null}var dr=typeof reportError=="function"?reportError:function(d){console.error(d)};function Hi(d){this._internalRoot=d}Go.prototype.render=Hi.prototype.render=function(d){var m=this._internalRoot;if(m===null)throw Error(z(409));Ci(d,m,null,null)},Go.prototype.unmount=Hi.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var m=d.containerInfo;ue(function(){Ci(null,d,null,null)}),m[tl]=null}};function Go(d){this._internalRoot=d}Go.prototype.unstable_scheduleHydration=function(d){if(d){var m=Za();d={blockedOn:null,target:d,priority:m};for(var w=0;w<Ys.length&&m!==0&&m<Ys[w].priority;w++);Ys.splice(w,0,d),w===0&&bh(d)}};function Co(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Ur(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function $o(){}function es(d,m,w,M,B){if(B){if(typeof M=="function"){var W=M;M=function(){var kt=hi(ce);W.call(kt)}}var ce=ur(m,M,d,0,null,!1,!1,"",$o);return d._reactRootContainer=ce,d[tl]=ce.current,Lh(d.nodeType===8?d.parentNode:d),ue(),ce}for(;B=d.lastChild;)d.removeChild(B);if(typeof M=="function"){var Fe=M;M=function(){var kt=hi(Ze);Fe.call(kt)}}var Ze=Gn(d,0,!1,null,null,!1,!1,"",$o);return d._reactRootContainer=Ze,d[tl]=Ze.current,Lh(d.nodeType===8?d.parentNode:d),ue(function(){Ci(m,Ze,w,M)}),Ze}function go(d,m,w,M,B){var W=w._reactRootContainer;if(W){var ce=W;if(typeof B=="function"){var Fe=B;B=function(){var Ze=hi(ce);Fe.call(Ze)}}Ci(m,ce,d,B)}else ce=es(w,m,d,B,M);return hi(ce)}wh=function(d){switch(d.tag){case 3:var m=d.stateNode;if(m.current.memoizedState.isDehydrated){var w=uo(m.pendingLanes);w!==0&&(Gl(m,w|1),Z(m,Qt()),(Sr&6)===0&&(t=Qt()+500,Na()))}break;case 13:ue(function(){var M=No(d,1);if(M!==null){var B=D();j(M,d,1,B)}}),tr(d,1)}},bu=function(d){if(d.tag===13){var m=No(d,134217728);if(m!==null){var w=D();j(m,d,134217728,w)}tr(d,134217728)}},Tu=function(d){if(d.tag===13){var m=V(d),w=No(d,m);if(w!==null){var M=D();j(w,d,m,M)}tr(d,m)}},Za=function(){return mr},ps=function(d,m){var w=mr;try{return mr=d,m()}finally{mr=w}},Ms=function(d,m,w){switch(m){case"input":if(Pr(d,w),m=w.name,w.type==="radio"&&m!=null){for(w=d;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<w.length;m++){var M=w[m];if(M!==d&&M.form===d.form){var B=jh(M);if(!B)throw Error(z(90));Ji(M),Pr(M,B)}}}break;case"textarea":So(d,w);break;case"select":m=w.value,m!=null&&Gs(d,!!w.multiple,m,!1)}},Yr=ge,Wr=ue;var Sa={usingClientEntryPoint:!1,Events:[Vu,nl,jh,ei,io,ge]},Ts={findFiberByHostInstance:vc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ns={bundleType:Ts.bundleType,version:Ts.version,rendererPackageName:Ts.rendererPackageName,rendererConfig:Ts.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ct.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Ge(d),d===null?null:d.stateNode},findFiberByHostInstance:Ts.findFiberByHostInstance||Mr,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fr.isDisabled&&fr.supportsFiber)try{Rr=fr.inject(Ns),ir=fr}catch{}}return jl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sa,jl.createPortal=function(d,m){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Co(m))throw Error(z(200));return zi(d,m,null,w)},jl.createRoot=function(d,m){if(!Co(d))throw Error(z(299));var w=!1,M="",B=dr;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(M=m.identifierPrefix),m.onRecoverableError!==void 0&&(B=m.onRecoverableError)),m=Gn(d,1,!1,null,null,w,!1,M,B),d[tl]=m.current,Lh(d.nodeType===8?d.parentNode:d),new Hi(m)},jl.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(z(188)):(d=Object.keys(d).join(","),Error(z(268,d)));return d=Ge(m),d=d===null?null:d.stateNode,d},jl.flushSync=function(d){return ue(d)},jl.hydrate=function(d,m,w){if(!Ur(m))throw Error(z(200));return go(null,d,m,!0,w)},jl.hydrateRoot=function(d,m,w){if(!Co(d))throw Error(z(405));var M=w!=null&&w.hydratedSources||null,B=!1,W="",ce=dr;if(w!=null&&(w.unstable_strictMode===!0&&(B=!0),w.identifierPrefix!==void 0&&(W=w.identifierPrefix),w.onRecoverableError!==void 0&&(ce=w.onRecoverableError)),m=ur(m,null,d,1,w??null,B,!1,W,ce),d[tl]=m.current,Lh(d),M)for(d=0;d<M.length;d++)w=M[d],B=w._getVersion,B=B(w._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[w,B]:m.mutableSourceEagerHydrationData.push(w,B);return new Go(m)},jl.render=function(d,m,w){if(!Ur(m))throw Error(z(200));return go(null,d,m,!1,w)},jl.unmountComponentAtNode=function(d){if(!Ur(d))throw Error(z(40));return d._reactRootContainer?(ue(function(){go(null,null,d,!1,function(){d._reactRootContainer=null,d[tl]=null})}),!0):!1},jl.unstable_batchedUpdates=ge,jl.unstable_renderSubtreeIntoContainer=function(d,m,w,M){if(!Ur(w))throw Error(z(200));if(d==null||d._reactInternals===void 0)throw Error(z(38));return go(d,m,w,!1,M)},jl.version="18.3.1-next-f1338f8080-20240426",jl}var pb;function sT(){if(pb)return pv.exports;pb=1;function T(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(T)}catch(R){console.error(R)}}return T(),pv.exports=lC(),pv.exports}var mb;function cC(){if(mb)return p_;mb=1;var T=sT();return p_.createRoot=T.createRoot,p_.hydrateRoot=T.hydrateRoot,p_}var uC=cC(),be=j_();const En=Yv(be),Kv=nC({__proto__:null,default:En},[be]);function eo(T,R,{checkForDefaultPrevented:z=!0}={}){return function(X){if(T?.(X),z===!1||!X.defaultPrevented)return R?.(X)}}function mg(T,R=[]){let z=[];function N(J,re){const s=be.createContext(re),he=z.length;z=[...z,re];const ae=oe=>{const{scope:Oe,children:je,...st}=oe,Ce=Oe?.[T]?.[he]||s,Be=be.useMemo(()=>st,Object.values(st));return $.jsx(Ce.Provider,{value:Be,children:je})};ae.displayName=J+"Provider";function Me(oe,Oe){const je=Oe?.[T]?.[he]||s,st=be.useContext(je);if(st)return st;if(re!==void 0)return re;throw new Error(`\`${oe}\` must be used within \`${J}\``)}return[ae,Me]}const X=()=>{const J=z.map(re=>be.createContext(re));return function(s){const he=s?.[T]||J;return be.useMemo(()=>({[`__scope${T}`]:{...s,[T]:he}}),[s,he])}};return X.scopeName=T,[N,hC(X,...R)]}function hC(...T){const R=T[0];if(T.length===1)return R;const z=()=>{const N=T.map(X=>({useScope:X(),scopeName:X.scopeName}));return function(J){const re=N.reduce((s,{useScope:he,scopeName:ae})=>{const oe=he(J)[`__scope${ae}`];return{...s,...oe}},{});return be.useMemo(()=>({[`__scope${R.scopeName}`]:re}),[re])}};return z.scopeName=R.scopeName,z}function gb(T,R){if(typeof T=="function")return T(R);T!=null&&(T.current=R)}function gg(...T){return R=>{let z=!1;const N=T.map(X=>{const J=gb(X,R);return!z&&typeof J=="function"&&(z=!0),J});if(z)return()=>{for(let X=0;X<N.length;X++){const J=N[X];typeof J=="function"?J():gb(T[X],null)}}}}function Vs(...T){return be.useCallback(gg(...T),T)}function _b(T){const R=dC(T),z=be.forwardRef((N,X)=>{const{children:J,...re}=N,s=be.Children.toArray(J),he=s.find(pC);if(he){const ae=he.props.children,Me=s.map(oe=>oe===he?be.Children.count(ae)>1?be.Children.only(null):be.isValidElement(ae)?ae.props.children:null:oe);return $.jsx(R,{...re,ref:X,children:be.isValidElement(ae)?be.cloneElement(ae,void 0,Me):null})}return $.jsx(R,{...re,ref:X,children:J})});return z.displayName=`${T}.Slot`,z}function dC(T){const R=be.forwardRef((z,N)=>{const{children:X,...J}=z;if(be.isValidElement(X)){const re=gC(X),s=mC(J,X.props);return X.type!==be.Fragment&&(s.ref=N?gg(N,re):re),be.cloneElement(X,s)}return be.Children.count(X)>1?be.Children.only(null):null});return R.displayName=`${T}.SlotClone`,R}var fC=Symbol("radix.slottable");function pC(T){return be.isValidElement(T)&&typeof T.type=="function"&&"__radixId"in T.type&&T.type.__radixId===fC}function mC(T,R){const z={...R};for(const N in R){const X=T[N],J=R[N];/^on[A-Z]/.test(N)?X&&J?z[N]=(...s)=>{const he=J(...s);return X(...s),he}:X&&(z[N]=X):N==="style"?z[N]={...X,...J}:N==="className"&&(z[N]=[X,J].filter(Boolean).join(" "))}return{...T,...z}}function gC(T){let R=Object.getOwnPropertyDescriptor(T.props,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning;return z?T.ref:(R=Object.getOwnPropertyDescriptor(T,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning,z?T.props.ref:T.props.ref||T.ref)}function aT(T){const R=T+"CollectionProvider",[z,N]=mg(R),[X,J]=z(R,{collectionRef:{current:null},itemMap:new Map}),re=Ce=>{const{scope:Be,children:Xe}=Ce,ot=En.useRef(null),Ke=En.useRef(new Map).current;return $.jsx(X,{scope:Be,itemMap:Ke,collectionRef:ot,children:Xe})};re.displayName=R;const s=T+"CollectionSlot",he=_b(s),ae=En.forwardRef((Ce,Be)=>{const{scope:Xe,children:ot}=Ce,Ke=J(s,Xe),Ct=Vs(Be,Ke.collectionRef);return $.jsx(he,{ref:Ct,children:ot})});ae.displayName=s;const Me=T+"CollectionItemSlot",oe="data-radix-collection-item",Oe=_b(Me),je=En.forwardRef((Ce,Be)=>{const{scope:Xe,children:ot,...Ke}=Ce,Ct=En.useRef(null),tt=Vs(Be,Ct),Nt=J(Me,Xe);return En.useEffect(()=>(Nt.itemMap.set(Ct,{ref:Ct,...Ke}),()=>void Nt.itemMap.delete(Ct))),$.jsx(Oe,{[oe]:"",ref:tt,children:ot})});je.displayName=Me;function st(Ce){const Be=J(T+"CollectionConsumer",Ce);return En.useCallback(()=>{const ot=Be.collectionRef.current;if(!ot)return[];const Ke=Array.from(ot.querySelectorAll(`[${oe}]`));return Array.from(Be.itemMap.values()).sort((Nt,jt)=>Ke.indexOf(Nt.ref.current)-Ke.indexOf(jt.ref.current))},[Be.collectionRef,Be.itemMap])}return[{Provider:re,Slot:ae,ItemSlot:je},st,N]}var Us=globalThis?.document?be.useLayoutEffect:()=>{},_C=Kv[" useId ".trim().toString()]||(()=>{}),yC=0;function _g(T){const[R,z]=be.useState(_C());return Us(()=>{z(N=>N??String(yC++))},[T]),T||(R?`radix-${R}`:"")}var yg=sT();const lT=Yv(yg);function vC(T){const R=xC(T),z=be.forwardRef((N,X)=>{const{children:J,...re}=N,s=be.Children.toArray(J),he=s.find(bC);if(he){const ae=he.props.children,Me=s.map(oe=>oe===he?be.Children.count(ae)>1?be.Children.only(null):be.isValidElement(ae)?ae.props.children:null:oe);return $.jsx(R,{...re,ref:X,children:be.isValidElement(ae)?be.cloneElement(ae,void 0,Me):null})}return $.jsx(R,{...re,ref:X,children:J})});return z.displayName=`${T}.Slot`,z}function xC(T){const R=be.forwardRef((z,N)=>{const{children:X,...J}=z;if(be.isValidElement(X)){const re=SC(X),s=TC(J,X.props);return X.type!==be.Fragment&&(s.ref=N?gg(N,re):re),be.cloneElement(X,s)}return be.Children.count(X)>1?be.Children.only(null):null});return R.displayName=`${T}.SlotClone`,R}var wC=Symbol("radix.slottable");function bC(T){return be.isValidElement(T)&&typeof T.type=="function"&&"__radixId"in T.type&&T.type.__radixId===wC}function TC(T,R){const z={...R};for(const N in R){const X=T[N],J=R[N];/^on[A-Z]/.test(N)?X&&J?z[N]=(...s)=>{const he=J(...s);return X(...s),he}:X&&(z[N]=X):N==="style"?z[N]={...X,...J}:N==="className"&&(z[N]=[X,J].filter(Boolean).join(" "))}return{...T,...z}}function SC(T){let R=Object.getOwnPropertyDescriptor(T.props,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning;return z?T.ref:(R=Object.getOwnPropertyDescriptor(T,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning,z?T.props.ref:T.props.ref||T.ref)}var EC=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],_o=EC.reduce((T,R)=>{const z=vC(`Primitive.${R}`),N=be.forwardRef((X,J)=>{const{asChild:re,...s}=X,he=re?z:R;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(he,{...s,ref:J})});return N.displayName=`Primitive.${R}`,{...T,[R]:N}},{});function IC(T,R){T&&yg.flushSync(()=>T.dispatchEvent(R))}function Ed(T){const R=be.useRef(T);return be.useEffect(()=>{R.current=T}),be.useMemo(()=>(...z)=>R.current?.(...z),[])}var AC=Kv[" useInsertionEffect ".trim().toString()]||Us;function M_({prop:T,defaultProp:R,onChange:z=()=>{},caller:N}){const[X,J,re]=CC({defaultProp:R,onChange:z}),s=T!==void 0,he=s?T:X;{const Me=be.useRef(T!==void 0);be.useEffect(()=>{const oe=Me.current;oe!==s&&console.warn(`${N} is changing from ${oe?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),Me.current=s},[s,N])}const ae=be.useCallback(Me=>{if(s){const oe=MC(Me)?Me(T):Me;oe!==T&&re.current?.(oe)}else J(Me)},[s,T,J,re]);return[he,ae]}function CC({defaultProp:T,onChange:R}){const[z,N]=be.useState(T),X=be.useRef(z),J=be.useRef(R);return AC(()=>{J.current=R},[R]),be.useEffect(()=>{X.current!==z&&(J.current?.(z),X.current=z)},[z,X]),[z,N,J]}function MC(T){return typeof T=="function"}var PC=be.createContext(void 0);function Jv(T){const R=be.useContext(PC);return T||R||"ltr"}var _v="rovingFocusGroup.onEntryFocus",RC={bubbles:!1,cancelable:!0},vg="RovingFocusGroup",[kv,cT,kC]=aT(vg),[zC,uT]=mg(vg,[kC]),[LC,DC]=zC(vg),hT=be.forwardRef((T,R)=>$.jsx(kv.Provider,{scope:T.__scopeRovingFocusGroup,children:$.jsx(kv.Slot,{scope:T.__scopeRovingFocusGroup,children:$.jsx(OC,{...T,ref:R})})}));hT.displayName=vg;var OC=be.forwardRef((T,R)=>{const{__scopeRovingFocusGroup:z,orientation:N,loop:X=!1,dir:J,currentTabStopId:re,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:he,onEntryFocus:ae,preventScrollOnEntryFocus:Me=!1,...oe}=T,Oe=be.useRef(null),je=Vs(R,Oe),st=Jv(J),[Ce,Be]=M_({prop:re,defaultProp:s??null,onChange:he,caller:vg}),[Xe,ot]=be.useState(!1),Ke=Ed(ae),Ct=cT(z),tt=be.useRef(!1),[Nt,jt]=be.useState(0);return be.useEffect(()=>{const Mt=Oe.current;if(Mt)return Mt.addEventListener(_v,Ke),()=>Mt.removeEventListener(_v,Ke)},[Ke]),$.jsx(LC,{scope:z,orientation:N,dir:st,loop:X,currentTabStopId:Ce,onItemFocus:be.useCallback(Mt=>Be(Mt),[Be]),onItemShiftTab:be.useCallback(()=>ot(!0),[]),onFocusableItemAdd:be.useCallback(()=>jt(Mt=>Mt+1),[]),onFocusableItemRemove:be.useCallback(()=>jt(Mt=>Mt-1),[]),children:$.jsx(_o.div,{tabIndex:Xe||Nt===0?-1:0,"data-orientation":N,...oe,ref:je,style:{outline:"none",...T.style},onMouseDown:eo(T.onMouseDown,()=>{tt.current=!0}),onFocus:eo(T.onFocus,Mt=>{const Rn=!tt.current;if(Mt.target===Mt.currentTarget&&Rn&&!Xe){const Kn=new CustomEvent(_v,RC);if(Mt.currentTarget.dispatchEvent(Kn),!Kn.defaultPrevented){const Ti=Ct().filter(Wt=>Wt.focusable),pi=Ti.find(Wt=>Wt.active),dn=Ti.find(Wt=>Wt.id===Ce),Hn=[pi,dn,...Ti].filter(Boolean).map(Wt=>Wt.ref.current);pT(Hn,Me)}}tt.current=!1}),onBlur:eo(T.onBlur,()=>ot(!1))})})}),dT="RovingFocusGroupItem",fT=be.forwardRef((T,R)=>{const{__scopeRovingFocusGroup:z,focusable:N=!0,active:X=!1,tabStopId:J,children:re,...s}=T,he=_g(),ae=J||he,Me=DC(dT,z),oe=Me.currentTabStopId===ae,Oe=cT(z),{onFocusableItemAdd:je,onFocusableItemRemove:st,currentTabStopId:Ce}=Me;return be.useEffect(()=>{if(N)return je(),()=>st()},[N,je,st]),$.jsx(kv.ItemSlot,{scope:z,id:ae,focusable:N,active:X,children:$.jsx(_o.span,{tabIndex:oe?0:-1,"data-orientation":Me.orientation,...s,ref:R,onMouseDown:eo(T.onMouseDown,Be=>{N?Me.onItemFocus(ae):Be.preventDefault()}),onFocus:eo(T.onFocus,()=>Me.onItemFocus(ae)),onKeyDown:eo(T.onKeyDown,Be=>{if(Be.key==="Tab"&&Be.shiftKey){Me.onItemShiftTab();return}if(Be.target!==Be.currentTarget)return;const Xe=NC(Be,Me.orientation,Me.dir);if(Xe!==void 0){if(Be.metaKey||Be.ctrlKey||Be.altKey||Be.shiftKey)return;Be.preventDefault();let Ke=Oe().filter(Ct=>Ct.focusable).map(Ct=>Ct.ref.current);if(Xe==="last")Ke.reverse();else if(Xe==="prev"||Xe==="next"){Xe==="prev"&&Ke.reverse();const Ct=Ke.indexOf(Be.currentTarget);Ke=Me.loop?jC(Ke,Ct+1):Ke.slice(Ct+1)}setTimeout(()=>pT(Ke))}}),children:typeof re=="function"?re({isCurrentTabStop:oe,hasTabStop:Ce!=null}):re})})});fT.displayName=dT;var FC={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function BC(T,R){return R!=="rtl"?T:T==="ArrowLeft"?"ArrowRight":T==="ArrowRight"?"ArrowLeft":T}function NC(T,R,z){const N=BC(T.key,z);if(!(R==="vertical"&&["ArrowLeft","ArrowRight"].includes(N))&&!(R==="horizontal"&&["ArrowUp","ArrowDown"].includes(N)))return FC[N]}function pT(T,R=!1){const z=document.activeElement;for(const N of T)if(N===z||(N.focus({preventScroll:R}),document.activeElement!==z))return}function jC(T,R){return T.map((z,N)=>T[(R+N)%T.length])}var VC=hT,UC=fT;function GC(T,R){return be.useReducer((z,N)=>R[z][N]??z,T)}var mT=T=>{const{present:R,children:z}=T,N=$C(R),X=typeof z=="function"?z({present:N.isPresent}):be.Children.only(z),J=Vs(N.ref,HC(X));return typeof z=="function"||N.isPresent?be.cloneElement(X,{ref:J}):null};mT.displayName="Presence";function $C(T){const[R,z]=be.useState(),N=be.useRef(null),X=be.useRef(T),J=be.useRef("none"),re=T?"mounted":"unmounted",[s,he]=GC(re,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return be.useEffect(()=>{const ae=m_(N.current);J.current=s==="mounted"?ae:"none"},[s]),Us(()=>{const ae=N.current,Me=X.current;if(Me!==T){const Oe=J.current,je=m_(ae);T?he("MOUNT"):je==="none"||ae?.display==="none"?he("UNMOUNT"):he(Me&&Oe!==je?"ANIMATION_OUT":"UNMOUNT"),X.current=T}},[T,he]),Us(()=>{if(R){let ae;const Me=R.ownerDocument.defaultView??window,oe=je=>{const Ce=m_(N.current).includes(CSS.escape(je.animationName));if(je.target===R&&Ce&&(he("ANIMATION_END"),!X.current)){const Be=R.style.animationFillMode;R.style.animationFillMode="forwards",ae=Me.setTimeout(()=>{R.style.animationFillMode==="forwards"&&(R.style.animationFillMode=Be)})}},Oe=je=>{je.target===R&&(J.current=m_(N.current))};return R.addEventListener("animationstart",Oe),R.addEventListener("animationcancel",oe),R.addEventListener("animationend",oe),()=>{Me.clearTimeout(ae),R.removeEventListener("animationstart",Oe),R.removeEventListener("animationcancel",oe),R.removeEventListener("animationend",oe)}}else he("ANIMATION_END")},[R,he]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:be.useCallback(ae=>{N.current=ae?getComputedStyle(ae):null,z(ae)},[])}}function m_(T){return T?.animationName||"none"}function HC(T){let R=Object.getOwnPropertyDescriptor(T.props,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning;return z?T.ref:(R=Object.getOwnPropertyDescriptor(T,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning,z?T.props.ref:T.props.ref||T.ref)}var V_="Tabs",[WC]=mg(V_,[uT]),gT=uT(),[qC,Qv]=WC(V_),_T=be.forwardRef((T,R)=>{const{__scopeTabs:z,value:N,onValueChange:X,defaultValue:J,orientation:re="horizontal",dir:s,activationMode:he="automatic",...ae}=T,Me=Jv(s),[oe,Oe]=M_({prop:N,onChange:X,defaultProp:J??"",caller:V_});return $.jsx(qC,{scope:z,baseId:_g(),value:oe,onValueChange:Oe,orientation:re,dir:Me,activationMode:he,children:$.jsx(_o.div,{dir:Me,"data-orientation":re,...ae,ref:R})})});_T.displayName=V_;var yT="TabsList",vT=be.forwardRef((T,R)=>{const{__scopeTabs:z,loop:N=!0,...X}=T,J=Qv(yT,z),re=gT(z);return $.jsx(VC,{asChild:!0,...re,orientation:J.orientation,dir:J.dir,loop:N,children:$.jsx(_o.div,{role:"tablist","aria-orientation":J.orientation,...X,ref:R})})});vT.displayName=yT;var xT="TabsTrigger",wT=be.forwardRef((T,R)=>{const{__scopeTabs:z,value:N,disabled:X=!1,...J}=T,re=Qv(xT,z),s=gT(z),he=ST(re.baseId,N),ae=ET(re.baseId,N),Me=N===re.value;return $.jsx(UC,{asChild:!0,...s,focusable:!X,active:Me,children:$.jsx(_o.button,{type:"button",role:"tab","aria-selected":Me,"aria-controls":ae,"data-state":Me?"active":"inactive","data-disabled":X?"":void 0,disabled:X,id:he,...J,ref:R,onMouseDown:eo(T.onMouseDown,oe=>{!X&&oe.button===0&&oe.ctrlKey===!1?re.onValueChange(N):oe.preventDefault()}),onKeyDown:eo(T.onKeyDown,oe=>{[" ","Enter"].includes(oe.key)&&re.onValueChange(N)}),onFocus:eo(T.onFocus,()=>{const oe=re.activationMode!=="manual";!Me&&!X&&oe&&re.onValueChange(N)})})})});wT.displayName=xT;var bT="TabsContent",TT=be.forwardRef((T,R)=>{const{__scopeTabs:z,value:N,forceMount:X,children:J,...re}=T,s=Qv(bT,z),he=ST(s.baseId,N),ae=ET(s.baseId,N),Me=N===s.value,oe=be.useRef(Me);return be.useEffect(()=>{const Oe=requestAnimationFrame(()=>oe.current=!1);return()=>cancelAnimationFrame(Oe)},[]),$.jsx(mT,{present:X||Me,children:({present:Oe})=>$.jsx(_o.div,{"data-state":Me?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":he,hidden:!Oe,id:ae,tabIndex:0,...re,ref:R,style:{...T.style,animationDuration:oe.current?"0s":void 0},children:Oe&&J})})});TT.displayName=bT;function ST(T,R){return`${T}-trigger-${R}`}function ET(T,R){return`${T}-content-${R}`}var ZC=_T,XC=vT,YC=wT,KC=TT;function IT(T){var R,z,N="";if(typeof T=="string"||typeof T=="number")N+=T;else if(typeof T=="object")if(Array.isArray(T)){var X=T.length;for(R=0;R<X;R++)T[R]&&(z=IT(T[R]))&&(N&&(N+=" "),N+=z)}else for(z in T)T[z]&&(N&&(N+=" "),N+=z);return N}function AT(){for(var T,R,z=0,N="",X=arguments.length;z<X;z++)(T=arguments[z])&&(R=IT(T))&&(N&&(N+=" "),N+=R);return N}const JC=(T,R)=>{const z=new Array(T.length+R.length);for(let N=0;N<T.length;N++)z[N]=T[N];for(let N=0;N<R.length;N++)z[T.length+N]=R[N];return z},QC=(T,R)=>({classGroupId:T,validator:R}),CT=(T=new Map,R=null,z)=>({nextPart:T,validators:R,classGroupId:z}),P_="-",yb=[],eM="arbitrary..",tM=T=>{const R=iM(T),{conflictingClassGroups:z,conflictingClassGroupModifiers:N}=T;return{getClassGroupId:re=>{if(re.startsWith("[")&&re.endsWith("]"))return nM(re);const s=re.split(P_),he=s[0]===""&&s.length>1?1:0;return MT(s,he,R)},getConflictingClassGroupIds:(re,s)=>{if(s){const he=N[re],ae=z[re];return he?ae?JC(ae,he):he:ae||yb}return z[re]||yb}}},MT=(T,R,z)=>{if(T.length-R===0)return z.classGroupId;const X=T[R],J=z.nextPart.get(X);if(J){const ae=MT(T,R+1,J);if(ae)return ae}const re=z.validators;if(re===null)return;const s=R===0?T.join(P_):T.slice(R).join(P_),he=re.length;for(let ae=0;ae<he;ae++){const Me=re[ae];if(Me.validator(s))return Me.classGroupId}},nM=T=>T.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const R=T.slice(1,-1),z=R.indexOf(":"),N=R.slice(0,z);return N?eM+N:void 0})(),iM=T=>{const{theme:R,classGroups:z}=T;return rM(z,R)},rM=(T,R)=>{const z=CT();for(const N in T){const X=T[N];ex(X,z,N,R)}return z},ex=(T,R,z,N)=>{const X=T.length;for(let J=0;J<X;J++){const re=T[J];oM(re,R,z,N)}},oM=(T,R,z,N)=>{if(typeof T=="string"){sM(T,R,z);return}if(typeof T=="function"){aM(T,R,z,N);return}lM(T,R,z,N)},sM=(T,R,z)=>{const N=T===""?R:PT(R,T);N.classGroupId=z},aM=(T,R,z,N)=>{if(cM(T)){ex(T(N),R,z,N);return}R.validators===null&&(R.validators=[]),R.validators.push(QC(z,T))},lM=(T,R,z,N)=>{const X=Object.entries(T),J=X.length;for(let re=0;re<J;re++){const[s,he]=X[re];ex(he,PT(R,s),z,N)}},PT=(T,R)=>{let z=T;const N=R.split(P_),X=N.length;for(let J=0;J<X;J++){const re=N[J];let s=z.nextPart.get(re);s||(s=CT(),z.nextPart.set(re,s)),z=s}return z},cM=T=>"isThemeGetter"in T&&T.isThemeGetter===!0,uM=T=>{if(T<1)return{get:()=>{},set:()=>{}};let R=0,z=Object.create(null),N=Object.create(null);const X=(J,re)=>{z[J]=re,R++,R>T&&(R=0,N=z,z=Object.create(null))};return{get(J){let re=z[J];if(re!==void 0)return re;if((re=N[J])!==void 0)return X(J,re),re},set(J,re){J in z?z[J]=re:X(J,re)}}},zv="!",vb=":",hM=[],xb=(T,R,z,N,X)=>({modifiers:T,hasImportantModifier:R,baseClassName:z,maybePostfixModifierPosition:N,isExternal:X}),dM=T=>{const{prefix:R,experimentalParseClassName:z}=T;let N=X=>{const J=[];let re=0,s=0,he=0,ae;const Me=X.length;for(let Ce=0;Ce<Me;Ce++){const Be=X[Ce];if(re===0&&s===0){if(Be===vb){J.push(X.slice(he,Ce)),he=Ce+1;continue}if(Be==="/"){ae=Ce;continue}}Be==="["?re++:Be==="]"?re--:Be==="("?s++:Be===")"&&s--}const oe=J.length===0?X:X.slice(he);let Oe=oe,je=!1;oe.endsWith(zv)?(Oe=oe.slice(0,-1),je=!0):oe.startsWith(zv)&&(Oe=oe.slice(1),je=!0);const st=ae&&ae>he?ae-he:void 0;return xb(J,je,Oe,st)};if(R){const X=R+vb,J=N;N=re=>re.startsWith(X)?J(re.slice(X.length)):xb(hM,!1,re,void 0,!0)}if(z){const X=N;N=J=>z({className:J,parseClassName:X})}return N},fM=T=>{const R=new Map;return T.orderSensitiveModifiers.forEach((z,N)=>{R.set(z,1e6+N)}),z=>{const N=[];let X=[];for(let J=0;J<z.length;J++){const re=z[J],s=re[0]==="[",he=R.has(re);s||he?(X.length>0&&(X.sort(),N.push(...X),X=[]),N.push(re)):X.push(re)}return X.length>0&&(X.sort(),N.push(...X)),N}},pM=T=>({cache:uM(T.cacheSize),parseClassName:dM(T),sortModifiers:fM(T),...tM(T)}),mM=/\s+/,gM=(T,R)=>{const{parseClassName:z,getClassGroupId:N,getConflictingClassGroupIds:X,sortModifiers:J}=R,re=[],s=T.trim().split(mM);let he="";for(let ae=s.length-1;ae>=0;ae-=1){const Me=s[ae],{isExternal:oe,modifiers:Oe,hasImportantModifier:je,baseClassName:st,maybePostfixModifierPosition:Ce}=z(Me);if(oe){he=Me+(he.length>0?" "+he:he);continue}let Be=!!Ce,Xe=N(Be?st.substring(0,Ce):st);if(!Xe){if(!Be){he=Me+(he.length>0?" "+he:he);continue}if(Xe=N(st),!Xe){he=Me+(he.length>0?" "+he:he);continue}Be=!1}const ot=Oe.length===0?"":Oe.length===1?Oe[0]:J(Oe).join(":"),Ke=je?ot+zv:ot,Ct=Ke+Xe;if(re.indexOf(Ct)>-1)continue;re.push(Ct);const tt=X(Xe,Be);for(let Nt=0;Nt<tt.length;++Nt){const jt=tt[Nt];re.push(Ke+jt)}he=Me+(he.length>0?" "+he:he)}return he},_M=(...T)=>{let R=0,z,N,X="";for(;R<T.length;)(z=T[R++])&&(N=RT(z))&&(X&&(X+=" "),X+=N);return X},RT=T=>{if(typeof T=="string")return T;let R,z="";for(let N=0;N<T.length;N++)T[N]&&(R=RT(T[N]))&&(z&&(z+=" "),z+=R);return z},yM=(T,...R)=>{let z,N,X,J;const re=he=>{const ae=R.reduce((Me,oe)=>oe(Me),T());return z=pM(ae),N=z.cache.get,X=z.cache.set,J=s,s(he)},s=he=>{const ae=N(he);if(ae)return ae;const Me=gM(he,z);return X(he,Me),Me};return J=re,(...he)=>J(_M(...he))},vM=[],js=T=>{const R=z=>z[T]||vM;return R.isThemeGetter=!0,R},kT=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,zT=/^\((?:(\w[\w-]*):)?(.+)\)$/i,xM=/^\d+\/\d+$/,wM=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,bM=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,TM=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,SM=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,EM=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rm=T=>xM.test(T),pr=T=>!!T&&!Number.isNaN(Number(T)),If=T=>!!T&&Number.isInteger(Number(T)),yv=T=>T.endsWith("%")&&pr(T.slice(0,-1)),xd=T=>wM.test(T),IM=()=>!0,AM=T=>bM.test(T)&&!TM.test(T),LT=()=>!1,CM=T=>SM.test(T),MM=T=>EM.test(T),PM=T=>!ai(T)&&!li(T),RM=T=>dm(T,FT,LT),ai=T=>kT.test(T),_p=T=>dm(T,BT,AM),vv=T=>dm(T,OM,pr),wb=T=>dm(T,DT,LT),kM=T=>dm(T,OT,MM),g_=T=>dm(T,NT,CM),li=T=>zT.test(T),ug=T=>fm(T,BT),zM=T=>fm(T,FM),bb=T=>fm(T,DT),LM=T=>fm(T,FT),DM=T=>fm(T,OT),__=T=>fm(T,NT,!0),dm=(T,R,z)=>{const N=kT.exec(T);return N?N[1]?R(N[1]):z(N[2]):!1},fm=(T,R,z=!1)=>{const N=zT.exec(T);return N?N[1]?R(N[1]):z:!1},DT=T=>T==="position"||T==="percentage",OT=T=>T==="image"||T==="url",FT=T=>T==="length"||T==="size"||T==="bg-size",BT=T=>T==="length",OM=T=>T==="number",FM=T=>T==="family-name",NT=T=>T==="shadow",BM=()=>{const T=js("color"),R=js("font"),z=js("text"),N=js("font-weight"),X=js("tracking"),J=js("leading"),re=js("breakpoint"),s=js("container"),he=js("spacing"),ae=js("radius"),Me=js("shadow"),oe=js("inset-shadow"),Oe=js("text-shadow"),je=js("drop-shadow"),st=js("blur"),Ce=js("perspective"),Be=js("aspect"),Xe=js("ease"),ot=js("animate"),Ke=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ct=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],tt=()=>[...Ct(),li,ai],Nt=()=>["auto","hidden","clip","visible","scroll"],jt=()=>["auto","contain","none"],Mt=()=>[li,ai,he],Rn=()=>[rm,"full","auto",...Mt()],Kn=()=>[If,"none","subgrid",li,ai],Ti=()=>["auto",{span:["full",If,li,ai]},If,li,ai],pi=()=>[If,"auto",li,ai],dn=()=>["auto","min","max","fr",li,ai],mi=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Hn=()=>["start","end","center","stretch","center-safe","end-safe"],Wt=()=>["auto",...Mt()],Jt=()=>[rm,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Mt()],nt=()=>[T,li,ai],mn=()=>[...Ct(),bb,wb,{position:[li,ai]}],sn=()=>["no-repeat",{repeat:["","x","y","space","round"]}],rt=()=>["auto","cover","contain",LM,RM,{size:[li,ai]}],Ut=()=>[yv,ug,_p],Gt=()=>["","none","full",ae,li,ai],gn=()=>["",pr,ug,_p],jn=()=>["solid","dashed","dotted","double"],oi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],cn=()=>[pr,yv,bb,wb],wn=()=>["","none",st,li,ai],xn=()=>["none",pr,li,ai],kn=()=>["none",pr,li,ai],_i=()=>[pr,li,ai],Ji=()=>[rm,"full",...Mt()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[xd],breakpoint:[xd],color:[IM],container:[xd],"drop-shadow":[xd],ease:["in","out","in-out"],font:[PM],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[xd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[xd],shadow:[xd],spacing:["px",pr],text:[xd],"text-shadow":[xd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",rm,ai,li,Be]}],container:["container"],columns:[{columns:[pr,ai,li,s]}],"break-after":[{"break-after":Ke()}],"break-before":[{"break-before":Ke()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:tt()}],overflow:[{overflow:Nt()}],"overflow-x":[{"overflow-x":Nt()}],"overflow-y":[{"overflow-y":Nt()}],overscroll:[{overscroll:jt()}],"overscroll-x":[{"overscroll-x":jt()}],"overscroll-y":[{"overscroll-y":jt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Rn()}],"inset-x":[{"inset-x":Rn()}],"inset-y":[{"inset-y":Rn()}],start:[{start:Rn()}],end:[{end:Rn()}],top:[{top:Rn()}],right:[{right:Rn()}],bottom:[{bottom:Rn()}],left:[{left:Rn()}],visibility:["visible","invisible","collapse"],z:[{z:[If,"auto",li,ai]}],basis:[{basis:[rm,"full","auto",s,...Mt()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[pr,rm,"auto","initial","none",ai]}],grow:[{grow:["",pr,li,ai]}],shrink:[{shrink:["",pr,li,ai]}],order:[{order:[If,"first","last","none",li,ai]}],"grid-cols":[{"grid-cols":Kn()}],"col-start-end":[{col:Ti()}],"col-start":[{"col-start":pi()}],"col-end":[{"col-end":pi()}],"grid-rows":[{"grid-rows":Kn()}],"row-start-end":[{row:Ti()}],"row-start":[{"row-start":pi()}],"row-end":[{"row-end":pi()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":dn()}],"auto-rows":[{"auto-rows":dn()}],gap:[{gap:Mt()}],"gap-x":[{"gap-x":Mt()}],"gap-y":[{"gap-y":Mt()}],"justify-content":[{justify:[...mi(),"normal"]}],"justify-items":[{"justify-items":[...Hn(),"normal"]}],"justify-self":[{"justify-self":["auto",...Hn()]}],"align-content":[{content:["normal",...mi()]}],"align-items":[{items:[...Hn(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Hn(),{baseline:["","last"]}]}],"place-content":[{"place-content":mi()}],"place-items":[{"place-items":[...Hn(),"baseline"]}],"place-self":[{"place-self":["auto",...Hn()]}],p:[{p:Mt()}],px:[{px:Mt()}],py:[{py:Mt()}],ps:[{ps:Mt()}],pe:[{pe:Mt()}],pt:[{pt:Mt()}],pr:[{pr:Mt()}],pb:[{pb:Mt()}],pl:[{pl:Mt()}],m:[{m:Wt()}],mx:[{mx:Wt()}],my:[{my:Wt()}],ms:[{ms:Wt()}],me:[{me:Wt()}],mt:[{mt:Wt()}],mr:[{mr:Wt()}],mb:[{mb:Wt()}],ml:[{ml:Wt()}],"space-x":[{"space-x":Mt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Mt()}],"space-y-reverse":["space-y-reverse"],size:[{size:Jt()}],w:[{w:[s,"screen",...Jt()]}],"min-w":[{"min-w":[s,"screen","none",...Jt()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[re]},...Jt()]}],h:[{h:["screen","lh",...Jt()]}],"min-h":[{"min-h":["screen","lh","none",...Jt()]}],"max-h":[{"max-h":["screen","lh",...Jt()]}],"font-size":[{text:["base",z,ug,_p]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[N,li,vv]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",yv,ai]}],"font-family":[{font:[zM,ai,R]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[X,li,ai]}],"line-clamp":[{"line-clamp":[pr,"none",li,vv]}],leading:[{leading:[J,...Mt()]}],"list-image":[{"list-image":["none",li,ai]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",li,ai]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:nt()}],"text-color":[{text:nt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...jn(),"wavy"]}],"text-decoration-thickness":[{decoration:[pr,"from-font","auto",li,_p]}],"text-decoration-color":[{decoration:nt()}],"underline-offset":[{"underline-offset":[pr,"auto",li,ai]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Mt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",li,ai]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",li,ai]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:mn()}],"bg-repeat":[{bg:sn()}],"bg-size":[{bg:rt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},If,li,ai],radial:["",li,ai],conic:[If,li,ai]},DM,kM]}],"bg-color":[{bg:nt()}],"gradient-from-pos":[{from:Ut()}],"gradient-via-pos":[{via:Ut()}],"gradient-to-pos":[{to:Ut()}],"gradient-from":[{from:nt()}],"gradient-via":[{via:nt()}],"gradient-to":[{to:nt()}],rounded:[{rounded:Gt()}],"rounded-s":[{"rounded-s":Gt()}],"rounded-e":[{"rounded-e":Gt()}],"rounded-t":[{"rounded-t":Gt()}],"rounded-r":[{"rounded-r":Gt()}],"rounded-b":[{"rounded-b":Gt()}],"rounded-l":[{"rounded-l":Gt()}],"rounded-ss":[{"rounded-ss":Gt()}],"rounded-se":[{"rounded-se":Gt()}],"rounded-ee":[{"rounded-ee":Gt()}],"rounded-es":[{"rounded-es":Gt()}],"rounded-tl":[{"rounded-tl":Gt()}],"rounded-tr":[{"rounded-tr":Gt()}],"rounded-br":[{"rounded-br":Gt()}],"rounded-bl":[{"rounded-bl":Gt()}],"border-w":[{border:gn()}],"border-w-x":[{"border-x":gn()}],"border-w-y":[{"border-y":gn()}],"border-w-s":[{"border-s":gn()}],"border-w-e":[{"border-e":gn()}],"border-w-t":[{"border-t":gn()}],"border-w-r":[{"border-r":gn()}],"border-w-b":[{"border-b":gn()}],"border-w-l":[{"border-l":gn()}],"divide-x":[{"divide-x":gn()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":gn()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...jn(),"hidden","none"]}],"divide-style":[{divide:[...jn(),"hidden","none"]}],"border-color":[{border:nt()}],"border-color-x":[{"border-x":nt()}],"border-color-y":[{"border-y":nt()}],"border-color-s":[{"border-s":nt()}],"border-color-e":[{"border-e":nt()}],"border-color-t":[{"border-t":nt()}],"border-color-r":[{"border-r":nt()}],"border-color-b":[{"border-b":nt()}],"border-color-l":[{"border-l":nt()}],"divide-color":[{divide:nt()}],"outline-style":[{outline:[...jn(),"none","hidden"]}],"outline-offset":[{"outline-offset":[pr,li,ai]}],"outline-w":[{outline:["",pr,ug,_p]}],"outline-color":[{outline:nt()}],shadow:[{shadow:["","none",Me,__,g_]}],"shadow-color":[{shadow:nt()}],"inset-shadow":[{"inset-shadow":["none",oe,__,g_]}],"inset-shadow-color":[{"inset-shadow":nt()}],"ring-w":[{ring:gn()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:nt()}],"ring-offset-w":[{"ring-offset":[pr,_p]}],"ring-offset-color":[{"ring-offset":nt()}],"inset-ring-w":[{"inset-ring":gn()}],"inset-ring-color":[{"inset-ring":nt()}],"text-shadow":[{"text-shadow":["none",Oe,__,g_]}],"text-shadow-color":[{"text-shadow":nt()}],opacity:[{opacity:[pr,li,ai]}],"mix-blend":[{"mix-blend":[...oi(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":oi()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[pr]}],"mask-image-linear-from-pos":[{"mask-linear-from":cn()}],"mask-image-linear-to-pos":[{"mask-linear-to":cn()}],"mask-image-linear-from-color":[{"mask-linear-from":nt()}],"mask-image-linear-to-color":[{"mask-linear-to":nt()}],"mask-image-t-from-pos":[{"mask-t-from":cn()}],"mask-image-t-to-pos":[{"mask-t-to":cn()}],"mask-image-t-from-color":[{"mask-t-from":nt()}],"mask-image-t-to-color":[{"mask-t-to":nt()}],"mask-image-r-from-pos":[{"mask-r-from":cn()}],"mask-image-r-to-pos":[{"mask-r-to":cn()}],"mask-image-r-from-color":[{"mask-r-from":nt()}],"mask-image-r-to-color":[{"mask-r-to":nt()}],"mask-image-b-from-pos":[{"mask-b-from":cn()}],"mask-image-b-to-pos":[{"mask-b-to":cn()}],"mask-image-b-from-color":[{"mask-b-from":nt()}],"mask-image-b-to-color":[{"mask-b-to":nt()}],"mask-image-l-from-pos":[{"mask-l-from":cn()}],"mask-image-l-to-pos":[{"mask-l-to":cn()}],"mask-image-l-from-color":[{"mask-l-from":nt()}],"mask-image-l-to-color":[{"mask-l-to":nt()}],"mask-image-x-from-pos":[{"mask-x-from":cn()}],"mask-image-x-to-pos":[{"mask-x-to":cn()}],"mask-image-x-from-color":[{"mask-x-from":nt()}],"mask-image-x-to-color":[{"mask-x-to":nt()}],"mask-image-y-from-pos":[{"mask-y-from":cn()}],"mask-image-y-to-pos":[{"mask-y-to":cn()}],"mask-image-y-from-color":[{"mask-y-from":nt()}],"mask-image-y-to-color":[{"mask-y-to":nt()}],"mask-image-radial":[{"mask-radial":[li,ai]}],"mask-image-radial-from-pos":[{"mask-radial-from":cn()}],"mask-image-radial-to-pos":[{"mask-radial-to":cn()}],"mask-image-radial-from-color":[{"mask-radial-from":nt()}],"mask-image-radial-to-color":[{"mask-radial-to":nt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Ct()}],"mask-image-conic-pos":[{"mask-conic":[pr]}],"mask-image-conic-from-pos":[{"mask-conic-from":cn()}],"mask-image-conic-to-pos":[{"mask-conic-to":cn()}],"mask-image-conic-from-color":[{"mask-conic-from":nt()}],"mask-image-conic-to-color":[{"mask-conic-to":nt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:mn()}],"mask-repeat":[{mask:sn()}],"mask-size":[{mask:rt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",li,ai]}],filter:[{filter:["","none",li,ai]}],blur:[{blur:wn()}],brightness:[{brightness:[pr,li,ai]}],contrast:[{contrast:[pr,li,ai]}],"drop-shadow":[{"drop-shadow":["","none",je,__,g_]}],"drop-shadow-color":[{"drop-shadow":nt()}],grayscale:[{grayscale:["",pr,li,ai]}],"hue-rotate":[{"hue-rotate":[pr,li,ai]}],invert:[{invert:["",pr,li,ai]}],saturate:[{saturate:[pr,li,ai]}],sepia:[{sepia:["",pr,li,ai]}],"backdrop-filter":[{"backdrop-filter":["","none",li,ai]}],"backdrop-blur":[{"backdrop-blur":wn()}],"backdrop-brightness":[{"backdrop-brightness":[pr,li,ai]}],"backdrop-contrast":[{"backdrop-contrast":[pr,li,ai]}],"backdrop-grayscale":[{"backdrop-grayscale":["",pr,li,ai]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[pr,li,ai]}],"backdrop-invert":[{"backdrop-invert":["",pr,li,ai]}],"backdrop-opacity":[{"backdrop-opacity":[pr,li,ai]}],"backdrop-saturate":[{"backdrop-saturate":[pr,li,ai]}],"backdrop-sepia":[{"backdrop-sepia":["",pr,li,ai]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Mt()}],"border-spacing-x":[{"border-spacing-x":Mt()}],"border-spacing-y":[{"border-spacing-y":Mt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",li,ai]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[pr,"initial",li,ai]}],ease:[{ease:["linear","initial",Xe,li,ai]}],delay:[{delay:[pr,li,ai]}],animate:[{animate:["none",ot,li,ai]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Ce,li,ai]}],"perspective-origin":[{"perspective-origin":tt()}],rotate:[{rotate:xn()}],"rotate-x":[{"rotate-x":xn()}],"rotate-y":[{"rotate-y":xn()}],"rotate-z":[{"rotate-z":xn()}],scale:[{scale:kn()}],"scale-x":[{"scale-x":kn()}],"scale-y":[{"scale-y":kn()}],"scale-z":[{"scale-z":kn()}],"scale-3d":["scale-3d"],skew:[{skew:_i()}],"skew-x":[{"skew-x":_i()}],"skew-y":[{"skew-y":_i()}],transform:[{transform:[li,ai,"","none","gpu","cpu"]}],"transform-origin":[{origin:tt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ji()}],"translate-x":[{"translate-x":Ji()}],"translate-y":[{"translate-y":Ji()}],"translate-z":[{"translate-z":Ji()}],"translate-none":["translate-none"],accent:[{accent:nt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:nt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",li,ai]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Mt()}],"scroll-mx":[{"scroll-mx":Mt()}],"scroll-my":[{"scroll-my":Mt()}],"scroll-ms":[{"scroll-ms":Mt()}],"scroll-me":[{"scroll-me":Mt()}],"scroll-mt":[{"scroll-mt":Mt()}],"scroll-mr":[{"scroll-mr":Mt()}],"scroll-mb":[{"scroll-mb":Mt()}],"scroll-ml":[{"scroll-ml":Mt()}],"scroll-p":[{"scroll-p":Mt()}],"scroll-px":[{"scroll-px":Mt()}],"scroll-py":[{"scroll-py":Mt()}],"scroll-ps":[{"scroll-ps":Mt()}],"scroll-pe":[{"scroll-pe":Mt()}],"scroll-pt":[{"scroll-pt":Mt()}],"scroll-pr":[{"scroll-pr":Mt()}],"scroll-pb":[{"scroll-pb":Mt()}],"scroll-pl":[{"scroll-pl":Mt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",li,ai]}],fill:[{fill:["none",...nt()]}],"stroke-w":[{stroke:[pr,ug,_p,vv]}],stroke:[{stroke:["none",...nt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},NM=yM(BM);function Wo(...T){return NM(AT(T))}function jT({className:T,...R}){return $.jsx(ZC,{"data-slot":"tabs",className:Wo("flex flex-col gap-2",T),...R})}function VT({className:T,...R}){return $.jsx(XC,{"data-slot":"tabs-list",className:Wo("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",T),...R})}function wd({className:T,...R}){return $.jsx(YC,{"data-slot":"tabs-trigger",className:Wo("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",T),...R})}function bd({className:T,...R}){return $.jsx(KC,{"data-slot":"tabs-content",className:Wo("flex-1 outline-none",T),...R})}var jM=(T,R,z,N,X,J,re,s)=>{let he=document.documentElement,ae=["light","dark"];function Me(je){(Array.isArray(T)?T:[T]).forEach(st=>{let Ce=st==="class",Be=Ce&&J?X.map(Xe=>J[Xe]||Xe):X;Ce?(he.classList.remove(...Be),he.classList.add(J&&J[je]?J[je]:je)):he.setAttribute(st,je)}),oe(je)}function oe(je){s&&ae.includes(je)&&(he.style.colorScheme=je)}function Oe(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(N)Me(N);else try{let je=localStorage.getItem(R)||z,st=re&&je==="system"?Oe():je;Me(st)}catch{}},VM=be.createContext(void 0),UM={setTheme:T=>{},themes:[]},GM=()=>{var T;return(T=be.useContext(VM))!=null?T:UM};be.memo(({forcedTheme:T,storageKey:R,attribute:z,enableSystem:N,enableColorScheme:X,defaultTheme:J,value:re,themes:s,nonce:he,scriptProps:ae})=>{let Me=JSON.stringify([z,R,J,T,s,re,N,X]).slice(1,-1);return be.createElement("script",{...ae,suppressHydrationWarning:!0,nonce:typeof window>"u"?he:"",dangerouslySetInnerHTML:{__html:`(${jM.toString()})(${Me})`}})});function $M(T){if(typeof document>"u")return;let R=document.head||document.getElementsByTagName("head")[0],z=document.createElement("style");z.type="text/css",R.appendChild(z),z.styleSheet?z.styleSheet.cssText=T:z.appendChild(document.createTextNode(T))}const HM=T=>{switch(T){case"success":return ZM;case"info":return YM;case"warning":return XM;case"error":return KM;default:return null}},WM=Array(12).fill(0),qM=({visible:T,className:R})=>En.createElement("div",{className:["sonner-loading-wrapper",R].filter(Boolean).join(" "),"data-visible":T},En.createElement("div",{className:"sonner-spinner"},WM.map((z,N)=>En.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${N}`})))),ZM=En.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},En.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),XM=En.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},En.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),YM=En.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},En.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),KM=En.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},En.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),JM=En.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},En.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),En.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),QM=()=>{const[T,R]=En.useState(document.hidden);return En.useEffect(()=>{const z=()=>{R(document.hidden)};return document.addEventListener("visibilitychange",z),()=>window.removeEventListener("visibilitychange",z)},[]),T};let Lv=1;class eP{constructor(){this.subscribe=R=>(this.subscribers.push(R),()=>{const z=this.subscribers.indexOf(R);this.subscribers.splice(z,1)}),this.publish=R=>{this.subscribers.forEach(z=>z(R))},this.addToast=R=>{this.publish(R),this.toasts=[...this.toasts,R]},this.create=R=>{var z;const{message:N,...X}=R,J=typeof R?.id=="number"||((z=R.id)==null?void 0:z.length)>0?R.id:Lv++,re=this.toasts.find(he=>he.id===J),s=R.dismissible===void 0?!0:R.dismissible;return this.dismissedToasts.has(J)&&this.dismissedToasts.delete(J),re?this.toasts=this.toasts.map(he=>he.id===J?(this.publish({...he,...R,id:J,title:N}),{...he,...R,id:J,dismissible:s,title:N}):he):this.addToast({title:N,...X,dismissible:s,id:J}),J},this.dismiss=R=>(R?(this.dismissedToasts.add(R),requestAnimationFrame(()=>this.subscribers.forEach(z=>z({id:R,dismiss:!0})))):this.toasts.forEach(z=>{this.subscribers.forEach(N=>N({id:z.id,dismiss:!0}))}),R),this.message=(R,z)=>this.create({...z,message:R}),this.error=(R,z)=>this.create({...z,message:R,type:"error"}),this.success=(R,z)=>this.create({...z,type:"success",message:R}),this.info=(R,z)=>this.create({...z,type:"info",message:R}),this.warning=(R,z)=>this.create({...z,type:"warning",message:R}),this.loading=(R,z)=>this.create({...z,type:"loading",message:R}),this.promise=(R,z)=>{if(!z)return;let N;z.loading!==void 0&&(N=this.create({...z,promise:R,type:"loading",message:z.loading,description:typeof z.description!="function"?z.description:void 0}));const X=Promise.resolve(R instanceof Function?R():R);let J=N!==void 0,re;const s=X.then(async ae=>{if(re=["resolve",ae],En.isValidElement(ae))J=!1,this.create({id:N,type:"default",message:ae});else if(nP(ae)&&!ae.ok){J=!1;const oe=typeof z.error=="function"?await z.error(`HTTP error! status: ${ae.status}`):z.error,Oe=typeof z.description=="function"?await z.description(`HTTP error! status: ${ae.status}`):z.description,st=typeof oe=="object"&&!En.isValidElement(oe)?oe:{message:oe};this.create({id:N,type:"error",description:Oe,...st})}else if(ae instanceof Error){J=!1;const oe=typeof z.error=="function"?await z.error(ae):z.error,Oe=typeof z.description=="function"?await z.description(ae):z.description,st=typeof oe=="object"&&!En.isValidElement(oe)?oe:{message:oe};this.create({id:N,type:"error",description:Oe,...st})}else if(z.success!==void 0){J=!1;const oe=typeof z.success=="function"?await z.success(ae):z.success,Oe=typeof z.description=="function"?await z.description(ae):z.description,st=typeof oe=="object"&&!En.isValidElement(oe)?oe:{message:oe};this.create({id:N,type:"success",description:Oe,...st})}}).catch(async ae=>{if(re=["reject",ae],z.error!==void 0){J=!1;const Me=typeof z.error=="function"?await z.error(ae):z.error,oe=typeof z.description=="function"?await z.description(ae):z.description,je=typeof Me=="object"&&!En.isValidElement(Me)?Me:{message:Me};this.create({id:N,type:"error",description:oe,...je})}}).finally(()=>{J&&(this.dismiss(N),N=void 0),z.finally==null||z.finally.call(z)}),he=()=>new Promise((ae,Me)=>s.then(()=>re[0]==="reject"?Me(re[1]):ae(re[1])).catch(Me));return typeof N!="string"&&typeof N!="number"?{unwrap:he}:Object.assign(N,{unwrap:he})},this.custom=(R,z)=>{const N=z?.id||Lv++;return this.create({jsx:R(N),id:N,...z}),N},this.getActiveToasts=()=>this.toasts.filter(R=>!this.dismissedToasts.has(R.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Vl=new eP,tP=(T,R)=>{const z=R?.id||Lv++;return Vl.addToast({title:T,...R,id:z}),z},nP=T=>T&&typeof T=="object"&&"ok"in T&&typeof T.ok=="boolean"&&"status"in T&&typeof T.status=="number",iP=tP,rP=()=>Vl.toasts,oP=()=>Vl.getActiveToasts(),xv=Object.assign(iP,{success:Vl.success,info:Vl.info,warning:Vl.warning,error:Vl.error,custom:Vl.custom,message:Vl.message,promise:Vl.promise,dismiss:Vl.dismiss,loading:Vl.loading},{getHistory:rP,getToasts:oP});$M("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function y_(T){return T.label!==void 0}const sP=3,aP="24px",lP="16px",Tb=4e3,cP=356,uP=14,hP=45,dP=200;function ph(...T){return T.filter(Boolean).join(" ")}function fP(T){const[R,z]=T.split("-"),N=[];return R&&N.push(R),z&&N.push(z),N}const pP=T=>{var R,z,N,X,J,re,s,he,ae;const{invert:Me,toast:oe,unstyled:Oe,interacting:je,setHeights:st,visibleToasts:Ce,heights:Be,index:Xe,toasts:ot,expanded:Ke,removeToast:Ct,defaultRichColors:tt,closeButton:Nt,style:jt,cancelButtonStyle:Mt,actionButtonStyle:Rn,className:Kn="",descriptionClassName:Ti="",duration:pi,position:dn,gap:mi,expandByDefault:Hn,classNames:Wt,icons:Jt,closeButtonAriaLabel:nt="Close toast"}=T,[mn,sn]=En.useState(null),[rt,Ut]=En.useState(null),[Gt,gn]=En.useState(!1),[jn,oi]=En.useState(!1),[cn,wn]=En.useState(!1),[xn,kn]=En.useState(!1),[_i,Ji]=En.useState(!1),[Gi,yo]=En.useState(0),[Es,vo]=En.useState(0),Pr=En.useRef(oe.duration||pi||Tb),Cr=En.useRef(null),Is=En.useRef(null),Ca=Xe===0,Gs=Xe+1<=Ce,to=oe.type,ds=oe.dismissible!==!1,So=oe.className||"",Ma=oe.descriptionClassName||"",Pa=En.useMemo(()=>Be.findIndex(ei=>ei.toastId===oe.id)||0,[Be,oe.id]),As=En.useMemo(()=>{var ei;return(ei=oe.closeButton)!=null?ei:Nt},[oe.closeButton,Nt]),Cs=En.useMemo(()=>oe.duration||pi||Tb,[oe.duration,pi]),Eo=En.useRef(0),qo=En.useRef(0),$s=En.useRef(0),Hs=En.useRef(null),[Ul,no]=dn.split("-"),Zo=En.useMemo(()=>Be.reduce((ei,io,Yr)=>Yr>=Pa?ei:ei+io.height,0),[Be,Pa]),_l=QM(),Ra=oe.invert||Me,fs=to==="loading";qo.current=En.useMemo(()=>Pa*mi+Zo,[Pa,Zo]),En.useEffect(()=>{Pr.current=Cs},[Cs]),En.useEffect(()=>{gn(!0)},[]),En.useEffect(()=>{const ei=Is.current;if(ei){const io=ei.getBoundingClientRect().height;return vo(io),st(Yr=>[{toastId:oe.id,height:io,position:oe.position},...Yr]),()=>st(Yr=>Yr.filter(Wr=>Wr.toastId!==oe.id))}},[st,oe.id]),En.useLayoutEffect(()=>{if(!Gt)return;const ei=Is.current,io=ei.style.height;ei.style.height="auto";const Yr=ei.getBoundingClientRect().height;ei.style.height=io,vo(Yr),st(Wr=>Wr.find(ct=>ct.toastId===oe.id)?Wr.map(ct=>ct.toastId===oe.id?{...ct,height:Yr}:ct):[{toastId:oe.id,height:Yr,position:oe.position},...Wr])},[Gt,oe.title,oe.description,st,oe.id,oe.jsx,oe.action,oe.cancel]);const Ro=En.useCallback(()=>{oi(!0),yo(qo.current),st(ei=>ei.filter(io=>io.toastId!==oe.id)),setTimeout(()=>{Ct(oe)},dP)},[oe,Ct,st,qo]);En.useEffect(()=>{if(oe.promise&&to==="loading"||oe.duration===1/0||oe.type==="loading")return;let ei;return Ke||je||_l?(()=>{if($s.current<Eo.current){const Wr=new Date().getTime()-Eo.current;Pr.current=Pr.current-Wr}$s.current=new Date().getTime()})():(()=>{Pr.current!==1/0&&(Eo.current=new Date().getTime(),ei=setTimeout(()=>{oe.onAutoClose==null||oe.onAutoClose.call(oe,oe),Ro()},Pr.current))})(),()=>clearTimeout(ei)},[Ke,je,oe,to,_l,Ro]),En.useEffect(()=>{oe.delete&&(Ro(),oe.onDismiss==null||oe.onDismiss.call(oe,oe))},[Ro,oe.delete]);function Ms(){var ei;if(Jt?.loading){var io;return En.createElement("div",{className:ph(Wt?.loader,oe==null||(io=oe.classNames)==null?void 0:io.loader,"sonner-loader"),"data-visible":to==="loading"},Jt.loading)}return En.createElement(qM,{className:ph(Wt?.loader,oe==null||(ei=oe.classNames)==null?void 0:ei.loader),visible:to==="loading"})}const ka=oe.icon||Jt?.[to]||HM(to);var Ps,lr;return En.createElement("li",{tabIndex:0,ref:Is,className:ph(Kn,So,Wt?.toast,oe==null||(R=oe.classNames)==null?void 0:R.toast,Wt?.default,Wt?.[to],oe==null||(z=oe.classNames)==null?void 0:z[to]),"data-sonner-toast":"","data-rich-colors":(Ps=oe.richColors)!=null?Ps:tt,"data-styled":!(oe.jsx||oe.unstyled||Oe),"data-mounted":Gt,"data-promise":!!oe.promise,"data-swiped":_i,"data-removed":jn,"data-visible":Gs,"data-y-position":Ul,"data-x-position":no,"data-index":Xe,"data-front":Ca,"data-swiping":cn,"data-dismissible":ds,"data-type":to,"data-invert":Ra,"data-swipe-out":xn,"data-swipe-direction":rt,"data-expanded":!!(Ke||Hn&&Gt),"data-testid":oe.testId,style:{"--index":Xe,"--toasts-before":Xe,"--z-index":ot.length-Xe,"--offset":`${jn?Gi:qo.current}px`,"--initial-height":Hn?"auto":`${Es}px`,...jt,...oe.style},onDragEnd:()=>{wn(!1),sn(null),Hs.current=null},onPointerDown:ei=>{ei.button!==2&&(fs||!ds||(Cr.current=new Date,yo(qo.current),ei.target.setPointerCapture(ei.pointerId),ei.target.tagName!=="BUTTON"&&(wn(!0),Hs.current={x:ei.clientX,y:ei.clientY})))},onPointerUp:()=>{var ei,io,Yr;if(xn||!ds)return;Hs.current=null;const Wr=Number(((ei=Is.current)==null?void 0:ei.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Wa=Number(((io=Is.current)==null?void 0:io.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ct=new Date().getTime()-((Yr=Cr.current)==null?void 0:Yr.getTime()),qr=mn==="x"?Wr:Wa,yl=Math.abs(qr)/ct;if(Math.abs(qr)>=hP||yl>.11){yo(qo.current),oe.onDismiss==null||oe.onDismiss.call(oe,oe),Ut(mn==="x"?Wr>0?"right":"left":Wa>0?"down":"up"),Ro(),kn(!0);return}else{var co,ti;(co=Is.current)==null||co.style.setProperty("--swipe-amount-x","0px"),(ti=Is.current)==null||ti.style.setProperty("--swipe-amount-y","0px")}Ji(!1),wn(!1),sn(null)},onPointerMove:ei=>{var io,Yr,Wr;if(!Hs.current||!ds||((io=window.getSelection())==null?void 0:io.toString().length)>0)return;const ct=ei.clientY-Hs.current.y,qr=ei.clientX-Hs.current.x;var yl;const co=(yl=T.swipeDirections)!=null?yl:fP(dn);!mn&&(Math.abs(qr)>1||Math.abs(ct)>1)&&sn(Math.abs(qr)>Math.abs(ct)?"x":"y");let ti={x:0,y:0};const ro=Ws=>1/(1.5+Math.abs(Ws)/20);if(mn==="y"){if(co.includes("top")||co.includes("bottom"))if(co.includes("top")&&ct<0||co.includes("bottom")&&ct>0)ti.y=ct;else{const Ws=ct*ro(ct);ti.y=Math.abs(Ws)<Math.abs(ct)?Ws:ct}}else if(mn==="x"&&(co.includes("left")||co.includes("right")))if(co.includes("left")&&qr<0||co.includes("right")&&qr>0)ti.x=qr;else{const Ws=qr*ro(qr);ti.x=Math.abs(Ws)<Math.abs(qr)?Ws:qr}(Math.abs(ti.x)>0||Math.abs(ti.y)>0)&&Ji(!0),(Yr=Is.current)==null||Yr.style.setProperty("--swipe-amount-x",`${ti.x}px`),(Wr=Is.current)==null||Wr.style.setProperty("--swipe-amount-y",`${ti.y}px`)}},As&&!oe.jsx&&to!=="loading"?En.createElement("button",{"aria-label":nt,"data-disabled":fs,"data-close-button":!0,onClick:fs||!ds?()=>{}:()=>{Ro(),oe.onDismiss==null||oe.onDismiss.call(oe,oe)},className:ph(Wt?.closeButton,oe==null||(N=oe.classNames)==null?void 0:N.closeButton)},(lr=Jt?.close)!=null?lr:JM):null,(to||oe.icon||oe.promise)&&oe.icon!==null&&(Jt?.[to]!==null||oe.icon)?En.createElement("div",{"data-icon":"",className:ph(Wt?.icon,oe==null||(X=oe.classNames)==null?void 0:X.icon)},oe.promise||oe.type==="loading"&&!oe.icon?oe.icon||Ms():null,oe.type!=="loading"?ka:null):null,En.createElement("div",{"data-content":"",className:ph(Wt?.content,oe==null||(J=oe.classNames)==null?void 0:J.content)},En.createElement("div",{"data-title":"",className:ph(Wt?.title,oe==null||(re=oe.classNames)==null?void 0:re.title)},oe.jsx?oe.jsx:typeof oe.title=="function"?oe.title():oe.title),oe.description?En.createElement("div",{"data-description":"",className:ph(Ti,Ma,Wt?.description,oe==null||(s=oe.classNames)==null?void 0:s.description)},typeof oe.description=="function"?oe.description():oe.description):null),En.isValidElement(oe.cancel)?oe.cancel:oe.cancel&&y_(oe.cancel)?En.createElement("button",{"data-button":!0,"data-cancel":!0,style:oe.cancelButtonStyle||Mt,onClick:ei=>{y_(oe.cancel)&&ds&&(oe.cancel.onClick==null||oe.cancel.onClick.call(oe.cancel,ei),Ro())},className:ph(Wt?.cancelButton,oe==null||(he=oe.classNames)==null?void 0:he.cancelButton)},oe.cancel.label):null,En.isValidElement(oe.action)?oe.action:oe.action&&y_(oe.action)?En.createElement("button",{"data-button":!0,"data-action":!0,style:oe.actionButtonStyle||Rn,onClick:ei=>{y_(oe.action)&&(oe.action.onClick==null||oe.action.onClick.call(oe.action,ei),!ei.defaultPrevented&&Ro())},className:ph(Wt?.actionButton,oe==null||(ae=oe.classNames)==null?void 0:ae.actionButton)},oe.action.label):null)};function Sb(){if(typeof window>"u"||typeof document>"u")return"ltr";const T=document.documentElement.getAttribute("dir");return T==="auto"||!T?window.getComputedStyle(document.documentElement).direction:T}function mP(T,R){const z={};return[T,R].forEach((N,X)=>{const J=X===1,re=J?"--mobile-offset":"--offset",s=J?lP:aP;function he(ae){["top","right","bottom","left"].forEach(Me=>{z[`${re}-${Me}`]=typeof ae=="number"?`${ae}px`:ae})}typeof N=="number"||typeof N=="string"?he(N):typeof N=="object"?["top","right","bottom","left"].forEach(ae=>{N[ae]===void 0?z[`${re}-${ae}`]=s:z[`${re}-${ae}`]=typeof N[ae]=="number"?`${N[ae]}px`:N[ae]}):he(s)}),z}const gP=En.forwardRef(function(R,z){const{id:N,invert:X,position:J="bottom-right",hotkey:re=["altKey","KeyT"],expand:s,closeButton:he,className:ae,offset:Me,mobileOffset:oe,theme:Oe="light",richColors:je,duration:st,style:Ce,visibleToasts:Be=sP,toastOptions:Xe,dir:ot=Sb(),gap:Ke=uP,icons:Ct,containerAriaLabel:tt="Notifications"}=R,[Nt,jt]=En.useState([]),Mt=En.useMemo(()=>N?Nt.filter(Gt=>Gt.toasterId===N):Nt.filter(Gt=>!Gt.toasterId),[Nt,N]),Rn=En.useMemo(()=>Array.from(new Set([J].concat(Mt.filter(Gt=>Gt.position).map(Gt=>Gt.position)))),[Mt,J]),[Kn,Ti]=En.useState([]),[pi,dn]=En.useState(!1),[mi,Hn]=En.useState(!1),[Wt,Jt]=En.useState(Oe!=="system"?Oe:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),nt=En.useRef(null),mn=re.join("+").replace(/Key/g,"").replace(/Digit/g,""),sn=En.useRef(null),rt=En.useRef(!1),Ut=En.useCallback(Gt=>{jt(gn=>{var jn;return(jn=gn.find(oi=>oi.id===Gt.id))!=null&&jn.delete||Vl.dismiss(Gt.id),gn.filter(({id:oi})=>oi!==Gt.id)})},[]);return En.useEffect(()=>Vl.subscribe(Gt=>{if(Gt.dismiss){requestAnimationFrame(()=>{jt(gn=>gn.map(jn=>jn.id===Gt.id?{...jn,delete:!0}:jn))});return}setTimeout(()=>{lT.flushSync(()=>{jt(gn=>{const jn=gn.findIndex(oi=>oi.id===Gt.id);return jn!==-1?[...gn.slice(0,jn),{...gn[jn],...Gt},...gn.slice(jn+1)]:[Gt,...gn]})})})}),[Nt]),En.useEffect(()=>{if(Oe!=="system"){Jt(Oe);return}if(Oe==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Jt("dark"):Jt("light")),typeof window>"u")return;const Gt=window.matchMedia("(prefers-color-scheme: dark)");try{Gt.addEventListener("change",({matches:gn})=>{Jt(gn?"dark":"light")})}catch{Gt.addListener(({matches:jn})=>{try{Jt(jn?"dark":"light")}catch(oi){console.error(oi)}})}},[Oe]),En.useEffect(()=>{Nt.length<=1&&dn(!1)},[Nt]),En.useEffect(()=>{const Gt=gn=>{var jn;if(re.every(wn=>gn[wn]||gn.code===wn)){var cn;dn(!0),(cn=nt.current)==null||cn.focus()}gn.code==="Escape"&&(document.activeElement===nt.current||(jn=nt.current)!=null&&jn.contains(document.activeElement))&&dn(!1)};return document.addEventListener("keydown",Gt),()=>document.removeEventListener("keydown",Gt)},[re]),En.useEffect(()=>{if(nt.current)return()=>{sn.current&&(sn.current.focus({preventScroll:!0}),sn.current=null,rt.current=!1)}},[nt.current]),En.createElement("section",{ref:z,"aria-label":`${tt} ${mn}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Rn.map((Gt,gn)=>{var jn;const[oi,cn]=Gt.split("-");return Mt.length?En.createElement("ol",{key:Gt,dir:ot==="auto"?Sb():ot,tabIndex:-1,ref:nt,className:ae,"data-sonner-toaster":!0,"data-sonner-theme":Wt,"data-y-position":oi,"data-x-position":cn,style:{"--front-toast-height":`${((jn=Kn[0])==null?void 0:jn.height)||0}px`,"--width":`${cP}px`,"--gap":`${Ke}px`,...Ce,...mP(Me,oe)},onBlur:wn=>{rt.current&&!wn.currentTarget.contains(wn.relatedTarget)&&(rt.current=!1,sn.current&&(sn.current.focus({preventScroll:!0}),sn.current=null))},onFocus:wn=>{wn.target instanceof HTMLElement&&wn.target.dataset.dismissible==="false"||rt.current||(rt.current=!0,sn.current=wn.relatedTarget)},onMouseEnter:()=>dn(!0),onMouseMove:()=>dn(!0),onMouseLeave:()=>{mi||dn(!1)},onDragEnd:()=>dn(!1),onPointerDown:wn=>{wn.target instanceof HTMLElement&&wn.target.dataset.dismissible==="false"||Hn(!0)},onPointerUp:()=>Hn(!1)},Mt.filter(wn=>!wn.position&&gn===0||wn.position===Gt).map((wn,xn)=>{var kn,_i;return En.createElement(pP,{key:wn.id,icons:Ct,index:xn,toast:wn,defaultRichColors:je,duration:(kn=Xe?.duration)!=null?kn:st,className:Xe?.className,descriptionClassName:Xe?.descriptionClassName,invert:X,visibleToasts:Be,closeButton:(_i=Xe?.closeButton)!=null?_i:he,interacting:mi,position:Gt,style:Xe?.style,unstyled:Xe?.unstyled,classNames:Xe?.classNames,cancelButtonStyle:Xe?.cancelButtonStyle,actionButtonStyle:Xe?.actionButtonStyle,closeButtonAriaLabel:Xe?.closeButtonAriaLabel,removeToast:Ut,toasts:Mt.filter(Ji=>Ji.position==wn.position),heights:Kn.filter(Ji=>Ji.position==wn.position),setHeights:Ti,expandByDefault:s,gap:Ke,expanded:pi,swipeDirections:R.swipeDirections})})):null}))}),_P=({...T})=>{const{theme:R="system"}=GM();return $.jsx(gP,{theme:R,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...T})};function Nr({className:T,...R}){return $.jsx("div",{"data-slot":"card",className:Wo("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",T),...R})}function Ia({className:T,...R}){return $.jsx("div",{"data-slot":"card-header",className:Wo("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",T),...R})}function Aa({className:T,...R}){return $.jsx("h4",{"data-slot":"card-title",className:Wo("leading-none",T),...R})}function jr({className:T,...R}){return $.jsx("div",{"data-slot":"card-content",className:Wo("px-6 [&:last-child]:pb-6",T),...R})}var yP=Symbol.for("react.lazy"),R_=Kv[" use ".trim().toString()];function vP(T){return typeof T=="object"&&T!==null&&"then"in T}function UT(T){return T!=null&&typeof T=="object"&&"$$typeof"in T&&T.$$typeof===yP&&"_payload"in T&&vP(T._payload)}function GT(T){const R=xP(T),z=be.forwardRef((N,X)=>{let{children:J,...re}=N;UT(J)&&typeof R_=="function"&&(J=R_(J._payload));const s=be.Children.toArray(J),he=s.find(bP);if(he){const ae=he.props.children,Me=s.map(oe=>oe===he?be.Children.count(ae)>1?be.Children.only(null):be.isValidElement(ae)?ae.props.children:null:oe);return $.jsx(R,{...re,ref:X,children:be.isValidElement(ae)?be.cloneElement(ae,void 0,Me):null})}return $.jsx(R,{...re,ref:X,children:J})});return z.displayName=`${T}.Slot`,z}var $T=GT("Slot");function xP(T){const R=be.forwardRef((z,N)=>{let{children:X,...J}=z;if(UT(X)&&typeof R_=="function"&&(X=R_(X._payload)),be.isValidElement(X)){const re=SP(X),s=TP(J,X.props);return X.type!==be.Fragment&&(s.ref=N?gg(N,re):re),be.cloneElement(X,s)}return be.Children.count(X)>1?be.Children.only(null):null});return R.displayName=`${T}.SlotClone`,R}var wP=Symbol("radix.slottable");function bP(T){return be.isValidElement(T)&&typeof T.type=="function"&&"__radixId"in T.type&&T.type.__radixId===wP}function TP(T,R){const z={...R};for(const N in R){const X=T[N],J=R[N];/^on[A-Z]/.test(N)?X&&J?z[N]=(...s)=>{const he=J(...s);return X(...s),he}:X&&(z[N]=X):N==="style"?z[N]={...X,...J}:N==="className"&&(z[N]=[X,J].filter(Boolean).join(" "))}return{...T,...z}}function SP(T){let R=Object.getOwnPropertyDescriptor(T.props,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning;return z?T.ref:(R=Object.getOwnPropertyDescriptor(T,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning,z?T.props.ref:T.props.ref||T.ref)}const Eb=T=>typeof T=="boolean"?`${T}`:T===0?"0":T,Ib=AT,tx=(T,R)=>z=>{var N;if(R?.variants==null)return Ib(T,z?.class,z?.className);const{variants:X,defaultVariants:J}=R,re=Object.keys(X).map(ae=>{const Me=z?.[ae],oe=J?.[ae];if(Me===null)return null;const Oe=Eb(Me)||Eb(oe);return X[ae][Oe]}),s=z&&Object.entries(z).reduce((ae,Me)=>{let[oe,Oe]=Me;return Oe===void 0||(ae[oe]=Oe),ae},{}),he=R==null||(N=R.compoundVariants)===null||N===void 0?void 0:N.reduce((ae,Me)=>{let{class:oe,className:Oe,...je}=Me;return Object.entries(je).every(st=>{let[Ce,Be]=st;return Array.isArray(Be)?Be.includes({...J,...s}[Ce]):{...J,...s}[Ce]===Be})?[...ae,oe,Oe]:ae},[]);return Ib(T,re,he,z?.class,z?.className)},EP=tx("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function vu({className:T,variant:R,asChild:z=!1,...N}){const X=z?$T:"span";return $.jsx(X,{"data-slot":"badge",className:Wo(EP({variant:R}),T),...N})}const IP="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function HT(T){const[R,z]=be.useState(!1),N=()=>{z(!0)},{src:X,alt:J,style:re,className:s,...he}=T;return R?$.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${s??""}`,style:re,children:$.jsx("div",{className:"flex items-center justify-center w-full h-full",children:$.jsx("img",{src:IP,alt:"Error loading image",...he,"data-original-url":X})})}):$.jsx("img",{src:X,alt:J,className:s,style:re,...he,onError:N})}/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AP=T=>T.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),CP=T=>T.replace(/^([A-Z])|[\s-_]+(\w)/g,(R,z,N)=>N?N.toUpperCase():z.toLowerCase()),Ab=T=>{const R=CP(T);return R.charAt(0).toUpperCase()+R.slice(1)},WT=(...T)=>T.filter((R,z,N)=>!!R&&R.trim()!==""&&N.indexOf(R)===z).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var MP={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PP=be.forwardRef(({color:T="currentColor",size:R=24,strokeWidth:z=2,absoluteStrokeWidth:N,className:X="",children:J,iconNode:re,...s},he)=>be.createElement("svg",{ref:he,...MP,width:R,height:R,stroke:T,strokeWidth:N?Number(z)*24/Number(R):z,className:WT("lucide",X),...s},[...re.map(([ae,Me])=>be.createElement(ae,Me)),...Array.isArray(J)?J:[J]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=(T,R)=>{const z=be.forwardRef(({className:N,...X},J)=>be.createElement(PP,{ref:J,iconNode:R,className:WT(`lucide-${AP(Ab(T))}`,`lucide-${T}`,N),...X}));return z.displayName=Ab(T),z};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RP=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],kP=Hr("calendar",RP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zP=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],LP=Hr("check",zP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DP=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],qT=Hr("chevron-down",DP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OP=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],FP=Hr("chevron-up",OP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BP=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Cb=Hr("circle-check-big",BP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NP=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],jP=Hr("circle-x",NP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VP=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],UP=Hr("clock",VP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GP=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],Dv=Hr("cloud-rain",GP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $P=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]],Ov=Hr("cloud-snow",$P);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HP=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Td=Hr("cloud",HP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WP=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],nx=Hr("droplets",WP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qP=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ZT=Hr("eye",qP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZP=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],XP=Hr("gauge",ZP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YP=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],XT=Hr("info",YP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KP=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],JP=Hr("loader-circle",KP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QP=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],vp=Hr("map-pin",QP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eR=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],YT=Hr("navigation",eR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],Mb=Hr("phone",tR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],iR=Hr("play",nR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],oR=Hr("plus",rR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],k_=Hr("refresh-cw",sR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aR=[["path",{d:"M13 7 9 3 5 7l4 4",key:"vyckw6"}],["path",{d:"m17 11 4 4-4 4-4-4",key:"rchckc"}],["path",{d:"m8 12 4 4 6-6-4-4Z",key:"1sshf7"}],["path",{d:"m16 8 3-3",key:"x428zp"}],["path",{d:"M9 21a6 6 0 0 0-6-6",key:"1iajcf"}]],Fv=Hr("satellite",aR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Bv=Hr("shield",lR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cR=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],z_=Hr("sun",cR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uR=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],Nv=Hr("terminal",uR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hR=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],L_=Hr("thermometer",hR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dR=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Sd=Hr("triangle-alert",dR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fR=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],KT=Hr("users",fR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pR=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],Pb=Hr("waves",pR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mR=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],um=Hr("wind",mR);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],S_=Hr("zap",gR);function _R(){const T={location:"Manila, Philippines",temperature:28,condition:"Partly Cloudy",humidity:75,windSpeed:12,visibility:8,uvIndex:6,feelsLike:32,airQuality:"Good"};return $.jsxs("div",{className:"space-y-4 p-4",children:[$.jsxs(Nr,{className:"relative overflow-hidden",children:[$.jsx("div",{className:"absolute inset-0 opacity-30",children:$.jsx(HT,{src:"https://images.unsplash.com/photo-1627817783271-1b8d21266a74?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzdW5ueSUyMHdlYXRoZXIlMjBza3klMjBjbG91ZHN8ZW58MXx8fHwxNzU5NjU1MzU5fDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral",alt:"Weather background",className:"w-full h-full object-cover"})}),$.jsx(Ia,{className:"relative",children:$.jsxs(Aa,{className:"flex items-center justify-between",children:[$.jsx("span",{children:T.location}),$.jsx(vu,{variant:"secondary",children:T.condition})]})}),$.jsx(jr,{className:"relative",children:$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("div",{children:[$.jsxs("div",{className:"flex items-baseline",children:[$.jsxs("span",{className:"text-4xl font-medium",children:[T.temperature,""]}),$.jsx("span",{className:"text-muted-foreground ml-1",children:"C"})]}),$.jsxs("p",{className:"text-sm text-muted-foreground",children:["Feels like ",T.feelsLike,"C"]})]}),$.jsx(z_,{className:"h-16 w-16 text-yellow-500"})]})})]}),$.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[$.jsx(Nr,{children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(nx,{className:"h-5 w-5 text-blue-500"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-muted-foreground",children:"Humidity"}),$.jsxs("p",{className:"text-lg",children:[T.humidity,"%"]})]})]})})}),$.jsx(Nr,{children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(um,{className:"h-5 w-5 text-gray-500"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-muted-foreground",children:"Wind"}),$.jsxs("p",{className:"text-lg",children:[T.windSpeed," km/h"]})]})]})})}),$.jsx(Nr,{children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(ZT,{className:"h-5 w-5 text-indigo-500"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-muted-foreground",children:"Visibility"}),$.jsxs("p",{className:"text-lg",children:[T.visibility," km"]})]})]})})}),$.jsx(Nr,{children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(L_,{className:"h-5 w-5 text-red-500"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-muted-foreground",children:"UV Index"}),$.jsx("p",{className:"text-lg",children:T.uvIndex})]})]})})})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsx(Aa,{children:"Air Quality"})}),$.jsx(jr,{children:$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsx("span",{children:"Current Status"}),$.jsx(vu,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:T.airQuality})]})})]})]})}var E_={exports:{}},yR=E_.exports,Rb;function vR(){return Rb||(Rb=1,(function(T,R){(function(z,N){T.exports=N()})(yR,(function(){var z,N,X;function J(s,he){if(!z)z=he;else if(!N)N=he;else{var ae="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+z+")(sharedChunk); ("+N+")(sharedChunk); self.onerror = null;",Me={};z(Me),X=he(Me),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(X.workerUrl=window.URL.createObjectURL(new Blob([ae],{type:"text/javascript"})))}}J(["exports"],(function(s){var he=1e-6,ae=typeof Float32Array<"u"?Float32Array:Array;function Me(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=n*u-a*o;return h?(i[0]=u*(h=1/h),i[1]=-o*h,i[2]=-a*h,i[3]=n*h,i):null}function oe(){var i=new ae(9);return ae!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Oe(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],x=e[7],S=e[8];return i[0]=h*S-p*x,i[1]=a*x-o*S,i[2]=o*p-a*h,i[3]=p*y-u*S,i[4]=n*S-a*y,i[5]=a*u-n*p,i[6]=u*x-h*y,i[7]=o*y-n*x,i[8]=n*h-o*u,i}function je(i,e,n){var o=e[0],a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],x=e[6],S=e[7],E=e[8],A=n[0],P=n[1],k=n[2],F=n[3],G=n[4],U=n[5],Y=n[6],Q=n[7],ne=n[8];return i[0]=A*o+P*h+k*x,i[1]=A*a+P*p+k*S,i[2]=A*u+P*y+k*E,i[3]=F*o+G*h+U*x,i[4]=F*a+G*p+U*S,i[5]=F*u+G*y+U*E,i[6]=Y*o+Q*h+ne*x,i[7]=Y*a+Q*p+ne*S,i[8]=Y*u+Q*y+ne*E,i}function st(){var i=new ae(16);return ae!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Ce(i){var e=new ae(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Be(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Xe(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],x=e[7],S=e[8],E=e[9],A=e[10],P=e[11],k=e[12],F=e[13],G=e[14],U=e[15],Y=n*p-o*h,Q=n*y-a*h,ne=n*x-u*h,me=o*y-a*p,de=o*x-u*p,ve=a*x-u*y,Te=S*F-E*k,Ie=S*G-A*k,qe=S*U-P*k,ke=E*G-A*F,Qe=E*U-P*F,ut=A*U-P*G,ht=Y*ut-Q*Qe+ne*ke+me*qe-de*Ie+ve*Te;return ht?(i[0]=(p*ut-y*Qe+x*ke)*(ht=1/ht),i[1]=(a*Qe-o*ut-u*ke)*ht,i[2]=(F*ve-G*de+U*me)*ht,i[3]=(A*de-E*ve-P*me)*ht,i[4]=(y*qe-h*ut-x*Ie)*ht,i[5]=(n*ut-a*qe+u*Ie)*ht,i[6]=(G*ne-k*ve-U*Q)*ht,i[7]=(S*ve-A*ne+P*Q)*ht,i[8]=(h*Qe-p*qe+x*Te)*ht,i[9]=(o*qe-n*Qe-u*Te)*ht,i[10]=(k*de-F*ne+U*Y)*ht,i[11]=(E*ne-S*de-P*Y)*ht,i[12]=(p*Ie-h*ke-y*Te)*ht,i[13]=(n*ke-o*Ie+a*Te)*ht,i[14]=(F*Q-k*me-G*Y)*ht,i[15]=(S*me-E*Q+A*Y)*ht,i):null}function ot(i,e,n){var o=e[0],a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],x=e[6],S=e[7],E=e[8],A=e[9],P=e[10],k=e[11],F=e[12],G=e[13],U=e[14],Y=e[15],Q=n[0],ne=n[1],me=n[2],de=n[3];return i[0]=Q*o+ne*p+me*E+de*F,i[1]=Q*a+ne*y+me*A+de*G,i[2]=Q*u+ne*x+me*P+de*U,i[3]=Q*h+ne*S+me*k+de*Y,i[4]=(Q=n[4])*o+(ne=n[5])*p+(me=n[6])*E+(de=n[7])*F,i[5]=Q*a+ne*y+me*A+de*G,i[6]=Q*u+ne*x+me*P+de*U,i[7]=Q*h+ne*S+me*k+de*Y,i[8]=(Q=n[8])*o+(ne=n[9])*p+(me=n[10])*E+(de=n[11])*F,i[9]=Q*a+ne*y+me*A+de*G,i[10]=Q*u+ne*x+me*P+de*U,i[11]=Q*h+ne*S+me*k+de*Y,i[12]=(Q=n[12])*o+(ne=n[13])*p+(me=n[14])*E+(de=n[15])*F,i[13]=Q*a+ne*y+me*A+de*G,i[14]=Q*u+ne*x+me*P+de*U,i[15]=Q*h+ne*S+me*k+de*Y,i}function Ke(i,e,n){var o,a,u,h,p,y,x,S,E,A,P,k,F=n[0],G=n[1],U=n[2];return e===i?(i[12]=e[0]*F+e[4]*G+e[8]*U+e[12],i[13]=e[1]*F+e[5]*G+e[9]*U+e[13],i[14]=e[2]*F+e[6]*G+e[10]*U+e[14],i[15]=e[3]*F+e[7]*G+e[11]*U+e[15]):(a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],x=e[6],S=e[7],E=e[8],A=e[9],P=e[10],k=e[11],i[0]=o=e[0],i[1]=a,i[2]=u,i[3]=h,i[4]=p,i[5]=y,i[6]=x,i[7]=S,i[8]=E,i[9]=A,i[10]=P,i[11]=k,i[12]=o*F+p*G+E*U+e[12],i[13]=a*F+y*G+A*U+e[13],i[14]=u*F+x*G+P*U+e[14],i[15]=h*F+S*G+k*U+e[15]),i}function Ct(i,e,n){var o=n[0],a=n[1],u=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function tt(i,e,n){var o=Math.sin(n),a=Math.cos(n),u=e[4],h=e[5],p=e[6],y=e[7],x=e[8],S=e[9],E=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*a+x*o,i[5]=h*a+S*o,i[6]=p*a+E*o,i[7]=y*a+A*o,i[8]=x*a-u*o,i[9]=S*a-h*o,i[10]=E*a-p*o,i[11]=A*a-y*o,i}function Nt(i,e,n){var o=Math.sin(n),a=Math.cos(n),u=e[0],h=e[1],p=e[2],y=e[3],x=e[8],S=e[9],E=e[10],A=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a-x*o,i[1]=h*a-S*o,i[2]=p*a-E*o,i[3]=y*a-A*o,i[8]=u*o+x*a,i[9]=h*o+S*a,i[10]=p*o+E*a,i[11]=y*o+A*a,i}function jt(i,e,n){var o=Math.sin(n),a=Math.cos(n),u=e[0],h=e[1],p=e[2],y=e[3],x=e[4],S=e[5],E=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a+x*o,i[1]=h*a+S*o,i[2]=p*a+E*o,i[3]=y*a+A*o,i[4]=x*a-u*o,i[5]=S*a-h*o,i[6]=E*a-p*o,i[7]=A*a-y*o,i}function Mt(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Rn(i,e,n){var o,a,u,h=n[0],p=n[1],y=n[2],x=Math.sqrt(h*h+p*p+y*y);return x<he?null:(h*=x=1/x,p*=x,y*=x,o=Math.sin(e),a=Math.cos(e),i[0]=h*h*(u=1-a)+a,i[1]=p*h*u+y*o,i[2]=y*h*u-p*o,i[3]=0,i[4]=h*p*u-y*o,i[5]=p*p*u+a,i[6]=y*p*u+h*o,i[7]=0,i[8]=h*y*u+p*o,i[9]=p*y*u-h*o,i[10]=y*y*u+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function Kn(i,e){var n=e[0],o=e[1],a=e[2],u=e[4],h=e[5],p=e[6],y=e[8],x=e[9],S=e[10];return i[0]=Math.sqrt(n*n+o*o+a*a),i[1]=Math.sqrt(u*u+h*h+p*p),i[2]=Math.sqrt(y*y+x*x+S*S),i}function Ti(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=n+n,p=o+o,y=a+a,x=n*h,S=o*h,E=o*p,A=a*h,P=a*p,k=a*y,F=u*h,G=u*p,U=u*y;return i[0]=1-E-k,i[1]=S+U,i[2]=A-G,i[3]=0,i[4]=S-U,i[5]=1-x-k,i[6]=P+F,i[7]=0,i[8]=A+G,i[9]=P-F,i[10]=1-x-E,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}var pi=ot;function dn(){var i=new ae(3);return ae!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function mi(i){var e=new ae(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Hn(i){var e=i[0],n=i[1],o=i[2];return Math.sqrt(e*e+n*n+o*o)}function Wt(i,e,n){var o=new ae(3);return o[0]=i,o[1]=e,o[2]=n,o}function Jt(i,e,n,o){return i[0]=e,i[1]=n,i[2]=o,i}function nt(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function mn(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function sn(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function rt(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i}function Ut(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i}function Gt(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function gn(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i}function jn(i,e){var n=e[0]-i[0],o=e[1]-i[1],a=e[2]-i[2];return Math.sqrt(n*n+o*o+a*a)}function oi(i,e){var n=e[0]-i[0],o=e[1]-i[1],a=e[2]-i[2];return n*n+o*o+a*a}function cn(i){var e=i[0],n=i[1],o=i[2];return e*e+n*n+o*o}function wn(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function xn(i,e){var n=e[0],o=e[1],a=e[2],u=n*n+o*o+a*a;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function kn(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function _i(i,e,n){var o=e[0],a=e[1],u=e[2],h=n[0],p=n[1],y=n[2];return i[0]=a*y-u*p,i[1]=u*h-o*y,i[2]=o*p-a*h,i}function Ji(i,e,n,o){var a=e[0],u=e[1],h=e[2];return i[0]=a+o*(n[0]-a),i[1]=u+o*(n[1]-u),i[2]=h+o*(n[2]-h),i}function Gi(i,e,n){var o=e[0],a=e[1],u=e[2],h=n[3]*o+n[7]*a+n[11]*u+n[15];return i[0]=(n[0]*o+n[4]*a+n[8]*u+n[12])/(h=h||1),i[1]=(n[1]*o+n[5]*a+n[9]*u+n[13])/h,i[2]=(n[2]*o+n[6]*a+n[10]*u+n[14])/h,i}function yo(i,e,n){var o=e[0],a=e[1],u=e[2];return i[0]=o*n[0]+a*n[3]+u*n[6],i[1]=o*n[1]+a*n[4]+u*n[7],i[2]=o*n[2]+a*n[5]+u*n[8],i}function Es(i,e,n){var o=n[0],a=n[1],u=n[2],h=n[3],p=e[0],y=e[1],x=e[2],S=a*x-u*y,E=u*p-o*x,A=o*y-a*p;return i[0]=p+h*(S+=S)+a*(A+=A)-u*(E+=E),i[1]=y+h*E+u*S-o*A,i[2]=x+h*A+o*E-a*S,i}function vo(i){return i[0]=0,i[1]=0,i[2]=0,i}function Pr(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}var Cr=mn,Is=sn,Ca=Hn;function Gs(){var i=new ae(4);return ae!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function to(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}function ds(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=n*n+o*o+a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=n*h,i[1]=o*h,i[2]=a*h,i[3]=u*h,i}function So(i,e,n){var o=e[0],a=e[1],u=e[2],h=e[3];return i[0]=n[0]*o+n[4]*a+n[8]*u+n[12]*h,i[1]=n[1]*o+n[5]*a+n[9]*u+n[13]*h,i[2]=n[2]*o+n[6]*a+n[10]*u+n[14]*h,i[3]=n[3]*o+n[7]*a+n[11]*u+n[15]*h,i}function Ma(){var i=new ae(4);return ae!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Pa(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function As(i,e,n){n*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(n),y=Math.cos(n);return i[0]=o*y+h*p,i[1]=a*y+u*p,i[2]=u*y-a*p,i[3]=h*y-o*p,i}function Cs(i,e,n){n*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(n),y=Math.cos(n);return i[0]=o*y-u*p,i[1]=a*y+h*p,i[2]=u*y+o*p,i[3]=h*y-a*p,i}dn(),Gs();var Eo,qo,$s,Hs=ds,Ul=(Eo=dn(),qo=Wt(1,0,0),$s=Wt(0,1,0),function(i,e,n){var o=kn(e,n);return o<-.999999?(_i(Eo,qo,e),Ca(Eo)<1e-6&&_i(Eo,$s,e),xn(Eo,Eo),(function(a,u,h){h*=.5;var p=Math.sin(h);a[0]=p*u[0],a[1]=p*u[1],a[2]=p*u[2],a[3]=Math.cos(h)})(i,Eo,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(_i(Eo,e,n),i[0]=Eo[0],i[1]=Eo[1],i[2]=Eo[2],i[3]=1+o,Hs(i,i))});function no(){var i=new ae(2);return ae!=Float32Array&&(i[0]=0,i[1]=0),i}function Zo(i,e){var n=new ae(2);return n[0]=i,n[1]=e,n}function _l(i,e,n){return i[0]=e,i[1]=n,i}function Ra(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i}function fs(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function Ro(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i}function Ms(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)}function ka(i,e){var n=e[0],o=e[1],a=n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),i[0]=e[0]*a,i[1]=e[1]*a,i}function Ps(i,e){return i[0]*e[0]+i[1]*e[1]}Ma(),Ma(),oe();var lr,ei,io=fs;function Yr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}no();var Wr=(function(){if(ei)return lr;function i(e,n,o,a){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(a-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=a}return ei=1,lr=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,a=0;a<8;a++){var u=this.sampleCurveX(o)-e;if(Math.abs(u)<n)return o;var h=this.sampleCurveDerivativeX(o);if(Math.abs(h)<1e-6)break;o-=u/h}var p=0,y=1;for(o=e,a=0;a<20&&(u=this.sampleCurveX(o),!(Math.abs(u-e)<n));a++)e>u?p=o:y=o,o=.5*(y-p)+p;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},lr})(),Wa=Yr(Wr);function ct(i,e){this.x=i,this.y=e}function qr(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!qr(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!qr(i[n],e[n]))return!1;return!0}return i===e}ct.prototype={clone(){return new ct(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround(i,e){const n=Math.cos(i),o=Math.sin(i),a=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=a,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ct},ct.convert=function(i){if(i instanceof ct)return i;if(Array.isArray(i))return new ct(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new ct(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};const yl=Math.PI/180,co=180/Math.PI;function ti(i){return i*yl}function ro(i){return i*co}const Ws=[[0,0],[1,0],[1,1],[0,1]];function qa(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Lc(i,e,n,o){const a=new Wa(i,e,n,o);return function(u){return a.solve(u)}}const De=Lc(.25,.1,.25,1);function H(i,e,n){return Math.min(n,Math.max(e,i))}function K(i,e,n){return(n=H((n-i)/(e-i),0,1))*n*(3-2*n)}function se(i,e,n){const o=n-e,a=((i-e)%o+o)%o+e;return a===e?n:a}function Se(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const a=new Array(i.length);let u=null;i.forEach(((h,p)=>{e(h,((y,x)=>{y&&(u=y),a[p]=x,--o==0&&n(u,a)}))}))}let we=1;function Pe(){return we++}function Ge(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log2(i)))}function ze(i,e){i.forEach((n=>{e[n]&&(e[n]=e[n].bind(e))}))}function Ve(i,e,n){const o={};for(const a in i)o[a]=e.call(this,i[a],a,i);return o}function yt(i,e,n){const o={};for(const a in i)e.call(this,i[a],a,i)&&(o[a]=i[a]);return o}function lt(i){return Array.isArray(i)?i.map(lt):typeof i=="object"&&i?Ve(i,lt):i}function Xt(i,e){for(let n=0;n<i.length;n++)if(e.indexOf(i[n])>=0)return!0;return!1}const Qt={};function $t(i){Qt[i]||(typeof console<"u"&&console.warn(i),Qt[i]=!0)}function Vn(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Un(i){let e=0;for(let n,o,a=0,u=i.length,h=u-1;a<u;h=a++)n=i[a],o=i[h],e+=(o.x-n.x)*(n.y+o.y);return e}function Fn([i,e,n]){const o=ti(e+90),a=ti(n);return{x:i*Math.cos(o)*Math.sin(a),y:i*Math.sin(o)*Math.sin(a),z:i*Math.cos(a),azimuthal:e,polar:n}}function xi(i){return(typeof self<"u"||i!==void 0)&&typeof WorkerGlobalScope<"u"&&(i!==void 0?i:self)instanceof WorkerGlobalScope}function xr(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,a,u)=>{const h=a||u;return e[o]=!h||h.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Rr=null;function ir(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function Kr(i,e,n,o){for(;e<n;){const a=e+n>>1;i[a]<o?e=a+1:n=a}return e}function Zi(i,e,n,o){for(;e<n;){const a=e+n>>1;i[a]<=o?e=a+1:n=a}return e}function Ei(i){return i>0?1/(1.001-i):1+i}function wr(i){return i>0?1-1/(1.001-i):-i}function Qi(i,e,n){return(i-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const ri={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ri.API_URL)return null;try{const i=new URL(ri.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function br(i){return ri.API_URL_REGEX.test(i)}function uo(i){return ri.API_SPRITE_REGEX.test(i)}let Io,Rs,Dc,ho,qs,Oo;function Zs(){return Io==null&&(Io=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Io}const xo={now:()=>ho!==void 0?ho:performance.now(),setNow(i){ho=i},restoreNow(){ho=void 0},frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:n,height:o}=i;qs||(qs=document.createElement("canvas"));const a=qs.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>qs.width||o>qs.height)&&(qs.width=n,qs.height=o),a.clearRect(-e,-e,n+2*e,o+2*e),a.drawImage(i,0,0,n,o),a.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:i=>(Rs||(Rs=document.createElement("a")),Rs.href=i,Rs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Dc==null&&(Dc=window.matchMedia("(prefers-reduced-motion: reduce)")),Dc.matches)},hasCanvasFingerprintNoise(){if(Oo!==void 0)return Oo;if(!Zs())return Oo=!1,!1;const i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0});let n=0;for(let a=0;a<i.width;++a)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(a,0,1,1);const o=e.getImageData(0,0,i.width,i.height);n=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&n++!==o.data[a])return Oo=!0,!0;return Oo=!1,!1}};function Gl(i,e){const n=i.indexOf("?");if(n<0)return`${i}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(i.slice(n));for(const a in e)o.set(a,e[a]);return`${i.slice(0,n)}?${o.toString()}`}function mr(i,e={persistentParams:[]}){const n=i.indexOf("?");if(n<0)return i;const o=new URLSearchParams,a=new URLSearchParams(i.slice(n));for(const h of e.persistentParams){const p=a.get(h);p&&o.set(h,p)}const u=o.toString();return`${i.slice(0,n)}${u.length>0?`?${u}`:""}`}const xh="mapbox-tiles";let wh=500,bu=50;const Tu=["language","worldview","jobid"];let Za,ps;function da(){try{return caches}catch{}}function Xs(){const i=da();i&&Za==null&&(Za=i.open(xh))}let Fo=1/0;const ns={supported:!1,testSupport:function(i){!dc&&Xa&&(Ys?kf(i):ks=i)}};let ks,Xa,dc=!1,Ys=!1;const Cd=typeof self<"u"?self:{};function kf(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Xa),i.isContextLost())return;ns.supported=!0}catch{}i.deleteTexture(e),dc=!0}Cd.document&&(Xa=Cd.document.createElement("img"),Xa.onload=function(){ks&&kf(ks),ks=null,Ys=!0},Xa.onerror=function(){dc=!0,ks=null},Xa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $l={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze($l);class Ks extends Error{constructor(e,n,o){n===401&&br(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bh=xi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,vl=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(bh())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(o,a){const u=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:bh(),referrerPolicy:o.referrerPolicy,signal:u.signal});let p=!1,y=!1;const x=(S=h.url).indexOf("sku=")>0&&br(S);var S;o.type==="json"&&h.headers.set("Accept","application/json");const E=(P,k,F)=>{if(y)return;if(P&&P.message!=="SecurityError"&&$t(P.toString()),k&&F)return A(k);const G=Date.now();fetch(h).then((U=>{if(U.ok){const Y=x?U.clone():null;return A(U,Y,G)}return a(new Ks(U.statusText,U.status,o.url))})).catch((U=>{U.name!=="AbortError"&&a(new Error(`${U.message} ${o.url}`))}))},A=(P,k,F)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then((G=>{y||(k&&F&&(function(U,Y,Q){if(Xs(),Za==null)return;const ne=xr(Y.headers.get("Cache-Control")||"");if(ne["no-store"])return;const me={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach(((Te,Ie)=>me.headers.set(Ie,Te))),ne["max-age"]&&me.headers.set("Expires",new Date(Q+1e3*ne["max-age"]).toUTCString());const de=me.headers.get("Expires");if(!de||new Date(de).getTime()-Q<42e4)return;let ve=mr(U.url,{persistentParams:Tu});if(Y.status===206){const Te=U.headers.get("Range");if(!Te)return;me.status=200,ve=Gl(ve,{range:Te})}(function(Te,Ie){if(ps===void 0)try{new Response(new ReadableStream),ps=!0}catch{ps=!1}ps?Ie(Te.body):Te.blob().then(Ie).catch((qe=>$t(qe.message)))})(Y,(Te=>{const Ie=new Response((qe=Y.status)!==200&&qe!==404&&[101,103,204,205,304].includes(qe)?null:Te,me);var qe;Xs(),Za?.then((ke=>ke.put(ve,Ie))).catch((ke=>$t(ke.message)))}))})(h,k,F),p=!0,a(null,G,P.headers))})).catch((G=>{y||a(new Error(G.message))}))};return x?(function(P,k){if(Xs(),Za==null)return k(null);Za.then((F=>{let G=mr(P.url,{persistentParams:Tu});const U=P.headers.get("Range");U&&(G=Gl(G,{range:U})),F.match(G).then((Y=>{const Q=(function(ne){if(!ne)return!1;const me=new Date(ne.headers.get("Expires")||0),de=xr(ne.headers.get("Cache-Control")||"");return Number(me)>Date.now()&&!de["no-cache"]})(Y);F.delete(G).catch(k),Q&&F.put(G,Y.clone()).catch(k),k(null,Y,Q)})).catch(k)})).catch(k)})(h,E):E(null,null),{cancel:()=>{y=!0,p||u.abort()}}})(i,e);if(xi(self)&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return(function(o,a){const u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(y){return a(y)}const p=new Headers;u.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((y=>{const x=y.split(": "),S=x.shift(),E=x.join(": ");p.append(S,E)})),a(null,h,p)}else a(new Ks(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}})(i,e)},xl=function(i,e){return vl(Object.assign(i,{type:"arrayBuffer"}),e)};function _m(i){const e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}const Su="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Hl,ci;Hl=[],ci=0;const Oc=function(i,e){if(ns.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ci>=ri.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Hl.push(u),u}ci++;let n=!1;const o=()=>{if(!n)for(n=!0,ci--;Hl.length&&ci<ri.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Hl.shift(),{requestParameters:h,callback:p,cancelled:y}=u;y||(u.cancel=Oc(h,p).cancel)}},a=xl(i,((u,h,p)=>{o(),u?e(u):h&&(self.createImageBitmap?(function(y,x){const S=new Blob([new Uint8Array(y)],{type:"image/png"});createImageBitmap(S).then((E=>{x(null,E)})).catch((E=>{x(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(h,((y,x)=>e(y,x,p))):(function(y,x){const S=new Image;S.onload=()=>{x(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame((()=>{S.src=Su}))},S.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const E=new Blob([new Uint8Array(y)],{type:"image/png"});S.src=y.byteLength?URL.createObjectURL(E):Su})(h,((y,x)=>e(y,x,p))))}));return{cancel:()=>{a.cancel(),o()}}};var zf,Tp,Md,Ya={exports:{}},Fc={exports:{}},Eu={exports:{}},wl=(function(){if(Md)return Ya.exports;Md=1;var i=(zf||(zf=1,Fc.exports=function(n,o){var a,u,h,p,y,x,S,E;for(u=n.length-(a=3&n.length),h=o,y=3432918353,x=461845907,E=0;E<u;)S=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(S=0,a){case 3:S^=(255&n.charCodeAt(E+2))<<16;case 2:S^=(255&n.charCodeAt(E+1))<<8;case 1:h^=S=(65535&(S=(S=(65535&(S^=255&n.charCodeAt(E)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),Fc.exports),e=(Tp||(Tp=1,Eu.exports=function(n,o){for(var a,u=n.length,h=o^u,p=0;u>=4;)a=1540483477*(65535&(a=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&n.charCodeAt(p+2))<<16;case 2:h^=(255&n.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),Eu.exports);return Ya.exports=i,Ya.exports.murmur3=i,Ya.exports.murmur2=e,Ya.exports})(),Iu=Yr(wl);class fa{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class Au extends fa{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function Cu(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Ka(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class fc{on(e,n){return this._listeners=this._listeners||{},Cu(e,n,this._listeners),this}off(e,n){return Ka(e,n,this._listeners),Ka(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Cu(e,n,this._oneTimeListeners),this):new Promise((o=>{this.once(e,o)}))}fire(e,n){const o=typeof e=="string"?new fa(e,n):e,a=o.type;if(this.listens(a)){o.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,o);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)Ka(a,y,this._oneTimeListeners),y.call(this,o);const p=this._eventedParent;if(p){const y=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(o,y),p.fire(o)}}else o instanceof Au&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class kr{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new kr(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,o]=e.split("");return new kr({name:n,iconsetId:o})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return kr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Wl,Bc={},ms=(function(){if(Wl)return Bc;Wl=1;var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function n(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function o(u){return(h=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:h>1?1:h;var h}function a(u,h,p){return p<0?p+=1:p>1&&(p-=1),6*p<1?u+(h-u)*p*6:2*p<1?h:3*p<2?u+(h-u)*(2/3-p)*6:u}try{Bc.parseCSSColor=function(u){var h,p=u.replace(/ /g,"").toLowerCase();if(p in i)return i[p].slice();if(p[0]==="#")return p.length===4?(h=parseInt(p.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:p.length===7&&(h=parseInt(p.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var y=p.indexOf("("),x=p.indexOf(")");if(y!==-1&&x+1===p.length){var S=p.substr(0,y),E=p.substr(y+1,x-(y+1)).split(","),A=1;switch(S){case"rgba":if(E.length!==4)return null;A=o(E.pop());case"rgb":return E.length!==3?null:[n(E[0]),n(E[1]),n(E[2]),A];case"hsla":if(E.length!==4)return null;A=o(E.pop());case"hsl":if(E.length!==3)return null;var P=(parseFloat(E[0])%360+360)%360/360,k=o(E[1]),F=o(E[2]),G=F<=.5?F*(k+1):F+k-F*k,U=2*F-G;return[e(255*a(U,G,P+1/3)),e(255*a(U,G,P)),e(255*a(U,G,P-1/3)),A];default:return null}}return null}}catch{}return Bc})();class Vi{constructor(e,n,o,a=1){this.r=e,this.g=n,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof Vi)return e;if(typeof e!="string")return;const n=ms.parseCSSColor(e);return n?new Vi(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,o,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*o)},${a})`}toNonPremultipliedRenderColor(e){const{r:n,g:o,b:a,a:u}=this;return new Rd(e,n,o,a,u)}toPremultipliedRenderColor(e){const{r:n,g:o,b:a,a:u}=this;return new Mu(e,n*u,o*u,a*u,u)}clone(){return new Vi(this.r,this.g,this.b,this.a)}}class Pd{constructor(e,n,o,a,u,h=!1){if(this.premultiplied=!1,this.premultiplied=h,e){const p=e.image.height,y=p*p;this.premultiplied?(n=u===0?0:n/u*(p-1),o=u===0?0:o/u*(p-1),a=u===0?0:a/u*(p-1)):(n*=p-1,o*=p-1,a*=p-1);const x=Math.floor(n),S=Math.floor(o),E=Math.floor(a),A=Math.ceil(n),P=Math.ceil(o),k=Math.ceil(a),F=n-x,G=o-S,U=a-E,Y=e.image.data,Q=4*(x+S*y+E*p),ne=4*(x+S*y+k*p),me=4*(x+P*y+E*p),de=4*(x+P*y+k*p),ve=4*(A+S*y+E*p),Te=4*(A+S*y+k*p),Ie=4*(A+P*y+E*p),qe=4*(A+P*y+k*p);if(Q<0||qe>=Y.length)throw new Error("out of range");this.r=bn(bn(bn(Y[Q],Y[ne],U),bn(Y[me],Y[de],U),G),bn(bn(Y[ve],Y[Te],U),bn(Y[Ie],Y[qe],U),G),F)/255*(this.premultiplied?u:1),this.g=bn(bn(bn(Y[Q+1],Y[ne+1],U),bn(Y[me+1],Y[de+1],U),G),bn(bn(Y[ve+1],Y[Te+1],U),bn(Y[Ie+1],Y[qe+1],U),G),F)/255*(this.premultiplied?u:1),this.b=bn(bn(bn(Y[Q+2],Y[ne+2],U),bn(Y[me+2],Y[de+2],U),G),bn(bn(Y[ve+2],Y[Te+2],U),bn(Y[Ie+2],Y[qe+2],U),G),F)/255*(this.premultiplied?u:1),this.a=u}else this.r=n,this.g=o,this.b=a,this.a=u}toArray(){const{r:e,g:n,b:o,a}=this;return[255*e,255*n,255*o,a]}toHslaArray(){let{r:e,g:n,b:o,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];const k=1/a;e*=k,n*=k,o*=k}const u=Math.min(Math.max(e,0),1),h=Math.min(Math.max(n,0),1),p=Math.min(Math.max(o,0),1),y=Math.min(u,h,p),x=Math.max(u,h,p),S=x-y,E=.5*(y+x);if(S===0)return[0,0,100*E,a];const A=E>.5?S/(2-x-y):S/(x+y);let P;switch(x){case u:P=60*((h-p)/S+(h<p?6:0));break;case h:P=60*((p-u)/S+2);break;default:P=60*((u-h)/S+4)}return[P,100*A,100*E,a]}toArray01(){const{r:e,g:n,b:o,a}=this;return[e,n,o,a]}toArray01Scaled(e){const{r:n,g:o,b:a}=this;return[n*e,o*e,a*e]}toArray01Linear(){const{r:e,g:n,b:o,a}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(o,2.2),a]}}class Rd extends Pd{constructor(e,n,o,a,u){super(e,n,o,a,u,!1)}}class Mu extends Pd{constructor(e,n,o,a,u){super(e,n,o,a,u,!0)}}function bn(i,e,n){return i*(1-n)+e*n}function kd(i,e,n){return i.map(((o,a)=>bn(o,e[a],n)))}Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1),Vi.blue=new Vi(0,0,1,1);var Th=Object.freeze({__proto__:null,array:kd,color:function(i,e,n){return new Vi(bn(i.r,e.r,n),bn(i.g,e.g,n),bn(i.b,e.b,n),bn(i.a,e.a,n))},number:bn});class za extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Pu{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,a]of n)this.bindings[o]=a}concat(e){return new Pu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const pa={kind:"null"},un={kind:"number"},yi={kind:"string"},$i={kind:"boolean"},zs={kind:"color"},bl={kind:"object"},Oi={kind:"value"},zd={kind:"collator"},Sh={kind:"formatted"},Eh={kind:"resolvedImage"};function Xo(i,e){return{kind:"array",itemType:i,N:e}}function Dr(i){if(i.kind==="array"){const e=Dr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ym=[pa,un,yi,$i,zs,Sh,bl,Xo(Oi),Eh];function pc(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!pc(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of ym)if(!pc(n,e))return null}}return`Expected ${Dr(i)} but found ${Dr(e)} instead.`}function Lf(i,e){return e.some((n=>n.kind===i.kind))}function Ru(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Ld(i,e){return i.kind==="array"&&e.kind==="array"?i.N===e.N&&Ld(i.itemType,e.itemType):i.kind===e.kind}class Df{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Dd{constructor(e,n,o,a,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=a,this.textColor=u}}class gs{constructor(e){this.sections=e}static fromString(e){return new gs([new Dd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof gs?e:gs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const a=n.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(n.text);const o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class ql{constructor(e,n={}){this.id=kr.from(e),this.params=n.params,this.sx=n.sx||1,this.sy=n.sy||1}toString(){return JSON.stringify(this)}static parse(e){let n,o,a,u;try{({id:n,params:o,sx:a,sy:u}=JSON.parse(e)||{})}catch{return null}return n?new ql(n,{params:o,sx:a,sy:u}):null}scaleSelf(e,n=e){return this.sx*=e,this.sy*=n,this}}class _s{constructor(e,n,o,a,u=!1){this.primaryId=kr.from(e),this.primaryOptions=n,o&&(this.secondaryId=kr.from(o)),this.secondaryOptions=a,this.available=u}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ql(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ql(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?_s.build({name:e}):e}static build(e,n,o,a){return!e||typeof e=="object"&&!("name"in e)?null:new _s(e,o,n,a)}}function Nc(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mc(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Vi||i instanceof Df||i instanceof gs||i instanceof _s)return!0;if(Array.isArray(i)){for(const e of i)if(!mc(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!mc(i[e]))return!1;return!0}return!1}function Zr(i){if(i===null)return pa;if(typeof i=="string")return yi;if(typeof i=="boolean")return $i;if(typeof i=="number")return un;if(i instanceof Vi)return zs;if(i instanceof Df)return zd;if(i instanceof gs)return Sh;if(i instanceof _s)return Eh;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const a=Zr(o);if(n){if(n===a)continue;n=Oi;break}n=a}return Xo(n||Oi,e)}return bl}function La(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof gs||i instanceof _s||i instanceof Vi?i.toString():JSON.stringify(i)}class Tl{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mc(e[1]))return n.error("invalid value");const o=e[1];let a=Zr(o);const u=n.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new Tl(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof gs?this.value.serialize():this.value}}class oo{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Od={string:yi,number:un,boolean:$i,object:bl};class Da{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,a=1;const u=e[0];if(u==="array"){let p,y;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Od)||x==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);p=Od[x],a++}else p=Oi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}o=Xo(p,y)}else o=Od[u];const h=[];for(;a<e.length;a++){const p=n.parse(e[a],a,Oi);if(!p)return null;h.push(p)}return new Da(o,h)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!pc(this.type,Zr(o)))return o;if(n===this.args.length-1)throw new oo(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Dr(Zr(o))} but was expected to be of type ${Dr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map((o=>o.serialize())))}}class Ja{constructor(e){this.type=Sh,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const a=[];let u=!1;for(let h=1;h<=e.length-1;++h){const p=e[h];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let y=null;if(p["font-scale"]&&(y=n.parseObjectValue(p["font-scale"],h,"font-scale",un),!y))return null;let x=null;if(p["text-font"]&&(x=n.parseObjectValue(p["text-font"],h,"text-font",Xo(yi)),!x))return null;let S=null;if(p["text-color"]&&(S=n.parseObjectValue(p["text-color"],h,"text-color",zs),!S))return null;const E=a[a.length-1];E.scale=y,E.font=x,E.textColor=S}else{const y=n.parse(e[h],h,Oi);if(!y)return null;const x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Ja(a)}evaluate(e){return new gs(this.sections.map((n=>{const o=n.content.evaluate(e);return Ld(Zr(o),Eh)?new Dd("",o,null,null,null):new Dd(La(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class On{constructor(e,n,o,a){this._imageWarnHistory={},this.type=Eh,this.namePrimary=e,this.nameSecondary=n,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=1;const a=[];function u(){if(o<e.length){const p=n.parse(e[o],o++,yi);return p?(a.push({image:p,options:{}}),!0):(n.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function h(){if(o<e.length){const y=e[o];if((p=y)===null||typeof p!="object"||Array.isArray(p))return!0;const x=y.params,S=y.iconset,E=n.concat(o);if(!x&&!S)return o++,!0;if(x){if(typeof x!="object"||x.constructor!==Object)return E.error('Image options "params" should be an object'),!1;const A={},P=E.concat(void 0,"params");for(const k in x){if(!k)return P.error("Image parameter name should be non-empty"),!1;const F=P.concat(void 0,k).parse(x[k],void 0,zs,void 0,{typeAnnotation:"coerce"});if(!F)return!1;A[k]=F}a[a.length-1].options.params=A}if(S){if(typeof S!="object"||S.constructor!==Object)return E.error('Image options "iconset" should be an object'),!1;if(!S.id)return E.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=S}return o++,!0}var p;return!0}for(let p=0;p<2;p++)if(!u()||!h())return;return new On(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,n){const o={};if(n){for(const a in n)if(n[a])try{o[a]=n[a].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=_s.build(n,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const u=a.getPrimary().id;if(a.available=e.availableImages.some((h=>kr.isEqual(h,u))),a.available){const h=a.getSecondary()?a.getSecondary().id:null;h&&(a.available=e.availableImages.some((p=>kr.isEqual(p,h))))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const o={};if(n&&(o.iconset={id:n}),e){o.params={};for(const a in e)e[a]&&(o.params[a]=e[a].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function an(i){return Pn(i)?"string":jc(i)?"number":Ih(i)?"boolean":Array.isArray(i)?"array":i===null?"null":Fd(i)?"object":typeof i}function Fd(i){return i!=null&&!Array.isArray(i)&&typeof i!="function"&&!(i instanceof String||i instanceof Number||i instanceof Boolean)&&typeof i=="object"}function Pn(i){return typeof i=="string"||i instanceof String}function jc(i){return typeof i=="number"||i instanceof Number}function Ih(i){return typeof i=="boolean"||i instanceof Boolean}const In={"to-boolean":$i,"to-color":zs,"to-number":un,"to-string":yi};class Js{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0],a=[];let u=pa;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Xo(n.expectedType.itemType,h)}else{if(!(h>0&&mc(e[1][0])))return null;u=Xo(Zr(e[1][0]),h)}for(let p=0;p<h;p++){const y=e[1][p];let x;if(Array.isArray(y))x=n.parse(y,void 0,u.itemType);else{const S=an(y);if(S!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${S}.`);x=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!x)return null;a.push(x)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=In[o];for(let h=1;h<e.length;h++){const p=n.parse(e[h],h,Oi);if(!p)return null;a.push(p)}}return new Js(u,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(const a of this.args){if(n=a.evaluate(e),o=null,n instanceof Vi)return n;if(typeof n=="string"){const u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Nc(n[0],n[1],n[2],n[3]),!o))return new Vi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new oo(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const a=Number(n);if(!isNaN(a))return a}throw new oo(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?gs.fromString(La(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_s.build(La(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((n=>n.evaluate(e))):La(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new On(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((n=>{e.push(n.serialize())})),e}}const Of=["Unknown","Point","LineString","Polygon"];class Vc{constructor(e,n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Of[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-e[0])+this.featureDistanceData.bearing[1]*(a*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Vi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class ys{constructor(e,n,o,a,u){this.name=e,this.type=n,this._evaluate=o,this.args=a,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const n=ys.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,n){const o=e[0],a=ys.definitions[o];if(!a)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=[];let y=null,x=-1;for(const[S,E]of h){if(Array.isArray(S)&&S.length!==e.length-1)continue;p.push(S),x++,y=new yc(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const A=[];let P=!1;for(let k=1;k<e.length;k++){const F=e[k],G=Array.isArray(S)?S[k-1]:S.type,U=y.parse(F,1+A.length,G);if(!U){P=!0;break}A.push(U)}if(!P)if(Array.isArray(S)&&S.length!==A.length)y.error(`Expected ${S.length} arguments, but found ${A.length} instead.`);else{for(let k=0;k<A.length;k++){const F=Array.isArray(S)?S[k]:S.type,G=A[k];y.concat(k+1).checkSubtype(F,G.type)}if(y.errors.length===0)return new ys(o,u,E,A,x)}}if(p.length===1)n.errors.push(...y.errors);else{const S=(p.length?p:h.map((([A])=>A))).map(Ah).join(" | "),E=[];for(let A=1;A<e.length;A++){const P=n.parse(e[A],1+E.length);if(!P)return null;E.push(Dr(P.type))}n.error(`Expected arguments of type ${S}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){ys.definitions=n;for(const o in n)e[o]=ys}}function Ah(i){return Array.isArray(i)?`(${i.map(Dr).join(", ")})`:`(${Dr(i.type)}...)`}class fo{constructor(e,n,o){this.type=zd,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const a=o["case-sensitive"]===void 0?n.parse(!1,1,$i):n.parseObjectValue(o["case-sensitive"],1,"case-sensitive",$i);if(!a)return null;const u=o["diacritic-sensitive"]===void 0?n.parse(!1,1,$i):n.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",$i);if(!u)return null;let h=null;return o.locale&&(h=n.parseObjectValue(o.locale,1,"locale",yi),!h)?null:new fo(a,u,h)}evaluate(e){return new Df(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ku(i,e,n=0,o=i.length-1,a=Bd){for(;o>n;){if(o-n>600){const y=o-n+1,x=e-n+1,S=Math.log(y),E=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*E*(y-E)/y)*(x-y/2<0?-1:1);ku(i,e,Math.max(n,Math.floor(e-x*E/y+A)),Math.min(o,Math.floor(e+(y-x)*E/y+A)),a)}const u=i[e];let h=n,p=o;for(Oa(i,n,e),a(i[o],u)>0&&Oa(i,n,o);h<p;){for(Oa(i,h,p),h++,p--;a(i[h],u)<0;)h++;for(;a(i[p],u)>0;)p--}a(i[n],u)===0?Oa(i,n,p):(p++,Oa(i,p,o)),p<=e&&(n=p+1),e<=p&&(o=p-1)}}function Oa(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Bd(i,e){return i<e?-1:i>e?1:0}function Zl(i){let e=0;for(let n,o,a=0,u=i.length,h=u-1;a<u;h=a++)n=i[a],o=i[h],e+=(o.x-n.x)*(n.y+o.y);return e}function Fa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ch(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function vm(i,e,n){const o=i[0]-e[0],a=i[1]-e[1],u=i[0]-n[0],h=i[1]-n[1];return o*h-u*a==0&&o*u<=0&&a*h<=0}function zu(i,e,n=!1){let o=!1;for(let p=0,y=e.length;p<y;p++){const x=e[p];for(let S=0,E=x.length,A=E-1;S<E;A=S++){const P=x[A],k=x[S];if(vm(i,P,k))return n;(u=P)[1]>(a=i)[1]!=(h=k)[1]>a[1]&&a[0]<(h[0]-u[0])*(a[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var a,u,h;return o}function Mh(i,e,n,o){const a=o[0]-n[0],u=o[1]-n[1],h=(i[0]-n[0])*u-a*(i[1]-n[1]),p=(e[0]-n[0])*u-a*(e[1]-n[1]);return h>0&&p<0||h<0&&p>0}function Ls(i,e,n,o){return(a=[o[0]-n[0],o[1]-n[1]])[0]*(u=[e[0]-i[0],e[1]-i[1]])[1]-a[1]*u[0]!=0&&!(!Mh(i,e,n,o)||!Mh(n,o,i,e));var a,u}function ma(i){const e=new ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of i[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),n.x<o.x&&(n.x=o.x),n.y<o.y&&(n.y=o.y);return{min:e,max:n}}const Xl=8192;function Sp(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(n*a*Xl),Math.round(o*a*Xl)]}function Nd(i,e){for(let n=0;n<e.length;n++)if(zu(i,e[n]))return!0;return!1}function Ep(i,e,n){for(const o of n)for(let a=0,u=o.length,h=u-1;a<u;h=a++)if(Ls(i,e,o[h],o[a]))return!0;return!1}function jd(i,e){for(let n=0;n<i.length;++n)if(!zu(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Ep(i[n],i[n+1],e))return!1;return!0}function Ip(i,e){for(let n=0;n<e.length;n++)if(jd(i,e[n]))return!0;return!1}function Ff(i,e,n){const o=[];for(let a=0;a<i.length;a++){const u=[];for(let h=0;h<i[a].length;h++){const p=Sp(i[a][h],n);Fa(e,p),u.push(p)}o.push(u)}return o}function ga(i,e,n){const o=[];for(let a=0;a<i.length;a++){const u=Ff(i[a],e,n);o.push(u)}return o}function Vd(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const a=.5*o;let u=i[0]-n[0]>a?-o:n[0]-i[0]>a?o:0;u===0&&(u=i[0]-n[2]>a?-o:n[2]-i[0]>a?o:0),i[0]+=u}Fa(e,i)}function Lu(i,e,n,o){const a=Math.pow(2,o.z)*Xl,u=[o.x*Xl,o.y*Xl],h=[];if(!i)return h;for(const p of i)for(const y of p){const x=[y.x+u[0],y.y+u[1]];Vd(x,e,n,a),h.push(x)}return h}function Du(i,e,n,o){const a=Math.pow(2,o.z)*Xl,u=[o.x*Xl,o.y*Xl],h=[];if(!i)return h;for(const y of i){const x=[];for(const S of y){const E=[S.x+u[0],S.y+u[1]];Fa(e,E),x.push(E)}h.push(x)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const y of h)for(const x of y)Vd(x,e,n,a)}var p;return h}class Yl{constructor(e,n){this.type=$i,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mc(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){const u=o.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Yl(o,o.features[a].geometry)}else if(o.type==="Feature"){const a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Yl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Yl(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const p=Ff(o.coordinates,u,h),y=Lu(n.geometry(),a,u,h);if(!Ch(a,u))return!1;for(const x of y)if(!zu(x,p))return!1}if(o.type==="MultiPolygon"){const p=ga(o.coordinates,u,h),y=Lu(n.geometry(),a,u,h);if(!Ch(a,u))return!1;for(const x of y)if(!Nd(x,p))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const p=Ff(o.coordinates,u,h),y=Du(n.geometry(),a,u,h);if(!Ch(a,u))return!1;for(const x of y)if(!jd(x,p))return!1}if(o.type==="MultiPolygon"){const p=ga(o.coordinates,u,h),y=Du(n.geometry(),a,u,h);if(!Ch(a,u))return!1;for(const x of y)if(!Ip(x,p))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const gc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},is=1/298.257223563,Ud=is*(2-is),Uc=Math.PI/180;class Kl{static fromTile(e,n,o){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),u=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/Uc;return new Kl(u,o)}static get units(){return gc}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!gc[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(gc).join(", ")}`);const o=6378.137*Uc*(n?gc[n]:1),a=Math.cos(e*Uc),u=1/(1-Ud*(1-a*a)),h=Math.sqrt(u);this.kx=o*h*a,this.ky=o*h*u*(1-Ud)}distance(e,n){const o=Qs(e[0]-n[0])*this.kx,a=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+a*a)}bearing(e,n){const o=Qs(n[0]-e[0])*this.kx;return Math.atan2(o,(n[1]-e[1])*this.ky)/Uc}destination(e,n,o){const a=o*Uc;return this.offset(e,Math.sin(a)*n,Math.cos(a)*n)}offset(e,n,o){return[e[0]+n/this.kx,e[1]+o/this.ky]}lineDistance(e){let n=0;for(let o=0;o<e.length-1;o++)n+=this.distance(e[o],e[o+1]);return n}area(e){let n=0;for(let o=0;o<e.length;o++){const a=e[o];for(let u=0,h=a.length,p=h-1;u<h;p=u++)n+=Qs(a[u][0]-a[p][0])*(a[u][1]+a[p][1])*(o?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let o=0;if(n<=0)return e[0];for(let a=0;a<e.length-1;a++){const u=e[a],h=e[a+1],p=this.distance(u,h);if(o+=p,o>n)return Ph(u,h,(n-(o-p))/p)}return e[e.length-1]}pointToSegmentDistance(e,n,o){let[a,u]=n,h=Qs(o[0]-a)*this.kx,p=(o[1]-u)*this.ky;if(h!==0||p!==0){const y=(Qs(e[0]-a)*this.kx*h+(e[1]-u)*this.ky*p)/(h*h+p*p);y>1?(a=o[0],u=o[1]):y>0&&(a+=h/this.kx*y,u+=p/this.ky*y)}return h=Qs(e[0]-a)*this.kx,p=(e[1]-u)*this.ky,Math.sqrt(h*h+p*p)}pointOnLine(e,n){let o=1/0,a=e[0][0],u=e[0][1],h=0,p=0;for(let y=0;y<e.length-1;y++){let x=e[y][0],S=e[y][1],E=Qs(e[y+1][0]-x)*this.kx,A=(e[y+1][1]-S)*this.ky,P=0;E===0&&A===0||(P=(Qs(n[0]-x)*this.kx*E+(n[1]-S)*this.ky*A)/(E*E+A*A),P>1?(x=e[y+1][0],S=e[y+1][1]):P>0&&(x+=E/this.kx*P,S+=A/this.ky*P)),E=Qs(n[0]-x)*this.kx,A=(n[1]-S)*this.ky;const k=E*E+A*A;k<o&&(o=k,a=x,u=S,h=y,p=P)}return{point:[a,u],index:h,t:Math.max(0,Math.min(1,p))}}lineSlice(e,n,o){let a=this.pointOnLine(o,e),u=this.pointOnLine(o,n);if(a.index>u.index||a.index===u.index&&a.t>u.t){const x=a;a=u,u=x}const h=[a.point],p=a.index+1,y=u.index;!Gd(o[p],h[0])&&p<=y&&h.push(o[p]);for(let x=p+1;x<=y;x++)h.push(o[x]);return Gd(o[y],u.point)||h.push(u.point),h}lineSliceAlong(e,n,o){let a=0;const u=[];for(let h=0;h<o.length-1;h++){const p=o[h],y=o[h+1],x=this.distance(p,y);if(a+=x,a>e&&u.length===0&&u.push(Ph(p,y,(e-(a-x))/x)),a>=n)return u.push(Ph(p,y,(n-(a-x))/x)),u;a>e&&u.push(y)}return u}bufferPoint(e,n){const o=n/this.ky,a=n/this.kx;return[e[0]-a,e[1]-o,e[0]+a,e[1]+o]}bufferBBox(e,n){const o=n/this.ky,a=n/this.kx;return[e[0]-a,e[1]-o,e[2]+a,e[3]+o]}insideBBox(e,n){return Qs(e[0]-n[0])>=0&&Qs(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Gd(i,e){return i[0]===e[0]&&i[1]===e[1]}function Ph(i,e,n){const o=Qs(e[0]-i[0]);return[i[0]+o*n,i[1]+(e[1]-i[1])*n]}function Qs(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class Rh{constructor(e=[],n=((o,a)=>o<a?-1:o>a?1:0)){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,a=n[e];for(;e>0;){const u=e-1>>1,h=n[u];if(o(a,h)>=0)break;n[e]=h,e=u}n[e]=a}_down(e){const{data:n,compare:o}=this,a=this.length>>1,u=n[e];for(;e<a;){let h=1+(e<<1);const p=h+1;if(p<this.length&&o(n[p],n[h])<0&&(h=p),o(n[h],u)>=0)break;n[e]=n[h],e=h}n[e]=u}}var Pt=8192;function $d(i,e){return e.dist-i.dist}const Qa=100,Ou=50;function kh(i){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==i[n])return!1;return!0}function zh(i){return i[1]-i[0]+1}function Sl(i,e){const n=i[1]>=i[0]&&i[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Gc(i,e){if(i[0]>i[1])return[null,null];const n=zh(i);if(e){if(n===2)return[i,null];const o=Math.floor(n/2);return[[i[0],i[0]+o],[i[0]+o,i[1]]]}{if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}}function $c(i,e){const n=[1/0,1/0,-1/0,-1/0];if(!Sl(e,i.length))return n;for(let o=e[0];o<=e[1];++o)Fa(n,i[o]);return n}function _c(i){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<i.length;++n)for(let o=0;o<i[n].length;++o)Fa(e,i[n][o]);return e}function Jl(i,e,n){if(kh(i)||kh(e))return NaN;let o=0,a=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(a=i[1]-e[3]),i[3]<e[1]&&(a=e[1]-i[3]),n.distance([0,0],[o,a])}function Or(i){return 360*i-180}function Hd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Hc(i,e){const n=Math.pow(2,e.z),o=(i.y/Pt+e.y)/n;return[Or((i.x/Pt+e.x)/n),Hd(o)]}function Lh(i,e){const n=[];for(let o=0;o<i.length;++o)n.push(Hc(i[o],e));return n}function Bf(i,e,n){const o=n.pointOnLine(e,i).point;return n.distance(i,o)}function Dh(i,e,n,o,a){const u=n.slice(o[0],o[1]+1);let h=1/0;for(let p=e[0];p<=e[1];++p)if((h=Math.min(h,Bf(i[p],u,a)))===0)return 0;return h}function Ba(i,e,n,o,a){const u=Math.min(a.pointToSegmentDistance(i,n,o),a.pointToSegmentDistance(e,n,o)),h=Math.min(a.pointToSegmentDistance(n,i,e),a.pointToSegmentDistance(o,i,e));return Math.min(u,h)}function ui(i,e,n,o,a){if(!Sl(e,i.length)||!Sl(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let p=o[0];p<o[1];++p){if(Ls(i[h],i[h+1],n[p],n[p+1]))return 0;u=Math.min(u,Ba(i[h],i[h+1],n[p],n[p+1],a))}return u}function Fu(i,e,n,o,a){if(!Sl(e,i.length)||!Sl(o,n.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let p=o[0];p<=o[1];++p)if((u=Math.min(u,a.distance(i[h],n[p])))===0)return u;return u}function Ap(i,e,n){if(zu(i,e,!0))return 0;let o=1/0;for(const a of e){const u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&(o=Math.min(o,n.pointToSegmentDistance(i,a[u-1],a[0])))===0||(o=Math.min(o,Bf(i,a,n)))===0)return o}return o}function xm(i,e,n,o){if(!Sl(e,i.length))return NaN;for(let u=e[0];u<=e[1];++u)if(zu(i[u],n,!0))return 0;let a=1/0;for(let u=e[0];u<e[1];++u)for(const h of n)for(let p=0,y=h.length,x=y-1;p<y;x=p++){if(Ls(i[u],i[u+1],h[x],h[p]))return 0;a=Math.min(a,Ba(i[u],i[u+1],h[x],h[p],o))}return a}function Nf(i,e){for(const n of i)for(let o=0;o<=n.length-1;++o)if(zu(n[o],e,!0))return!0;return!1}function Cp(i,e,n,o=1/0){const a=_c(i),u=_c(e);if(o!==1/0&&Jl(a,u,n)>=o)return o;if(Ch(a,u)){if(Nf(i,e))return 0}else if(Nf(e,i))return 0;let h=o;for(const p of i)for(let y=0,x=p.length,S=x-1;y<x;S=y++)for(const E of e)for(let A=0,P=E.length,k=P-1;A<P;k=A++){if(Ls(p[S],p[y],E[k],E[A]))return 0;h=Math.min(h,Ba(p[S],p[y],E[k],E[A],n))}return h}function or(i,e,n,o,a,u,h){if(u===null||h===null)return;const p=Jl($c(o,u),$c(a,h),n);p<e&&i.push({dist:p,range1:u,range2:h})}function Wd(i,e,n,o,a=1/0){let u=Math.min(o.distance(i[0],n[0][0]),a);if(u===0)return u;const h=new Rh([{dist:0,range1:[0,i.length-1],range2:[0,0]}],$d),p=e?Ou:Qa,y=_c(n);for(;h.length;){const x=h.pop();if(x.dist>=u)continue;const S=x.range1;if(zh(S)<=p){if(!Sl(S,i.length))return NaN;if(e){const E=xm(i,S,n,o);if((u=Math.min(u,E))===0)return u}else for(let E=S[0];E<=S[1];++E){const A=Ap(i[E],n,o);if((u=Math.min(u,A))===0)return u}}else{const E=Gc(S,e);if(E[0]!==null){const A=Jl($c(i,E[0]),y,o);A<u&&h.push({dist:A,range1:E[0],range2:[0,0]})}if(E[1]!==null){const A=Jl($c(i,E[1]),y,o);A<u&&h.push({dist:A,range1:E[1],range2:[0,0]})}}}return u}function qd(i,e,n,o,a,u=1/0){let h=Math.min(u,a.distance(i[0],n[0]));if(h===0)return h;const p=new Rh([{dist:0,range1:[0,i.length-1],range2:[0,n.length-1]}],$d),y=e?Ou:Qa,x=o?Ou:Qa;for(;p.length;){const S=p.pop();if(S.dist>=h)continue;const E=S.range1,A=S.range2;if(zh(E)<=y&&zh(A)<=x){if(!Sl(E,i.length)||!Sl(A,n.length))return NaN;if(e&&o?h=Math.min(h,ui(i,E,n,A,a)):e||o?e&&!o?h=Math.min(h,Dh(n,A,i,E,a)):!e&&o&&(h=Math.min(h,Dh(i,E,n,A,a))):h=Math.min(h,Fu(i,E,n,A,a)),h===0)return h}else{const P=Gc(E,e),k=Gc(A,o);or(p,h,a,i,n,P[0],k[0]),or(p,h,a,i,n,P[0],k[1]),or(p,h,a,i,n,P[1],k[0]),or(p,h,a,i,n,P[1],k[1])}}return h}function Oh(i,e,n,o,a=1/0){let u=a;const h=$c(i,[0,i.length-1]);for(const p of n)if(!(u!==1/0&&Jl(h,$c(p,[0,p.length-1]),o)>=u)&&(u=Math.min(u,qd(i,e,p,!0,o,u)),u===0))return u;return u}function Bu(i,e,n,o,a=1/0){let u=a;const h=$c(i,[0,i.length-1]);for(const p of n){if(u!==1/0&&Jl(h,_c(p),o)>=u)continue;const y=Wd(i,e,p,o,u);if(isNaN(y))return y;if((u=Math.min(u,y))===0)return u}return u}function Fh(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Wc{constructor(e,n){this.type=un,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(mc(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(Fh(o.features[a].geometry.type))return new Wc(o,o.features[a].geometry)}else if(o.type==="Feature"){if(Fh(o.geometry.type))return new Wc(o,o.geometry)}else if(Fh(o.type))return new Wc(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return(function(a,u,h){const p=[];for(const x of a)for(const S of x)p.push(Hc(S,u));const y=new Kl(p[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?qd(p,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?Oh(p,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?Bu(p,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null})(n,o,this.geometries);if(e.geometryType()==="LineString")return(function(a,u,h){const p=[];for(const x of a){const S=[];for(const E of x)S.push(Hc(E,u));p.push(S)}const y=new Kl(p[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Oh(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,y);if(h.type==="MultiLineString"){let x=1/0;for(let S=0;S<h.coordinates.length;S++){const E=Oh(h.coordinates[S],!0,p,y,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}if(h.type==="Polygon"||h.type==="MultiPolygon"){let x=1/0;for(let S=0;S<p.length;S++){const E=Bu(p[S],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return null})(n,o,this.geometries);if(e.geometryType()==="Polygon")return(function(a,u,h){const p=[];for(const x of(function(S,E){const A=S.length;if(A<=1)return[S];const P=[];let k,F;for(let G=0;G<A;G++){const U=Zl(S[G]);U!==0&&(S[G].area=Math.abs(U),F===void 0&&(F=U<0),F===U<0?(k&&P.push(k),k=[S[G]]):k.push(S[G]))}return k&&P.push(k),P})(a)){const S=[];for(let E=0;E<x.length;++E)S.push(Lh(x[E],u));p.push(S)}const y=new Kl(p[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Bu(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,y);if(h.type==="MultiLineString"){let x=1/0;for(let S=0;S<h.coordinates.length;S++){const E=Bu(h.coordinates[S],!0,p,y,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return h.type==="Polygon"||h.type==="MultiPolygon"?(function(x,S,E){let A=1/0;for(const P of x)for(const k of S){const F=Cp(P,k,E,A);if(isNaN(F))return F;if((A=Math.min(A,F))===0)return A}return A})(h.type==="Polygon"?[h.coordinates]:h.coordinates,p,y):null})(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qc(i){if(i instanceof ys&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Yl||i instanceof Wc)return!1;if(i instanceof el)return i.featureConstant;let e=!0;return i.eachChild((n=>{e&&!qc(n)&&(e=!1)})),e}function Bh(i){if(i instanceof ys&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!Bh(n)&&(e=!1)})),e}function Nu(i,e){if(i instanceof ys&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((o=>{n&&!Nu(o,e)&&(n=!1)})),n}function Zd(i,e,n){return[i,e,n].filter(Boolean).join("")}function El(i,e){switch(i){case"string":return La(e);case"number":return+e;case"boolean":return!!e;case"color":return Vi.parse(e);case"formatted":return gs.fromString(La(e));case"resolvedImage":return _s.build(La(e))}return e}function jf(i,e,n,o){return o!==void 0&&(i=o*Math.round(i/o)),e!==void 0&&i<e&&(i=e),n!==void 0&&i>n&&(i=n),i}class el{constructor(e,n,o,a=!1){this.type=e,this.key=n,this.scope=o,this.featureConstant=a}static parse(e,n){let o=n.expectedType;if(o==null&&(o=Oi),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const a=n.parse(e[1],1);if(!(a instanceof Tl))return n.error("Key name of 'config' expression must be a string literal.");let u,h=!0;const p=La(a.value);if(e.length>=3){const y=n.parse(e[2],2);if(!(y instanceof Tl))return n.error("Scope of 'config' expression must be a string literal.");u=La(y.value)}if(n.options){const y=Zd(p,u,n._scope),x=n.options.get(y);x&&(h=qc(x.value||x.default))}return new el(o,p,u,h)}evaluate(e){const n=Zd(this.key,this.scope,e.scope),o=e.getConfig(n);if(!o)return null;const{type:a,value:u,values:h,minValue:p,maxValue:y,stepValue:x}=o,S=o.default.evaluate(e);let E=S;if(u){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),E=u.evaluate(e),e.scope=A}return a&&(E=El(a,E)),E===void 0||p===void 0&&y===void 0&&x===void 0||(typeof E=="number"?E=jf(E,p,y,x):Array.isArray(E)&&(E=E.map((A=>typeof A=="number"?jf(A,p,y,x):A)))),u!==void 0&&E!==void 0&&h&&!h.includes(E)&&(E=S,a&&(E=El(a,E))),(a&&a!==this.type||E!==void 0&&!Ld(Zr(E),this.type))&&(E=El(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class _a{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new _a(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class yc{constructor(e,n=[],o,a=new Pu,u=[],h,p,y){this.registry=e,this.path=n,this.key=n.map((x=>typeof x=="string"?`['${x}']`:`[${x}]`)).join(""),this.scope=a,this.errors=u,this.expectedType=o,this._scope=h,this.options=p,this.iconImageUseTheme=y}parse(e,n,o,a,u={}){return n||o?this.concat(n,null,o,a)._parse(e,u):this._parse(e,u)}parseObjectValue(e,n,o,a,u,h={}){return this.concat(n,o,a,u)._parse(e,h)}_parse(e,n){function o(a,u,h){return h==="assert"?new Da(u,[a]):h==="coerce"?new Js(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let u=a.parse(e,this);if(!u)return null;if(this.expectedType){const h=this.expectedType,p=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||p.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(h,p))return null}else u=o(u,h,n.typeAnnotation||"coerce");else u=o(u,h,n.typeAnnotation||"assert")}if(!(u instanceof Tl)&&u.type.kind!=="resolvedImage"&&tl(u)){const h=new Vc(this._scope,this.options,this.iconImageUseTheme);try{u=new Tl(u.type,u.evaluate(h))}catch(p){return this.error(p.message),null}}return u}return Js.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o,a){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof n=="string"?u.concat(n):u;const h=a?this.scope.concat(a):this.scope;return new yc(this.registry,u,o||null,h,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const o=`${this.key}${n.map((a=>`[${a}]`)).join("")}`;this.errors.push(new za(o,e))}checkSubtype(e,n){const o=pc(e,n);return o&&this.error(o),o}}function tl(i){if(i instanceof _a)return tl(i.boundExpression);if(i instanceof ys&&i.name==="error"||i instanceof fo||i instanceof Yl||i instanceof Wc||i instanceof el)return!1;const e=i instanceof Js||i instanceof Da;let n=!0;return i.eachChild((o=>{n=e?n&&tl(o):n&&o instanceof Tl})),!!n&&qc(i)&&Nu(i,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ju(i,e){const n=i.length-1;let o,a,u=0,h=n,p=0;for(;u<=h;)if(p=Math.floor((u+h)/2),o=i[p],a=i[p+1],o<=e){if(p===n||e<a)return p;u=p+1}else{if(!(o>e))throw new oo("Input is not a number.");h=p-1}return 0}class Nh{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[a,u]of o)this.labels.push(a),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,un);if(!o)return null;const a=[];let u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let h=1;h<e.length;h+=2){const p=h===1?-1/0:e[h],y=e[h+1],x=h,S=h+1;if(typeof p!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=p)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=n.parse(y,S,u);if(!E)return null;u=u||E.type,a.push([p,E])}return new Nh(u,o,a)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return o[0].evaluate(e);const u=n.length;return a>=n[u-1]?o[u-1].evaluate(e):o[ju(n,a)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Mp=.95047,vc=1.08883,Vu=4/29,nl=6/29,jh=3*nl*nl,Vf=nl*nl*nl,Uu=Math.PI/180,xc=180/Math.PI;function Vr(i){return i>Vf?Math.pow(i,1/3):i/jh+Vu}function Fr(i){return i>nl?i*i*i:jh*(i-Vu)}function Il(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Yo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ds(i){const e=Yo(i.r),n=Yo(i.g),o=Yo(i.b),a=Vr((.4124564*e+.3575761*n+.1804375*o)/Mp),u=Vr((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-Vr((.0193339*e+.119192*n+.9503041*o)/vc)),alpha:i.a}}function Al(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Fr(e),n=Mp*Fr(n),o=vc*Fr(o),new Vi(Il(3.2404542*n-1.5371385*e-.4985314*o),Il(-.969266*n+1.8760108*e+.041556*o),Il(.0556434*n-.2040259*e+1.0572252*o),i.alpha)}function Ql(i,e,n){const o=e-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const Bo={forward:Ds,reverse:Al,interpolate:function(i,e,n){return{l:bn(i.l,e.l,n),a:bn(i.a,e.a,n),b:bn(i.b,e.b,n),alpha:bn(i.alpha,e.alpha,n)}}},wc={forward:function(i){const{l:e,a:n,b:o}=Ds(i),a=Math.atan2(o,n)*xc;return{h:a<0?a+360:a,c:Math.sqrt(n*n+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Uu,n=i.c;return Al({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:Ql(i.h,e.h,n),c:bn(i.c,e.c,n),l:bn(i.l,e.l,n),alpha:bn(i.alpha,e.alpha,n)}}};var Uf=Object.freeze({__proto__:null,hcl:wc,lab:Bo});class ea{constructor(e,n,o,a,u){this.type=e,this.operator=n,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(e,n,o,a){let u=0;if(e.name==="exponential")u=Zc(n,e.base,o,a);else if(e.name==="linear")u=Zc(n,1,o,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;u=new Wa(h[0],h[1],h[2],h[3]).solve(Zc(n,1,o,a))}return u}static parse(e,n){let[o,a,u,...h]=e;if(!Array.isArray(a)||a.length===0)return n.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const x=a[1];if(typeof x!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const x=a.slice(1);if(x.length!==4||x.some((S=>typeof S!="number"||S<0||S>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,un),!u)return null;const p=[];let y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=zs:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let x=0;x<h.length;x+=2){const S=h[x],E=h[x+1],A=x+3,P=x+4;if(typeof S!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=S)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const k=n.parse(E,P,y);if(!k)return null;y=y||k.type,p.push([S,k])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new ea(y,o,a,u,p):n.error(`Type ${Dr(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return o[0].evaluate(e);const u=n.length;if(a>=n[u-1])return o[u-1].evaluate(e);const h=ju(n,a),p=ea.interpolationFactor(this.interpolation,a,n[h],n[h+1]),y=o[h].evaluate(e),x=o[h+1].evaluate(e);return this.operator==="interpolate"?Th[this.type.kind.toLowerCase()](y,x,p):this.operator==="interpolate-hcl"?wc.reverse(wc.interpolate(wc.forward(y),wc.forward(x),p)):Bo.reverse(Bo.interpolate(Bo.forward(y),Bo.forward(x),p))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function Zc(i,e,n,o){const a=o-n,u=i-n;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class Gu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const a=n.expectedType;a&&a.kind!=="value"&&(o=a);const u=[];for(const p of e.slice(1)){const y=n.parse(p,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,u.push(y)}const h=a&&u.some((p=>pc(a,p.type)));return new Gu(h?Oi:o,u)}evaluate(e){let n,o=null,a=0;for(const u of this.args){if(a++,o=u.evaluate(e),o&&o instanceof _s&&!o.available&&(n||(n=o),o=null,a===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class rs{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const h=e[u];if(typeof h!="string")return n.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);const p=n.parse(e[u+1],u+1);if(!p)return null;o.push([h,p])}const a=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return a?new rs(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}class Xc{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,un),a=n.parse(e[2],2,Xo(n.expectedType||Oi));return o&&a?new Xc(a.type.itemType,o,a):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new oo("Array index out of bounds: negative index");if(n>=o.length)throw new oo("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new oo("Array index must be an integer. Use at-interpolated for fractional indices");return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class $u{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,un),a=n.parse(e[2],2,Xo(n.expectedType||Oi));return o&&a?new $u(a.type.itemType,o,a):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new oo(`Array index out of bounds: ${n} < 0.`);if(n>o.length-1)throw new oo(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n===Math.floor(n))return o[n];const a=Math.floor(n),u=Math.ceil(n),h=o[a],p=o[u];if(typeof h!="number"||typeof p!="number")throw new oo(`Cannot interpolate between non-number values at index ${n}.`);const y=n-a;return h*(1-y)+p*y}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Xd{constructor(e,n){this.type=$i,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Oi),a=n.parse(e[2],2,Oi);return o&&a?Lf(o.type,[$i,yi,un,pa,Oi])?new Xd(o,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ru(n,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Zr(n))} instead.`);if(!Ru(o,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${Dr(Zr(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Hu{constructor(e,n,o){this.type=un,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Oi),a=n.parse(e[2],2,Oi);if(!o||!a)return null;if(!Lf(o.type,[$i,yi,un,pa,Oi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(o.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,un);return u?new Hu(o,a,u):null}return new Hu(o,a)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ru(n,["boolean","string","number","null"]))throw new oo(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(Zr(n))} instead.`);if(!Ru(o,["string","array"]))throw new oo(`Expected second argument to be of type array or string, but found ${Dr(Zr(o))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return o.indexOf(n,a)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Na{constructor(e,n,o,a,u,h){this.inputType=e,this.type=n,this.input=o,this.cases=a,this.outputs=u,this.otherwise=h}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u={},h=[];for(let x=2;x<e.length-1;x+=2){let S=e[x];const E=e[x+1];Array.isArray(S)||(S=[S]);const A=n.concat(x);if(S.length===0)return A.error("Expected at least one branch label.");for(const k of S){if(typeof k!="number"&&typeof k!="string")return A.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return A.error("Numeric branch labels must be integer values.");if(o){if(A.checkSubtype(o,Zr(k)))return null}else o=Zr(k);if(u[String(k)]!==void 0)return A.error("Branch labels must be unique.");u[String(k)]=h.length}const P=n.parse(E,x,a);if(!P)return null;a=a||P.type,h.push(P)}const p=n.parse(e[1],1,Oi);if(!p)return null;const y=n.parse(e[e.length-1],e.length-1,a);return y?p.type.kind!=="value"&&n.concat(1).checkSubtype(o,p.type)?null:new Na(o,a,p,u,h,y):null}evaluate(e){const n=this.input.evaluate(e);return(Ld(Zr(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],a={};for(const h of n){const p=a[this.cases[h]];p===void 0?(a[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[p][1].push(h)}const u=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,p]of o)e.push(p.length===1?u(p[0]):p.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class Cl{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const p=n.parse(e[h],h,$i);if(!p)return null;const y=n.parse(e[h+1],h+1,o);if(!y)return null;a.push([p,y]),o=o||y.type}const u=n.parse(e[e.length-1],e.length-1,o);return u?new Cl(o,a,u):null}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((n=>{e.push(n.serialize())})),e}}class ec{constructor(e,n,o,a){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Oi),a=n.parse(e[2],2,un);if(!o||!a)return null;if(!Lf(o.type,[Xo(Oi),yi,Oi]))return n.error(`Expected first argument to be of type array or string, but found ${Dr(o.type)} instead`);if(e.length===4){const u=n.parse(e[3],3,un);return u?new ec(o.type,o,a,u):null}return new ec(o.type,o,a)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ru(n,["string","array"]))throw new oo(`Expected first argument to be of type array or string, but found ${Dr(Zr(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return n.slice(o,a)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Wu{constructor(e,n){this.type=Xo(yi),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,yi),a=n.parse(e[2],2,yi);return o&&a?new Wu(o,a):void 0}evaluate(e){const n=this.str.evaluate(e),o=this.delimiter.evaluate(e);return n.split(o)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function qu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ta(i,e,n,o){return o.compare(e,n)===0}function os(i,e,n){const o=i!=="=="&&i!=="!=";return class JT{constructor(u,h,p){this.type=$i,this.lhs=u,this.rhs=h,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");const p=u[0];let y=h.parse(u[1],1,Oi);if(!y)return null;if(!qu(p,y.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${Dr(y.type)}'.`);let x=h.parse(u[2],2,Oi);if(!x)return null;if(!qu(p,x.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${Dr(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error(`Cannot compare types '${Dr(y.type)}' and '${Dr(x.type)}'.`);o&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new Da(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new Da(y.type,[x])));let S=null;if(u.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(S=h.parse(u[3],3,zd),!S)return null}return new JT(y,x,S)}evaluate(u){const h=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const y=Zr(h),x=Zr(p);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new oo(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const y=Zr(h),x=Zr(p);if(y.kind!=="string"||x.kind!=="string")return e(u,h,p)}return this.collator?n(u,h,p,this.collator.evaluate(u)):e(u,h,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild((h=>{u.push(h.serialize())})),u}}}const Yc=os("==",(function(i,e,n){return e===n}),ta),tc=os("!=",(function(i,e,n){return e!==n}),(function(i,e,n,o){return!ta(0,e,n,o)})),Ml=os("<",(function(i,e,n){return e<n}),(function(i,e,n,o){return o.compare(e,n)<0})),bc=os(">",(function(i,e,n){return e>n}),(function(i,e,n,o){return o.compare(e,n)>0})),Vh=os("<=",(function(i,e,n){return e<=n}),(function(i,e,n,o){return o.compare(e,n)<=0})),Gf=os(">=",(function(i,e,n){return e>=n}),(function(i,e,n,o){return o.compare(e,n)>=0}));class Zu{constructor(e,n,o,a,u,h){this.type=yi,this.number=e,this.locale=n,this.currency=o,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,un);if(!o)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=n.parseObjectValue(a.locale,2,"locale",yi),!u))return null;let h=null;if(a.currency&&(h=n.parseObjectValue(a.currency,2,"currency",yi),!h))return null;let p=null;if(a.unit&&(p=n.parseObjectValue(a.unit,2,"unit",yi),!p))return null;let y=null;if(a["min-fraction-digits"]&&(y=n.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",un),!y))return null;let x=null;return a["max-fraction-digits"]&&(x=n.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",un),!x)?null:new Zu(o,u,h,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Os{constructor(e){this.type=un,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Dr(o.type)} instead.`):new Os(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new oo(`Expected value to be of type string or array, but found ${Dr(Zr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((n=>{e.push(n.serialize())})),e}}function na(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const zr={"==":Yc,"!=":tc,">":bc,"<":Ml,">=":Gf,"<=":Vh,array:Da,at:Xc,"at-interpolated":$u,boolean:Da,case:Cl,coalesce:Gu,collator:fo,format:Ja,image:On,in:Xd,"index-of":Hu,interpolate:ea,"interpolate-hcl":ea,"interpolate-lab":ea,length:Os,let:rs,literal:Tl,match:Na,number:Da,"number-format":Zu,object:Da,slice:ec,step:Nh,string:Da,"to-boolean":Js,"to-color":Js,"to-number":Js,"to-string":Js,var:_a,within:Yl,distance:Wc,config:el,split:Wu};function ya(i,[e,n,o,a]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const u=a?a.evaluate(i):1,h=Nc(e,n,o,u);if(h)throw new oo(h);return new Vi(e/255,n/255,o/255,u)}function Yd(i,[e,n,o,a]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const u=a?a.evaluate(i):1,h=(function(x,S,E,A){return typeof x=="number"&&x>=0&&x<=360?typeof S=="number"&&S>=0&&S<=100&&typeof E=="number"&&E>=0&&E<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[x,S,E,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[x,S,E,A]:[x,S,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[x,S,E,A]:[x,S,E]).join(", ")}]: 'h' must be between 0 and 360.`})(e,n,o,u);if(h)throw new oo(h);const p=`hsla(${e}, ${n}%, ${o}%, ${u})`,y=Vi.parse(p);if(!y)throw new oo(`Failed to parse HSLA color: ${p}`);return y}function $f(i,e){return i in e}function Uh(i,e){const n=e[i];return n===void 0?null:n}function Pl(i){return{type:i}}function Tc(i){if(i instanceof el)return new Set([i.key]);let e=new Set;return i.eachChild((n=>{e=new Set([...e,...Tc(n)])})),e}function Kc(i){if(i instanceof ys&&i.name==="is-active-floor")return!0;let e=!1;return i.eachChild((n=>{!e&&Kc(n)&&(e=!0)})),e}function Hf(i){return{result:"success",value:i}}function va(i){return{result:"error",value:i}}function Gh(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function $h(i){return i["property-type"]==="data-driven"}function Xu(i){return Gh(i.expression,"measure-light")}function Hh(i){return Gh(i.expression,"zoom")}function Wh(i){return!!i.expression&&i.expression.interpolated}function qh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Jc(i){return i}function Wf(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",a=o||!(o||i.property!==void 0),u=i.type||(Wh(e)?"exponential":"interval");if(n&&((i=Object.assign({},i)).stops&&(i.stops=i.stops.map((x=>[x[0],Vi.parse(x[1])]))),i.default=Vi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Uf[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let h,p,y;if(u==="exponential")h=Jd;else if(u==="interval")h=Yu;else if(u==="categorical"){h=Kd,p=Object.create(null);for(const x of i.stops)p[x[0]]=x[1];y=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=Qd}if(o){const x={},S=[];for(let P=0;P<i.stops.length;P++){const k=i.stops[P],F=k[0].zoom;x[F]===void 0&&(x[F]={zoom:F,type:i.type,property:i.property,default:i.default,stops:[]},S.push(F)),x[F].stops.push([k[0].value,k[1]])}const E=[];for(const P of S)E.push([x[P].zoom,Wf(x[P],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:ea.interpolationFactor.bind(void 0,A),zoomStops:E.map((P=>P[0])),evaluate:({zoom:P},k)=>Jd({stops:E,base:i.base},e,P).evaluate(P,k)}}if(a){const x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:ea.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map((S=>S[0])),evaluate:({zoom:S})=>h(i,e,S,p,y)}}return{kind:"source",evaluate(x,S){const E=S&&S.properties?S.properties[i.property]:void 0;return E===void 0?xa(i.default,e.default):h(i,e,E,p,y)}}}function xa(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Kd(i,e,n,o,a){return xa(typeof n===a?o[n]:void 0,i.default,e.default)}function Yu(i,e,n){if(!jc(n))return xa(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const a=ju(i.stops.map((u=>u[0])),n);return i.stops[a][1]}function Jd(i,e,n){const o=i.base!==void 0?i.base:1;if(!jc(n))return xa(i.default,e.default);const a=i.stops.length;if(a===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[a-1][0])return i.stops[a-1][1];const u=ju(i.stops.map((S=>S[0])),n),h=(function(S,E,A,P){const k=P-A,F=S-A;return k===0?0:E===1?F/k:(Math.pow(E,F)-1)/(Math.pow(E,k)-1)})(n,o,i.stops[u][0],i.stops[u+1][0]),p=i.stops[u][1],y=i.stops[u+1][1];let x=Th[e.type]||Jc;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=Uf[i.colorSpace];x=(E,A)=>S.reverse(S.interpolate(S.forward(E),S.forward(A),h))}return typeof p.evaluate=="function"?{evaluate(...S){const E=p.evaluate.apply(void 0,S),A=y.evaluate.apply(void 0,S);if(E!==void 0&&A!==void 0)return x(E,A,h)}}:x(p,y,h)}function Qd(i,e,n){return e.type==="color"?n=Vi.parse(n):e.type==="formatted"?n=gs.fromString(n.toString()):e.type==="resolvedImage"?n=_s.build(n.toString()):an(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),xa(n,i.default,e.default)}ys.register(zr,{error:[{kind:"error"},[yi],(i,[e])=>{throw new oo(e.evaluate(i))}],typeof:[yi,[Oi],(i,[e])=>Dr(Zr(e.evaluate(i)))],"to-rgba":[Xo(un,4),[zs],(i,[e])=>e.evaluate(i).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xo(un,4),[zs],(i,[e])=>e.evaluate(i).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[zs,[un,un,un],ya],rgba:[zs,[un,un,un,un],ya],hsl:[zs,[un,un,un],Yd],hsla:[zs,[un,un,un,un],Yd],has:{type:$i,overloads:[[[yi],(i,[e])=>$f(e.evaluate(i),i.properties())],[[yi,bl],(i,[e,n])=>$f(e.evaluate(i),n.evaluate(i))]]},get:{type:Oi,overloads:[[[yi],(i,[e])=>Uh(e.evaluate(i),i.properties())],[[yi,bl],(i,[e,n])=>Uh(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Oi,[yi],(i,[e])=>Uh(e.evaluate(i),i.featureState||{})],properties:[bl,[],i=>i.properties()],"geometry-type":[yi,[],i=>i.geometryType()],worldview:[yi,[],i=>i.globals.worldview||""],"is-active-floor":[$i,Pl(yi),(i,e)=>{if(!(i.globals.activeFloors&&i.globals.activeFloors.size>0))return!1;const n=i.globals.activeFloors;return e.some((o=>{const a=o.evaluate(i);return n.has(a)}))}],id:[Oi,[],i=>i.id()],zoom:[un,[],i=>i.globals.zoom],pitch:[un,[],i=>i.globals.pitch||0],"distance-from-center":[un,[],i=>i.distanceFromCenter()],"measure-light":[un,[yi],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[un,[],i=>i.globals.heatmapDensity||0],"line-progress":[un,[],i=>i.globals.lineProgress||0],"raster-value":[un,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[un,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[un,[],i=>i.globals.skyRadialProgress||0],accumulated:[Oi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[un,Pl(un),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[un,Pl(un),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:un,overloads:[[[un,un],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[un],(i,[e])=>-e.evaluate(i)]]},"/":[un,[un,un],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[un,[un,un],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[un,[],()=>Math.LN2],pi:[un,[],()=>Math.PI],e:[un,[],()=>Math.E],"^":[un,[un,un],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[un,[un],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[un,[un],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[un,[un],(i,[e])=>Math.log(e.evaluate(i))],log2:[un,[un],(i,[e])=>Math.log2(e.evaluate(i))],sin:[un,[un],(i,[e])=>Math.sin(e.evaluate(i))],cos:[un,[un],(i,[e])=>Math.cos(e.evaluate(i))],tan:[un,[un],(i,[e])=>Math.tan(e.evaluate(i))],asin:[un,[un],(i,[e])=>Math.asin(e.evaluate(i))],acos:[un,[un],(i,[e])=>Math.acos(e.evaluate(i))],atan:[un,[un],(i,[e])=>Math.atan(e.evaluate(i))],min:[un,Pl(un),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[un,Pl(un),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[un,[un],(i,[e])=>Math.abs(e.evaluate(i))],round:[un,[un],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[un,[un],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[un,[un],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[$i,[yi,Oi],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[$i,[Oi],(i,[e])=>i.id()===e.value],"filter-type-==":[$i,[yi],(i,[e])=>i.geometryType()===e.value],"filter-<":[$i,[yi,Oi],(i,[e,n])=>{const o=i.properties()[e.value],a=n.value;return typeof o==typeof a&&o<a}],"filter-id-<":[$i,[Oi],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[$i,[yi,Oi],(i,[e,n])=>{const o=i.properties()[e.value],a=n.value;return typeof o==typeof a&&o>a}],"filter-id->":[$i,[Oi],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[$i,[yi,Oi],(i,[e,n])=>{const o=i.properties()[e.value],a=n.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[$i,[Oi],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[$i,[yi,Oi],(i,[e,n])=>{const o=i.properties()[e.value],a=n.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[$i,[Oi],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[$i,[Oi],(i,[e])=>e.value in i.properties()],"filter-has-id":[$i,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$i,[Xo(yi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[$i,[Xo(Oi)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[$i,[yi,Xo(Oi)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[$i,[yi,Xo(Oi)],(i,[e,n])=>(function(o,a,u,h){for(;u<=h;){const p=u+h>>1;if(a[p]===o)return!0;a[p]>o?h=p-1:u=p+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:$i,overloads:[[[$i,$i],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Pl($i),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:$i,overloads:[[[$i,$i],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Pl($i),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[$i,[$i],(i,[e])=>!e.evaluate(i)],"is-supported-script":[$i,[yi],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[yi,[yi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[yi,[yi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[yi,Pl(Oi),(i,e)=>e.map((n=>La(n.evaluate(i)))).join("")],"resolved-locale":[yi,[zd],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[un,[un,un,Oi],(i,e)=>{const[n,o,a]=e.map((h=>h.evaluate(i)));if(n>o||n===o)return n;let u;if(typeof a=="string")u=(function(h){let p=0;if(h.length===0)return p;for(let y=0;y<h.length;y++)p=(p<<5)-p+h.charCodeAt(y),p|=0;return p})(a);else{if(typeof a!="number")throw new oo(`Invalid seed input: ${a}`);u=a}return n+na(u)()*(o-n)}]});class Ku{constructor(e,n,o,a,u){this.expression=e,this._warningHistory={},this._scope=o,this._options=a,this._iconImageUseTheme=u,this._evaluator=new Vc(o,a,u),this._defaultValue=n?(function(h){return h.type==="color"&&(qh(h.default)||Array.isArray(h.default))?new Vi(0,0,0,0):h.type==="color"?Vi.parse(h.default)||null:h.default===void 0?null:h.default})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=Tc(e),this.isIndoorDependent=Kc(e)}evaluateWithoutErrorHandling(e,n,o,a,u,h,p,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,a,u,h,p,y,x){this._evaluator||(this._evaluator=new Vc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null,this._evaluator.iconImageUseTheme=x||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new oo(`Expected value to be one of ${Object.keys(this._enumValues).map((E=>JSON.stringify(E))).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){const E=S;return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function Qc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in zr}function wa(i,e,n,o,a){const u=new yc(zr,[],e?(function(p){const y={color:zs,string:yi,number:un,enum:yi,boolean:$i,formatted:Sh,resolvedImage:Eh};return p.type==="array"?Xo(y[p.value]||Oi,p.length):y[p.type]})(e):void 0,void 0,void 0,n,o,a),h=u.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Hf(new Ku(h,e,n,o,a)):va(u.errors)}class ss{constructor(e,n,o,a){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!Bh(n.expression),this.configDependencies=Tc(n.expression),this.isIndoorDependent=Kc(n.expression)}evaluateWithoutErrorHandling(e,n,o,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,a,u,h)}evaluate(e,n,o,a,u,h,p){return this._styleExpression.evaluate(e,n,o,a,u,h,void 0,void 0,p)}}class ba{constructor(e,n,o,a,u,h){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Bh(n.expression),this.isIndoorDependent=Kc(n.expression),this.isLightConstant=u,this.isLineProgressConstant=h,this.configDependencies=Tc(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,n,o,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,a,u,h)}evaluate(e,n,o,a,u,h){return this._styleExpression.evaluate(e,n,o,a,u,h)}interpolationFactor(e,n,o){return this.interpolationType?ea.interpolationFactor(this.interpolationType,e,n,o):0}}function Zh(i,e,n,o,a){if((i=wa(i,e,n,o,a)).result==="error")return i;const u=i.value.expression,h=qc(u);if(!h&&!$h(e))return va([new za("","data expressions not supported")]);const p=Nu(u,["zoom","pitch","distance-from-center"]);if(!p&&!Hh(e))return va([new za("","zoom expressions not supported")]);const y=Nu(u,["measure-light"]);if(!y&&!Xu(e))return va([new za("","measure-light expression not supported")]);const x=Nu(u,["line-progress"]);if(!x&&!(function(A){return Gh(A.expression,"line-progress")})(e))return va([new za("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,E=No(u);return E||p||S?E instanceof za?va([E]):E instanceof ea&&!Wh(e)?va([new za("",'"interpolate" expressions cannot be used with this property')]):Hf(E?new ba(h&&x?"camera":"composite",i.value,E.labels,E instanceof ea?E.interpolation:void 0,y,x):new ss(h&&x?"constant":"source",i.value,y,x)):va([new za("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xh{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,Wf(this._parameters,this._specification))}static deserialize(e){return new Xh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function No(i){let e=null;if(i instanceof rs)e=No(i.result);else if(i instanceof Gu){for(const n of i.args)if(e=No(n),e)break}else(i instanceof Nh||i instanceof ea)&&i.input instanceof ys&&i.input.name==="zoom"&&(e=i);return e instanceof za||i.eachChild((n=>{const o=No(n);o instanceof za?e=o:e&&o&&e!==o&&(e=new za("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Rl,ef,qf=(function(){if(ef)return Rl;ef=1,Rl=e;var i=3;function e(n,o,a){var u=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(o=h[1])+2*(a=h[2]);for(var p=0;p<this.d*this.d;p++){var y=h[i+p],x=h[i+p+1];u.push(y===x?null:h.subarray(y,x))}var S=h[i+u.length+1];this.keys=h.subarray(h[i+u.length],S),this.bboxes=h.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*a;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=a,this.scale=o/n,this.uid=0;var A=a/o*n;this.min=-A,this.max=n+A}return e.prototype.insert=function(n,o,a,u,h){this._forEachCell(o,a,u,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,o,a,u,h,p){this.cells[h].push(p)},e.prototype.query=function(n,o,a,u,h){var p=this.min,y=this.max;if(n<=p&&o<=p&&y<=a&&y<=u&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,o,a,u,this._queryCell,x,{},h),x},e.prototype._queryCell=function(n,o,a,u,h,p,y,x){var S=this.cells[h];if(S!==null)for(var E=this.keys,A=this.bboxes,P=0;P<S.length;P++){var k=S[P];if(y[k]===void 0){var F=4*k;(x?x(A[F+0],A[F+1],A[F+2],A[F+3]):n<=A[F+2]&&o<=A[F+3]&&a>=A[F+0]&&u>=A[F+1])?(y[k]=!0,p.push(E[k])):y[k]=!1}}},e.prototype._forEachCell=function(n,o,a,u,h,p,y,x){for(var S=this._convertToCellCoord(n),E=this._convertToCellCoord(o),A=this._convertToCellCoord(a),P=this._convertToCellCoord(u),k=S;k<=A;k++)for(var F=E;F<=P;F++){var G=this.d*F+k;if((!x||x(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&h.call(this,n,o,a,u,G,p,y,x))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,o=i+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var h=new Int32Array(o+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=o,y=0;y<n.length;y++){var x=n[y];h[i+y]=p,h.set(x,p),p+=x.length}return h[i+n.length]=p,h.set(this.keys,p),h[i+n.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer},Rl})(),ia=Yr(qf);const ra={};function qt(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),ra[e]={klass:i,omit:n.omit||[]}}qt(Object,"Object"),ia.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.add(n),{buffer:n}},ia.deserialize=function(i){return new ia(i.buffer)},Object.defineProperty(ia,"name",{value:"Grid"}),qt(ia,"Grid"),delete ct.prototype.constructor,qt(Vi,"Color"),qt(Error,"Error"),qt(gs,"Formatted"),qt(Dd,"FormattedSection"),qt(Ks,"AJAXError"),qt(_s,"ResolvedImage"),qt(Xh,"StylePropertyFunction"),qt(Ku,"StyleExpression",{omit:["_evaluator"]}),qt(kr,"ImageId"),qt(ql,"ImageVariant"),qt(ba,"ZoomDependentExpression"),qt(ss,"ZoomConstantExpression"),qt(ys,"CompoundExpression",{omit:["_evaluate"]});for(const i in zr)ra[zr[i]._classRegistryKey]||qt(zr[i],`Expression${i}`);function Ju(i){return i&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ja(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ju(i)||i instanceof ImageBitmap)return e&&e.add(i),i;if(ArrayBuffer.isView(i))return e&&e.add(i.buffer),i;if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(ja(o,e));return n}if(i instanceof Map){const n={$name:"Map",entries:[]};for(const[o,a]of i.entries())n.entries.push(ja(o),ja(a,e));return n}if(i instanceof Set){const n={$name:"Set"};let o=0;for(const a of i.values())n[++o]=ja(a);return n}if(typeof i=="bigint")return{$name:"BigInt",value:i.toString()};if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const a=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const u in i)i.hasOwnProperty(u)&&(ra[o].omit.indexOf(u)>=0||(a[u]=ja(i[u],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof i)}function nc(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ju(i)||i instanceof ImageBitmap||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(nc);if(typeof i=="object"){const e=i.$name||"Object";if(e==="Map"){const a=i.entries||[],u=new Map;for(let h=0;h<a.length;h+=2)u.set(nc(a[h]),nc(a[h+1]));return u}if(e==="Set"){const a=new Set;for(const u of Object.keys(i))u!=="$name"&&a.add(nc(i[u]));return a}if(e==="BigInt")return BigInt(i.value);const{klass:n}=ra[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const a of Object.keys(i))a!=="$name"&&(o[a]=nc(i[a]));return o}throw new Error("can't deserialize object of type "+typeof i)}const yn={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,Osage:i=>i>=66736&&i<=66815,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function oa(i){for(const e of i)if(kl(e.charCodeAt(0)))return!0;return!1}function eu(i){for(const e of i)if(!Qu(e.charCodeAt(0)))return!1;return!0}function Qu(i){return!(yn.Arabic(i)||yn["Arabic Supplement"](i)||yn["Arabic Extended-A"](i)||yn["Arabic Presentation Forms-A"](i)||yn["Arabic Presentation Forms-B"](i))}function kl(i){return!(i!==746&&i!==747&&(i<4352||!(yn["Bopomofo Extended"](i)||yn.Bopomofo(i)||yn["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||yn["CJK Compatibility Ideographs"](i)||yn["CJK Compatibility"](i)||yn["CJK Radicals Supplement"](i)||yn["CJK Strokes"](i)||!(!yn["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||yn["CJK Unified Ideographs Extension A"](i)||yn["CJK Unified Ideographs"](i)||yn["Enclosed CJK Letters and Months"](i)||yn["Hangul Compatibility Jamo"](i)||yn["Hangul Jamo Extended-A"](i)||yn["Hangul Jamo Extended-B"](i)||yn["Hangul Jamo"](i)||yn["Hangul Syllables"](i)||yn.Hiragana(i)||yn["Ideographic Description Characters"](i)||yn.Kanbun(i)||yn["Kangxi Radicals"](i)||yn["Katakana Phonetic Extensions"](i)||yn.Katakana(i)&&i!==12540||!(!yn["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!yn["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||yn["Unified Canadian Aboriginal Syllabics"](i)||yn["Unified Canadian Aboriginal Syllabics Extended"](i)||yn["Vertical Forms"](i)||yn["Yijing Hexagram Symbols"](i)||yn["Yi Syllables"](i)||yn["Yi Radicals"](i))))}function eh(i){return!(kl(i)||(function(e){return!!(yn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||yn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||yn["Letterlike Symbols"](e)||yn["Number Forms"](e)||yn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||yn["Control Pictures"](e)&&e!==9251||yn["Optical Character Recognition"](e)||yn["Enclosed Alphanumerics"](e)||yn["Geometric Shapes"](e)||yn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||yn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||yn["CJK Symbols and Punctuation"](e)||yn.Katakana(e)||yn["Private Use Area"](e)||yn["CJK Compatibility Forms"](e)||yn["Small Form Variants"](e)||yn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(i))}function ic(i){return yn.Arabic(i)||yn["Arabic Supplement"](i)||yn["Arabic Extended-A"](i)||yn["Arabic Presentation Forms-A"](i)||yn["Arabic Presentation Forms-B"](i)}function tf(i){return i>=1424&&i<=2303||yn["Arabic Presentation Forms-A"](i)||yn["Arabic Presentation Forms-B"](i)}function il(i,e){return!(!e&&tf(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||yn.Khmer(i))}function po(i){for(const e of i)if(tf(e.charCodeAt(0)))return!0;return!1}const as={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Yh=null,Ko=as.unavailable,Va=null;const tu=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Ko=as.error),Yh&&Yh(i)};function zl(){Xr.fire(new fa("pluginStateChange",{pluginStatus:Ko,pluginURL:Va}))}const Xr=new fc,mo=function(){return Ko},jo=function(){if(Ko!==as.deferred||!Va)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko=as.loading,zl(),Va&&xl({url:Va},(i=>{i?tu(i):(Ko=as.loaded,zl())}))},Ua={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ko===as.loaded||Ua.applyArabicShaping!=null,isLoading:()=>Ko===as.loading,setState(i){Ko=i.pluginStatus,Va=i.pluginURL},isParsing:()=>Ko===as.parsing,isParsed:()=>Ko===as.parsed,getPluginURL:()=>Va};class Xi{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(n,o){for(const a of n)if(!il(a.charCodeAt(0),o))return!1;return!0})(e,Ua.isLoaded())}}class Sc{constructor(e,n,o,a,u){this.property=e,this.value=n,this.expression=(function(h,p,y,x,S){if(qh(h))return new Xh(h,p);if(Qc(h)||Array.isArray(h)&&h.length>0){const E=Zh(h,p,y,x,S);if(E.result==="error")throw new Error(E.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return E.value}{let E=h;return typeof h=="string"&&p.type==="color"&&(E=Vi.parse(h)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>E}}})(n===void 0?e.specification.default:n,e.specification,o,a,u)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o,a){return this.property.possiblyEvaluate(this,e,n,o,a)}}class Zf{constructor(e,n,o,a){this.property=e,this.value=new Sc(e,void 0,n,o,a)}transitioned(e,n){return new nf(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new nf(this.property,this.value,null,{},0)}}class ls{constructor(e,n,o,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=o,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return lt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Zf(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Sc(this._values[e].property,n===null?void 0:lt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const o=this._properties.properties;if(e)for(const a in e){const u=e[a];if(a.endsWith("-transition")){const h=a.slice(0,-11);o[h]&&this.setTransition(h,u)}else o.hasOwnProperty(a)&&this.setValue(a,u)}}getTransition(e){return lt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Zf(this._values[e].property)),this._values[e].transition=lt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const a=this.getTransition(n);a!==void 0&&(e[`${n}-transition`]=a)}return e}transitioned(e,n){const o=new rf(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,n._values[a]);return o}untransitioned(){const e=new rf(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class nf{constructor(e,n,o,a,u){const h=a.delay||0,p=a.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+h,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const a=e.now||0,u=this.value.possiblyEvaluate(e,n,o),h=this.prior;if(h){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return h.possiblyEvaluate(e,n,o);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,n,o),u,qa(p))}}return u}}class rf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const a=new Jo(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,n,o);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class of{constructor(e,n,o,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=o,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return lt(this._values[e].value)}setValue(e,n){this._values[e]=new Sc(this._values[e].property,n===null?void 0:lt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o,a){const u=new Jo(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(e,n,o,a);return u}isIndoorDependent(){return this._isIndoorDependent}}class vs{constructor(e,n,o,a){this.property=e,this.value=n,this.parameters=o,this.iconImageUseTheme=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,a){return this.property.evaluate(this.value,this.parameters,e,n,o,a,this.iconImageUseTheme)}}class Jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){const a=Th[this.specification.type];return a?a(e,n,o):e}}class Dt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,a,u){return e.expression.kind==="constant"||e.expression.kind==="camera"?new vs(this,{kind:"constant",value:e.expression.evaluate(n,null,{},o,a,void 0,u)},n):new vs(this,e.expression,n,u)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},e.parameters);const a=Th[this.specification.type];return a?new vs(this,{kind:"constant",value:a(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,a,u,h,p){return e.kind==="constant"?e.value:e.evaluate(n,o,a,u,h,void 0,p)}}class rc{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,a){return!!e.expression.evaluate(n,null,{},o,a)}interpolate(){return!1}}class Tr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Xi(0,{});for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const u=this.defaultPropertyValues[o]=new Sc(a,void 0),h=this.defaultTransitionablePropertyValues[o]=new Zf(a);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(n)}}}qt(Dt,"DataDrivenProperty"),qt(Tt,"DataConstantProperty"),qt(rc,"ColorRampProperty");var Le=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Xf(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Kh(i){if(Array.isArray(i))return i.map(Kh);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Kh(i[n]);return e}return Xf(i)}function rl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!rl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Jh(i,e="",n=null,o="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rl(i)||(i=ed(i));const a=i;let u=!0;try{u=(function(S){if(!Ll(S))return S;let E=Kh(S);return Yf(E),E=Ec(E),E})(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let h=null,p=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){p=Le[`filter_${o}`];const S=wa(u,p,e,n);if(S.result==="error")throw new Error(S.value.map((E=>`${E.key}: ${E.message}`)).join(", "));h=(E,A,P)=>S.value.evaluate(E,A,{},P)}let y=null,x=null;if(u!==a){const S=wa(a,p,e,n);if(S.result==="error")throw new Error(S.value.map((E=>`${E.key}: ${E.message}`)).join(", "));y=(E,A,P,k,F)=>S.value.evaluate(E,A,{},P,void 0,void 0,k,F),x=!qc(S.value.expression)}return{filter:h,dynamicFilter:y||void 0,needGeometry:Qh(u),needFeature:!!x}}function Ec(i){if(!Array.isArray(i))return i;const e=(function(n){if(Pp.has(n[0])){for(let o=1;o<n.length;o++)if(Ll(n[o]))return!0}return n})(i);return e===!0?e:e.map((n=>Ec(n)))}function Yf(i){let e=!1;const n=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||Ll(i[o]),n.push(i[o+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||Ll(i[1]);for(let o=2;o<i.length-1;o+=2)n.push(i[o+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||Ll(i[1]);for(let o=1;o<i.length-1;o+=2)n.push(i[o+1])}e&&(i.length=0,i.push("any",...n));for(let o=1;o<i.length;o++)Yf(i[o])}function Ll(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(Ll(i[n]))return!0;return!1}const Pp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function sf(i,e){return i<e?-1:i>e?1:0}function Qh(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Qh(i[e]))return!0;return!1}function ed(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?th(i[1],i[2],"=="):e==="!="?nh(th(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?th(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(ed))):e==="all"?["all"].concat(i.slice(1).map(ed)):e==="none"?["all"].concat(i.slice(1).map(ed).map(nh)):e==="in"?td(i[1],i.slice(2)):e==="!in"?nh(td(i[1],i.slice(2))):e==="has"?nd(i[1]):e!=="!has"||nh(nd(i[1]));var n}function th(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function td(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(sf)]]:["filter-in-small",i,["literal",e]]}}function nd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function nh(i){return["!",i]}const Ic="";function Ta(i,e){return e?`${i}${Ic}${e}`:i}let Kf;const Jf=()=>Kf||(Kf=new Tr({"icon-size":new Dt(Le.layout_symbol["icon-size"]),"icon-image":new Dt(Le.layout_symbol["icon-image"]),"icon-rotate":new Dt(Le.layout_symbol["icon-rotate"]),"icon-offset":new Dt(Le.layout_symbol["icon-offset"]),"text-size":new Dt(Le.layout_symbol["text-size"]),"text-rotate":new Dt(Le.layout_symbol["text-rotate"]),"text-offset":new Dt(Le.layout_symbol["text-offset"])}));class Qf{constructor(e,n,o,a,u,h){const p=wa(e,Le.appearance.condition);if(p.result==="success"&&(this.condition=p.value),this.name=n,o){this.properties=new Jo(Jf()),this.unevaluatedLayout=new of(Jf(),a,u,h);for(const y in o)this.unevaluatedLayout.setValue(y,o[y])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,n,o){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,o))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),n=this.hasProperty("icon-size"),o=this.hasProperty("icon-offset"),a=this.hasProperty("icon-rotate");return e||n||o||a}hasTextProperties(){const e=this.hasProperty("text-size"),n=this.hasProperty("text-offset"),o=this.hasProperty("text-rotate");return e||n||o}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Rp="-transition",ol=new Set(["fill","line","background","hillshade","raster"]);class xs extends fc{constructor(e,n,o,a,u,h){if(super(),this.id=e.id,this.fqid=Ta(this.id,o),this.type=e.type,this.scope=o,this.lut=a,this.options=u,this.iconImageUseTheme=h,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const p=wa(this.filter,Le[`filter_${e.type}`]);p.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new of(n.layout,this.scope,u,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new ls(n.paint,this.scope,u);for(const p in e.paint)this.setPaintProperty(p,e.paint[p]);for(const p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jo(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ol.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...o.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||o.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((n=>{this.appearances.push(new Qf(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Rp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const o=this._transitionablePaint,a=o._properties.properties;if(e.endsWith(Rp)){const E=e.slice(0,-11);return a[E]&&o.setTransition(E,n||void 0),!1}if(!a[e])return!1;const u=o._values[e],h=u.value.isDataDriven(),p=u.value;o.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...o.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||o.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const y=o._values[e].value,x=y.isDataDriven(),S=e.endsWith("pattern")||e==="line-dasharray";return x||h||S||this._handleOverridablePaintPropertyUpdate(e,p,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,o){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((n=>n.serialize()))),yt(e,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof vs&&$h(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!Bh(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Jh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,o){return{}}queryRadius(e){}queryIntersectsFeature(e,n,o,a,u,h,p,y,x){}}const kp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ih{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const zp=new ArrayBuffer(0);class cr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,n){return e._trim(),n&&e.arrayBuffer&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,e.arrayBuffer?n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement:(n.capacity=0,n.arrayBuffer=zp),n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ni(i,e=1){let n=0,o=0;return{members:i.map((a=>{const u=kp[a.type].BYTES_PER_ELEMENT,h=n=Lp(n,Math.max(e,u)),p=a.components||1;return o=Math.max(o,u),n+=u*p,{name:a.name,type:a.type,components:p,offset:h}})),size:Lp(n,Math.max(o,e)),alignment:e}}function Lp(i,e){return Math.ceil(i/e)*e}class Ac extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const a=2*e;return this.int16[a+0]=n,this.int16[a+1]=o,e}}Ac.prototype.bytesPerElement=4,qt(Ac,"StructArrayLayout2i4");class rh extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,o)}emplace(e,n,o,a){const u=3*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=a,e}}rh.prototype.bytesPerElement=6,qt(rh,"StructArrayLayout3i6");class ws extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,a)}emplace(e,n,o,a,u){const h=4*e;return this.int16[h+0]=n,this.int16[h+1]=o,this.int16[h+2]=a,this.int16[h+3]=u,e}}ws.prototype.bytesPerElement=8,qt(ws,"StructArrayLayout4i8");class sl extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}sl.prototype.bytesPerElement=4,qt(sl,"StructArrayLayout1f4");class oh extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,o)}emplace(e,n,o,a){const u=4*e,h=2*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.float32[h+1]=a,e}}oh.prototype.bytesPerElement=8,qt(oh,"StructArrayLayout2i1f8");class af extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,o)}emplace(e,n,o,a){const u=4*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=a,e}}af.prototype.bytesPerElement=8,qt(af,"StructArrayLayout3i8");class lf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,a,u)}emplace(e,n,o,a,u,h){const p=5*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=a,this.int16[p+3]=u,this.int16[p+4]=h,e}}lf.prototype.bytesPerElement=10,qt(lf,"StructArrayLayout5i10");class id extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,a,u,h,p)}emplace(e,n,o,a,u,h,p,y){const x=6*e,S=12*e,E=3*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[S+4]=a,this.uint8[S+5]=u,this.uint8[S+6]=h,this.uint8[S+7]=p,this.float32[E+2]=y,e}}id.prototype.bytesPerElement=12,qt(id,"StructArrayLayout2i4ub1f12");class Fs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,o)}emplace(e,n,o,a){const u=3*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=a,e}}Fs.prototype.bytesPerElement=12,qt(Fs,"StructArrayLayout3f12");class ko extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,a,u)}emplace(e,n,o,a,u,h){const p=6*e,y=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=a,this.uint16[p+3]=u,this.float32[y+2]=h,e}}ko.prototype.bytesPerElement=12,qt(ko,"StructArrayLayout4ui1f12");class oc extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,a)}emplace(e,n,o,a,u){const h=4*e;return this.uint16[h+0]=n,this.uint16[h+1]=o,this.uint16[h+2]=a,this.uint16[h+3]=u,e}}oc.prototype.bytesPerElement=8,qt(oc,"StructArrayLayout4ui8");class sh extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,a,u,h)}emplace(e,n,o,a,u,h,p){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=a,this.int16[y+3]=u,this.int16[y+4]=h,this.int16[y+5]=p,e}}sh.prototype.bytesPerElement=12,qt(sh,"StructArrayLayout6i12");class ep extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,a,u,h,p,y,x,S,E,A)}emplace(e,n,o,a,u,h,p,y,x,S,E,A,P){const k=12*e;return this.int16[k+0]=n,this.int16[k+1]=o,this.int16[k+2]=a,this.int16[k+3]=u,this.uint16[k+4]=h,this.uint16[k+5]=p,this.uint16[k+6]=y,this.uint16[k+7]=x,this.int16[k+8]=S,this.int16[k+9]=E,this.int16[k+10]=A,this.int16[k+11]=P,e}}ep.prototype.bytesPerElement=24,qt(ep,"StructArrayLayout4i4ui4i24");class cf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,a,u,h)}emplace(e,n,o,a,u,h,p){const y=10*e,x=5*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=a,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=p,e}}cf.prototype.bytesPerElement=20,qt(cf,"StructArrayLayout3i3f20");class sc extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,a)}emplace(e,n,o,a,u){const h=4*e;return this.float32[h+0]=n,this.float32[h+1]=o,this.float32[h+2]=a,this.float32[h+3]=u,e}}sc.prototype.bytesPerElement=16,qt(sc,"StructArrayLayout4f16");class rd extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}rd.prototype.bytesPerElement=4,qt(rd,"StructArrayLayout1ul4");class sa extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const a=2*e;return this.uint16[a+0]=n,this.uint16[a+1]=o,e}}sa.prototype.bytesPerElement=4,qt(sa,"StructArrayLayout2ui4");class od extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E,A,P){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,o,a,u,h,p,y,x,S,E,A,P)}emplace(e,n,o,a,u,h,p,y,x,S,E,A,P,k){const F=20*e,G=10*e;return this.int16[F+0]=n,this.int16[F+1]=o,this.int16[F+2]=a,this.int16[F+3]=u,this.int16[F+4]=h,this.float32[G+3]=p,this.float32[G+4]=y,this.float32[G+5]=x,this.float32[G+6]=S,this.int16[F+14]=E,this.uint32[G+8]=A,this.uint16[F+18]=P,this.uint16[F+19]=k,e}}od.prototype.bytesPerElement=40,qt(od,"StructArrayLayout5i4f1i1ul2ui40");class uf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,a,u,h,p)}emplace(e,n,o,a,u,h,p,y){const x=8*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+4]=u,this.int16[x+5]=h,this.int16[x+6]=p,this.int16[x+7]=y,e}}uf.prototype.bytesPerElement=16,qt(uf,"StructArrayLayout3i2i2i16");class cs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,a,u)}emplace(e,n,o,a,u,h){const p=4*e,y=8*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=a,this.int16[y+6]=u,this.int16[y+7]=h,e}}cs.prototype.bytesPerElement=16,qt(cs,"StructArrayLayout2f1f2i16");class us extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,a,u,h)}emplace(e,n,o,a,u,h,p){const y=20*e,x=5*e;return this.uint8[y+0]=n,this.uint8[y+1]=o,this.float32[x+1]=a,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=p,e}}us.prototype.bytesPerElement=20,qt(us,"StructArrayLayout2ub4f20");class Jr extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,o)}emplace(e,n,o,a){const u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=a,e}}Jr.prototype.bytesPerElement=6,qt(Jr,"StructArrayLayout3ui6");class nu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me){const de=this.length;return this.resize(de+1),this.emplace(de,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me)}emplace(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me,de){const ve=30*e,Te=15*e,Ie=60*e;return this.int16[ve+0]=n,this.int16[ve+1]=o,this.int16[ve+2]=a,this.float32[Te+2]=u,this.float32[Te+3]=h,this.uint16[ve+8]=p,this.uint16[ve+9]=y,this.uint32[Te+5]=x,this.uint32[Te+6]=S,this.uint32[Te+7]=E,this.uint16[ve+16]=A,this.uint16[ve+17]=P,this.uint16[ve+18]=k,this.float32[Te+10]=F,this.float32[Te+11]=G,this.uint8[Ie+48]=U,this.uint8[Ie+49]=Y,this.uint8[Ie+50]=Q,this.uint32[Te+13]=ne,this.int16[ve+28]=me,this.uint8[Ie+58]=de,e}}nu.prototype.bytesPerElement=60,qt(nu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class hf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me,de,ve,Te,Ie,qe,ke,Qe,ut,ht,gt,vt,ft){const pt=this.length;return this.resize(pt+1),this.emplace(pt,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me,de,ve,Te,Ie,qe,ke,Qe,ut,ht,gt,vt,ft)}emplace(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me,de,ve,Te,Ie,qe,ke,Qe,ut,ht,gt,vt,ft,pt){const Je=20*e,Ye=40*e,mt=80*e;return this.float32[Je+0]=n,this.float32[Je+1]=o,this.int16[Ye+4]=a,this.int16[Ye+5]=u,this.int16[Ye+6]=h,this.int16[Ye+7]=p,this.int16[Ye+8]=y,this.int16[Ye+9]=x,this.int16[Ye+10]=S,this.int16[Ye+11]=E,this.int16[Ye+12]=A,this.uint16[Ye+13]=P,this.uint16[Ye+14]=k,this.uint16[Ye+15]=F,this.uint16[Ye+16]=G,this.uint16[Ye+17]=U,this.uint16[Ye+18]=Y,this.uint16[Ye+19]=Q,this.uint16[Ye+20]=ne,this.uint16[Ye+21]=me,this.uint16[Ye+22]=de,this.uint16[Ye+23]=ve,this.uint16[Ye+24]=Te,this.uint16[Ye+25]=Ie,this.uint16[Ye+26]=qe,this.uint16[Ye+27]=ke,this.uint32[Je+14]=Qe,this.float32[Je+15]=ut,this.float32[Je+16]=ht,this.float32[Je+17]=gt,this.float32[Je+18]=vt,this.uint8[mt+76]=ft,this.uint16[Ye+39]=pt,e}}hf.prototype.bytesPerElement=80,qt(hf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class df extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,a,u,h)}emplace(e,n,o,a,u,h,p){const y=6*e;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=a,this.float32[y+3]=u,this.float32[y+4]=h,this.float32[y+5]=p,e}}df.prototype.bytesPerElement=24,qt(df,"StructArrayLayout6f24");class Cc extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,a,u)}emplace(e,n,o,a,u,h){const p=5*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=a,this.float32[p+3]=u,this.float32[p+4]=h,e}}Cc.prototype.bytesPerElement=20,qt(Cc,"StructArrayLayout5f20");class sd extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,a,u,h,p)}emplace(e,n,o,a,u,h,p,y){const x=7*e;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=u,this.float32[x+4]=h,this.float32[x+5]=p,this.float32[x+6]=y,e}}sd.prototype.bytesPerElement=28,qt(sd,"StructArrayLayout7f28");class ff extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,o,a,u,h,p,y,x,S,E)}emplace(e,n,o,a,u,h,p,y,x,S,E,A){const P=11*e;return this.float32[P+0]=n,this.float32[P+1]=o,this.float32[P+2]=a,this.float32[P+3]=u,this.float32[P+4]=h,this.float32[P+5]=p,this.float32[P+6]=y,this.float32[P+7]=x,this.float32[P+8]=S,this.float32[P+9]=E,this.float32[P+10]=A,e}}ff.prototype.bytesPerElement=44,qt(ff,"StructArrayLayout11f44");class Mc extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,o,a,u,h,p,y,x)}emplace(e,n,o,a,u,h,p,y,x,S){const E=9*e;return this.float32[E+0]=n,this.float32[E+1]=o,this.float32[E+2]=a,this.float32[E+3]=u,this.float32[E+4]=h,this.float32[E+5]=p,this.float32[E+6]=y,this.float32[E+7]=x,this.float32[E+8]=S,e}}Mc.prototype.bytesPerElement=36,qt(Mc,"StructArrayLayout9f36");class al extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const a=2*e;return this.float32[a+0]=n,this.float32[a+1]=o,e}}al.prototype.bytesPerElement=8,qt(al,"StructArrayLayout2f8");class bs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,a)}emplace(e,n,o,a,u){const h=6*e;return this.uint32[3*e+0]=n,this.uint16[h+2]=o,this.uint16[h+3]=a,this.uint16[h+4]=u,e}}bs.prototype.bytesPerElement=12,qt(bs,"StructArrayLayout1ul3ui12");class Dl extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Dl.prototype.bytesPerElement=2,qt(Dl,"StructArrayLayout1ui2");class ad extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G)}emplace(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U){const Y=16*e;return this.float32[Y+0]=n,this.float32[Y+1]=o,this.float32[Y+2]=a,this.float32[Y+3]=u,this.float32[Y+4]=h,this.float32[Y+5]=p,this.float32[Y+6]=y,this.float32[Y+7]=x,this.float32[Y+8]=S,this.float32[Y+9]=E,this.float32[Y+10]=A,this.float32[Y+11]=P,this.float32[Y+12]=k,this.float32[Y+13]=F,this.float32[Y+14]=G,this.float32[Y+15]=U,e}}ad.prototype.bytesPerElement=64,qt(ad,"StructArrayLayout16f64");class ld extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,a,u,h,p)}emplace(e,n,o,a,u,h,p,y){const x=10*e,S=5*e;return this.uint16[x+0]=n,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=u,this.float32[S+2]=h,this.float32[S+3]=p,this.float32[S+4]=y,e}}ld.prototype.bytesPerElement=20,qt(ld,"StructArrayLayout4ui3f20");class cd extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}cd.prototype.bytesPerElement=2,qt(cd,"StructArrayLayout1i2");class iu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}iu.prototype.bytesPerElement=1,qt(iu,"StructArrayLayout1ub1");class pf extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pf.prototype.size=40;class tp extends od{get(e){return new pf(this,e)}}qt(tp,"CollisionBoxArray");class ah extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ah.prototype.size=60;class np extends nu{get(e){return new ah(this,e)}}qt(np,"PlacedSymbolArray");class ud extends ih{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ud.prototype.size=80;class ll extends hf{get(e){return new ud(this,e)}}qt(ll,"SymbolInstanceArray");class mf extends sl{getoffsetX(e){return this.float32[1*e+0]}}qt(mf,"GlyphOffsetArray");class ip extends Ac{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qt(ip,"SymbolLineVertexArray");class hd extends ih{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hd.prototype.size=12;class gf extends bs{get(e){return new hd(this,e)}}qt(gf,"FeatureIndexArray");class rp extends sa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qt(rp,"FillExtrusionCentroidArray");class Pc extends ih{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Pc.prototype.size=6;class zo extends rh{get(e){return new Pc(this,e)}}qt(zo,"FillExtrusionWallArray");const Dp=ni([{name:"a_pos",components:2,type:"Int16"}],4),wm=ni([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),dd=ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ki{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,a){let u=this.segments[this.segments.length-1];return e>ki.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>ki.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(e,n,o,a){return this._prepareSegment(e,n.length,o.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,a){return new ki([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function _f(i,e){return 256*(i=H(Math.floor(i),0,255))+H(Math.floor(e),0,255)}ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(ki,"SegmentVector");const Zn=ni([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lh=ni([{name:"a_pattern_b",components:4,type:"Uint16"}]),op=ni([{name:"a_dash",components:4,type:"Uint16"}]);class ch{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,a){this.ids.push(sp(e)),this.positions.push(n,o,a)}eachPosition(e,n){const o=sp(e);let a=0,u=this.ids.length-1;for(;a<u;){const h=a+u>>1;this.ids[h]>=o?u=h:a=h+1}for(;this.ids[a]===o;)n(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,n){const o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return ru(o,a,0,o.length-1),n&&(n.add(o.buffer),n.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){const n=new ch;let o;n.ids=e.ids,n.positions=e.positions;for(const a of n.ids)a!==o&&n.uniqueIds.push(a),o=a;return n.indexed=!0,n}}function sp(i){const e=+i;return Number.isSafeInteger(e)?e:Iu(String(i))}function ru(i,e,n,o){for(;n<o;){const a=i[n+o>>1];let u=n-1,h=o+1;for(;;){do u++;while(i[u]<a);do h--;while(i[h]>a);if(u>=h)break;ou(i,u,h),ou(e,3*u,3*h),ou(e,3*u+1,3*h+1),ou(e,3*u+2,3*h+2)}h-n<o-h?(ru(i,e,n,h),n=h+1):(ru(i,e,h+1,o),o=h)}}function ou(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}qt(ch,"FeaturePositionMap");class cl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class fd extends cl{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Qr extends cl{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class ul extends cl{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class su extends cl{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class uh extends cl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Ao extends cl{constructor(e){super(e),this.current=Vi.transparent.toPremultipliedRenderColor(null)}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const hl=new Float32Array(16);class Ga extends cl{constructor(e){super(e),this.current=hl}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const pd=new Float32Array(9),Op=new Float32Array(4);class aa extends cl{constructor(e){super(e),this.current=Op}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function yf(i){return[_f(255*i.r,255*i.g),_f(255*i.b,255*i.a)]}function la(i,e,n,o,a,u,h,p){return!!i&&(i.kind==="composite"||i.kind==="source"?i.evaluate(new Xi(0,{brightness:u,worldview:p}),e,n,a,o,h)==="none":i.value==="none")}class md{constructor(e,n,o,a){this.value=e,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o,this.context=a}setUniform(e,n,o,a,u){const h=a.constantOr(this.value);n.set(e,u,h instanceof Vi?h.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):h)}getBinding(e,n){return this.type==="color"?new Ao(e):new Qr(e)}}class au{constructor(e,n){this.uniformNames=n.map((o=>`u_${o}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,o,a,u){let h=null;u!=="u_pattern"&&u!=="u_dash"||(h=this.pattern),u==="u_pattern_b"&&(h=this.patternTransition),u==="u_pixel_ratio"&&(h=this.pixelRatio),h&&n.set(e,u,h)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new uh(e):new Qr(e)}}class Ol{constructor(e,n,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,n,o,a,u,h,p,y){const x=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Xi(0,{brightness:h,worldview:y}),n,{},u,a,p):this.expression.kind==="constant"&&this.expression.value,E=la(this.lutExpression,n,{},a,u,h,p,y);this.paintVertexArray.resize(e),this._setPaintValue(x,e,S,E?null:this.context.lut)}updatePaintArray(e,n,o,a,u,h,p,y){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:p,worldview:y},o,a,void 0,u):this.expression.kind==="constant"&&this.expression.value,S=la(this.lutExpression,o,a,u,void 0,p,void 0,y);this._setPaintValue(e,n,x,S?null:this.context.lut)}_setPaintValue(e,n,o,a){if(this.type==="color"){const u=yf(o.toPremultipliedRenderColor(a));for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(e,n,o,a,u,h){this.expression=e,this.uniformNames=n.map((p=>`u_${p}_t`)),this.type=o,this.useIntegerZoom=a,this.context=u,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,n,o,a,u,h,p,y){const x=this.expression.evaluate(new Xi(this.context.zoom,{brightness:h,worldview:y}),n,{},u,a,p),S=this.expression.evaluate(new Xi(this.context.zoom+1,{brightness:h,worldview:y}),n,{},u,a,p),E=la(this.lutExpression,n,{},a,u,h,p,y),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,x,S,E?null:this.context.lut)}updatePaintArray(e,n,o,a,u,h,p,y){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:p,worldview:y},o,a,void 0,u),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:p,worldview:y},o,a,void 0,u),E=la(this.lutExpression,o,a,u,void 0,p,void 0,y);this._setPaintValue(e,n,x,S,E?null:this.context.lut)}_setPaintValue(e,n,o,a,u){if(this.type==="color"){const h=yf(o.toPremultipliedRenderColor(u)),p=yf(o.toPremultipliedRenderColor(u));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,a,u){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=H(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);n.set(e,u,p)}getBinding(e,n){return new Qr(e)}}class Bl{constructor(e,n,o,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?op:Zn).members;for(let h=0;h<n.length;++h);this.paintVertexArray=new a,this.paintTransitionVertexArray=new oc}populatePaintArray(e,n,o,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,a,u,h,p){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,n,o,a){if(!a||!o)return;const u=a[o[0]],h=a[o[1]];if(u){if(u){const{tl:p,br:y,pixelRatio:x}=u;for(let S=e;S<n;S++)this.paintVertexArray.emplace(S,p[0],p[1],y[0],y[1],x)}if(h){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:p,br:y}=h;for(let x=e;x<n;x++)this.paintTransitionVertexArray.emplace(x,p[0],p[1],y[0],y[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,lh.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Rc{constructor(e,n,o=(()=>!0)){this.binders={},this._buffers=[],this.context=n;const a=[];for(const u in e.paint._values){const h=e.paint.get(u);if(u.endsWith("-use-theme")||!o(u)||!(h instanceof vs&&$h(h.property.specification)))continue;const p=$a(u,e.type),y=h.value,x=h.property.specification.type,S=!!h.property.useIntegerZoom,E=u==="line-dasharray"||u.endsWith("pattern"),A=e.paint.get(`${u}-use-theme`),P=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||A&&A.value.kind!=="constant";if(y.kind!=="constant"||P)if(y.kind==="source"||P||E){const k=wo(u,x,"source");this.binders[u]=E?new Bl(y,p,x,k,e.id):new Ol(y,p,x,k),a.push(`/a_${u}`)}else{const k=wo(u,x,"composite");this.binders[u]=new Fl(y,p,x,S,n,k),a.push(`/z_${u}`)}else this.binders[u]=E?new au(y.value,p):new md(y.value,p,x,n),a.push(`/u_${u}`);A&&(this.binders[u].lutExpression=A.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Ol||n instanceof Fl?n.maxValue:0}populatePaintArrays(e,n,o,a,u,h,p,y){for(const x in this.binders){const S=this.binders[x];S.context=this.context,(S instanceof Ol||S instanceof Fl||S instanceof Bl)&&S.populatePaintArray(e,n,o,a,u,h,p,y)}}setConstantPatternPositions(e,n){for(const o in this.binders){const a=this.binders[o];a instanceof au&&a.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof Bl?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,o,a,u,h,p,y,x,S){let E=!1;const A=Object.keys(e),P=A.length!==0&&!y,k=P?A:n.uniqueIds;this.context.lut=u.lut;for(const F in this.binders){const G=this.binders[F];if(G.context=this.context,(G instanceof Ol||G instanceof Fl||G instanceof Bl)&&G.expression&&G.expression.kind&&G.expression.kind!=="constant"&&(G.expression.isStateDependent===!0||G.expression.isLightConstant===!1)){const U=u.paint.get(F);G.expression=U.value;for(const Y of k){const Q=e[Y.toString()];n.eachPosition(Y,((ne,me,de)=>{const ve=a.feature(ne);G.updatePaintArray(me,de,ve,Q,h,p,x,S)}))}if(!P)for(const Y of o.uniqueIds){const Q=e[Y.toString()];o.eachPosition(Y,((ne,me,de)=>{const ve=a.feature(ne);G.updatePaintArray(me,de,ve,Q,h,p,x,S)}))}E=!0}}return E}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof md||o instanceof au)&&e.push(...o.uniformNames.map((a=>`#define HAS_UNIFORM_${a}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof md||a instanceof au||a instanceof Fl)for(const u of a.uniformNames)n.push({name:u,property:o,binding:a.getBinding(e,u)})}return n}setUniforms(e,n,o,a,u){for(const{name:h,property:p,binding:y}of o)this.binders[p].setUniform(e,y,u,a.get(p),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ol||n instanceof Fl||n instanceof Bl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof Bl&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof Ol||o instanceof Fl||o instanceof Bl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Ol||n instanceof Fl||n instanceof Bl)&&n.destroy()}}}class ca{constructor(e,n,o=(()=>!0)){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Rc(a,n,o);this.needsUpload=!1,this._featureMap=new ch,this._featureMapWithoutIds=new ch,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,a,u,h,p,y,x){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,n,a,u,h,p,y,x);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,a,u,h,p,y){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,x,a,u,h,p||0,y)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ap={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function $a(i,e){return ap[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Sr={"line-pattern":{source:ko,composite:ko},"fill-pattern":{source:ko,composite:ko},"fill-extrusion-pattern":{source:ko,composite:ko},"line-dasharray":{source:oc,composite:oc}},Qo={color:{source:al,composite:sc},number:{source:sl,composite:al}};function wo(i,e,n){const o=Sr[i];return o&&o[n]||Qo[e][n]}qt(md,"ConstantBinder"),qt(au,"PatternConstantBinder"),qt(Ol,"SourceExpressionBinder"),qt(Bl,"PatternCompositeBinder"),qt(Fl,"CompositeExpressionBinder"),qt(Rc,"ProgramConfiguration",{omit:["_buffers"]}),qt(ca,"ProgramConfigurationSet");const gr=Pt/Math.PI/2,so=5,ac=6,Vo=16383,Nl=64,lc=[Nl,32,16],Bs=-gr,ua=gr;function dl(i,e,n,o=gr){return n=ti(n),[i*Math.sin(n)*o,-e*o,i*Math.cos(n)*o]}function Uo(i,e,n){return dl(Math.cos(ti(i)),Math.sin(ti(i)),e,n)}const l=63710088e-1,t=2*Math.PI*l;class r{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new r(se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,a=e.lat*n,u=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*n);return l*Math.acos(Math.min(u,1))}toBounds(e=0){const n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new c({lng:this.lng-o,lat:this.lat-n},{lng:this.lng+o,lat:this.lat+n})}toEcef(e){return Uo(this.lat,this.lng,gr+e*gr/l)}static convert(e){if(e instanceof r)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new r(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new r(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class c{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof r?new r(e.lng,e.lat):r.convert(e),this}setSouthWest(e){return this._sw=e instanceof r?new r(e.lng,e.lat):r.convert(e),this}extend(e){const n=this._sw,o=this._ne;let a,u;if(e instanceof r)a=e,u=e;else{if(!(e instanceof c))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(c.convert(e)):this.extend(r.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(r.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return n||o?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new r(a.lng,a.lat),this._ne=new r(u.lng,u.lat)),this}getCenter(){return new r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new r(this.getWest(),this.getNorth())}getSouthEast(){return new r(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:o}=r.convert(e);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){if(e)return e instanceof c?e:new c(e)}}const f=0,g=25.5;function _(i){return t*Math.cos(i*Math.PI/180)}function v(i){return(180+i)/360}function b(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function I(i,e){return i/_(e)}function C(i){return 360*i-180}function O(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function L(i,e){return i*_(O(e))}const D=85.051129;function V(i){return Math.cos(ti(H(i,-D,D)))}function j(i,e){const n=H(e,f,g),o=Math.pow(2,n);return V(i)*t/(512*o)}function Z(i){return 1/Math.cos(i*Math.PI/180)}function q(i,e=0){const n=Math.exp(Math.PI*(1-(i.y+e/Pt)/(1<<i.z)*2));return 80150034*n/(n*n+1)/Pt/(1<<i.z)}class ee{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=r.convert(e);return new ee(v(o.lng),b(o.lat),I(n,o.lat))}toLngLat(){return new r(C(this.x),O(this.y))}toAltitude(){return L(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*Z(O(this.y))}}function ie(i,e,n,o,a,u,h,p,y){const x=(e+o)/2,S=(n+a)/2,E=new ct(x,S);p(E),(function(A,P,k,F,G,U){const Y=k-G,Q=F-U;return Math.abs((F-P)*Y-(k-A)*Q)/Math.hypot(Y,Q)})(E.x,E.y,u.x,u.y,h.x,h.y)>=y?(ie(i,e,n,x,S,u,E,p,y),ie(i,x,S,o,a,E,h,p,y)):i.push(h)}function te(i,e,n){let o=i[0],a=o.x,u=o.y;e(o);const h=[o];for(let p=1;p<i.length;p++){const y=i[p],{x,y:S}=y;e(y),ie(h,a,u,x,S,o,y,e,n),a=x,u=S,o=y}return h}function ye(i,e,n,o){if(o(e,n)){const a=e.add(n)._mult(.5);ye(i,e,a,o),ye(i,a,n,o)}else i.push(n)}function pe(i,e){let n=i[0];const o=[n];for(let a=1;a<i.length;a++){const u=i[a];ye(o,n,u,e),n=u}return o}const ge=Math.pow(2,14)-1,ue=-ge-1;function le(i,e){const n=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=H(n,ue,ge),i.y=H(o,ue,ge),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function xe(i,e,n){const o=i.loadGeometry(),a=i.extent,u=Pt/a;if(e&&n&&n.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:p,x:y,y:x,projection:S}=n,E=A=>{const P=C((e.x+A.x/a)/h),k=O((e.y+A.y/a)/h),F=S.project(P,k);A.x=(F.x*p-y)*a,A.y=(F.y*p-x)*a};for(let A=0;A<o.length;A++)if(i.type!==1)o[A]=te(o[A],E,1);else{const P=[];for(const k of o[A])k.x<0||k.x>=a||k.y<0||k.y>=a||(E(k),P.push(k));o[A]=P}}for(const h of o)for(const p of h)le(p,u);return o}function Re(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?xe(i):[]}}class Ae{constructor(e,n,o,a,u){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields($e,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,o=[];let a,u=1,h=0,p=0,y=0;for(;e.pos<n;){if(h<=0){const x=e.readVarint();u=7&x,h=x>>3}if(h--,u===1||u===2)p+=e.readSVarint(),y+=e.readSVarint(),u===1&&(a&&o.push(a),a=[]),a&&a.push(new ct(p,y));else{if(u!==7)throw new Error(`unknown command ${u}`);a&&a.push(a[0].clone())}}return a&&o.push(a),o}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let o=1,a=0,u=0,h=0,p=1/0,y=-1/0,x=1/0,S=-1/0;for(;e.pos<n;){if(a<=0){const E=e.readVarint();o=7&E,a=E>>3}if(a--,o===1||o===2)u+=e.readSVarint(),h+=e.readSVarint(),u<p&&(p=u),u>y&&(y=u),h<x&&(x=h),h>S&&(S=h);else if(o!==7)throw new Error(`unknown command ${o}`)}return[p,x,y,S]}toGeoJSON(e,n,o){const a=this.extent*Math.pow(2,o),u=this.extent*e,h=this.extent*n,p=this.loadGeometry();function y(A){return[360*(A.x+u)/a-180,360/Math.PI*Math.atan(Math.exp((1-2*(A.y+h)/a)*Math.PI))-90]}function x(A){return A.map(y)}let S;if(this.type===1){const A=[];for(const k of p)A.push(k[0]);const P=x(A);S=A.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const A=p.map(x);S=A.length===1?{type:"LineString",coordinates:A[0]}:{type:"MultiLineString",coordinates:A}}else{if(this.type!==3)throw new Error("unknown feature type");{const A=(function(k){const F=k.length;if(F<=1)return[k];const G=[];let U,Y;for(let Q=0;Q<F;Q++){const ne=He(k[Q]);ne!==0&&(Y===void 0&&(Y=ne<0),Y===ne<0?(U&&G.push(U),U=[k[Q]]):U&&U.push(k[Q]))}return U&&G.push(U),G})(p),P=[];for(const k of A)P.push(k.map(x));S=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const E={type:"Feature",geometry:S,properties:this.properties};return this.id!=null&&(E.id=this.id),E}}function $e(i,e,n){i===1?e.id=n.readVarint():i===2?(function(o,a){const u=o.readVarint()+o.pos;for(;o.pos<u;){const h=a._keys[o.readVarint()],p=a._values[o.readVarint()];a.properties[h]=p}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function He(i){let e=0;for(let n,o,a=0,u=i.length,h=u-1;a<u;h=a++)n=i[a],o=i[h],e+=(o.x-n.x)*(n.y+o.y);return e}Ae.types=["Unknown","Point","LineString","Polygon"];class it{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(xt,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Ae(this._pbf,n,this.extent,this._keys,this._values)}}function xt(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(o){let a=null;const u=o.readVarint()+o.pos;for(;o.pos<u;){const h=o.readVarint()>>3;a=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}if(a==null)throw new Error("unknown feature value");return a})(n))}class Ne{constructor(e,n){this.layers=e.readFields(Ee,{},n)}}function Ee(i,e,n){if(i===3){const o=new it(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}const We="3d_elevation_id",Ue="level";class dt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,o){return this.get(e,!0,n,o)}optional(e,n,o){return this.get(e,!1,n,o)}success(){return this._valid}get(e,n,o,a){const u=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&u!==void 0&&!Number.isNaN(u)?o(a?a(u):u):n&&(this._valid=!1),this}}class Rt{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,o){return this.featureFunc(e,n,o)}parseVertex(e,n,o){return this.vertexFunc(e,n,o)}}const Lt=new Rt(((i,e,n)=>i.reset(e).require(We,(o=>{n.id=o})).optional("fixed_height_relative",(o=>{n.constantHeight=o}),wt.decodeRelativeHeight).geometry((o=>{n.bounds=o}),ma).success()),((i,e,n)=>i.reset(e).require(We,(o=>{n.id=o})).require("elevation_idx",(o=>{n.idx=o})).require("extent",(o=>{n.extent=o})).require("height_relative",(o=>{n.height=o}),wt.decodeRelativeHeight).geometry((o=>{n.position=o}),wt.getPoint).success())),At=new Rt(((i,e,n)=>i.reset(e).require(We,(o=>{n.id=o})).optional("fixed_height",(o=>{n.constantHeight=o}),wt.decodeMetricHeight).geometry((o=>{n.bounds=o}),ma).success()),((i,e,n)=>i.reset(e).require(We,(o=>{n.id=o})).require("elevation_idx",(o=>{n.idx=o})).require("extent",(o=>{n.extent=o})).require("height",(o=>{n.height=o}),wt.decodeMetricHeight).geometry((o=>{n.position=o}),wt.getPoint).success()));class wt{static getPoint(e){return Zo(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?At:void 0:Lt}static parse(e){const n=[],o=[],a=e.length,u=new dt;for(let h=0;h<a;h++){const p=e.feature(h),y=p.properties.version,x=wt.getVersionSchema(y);if(x===void 0){$t(`Unknown elevation feature version number ${y||"(unknown)"}`);continue}const S=p.properties.type;if(!S)continue;const E=Ae.types[p.type];if(E==="Point"&&S==="curve_point"){const A={};x.parseVertex(u,p,A)&&n.push(A)}else if(E==="Polygon"&&S==="curve_meta"){const A={};x.parseFeature(u,p,A)&&o.push(A)}}return{vertices:n,features:o}}}class tn{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){const a=Ps(n,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/a;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,!0}}class Yt{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){const a=kn(n,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/a;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,o){if((function(P,k){var F=P[0],G=P[1],U=P[2],Y=k[0],Q=k[1],ne=k[2];return Math.abs(F-Y)<=he*Math.max(1,Math.abs(F),Math.abs(Y))&&Math.abs(G-Q)<=he*Math.max(1,Math.abs(G),Math.abs(Q))&&Math.abs(U-ne)<=he*Math.max(1,Math.abs(U),Math.abs(ne))})(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;const[a,u,h]=this.dir,p=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],S=a*a+u*u+h*h,E=2*(p*a+y*u+x*h),A=E*E-4*S*(p*p+y*y+x*x-n*n);if(A<0){const P=Math.max(-E/2,0),k=p+a*P,F=y+u*P,G=x+h*P,U=Math.hypot(k,F,G);return o[0]=k*n/U,o[1]=F*n/U,o[2]=G*n/U,!1}{const P=(-E-Math.sqrt(A))/(2*S);if(P<0){const k=Math.hypot(p,y,x);return o[0]=p*n/k,o[1]=y*n/k,o[2]=x*n/k,!1}return o[0]=p+a*P,o[1]=y+u*P,o[2]=x+h*P,!0}}}class Bt{constructor(e,n,o,a,u){this.TL=e,this.TR=n,this.BR=o,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,n,o){const a=[-1,1,1],u=[1,1,1],h=[1,-1,1],p=[-1,-1,1],y=Gi(a,a,e),x=Gi(u,u,e),S=Gi(h,h,e),E=Gi(p,p,e);return new Bt(y,x,S,E,n/o)}}function Ht(i,e,n){let o=1/0,a=-1/0;const u=[];for(const h of i){Cr(u,h,e);const p=kn(u,n);o=Math.min(o,p),a=Math.max(a,p)}return[o,a]}function _n(i,e){let n=!0;for(let o=0;o<i.planes.length;o++){const a=i.planes[o];let u=0;for(let h=0;h<e.length;h++)u+=+(kn(a,e[h])+a[3]>=0);if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function An(i,e){for(const n of i.projections){const o=Ht(e,i.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function si(i,e){let n=0;const o=[0,0,0,0];for(let h=0;h<i.length;h++)o[0]=i[h][0],o[1]=i[h][1],o[2]=i[h][2],o[3]=1,(a=o)[0]*(u=e)[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]>=0&&n++;var a,u;return n}class Ri{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Kt.fromPoints(this.points),this.projections=[],this.frustumEdges=[Cr([],this.points[2],this.points[3]),Cr([],this.points[0],this.points[3]),Cr([],this.points[4],this.points[0]),Cr([],this.points[5],this.points[1]),Cr([],this.points[6],this.points[2]),Cr([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const a=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Ht(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:Ht(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,o,a){const u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((x=>{const S=So([],x,e),E=1/S[3]/n*u;return(A=S)[0]=(P=S)[0]*(k=[E,E,a?1/S[3]:E,E])[0],A[1]=P[1]*k[1],A[2]=P[2]*k[2],A[3]=P[3]*k[3],A;var A,P,k})),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((x=>{const S=xn([],_i([],Cr([],h[x[0]],h[x[1]]),Cr([],h[x[2]],h[x[1]]))),E=-kn(S,h[x[1]]);return S.concat(E)})),y=[];for(let x=0;x<h.length;x++)y.push([h[x][0],h[x][1],h[x][2]]);return new Ri(y,p)}intersectsPrecise(e,n,o){for(let a=0;a<n.length;a++)if(!si(e,n[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!si(e,this.planes[a]))return 0;for(const a of o)for(const u of this.frustumEdges){const h=_i([],a,u),p=Hn(h);if(p===0)continue;Gt(h,h,1/p);const y=Ht(this.points,this.points[0],h),x=Ht(e,this.points[0],h);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const o=n[3];if(kn([n[0],n[1],n[2]],e)+o<0)return!1}return!0}}class Kt{static fromPoints(e){const n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const a of e)rt(n,n,a),Ut(o,o,a);return new Kt(n,o)}static fromTileIdAndHeight(e,n,o){const a=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new Kt([u/a,h/a,n],[(u+1)/a,(h+1)/a,o])}static applyTransform(e,n){const o=e.getCorners();for(let a=0;a<o.length;++a)Gi(o[a],o[a],n);return Kt.fromPoints(o)}static applyTransformFast(e,n){const o=[n[12],n[13],n[14]],a=[...o];for(let u=0;u<3;u++)for(let h=0;h<3;h++){const p=n[4*h+u],y=p*e.min[h],x=p*e.max[h];o[u]+=Math.min(y,x),a[u]+=Math.max(y,x)}return new Kt(o,a)}static projectAabbCorners(e,n){const o=e.getCorners();for(let a=0;a<o.length;++a)Gi(o[a],o[a],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=Gt([],nt([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],o=mi(this.min),a=mi(this.max);for(let u=0;u<n.length;u++)o[u]=n[u]?this.min[u]:this.center[u],a[u]=n[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Kt(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?_n(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?_n(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?An(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?An(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}qt(Kt,"Aabb");class wi{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,o=n[1],a=-n[0],u=(e.extent+1)*this.metersToTile;return[new ct(Math.trunc(e.position[0]+o*u),Math.trunc(e.position[1]+a*u)),new ct(Math.trunc(e.position[0]-o*u),Math.trunc(e.position[1]-a*u))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mn{constructor(e,n,o,a,u,h){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[no(),no(),no(),no(),no(),no(),no()],this.id=e,this.heightRange={min:o,max:o},this.safeArea=n,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=u,this.edges=this.edges.filter((p=>{return p.a<this.vertices.length&&p.b<this.vertices.length&&!((y=this.vertices[p.a].position)[0]===(x=this.vertices[p.b].position)[0]&&y[1]===x[1]);var y,x})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const p of this.vertices)this.vertexProps.push({dir:Zo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,p.height),this.heightRange.max=Math.max(this.heightRange.max,p.height);for(const p of this.edges){const y=this.vertices[p.a].position,x=this.vertices[p.b].position,S=fs(no(),x,y),E=Ms(S),A=Ro(no(),S,1/E);this.edgeProps.push({vec:S,dir:A,len:E});const P=this.vertexProps[p.a].dir,k=this.vertexProps[p.b].dir;Ra(P,P,A),Ra(k,k,A)}for(const p of this.vertexProps)p.dir[0]===0&&p.dir[1]===0||ka(p.dir,p.dir);this.tessellate(h)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[o,a]=n;return bn(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,a)}computeSlopeNormal(e,n){const o=this.getClosestEdge(e);if(!o)return Wt(0,0,1);const a=o[0],u=this.edges[a],h=this.edgeProps[a].vec,p=Wt(h[0],h[1],(this.vertices[u.b].height-this.vertices[u.a].height)*n),y=Wt(p[1],-p[0],0);_i(y,y,p);const x=Hn(y);return x>0?Gt(y,y,1/x):Jt(y,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,o=Number.POSITIVE_INFINITY,a=0;const[u,h,p,y,x,S,E]=this._tmpVec2;_l(E,e.x,e.y);const A=new tn(E,null);for(let P=0;P<this.edges.length;P++){const k=this.edges[P],F=this.edgeProps[P].dir;A.dir=F;const G=this.vertices[k.a].position,U=this.vertices[k.b].position,Y=A.intersectsPlane(G,this.vertexProps[k.a].dir,u),Q=A.intersectsPlane(U,this.vertexProps[k.b].dir,h);if(!Y||!Q)continue;fs(p,h,u),fs(y,E,u);const ne=Ps(p,p),me=ne>0?Ps(y,p)/ne:0,de=H(me,0,1),ve=Math.abs((me-de)*this.edgeProps[P].len);fs(x,E,G),_l(S,F[1],-F[0]);const Te=ve+Math.abs(Ps(x,S));Te<o&&(n=P,o=Te,a=de)}return[n,a]}tessellate(e){const n=dn(),o=dn(),a=dn(),u=dn();for(let h=this.edges.length-1;h>=0;--h){const p=this.edges[h].a,y=this.edges[h].b,{position:x,height:S,extent:E}=this.vertices[p],{position:A,height:P,extent:k}=this.vertices[y],F=this.vertexProps[p].dir,G=this.vertexProps[y].dir;if(Jt(n,x[0]/e,x[1]/e,S),Jt(o,A[0]/e,A[1]/e,P),Jt(a,F[1],-F[0],0),Gt(a,a,E),Jt(u,G[1],-G[0],0),Gt(u,u,k),this.distSqLines(Wt(n[0]+.5*a[0],n[1]+.5*a[1],n[2]+.5*a[2]),Wt(o[0]-.5*u[0],o[1]-.5*u[1],o[2]-.5*u[2]),Wt(n[0]-.5*a[0],n[1]-.5*a[1],n[2]-.5*a[2]),Wt(o[0]+.5*u[0],o[1]+.5*u[1],o[2]+.5*u[2]))<=.0025000000000000005)continue;const U=this.vertices.length,Y=Ra(no(),x,A);this.vertices.push({position:Ro(Y,Y,.5),height:.5*(S+P),extent:.5*(E+k)});const Q=Ra(no(),F,G);this.vertexProps.push({dir:ka(Q,Q)}),this.edges.splice(h,1),this.edgeProps.splice(h,1),this.edges.push({a:p,b:U}),this.edges.push({a:U,b:y});const ne=fs(no(),this.vertices[U].position,x),me=Ms(ne),de={vec:ne,dir:Ro(no(),ne,1/me),len:me};this.edgeProps.push(de),this.edgeProps.push(de)}}distSqLines(e,n,o,a){const u=mn(dn(),n,e),h=mn(dn(),a,o),p=mn(dn(),e,o),y=kn(u,u),x=kn(u,h),S=kn(u,p),E=kn(h,h),A=kn(h,p),P=y*E-x*x;if(P===0)return oi(Ji(u,o,a,kn(p,h)/kn(h,h)),e);const k=(y*A-x*S)/P;return oi(Ji(u,e,n,(x*A-S*E)/P),Ji(h,o,a,k))}}class Ai{static parseFrom(e,n){const o=wt.parse(e);if(!o)return[];let{vertices:a,features:u}=o;const h=1/q(n);u.sort(((S,E)=>S.id-E.id)),a.sort(((S,E)=>S.id-E.id||S.idx-E.idx)),a=a.filter(((S,E,A)=>E===A.findIndex((P=>P.id===S.id&&P.idx===S.idx))));const p=new Array;let y=0;const x=a.length;for(const S of u){if(S.constantHeight){p.push(new Mn(S.id,S.bounds,S.constantHeight));continue}for(;y!==x&&a[y].id<S.id;)y++;if(y===x||a[y].id!==S.id)continue;const E=new Array,A=new Array,P=y;for(;y!==x&&a[y].id===S.id;){const k=a[y];if(E.push({position:k.position,height:k.height,extent:k.extent}),y!==P&&a[y-1].idx===k.idx-1){const F=y-P;A.push({a:F-1,b:F})}y++}p.push(new Mn(S.id,S.bounds,void 0,E,A,h))}return p}static getElevationFeature(e,n){if(!n)return;const o=+e.properties[We];return Number.isNaN(o)?void 0:n.find((a=>a.id===o))}}class ji{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Pt,this.yOffset=(e.y*this.zScale-n.y)*Pt)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,o){const a=this.constantElevation(n,o);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),o))}computeBiasedHeight(e,n){return n<=0?e:e+n*K(0,n,e>=0?e:Math.abs(.5*e))}}qt(Mn,"ElevationFeature");class Fi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ac,this.indexArray=new Jr,this.segments=new ki,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new sl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,o,a){}populate(e,n,o,a){const u=this.layers[0],h=[];let p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(const{feature:x,id:S,index:E,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,k=Re(x,P);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),k,o))continue;const F=p?p.evaluate(k,{},o):void 0,G={id:S,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:P?k.geometry:xe(x,o,a),patterns:{},sortKey:F};h.push(G)}p&&h.sort(((x,S)=>x.sortKey-S.sortKey));let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new sh,y=a.projection);for(const x of h){const{geometry:S,index:E,sourceLayerIndex:A}=x,P=e[E].feature;this.addFeature(x,S,E,n.availableImages,o,y,n.brightness,n.elevationFeatures),n.featureIndex.insert(P,S,E,A,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,o,a,u,h,p){this.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,dd.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,wm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,o,a,u,h,p,y){let x;this.elevationMode!=="none"&&(x=Ai.getElevationFeature(e,y));for(const S of n)for(const E of S){const A=E.x,P=E.y;if(A<0||A>=Pt||P<0||P>=Pt)continue;if(h){const G=h.projectTilePoint(A,P,u),U=h.upVector(u,A,P);this.addGlobeExtVertex(G,U),this.addGlobeExtVertex(G,U),this.addGlobeExtVertex(G,U),this.addGlobeExtVertex(G,U)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=k.vertexLength;if(this.addCircleVertex(A,P,-1,-1),this.addCircleVertex(A,P,1,-1),this.addCircleVertex(A,P,1,1),this.addCircleVertex(A,P,-1,1),this.elevationMode!=="none"){const G=x?x.pointElevation(new ct(A,P)):0;this.hasElevation=this.hasElevation||G!==0;for(let U=0;U<4;U++)this.elevatedLayoutVertexArray.emplaceBack(G)}this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,u,p,void 0,this.worldview)}addCircleVertex(e,n,o,a){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*n+(a+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function Ii(i,e){for(let n=0;n<i.length;n++)if(Hi(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Hi(i,e[n]))return!0;return!!ur(i,e)}function Gn(i,e,n){return!!Hi(i,e)||!!tr(e,i,n)}function zi(i,e){if(i.length===1)return dr(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let a=0;a<o.length;a++)if(Hi(i,o[a]))return!0}for(let n=0;n<i.length;n++)if(dr(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ur(i,e[n]))return!0;return!1}function _r(i,e,n){if(i.length>1){if(ur(i,e))return!0;for(let o=0;o<e.length;o++)if(tr(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(tr(i[o],e,n))return!0;return!1}function ur(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let u=0;u<e.length-1;u++)if(Ci(o,a,e[u],e[u+1]))return!0}return!1}function Ci(i,e,n,o){return Vn(i,n,o)!==Vn(e,n,o)&&Vn(i,e,n)!==Vn(i,e,o)}function hi(i,e,n){return(i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x)}function Wn(i,e,n,o){const a=hi(i,e,o),u=hi(i,e,n);if(Math.sign(a)===Math.sign(u))return;const h=hi(n,o,i),p=h+u-a;return Math.sign(h)!==Math.sign(p)?[h/(h-p),u/(u-a)]:void 0}function tr(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(Mr(i,e[a-1],e[a])<o)return!0;return!1}function Mr(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const a=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(a<0?e:a>1?n:n.sub(e)._mult(a)._add(e))}function dr(i,e){let n,o,a,u=!1;for(let h=0;h<i.length;h++){n=i[h];for(let p=0,y=n.length-1;p<n.length;y=p++)o=n[p],a=n[y],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(u=!u)}return u}function Hi(i,e){let n=!1;for(let o=0,a=i.length-1;o<i.length;a=o++){const u=i[o],h=i[a];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(n=!n)}return n}function Go(i,e,n,o,a){for(const h of i)if(e<=h.x&&n<=h.y&&o>=h.x&&a>=h.y)return!0;const u=[new ct(e,n),new ct(e,a),new ct(o,a),new ct(o,n)];if(i.length>2){for(const h of u)if(Hi(i,h))return!0}for(let h=0;h<i.length-1;h++)if(Co(i[h],i[h+1],u))return!0;return!1}function Co(i,e,n){const o=n[0],a=n[2];if(i.x<o.x&&e.x<o.x||i.x>a.x&&e.x>a.x||i.y<o.y&&e.y<o.y||i.y>a.y&&e.y>a.y)return!1;const u=Vn(i,e,n[0]);return u!==Vn(i,e,n[1])||u!==Vn(i,e,n[2])||u!==Vn(i,e,n[3])}function Ur(i,e,n,o,a,u){let h=e.y-i.y,p=i.x-e.x;if(u=u||0){const y=h*h+p*p;if(y===0)return!0;const x=Math.sqrt(y);h/=x,p/=x}return!((n.x-i.x)*h+(n.y-i.y)*p-u<0||(o.x-i.x)*h+(o.y-i.y)*p-u<0||(a.x-i.x)*h+(a.y-i.y)*p-u<0)}function $o(i,e,n,o,a,u,h){return!(Ur(i,e,o,a,u,h)||Ur(e,n,o,a,u,h)||Ur(n,i,o,a,u,h)||Ur(o,a,i,e,n,h)||Ur(a,u,i,e,n,h)||Ur(u,o,i,e,n,h))}function es(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function go(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Sa(i,e,n,o,a){if(!e[0]&&!e[1])return i;const u=ct.convert(e)._mult(a);n==="viewport"&&u._rotate(-o);const h=[];for(let p=0;p<i.length;p++)h.push(i[p].sub(u));return h}function Ts(i,e,n,o){const a=ct.convert(i)._mult(o);return e==="viewport"&&a._rotate(-n),a}let Ns,fr;function d(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}qt(Fi,"CircleBucket",{omit:["layers"]});class m{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=B(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const o=(function(u,h,p){var y=d(256*u,256*(h=Math.pow(2,p)-h-1),p),x=d(256*(u+1),256*(h+1),p);return y[0]+","+y[1]+","+x[0]+","+x[1]})(this.x,this.y,this.z),a=(function(u,h,p){let y,x="";for(let S=u;S>0;S--)y=1<<S-1,x+=(h&y?1:0)+(p&y?2:0);return x})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class w{constructor(e,n){this.wrap=e,this.canonical=n,this.key=B(e,n.z,n.z,n.x,n.y)}}class M{constructor(e,n,o,a,u){this.overscaledZ=e,this.wrap=n,this.canonical=new m(o,+a,+u),this.key=n===0&&e===o?this.canonical.key:B(n,e,o,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new M(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new M(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return B(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return B(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new M(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new M(n,this.wrap,n,o,a),new M(n,this.wrap,n,o+1,a),new M(n,this.wrap,n,o,a+1),new M(n,this.wrap,n,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new M(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new M(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new w(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function B(i,e,n,o,a){const u=1<<Math.min(n,22);let h=u*(a%u)+o%u;return i&&n<22&&(h+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*h+n)+(e-n)}const W=[i=>{let e=i.canonical.x-1,n=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,n--),new M(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,n=i.wrap;return e===1<<i.canonical.z&&(e=0,n++),new M(i.overscaledZ,n,i.canonical.z,e,i.canonical.y)},i=>new M(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new M(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];qt(m,"CanonicalTileID"),qt(M,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ce=ni([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Fe}=ce,Ze=ni([{name:"a_pos_3",components:3,type:"Int16"}]);var kt=ni([{name:"a_pos",type:"Int16",components:2}]);function en(i){return i*gr/l}const ln=[new Kt([Bs,Bs,Bs],[ua,ua,ua]),new Kt([Bs,Bs,Bs],[0,0,ua]),new Kt([0,Bs,Bs],[ua,0,ua]),new Kt([Bs,0,Bs],[0,ua,ua]),new Kt([0,0,Bs],[ua,ua,ua])];function rn(i,e,n,o=!0){const a=Gt([],i._camera.position,i.worldSize),u=[e,n,1,1];So(u,u,i.pixelMatrixInverse),to(u,u,1/u[3]);const h=xn([],Cr([],u,a)),p=i.globeMatrix,y=[p[12],p[13],p[14]],x=Cr([],y,a),S=Hn(x),E=xn([],x),A=i.worldSize/(2*Math.PI),P=kn(E,h),k=Math.asin(A/S);if(k<Math.acos(P)){if(!o)return null;const qe=[],ke=[];Gt(qe,h,S/P),xn(ke,Cr(ke,qe,x)),xn(h,nt(h,x,Gt(h,ke,Math.tan(k)*S)))}const F=[];new Yt(a,h).closestPointOnSphere(y,A,F);const G=xn([],ir(p,0)),U=xn([],ir(p,1)),Y=xn([],ir(p,2)),Q=kn(G,F),ne=kn(U,F),me=kn(Y,F),de=ro(Math.asin(-ne/A));let ve=ro(Math.atan2(Q,me));ve=i.center.lng+(function(qe,ke){const Qe=(ke-qe+180)%360-180;return Qe<-180?Qe+360:Qe})(i.center.lng,ve);const Te=v(ve),Ie=H(b(de),0,1);return new ee(Te,Ie)}class zn{constructor(e,n,o){this.a=Cr([],e,o),this.b=Cr([],n,o),this.center=o;const a=xn([],this.a),u=xn([],this.b);this.angle=Math.acos(kn(a,u))}}function Bn(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:(function(o,a,u,h){const p=Math.sin(u);return o*(Math.sin((1-h)*u)/p)+a*(Math.sin(h*u)/p)})(i.a[e],i.b[e],i.angle,H(n,0,1))+i.center[e]}function Nn(i){if(i.z<=1)return ln[i.z+2*i.y+i.x];const e=vn(Et(i));return Kt.fromPoints(e)}function Lr(i,e,n){return Gt(i,i,1-n),gn(i,i,e,n)}function bt(i,e,n){for(const o of i)Gi(o,o,e),Gt(o,o,n)}function at(i,e,n,o){const a=e/i.worldSize,u=i.globeMatrix;if(n.z<=1){const Ie=Nn(n).getCorners();return bt(Ie,u,a),Kt.fromPoints(Ie)}const h=Et(n,o),p=vn(h,gr+en(i._tileCoverLift));bt(p,u,a);const y=Number.MAX_VALUE,x=[-y,-y,-y],S=[y,y,y];if(h.contains(i.center)){for(const ke of p)rt(S,S,ke),Ut(x,x,ke);x[2]=0;const Ie=i.point,qe=[Ie.x*a,Ie.y*a,0];return rt(S,S,qe),Ut(x,x,qe),new Kt(S,x)}if(i._tileCoverLift>0){for(const Ie of p)rt(S,S,Ie),Ut(x,x,Ie);return new Kt(S,x)}const E=[u[12]*a,u[13]*a,u[14]*a],A=h.getCenter(),P=H(i.center.lat,-D,D),k=H(A.lat,-D,D),F=v(i.center.lng),G=b(P);let U=F-v(A.lng);const Y=G-b(k);U>.5?U-=1:U<-.5&&(U+=1);let Q=0;Math.abs(U)>Math.abs(Y)?Q=U>=0?1:3:(Q=Y>=0?0:2,gn(E,E,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(ti(Y>=0?h.getSouth():h.getNorth()))*gr));const ne=p[Q],me=p[(Q+1)%4],de=new zn(ne,me,E),ve=[Bn(de,0)||ne[0],Bn(de,1)||ne[1],Bn(de,2)||ne[2]],Te=vf(i.zoom);if(Te>0){const Ie=(function({x:ke,y:Qe,z:ut},ht,gt,vt,ft){const pt=1/(1<<ut);let Je=ke*pt,Ye=Je+pt,mt=Qe*pt,zt=mt+pt,St=0;const hn=(Je+Ye)/2-vt;return hn>.5?St=-1:hn<-.5&&(St=1),Je=((Je+St)*ht-(vt*=ht))*gt+vt,Ye=((Ye+St)*ht-vt)*gt+vt,mt=(mt*ht-(ft*=ht))*gt+ft,zt=(zt*ht-ft)*gt+ft,[[Je,zt,0],[Ye,zt,0],[Ye,mt,0],[Je,mt,0]]})(n,e,i._pixelsPerMercatorPixel,F,G);for(let ke=0;ke<p.length;ke++)Lr(p[ke],Ie[ke],Te);const qe=nt([],Ie[Q],Ie[(Q+1)%4]);Gt(qe,qe,.5),Lr(ve,qe,Te)}for(const Ie of p)rt(S,S,Ie),Ut(x,x,Ie);return S[2]=Math.min(ne[2],me[2]),rt(S,S,ve),Ut(x,x,ve),new Kt(S,x)}function Et({x:i,y:e,z:n},o=!1){const a=1/(1<<n),u=new r(C(i*a),e===(1<<n)-1&&o?-90:O((e+1)*a)),h=new r(C((i+1)*a),e===0&&o?90:O(e*a));return new c(u,h)}function vn(i,e=gr){const n=ti(i.getNorth()),o=ti(i.getSouth()),a=Math.cos(n),u=Math.cos(o),h=Math.sin(n),p=Math.sin(o),y=i.getWest(),x=i.getEast();return[dl(u,p,y,e),dl(u,p,x,e),dl(a,h,x,e),dl(a,h,y,e)]}function ii(i,e,n,o){const a=1<<n.z,u=(i/Pt+n.x)/a;return Uo(O((e/Pt+n.y)/a),C(u),o)}function Si({min:i,max:e}){return Vo/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const Mi=new Float64Array(16);function Bi(i){const e=Si(i),n=Mt(Mi,[e,e,e]);return Ke(n,n,wn([],i.min))}function ts(i){const e=(o=i.min,(n=Mi)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n);var n,o;const a=1/Si(i);return Ct(e,e,[a,a,a])}function Ir(i){const e=Pt/(2*Math.PI);return i/(2*Math.PI)/e}function lu(i,e){return Pt/(512*Math.pow(2,i))*Si(Nn(e))}function Tg(i,e,n,o,a){const u=Ir(n),h=[i,e,-n/(2*Math.PI)],p=Be(new Float64Array(16));return Ke(p,p,h),Ct(p,p,[u,u,u]),tt(p,p,ti(-a)),Nt(p,p,ti(-o)),p}function vf(i){return K(so,ac,i)}function gx(i,e){const n=Uo(e.lat,e.lng),o=(function(k){const F=Uo(k._center.lat,k._center.lng);let G=_i([],Wt(0,1,0),F);const U=Rn([],-k.angle,F);G=Gi(G,G,U),Rn(U,-k._pitch,G);const Y=xn([],F);return Gt(Y,Y,en(k.cameraToCenterDistance/k.pixelsPerMeter)),Gi(Y,Y,U),nt([],F,Y)})(i);return h=(a=mn([],o,n))[0],p=a[1],y=a[2],x=(u=n)[0],S=u[1],E=u[2],P=(A=Math.sqrt((h*h+p*p+y*y)*(x*x+S*S+E*E)))&&kn(a,u)/A,Math.acos(Math.min(Math.max(P,-1),1));var a,u,h,p,y,x,S,E,A,P}function Y_(i,e){return gx(i,e)>Math.PI/2*1.01}const _x=ti(85),y2=Math.cos(_x),v2=Math.sin(_x),x2=st(),yx=i=>{const e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function vx(i,e,n,o,a,u,h,p,y){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(y*=i.pixelToTileUnitsFactor);const x=i.tileID.canonical,S=n.projection.upVectorScale(x,n.center.lat,n.worldSize).metersToTile;for(const E of e)for(const A of E){const P=A.add(p),k=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(P.x,P.y,!0):0,F=n.projection.projectTilePoint(P.x,P.y,x);if(k>0){const Q=n.projection.upVector(x,P.x,P.y);F.x+=Q[0]*S*k,F.y+=Q[1]*S*k,F.z+=Q[2]*S*k}const G=u?P:w2(F.x,F.y,F.z,o),U=u?i.tilespaceRays.map((Q=>T2(Q,k))):i.queryGeometry.screenGeometry,Y=So([],[F.x,F.y,F.z,1],o);if(!h&&u?y*=Y[3]/n.cameraToCenterDistance:h&&!u&&(y*=n.cameraToCenterDistance/Y[3]),u){const Q=O((A.y/Pt+x.y)/(1<<x.z));y/=n.projection.pixelsPerMeter(Q,1)/I(1,Q)}if(Gn(U,G,y))return!0}return!1}function w2(i,e,n,o){const a=So([],[i,e,n,1],o);return new ct(a[0]/a[3],a[1]/a[3])}const xx=Wt(0,0,0),b2=Wt(0,0,1);function T2(i,e){const n=dn();return xx[2]=e,i.intersectsPlane(xx,b2,n),new ct(n[0],n[1])}class wx extends Fi{}let bx,Tx,Sx,Ex;function Ix(i,{width:e,height:n},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*n*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=a,i}function Ax(i,e,n){const{width:o,height:a}=e;o===i.width&&a===i.height||(K_(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,a)},n,null),i.width=o,i.height=a,i.data=e.data)}function K_(i,e,n,o,a,u,h,p){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||n.x>i.width-a.width||n.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,x=e.data,S=u===4&&p;for(let E=0;E<a.height;E++){const A=((n.y+E)*i.width+n.x)*u,P=((o.y+E)*e.width+o.x)*u;if(S)for(let k=0;k<a.width;k++){const F=A+k*u+3,G=P+k*u;x[G+0]=255,x[G+1]=255,x[G+2]=255,x[G+3]=y[F]}else if(h)for(let k=0;k<a.width;k++){const F=A+k*u,G=P+k*u,U=new Vi(y[F+0]/255,y[F+1]/255,y[F+2]/255,y[F+3]).toNonPremultipliedRenderColor(h).toArray();x[G+0]=U[0],x[G+1]=U[1],x[G+2]=U[2],x[G+3]=U[3]}else for(let k=0;k<a.width*u;k++)x[P+k]=y[A+k]}return e}qt(wx,"HeatmapBucket",{omit:["layers"]});class xf{constructor(e,n){Ix(this,e,1,n)}resize(e){Ax(this,new xf(e),1)}clone(){return new xf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,a,u){K_(e,n,o,a,u,1,null)}}class Ss{constructor(e,n){Ix(this,e,4,n)}resize(e){Ax(this,new Ss(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,a,u,h,p){K_(e,n,o,a,u,4,h,p)}}class Cx{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function bm(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,a=i.image||new Ss({width:n,height:o}),u=(h,p,y)=>{e[i.evaluationKey]=y;const x=i.expression.evaluate(e),S=x?x.toNonPremultipliedRenderColor(null):null;S&&(a.data[h+p+0]=Math.floor(255*S.r),a.data[h+p+1]=Math.floor(255*S.g),a.data[h+p+2]=Math.floor(255*S.b),a.data[h+p+3]=Math.floor(255*S.a))};if(i.clips)for(let h=0,p=0;h<o;++h,p+=4*n)for(let y=0,x=0;y<n;y++,x+=4){const S=y/(n-1),{start:E,end:A}=i.clips[h];u(p,x,E*(1-S)+A*S)}else for(let h=0,p=0;h<n;h++,p+=4)u(0,p,h/(n-1));return a}qt(xf,"AlphaImage"),qt(Ss,"RGBAImage");const S2=ni([{name:"a_pos",components:2,type:"Int16"}],4),E2=ni([{name:"a_road_z_offset",components:1,type:"Float32"}],4),I2=ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),A2=ni([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Fp(i,e,n=2){const o=e&&e.length,a=o?e[0]*n:i.length;let u=Mx(i,0,a,n,!0);const h=[];if(!u||u.next===u.prev)return h;let p,y,x;if(o&&(u=(function(S,E,A,P){const k=[];for(let F=0,G=E.length;F<G;F++){const U=Mx(S,E[F]*P,F<G-1?E[F+1]*P:S.length,P,!1);U===U.next&&(U.steiner=!0),k.push(D2(U))}k.sort(k2);for(let F=0;F<k.length;F++)A=z2(k[F],A);return A})(i,e,u,n)),i.length>80*n){p=i[0],y=i[1];let S=p,E=y;for(let A=n;A<a;A+=n){const P=i[A],k=i[A+1];P<p&&(p=P),k<y&&(y=k),P>S&&(S=P),k>E&&(E=k)}x=Math.max(S-p,E-y),x=x!==0?32767/x:0}return Tm(u,h,n,p,y,x,0),h}function Mx(i,e,n,o,a){let u;if(a===(function(h,p,y,x){let S=0;for(let E=p,A=y-x;E<y;E+=x)S+=(h[A]-h[E])*(h[E+1]+h[A+1]),A=E;return S})(i,e,n,o)>0)for(let h=e;h<n;h+=o)u=zx(h/o|0,i[h],i[h+1],u);else for(let h=n-o;h>=e;h-=o)u=zx(h/o|0,i[h],i[h+1],u);return u&&Bp(u,u.next)&&(Im(u),u=u.next),u}function lp(i,e){if(!i)return i;e||(e=i);let n,o=i;do if(n=!1,o.steiner||!Bp(o,o.next)&&Ho(o.prev,o,o.next)!==0)o=o.next;else{if(Im(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function Tm(i,e,n,o,a,u,h){if(!i)return;!h&&u&&(function(y,x,S,E){let A=y;do A.z===0&&(A.z=J_(A.x,A.y,x,S,E)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==y);A.prevZ.nextZ=null,A.prevZ=null,(function(P){let k,F=1;do{let G,U=P;P=null;let Y=null;for(k=0;U;){k++;let Q=U,ne=0;for(let de=0;de<F&&(ne++,Q=Q.nextZ,Q);de++);let me=F;for(;ne>0||me>0&&Q;)ne!==0&&(me===0||!Q||U.z<=Q.z)?(G=U,U=U.nextZ,ne--):(G=Q,Q=Q.nextZ,me--),Y?Y.nextZ=G:P=G,G.prevZ=Y,Y=G;U=Q}Y.nextZ=null,F*=2}while(k>1)})(A)})(i,o,a,u);let p=i;for(;i.prev!==i.next;){const y=i.prev,x=i.next;if(u?M2(i,o,a,u):C2(i))e.push(y.i,i.i,x.i),Im(i),i=x.next,p=x.next;else if((i=x)===p){h?h===1?Tm(i=P2(lp(i),e),e,n,o,a,u,2):h===2&&R2(i,e,n,o,a,u):Tm(lp(i),e,n,o,a,u,1);break}}}function C2(i){const e=i.prev,n=i,o=i.next;if(Ho(e,n,o)>=0)return!1;const a=e.x,u=n.x,h=o.x,p=e.y,y=n.y,x=o.y,S=Math.min(a,u,h),E=Math.min(p,y,x),A=Math.max(a,u,h),P=Math.max(p,y,x);let k=o.next;for(;k!==e;){if(k.x>=S&&k.x<=A&&k.y>=E&&k.y<=P&&Sm(a,p,u,y,h,x,k.x,k.y)&&Ho(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function M2(i,e,n,o){const a=i.prev,u=i,h=i.next;if(Ho(a,u,h)>=0)return!1;const p=a.x,y=u.x,x=h.x,S=a.y,E=u.y,A=h.y,P=Math.min(p,y,x),k=Math.min(S,E,A),F=Math.max(p,y,x),G=Math.max(S,E,A),U=J_(P,k,e,n,o),Y=J_(F,G,e,n,o);let Q=i.prevZ,ne=i.nextZ;for(;Q&&Q.z>=U&&ne&&ne.z<=Y;){if(Q.x>=P&&Q.x<=F&&Q.y>=k&&Q.y<=G&&Q!==a&&Q!==h&&Sm(p,S,y,E,x,A,Q.x,Q.y)&&Ho(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ne.x>=P&&ne.x<=F&&ne.y>=k&&ne.y<=G&&ne!==a&&ne!==h&&Sm(p,S,y,E,x,A,ne.x,ne.y)&&Ho(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;Q&&Q.z>=U;){if(Q.x>=P&&Q.x<=F&&Q.y>=k&&Q.y<=G&&Q!==a&&Q!==h&&Sm(p,S,y,E,x,A,Q.x,Q.y)&&Ho(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ne&&ne.z<=Y;){if(ne.x>=P&&ne.x<=F&&ne.y>=k&&ne.y<=G&&ne!==a&&ne!==h&&Sm(p,S,y,E,x,A,ne.x,ne.y)&&Ho(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function P2(i,e){let n=i;do{const o=n.prev,a=n.next.next;!Bp(o,a)&&Rx(o,n,n.next,a)&&Em(o,a)&&Em(a,o)&&(e.push(o.i,n.i,a.i),Im(n),Im(n.next),n=i=a),n=n.next}while(n!==i);return lp(n)}function R2(i,e,n,o,a,u){let h=i;do{let p=h.next.next;for(;p!==h.prev;){if(h.i!==p.i&&O2(h,p)){let y=kx(h,p);return h=lp(h,h.next),y=lp(y,y.next),Tm(h,e,n,o,a,u,0),void Tm(y,e,n,o,a,u,0)}p=p.next}h=h.next}while(h!==i)}function k2(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function z2(i,e){const n=(function(a,u){let h=u;const p=a.x,y=a.y;let x,S=-1/0;if(Bp(a,h))return h;do{if(Bp(a,h.next))return h.next;if(y<=h.y&&y>=h.next.y&&h.next.y!==h.y){const F=h.x+(y-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(F<=p&&F>S&&(S=F,x=h.x<h.next.x?h:h.next,F===p))return x}h=h.next}while(h!==u);if(!x)return null;const E=x,A=x.x,P=x.y;let k=1/0;h=x;do{if(p>=h.x&&h.x>=A&&p!==h.x&&Px(y<P?p:S,y,A,P,y<P?S:p,y,h.x,h.y)){const F=Math.abs(y-h.y)/(p-h.x);Em(h,a)&&(F<k||F===k&&(h.x>x.x||h.x===x.x&&L2(x,h)))&&(x=h,k=F)}h=h.next}while(h!==E);return x})(i,e);if(!n)return e;const o=kx(n,i);return lp(o,o.next),lp(n,n.next)}function L2(i,e){return Ho(i.prev,i,e.prev)<0&&Ho(e.next,i,i.next)<0}function J_(i,e,n,o,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*a|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function D2(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Px(i,e,n,o,a,u,h,p){return(a-h)*(e-p)>=(i-h)*(u-p)&&(i-h)*(o-p)>=(n-h)*(e-p)&&(n-h)*(u-p)>=(a-h)*(o-p)}function Sm(i,e,n,o,a,u,h,p){return!(i===h&&e===p)&&Px(i,e,n,o,a,u,h,p)}function O2(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,o){let a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==o.i&&a.next.i!==o.i&&Rx(a,a.next,n,o))return!0;a=a.next}while(a!==n);return!1})(i,e)&&(Em(i,e)&&Em(e,i)&&(function(n,o){let a=n,u=!1;const h=(n.x+o.x)/2,p=(n.y+o.y)/2;do a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==n);return u})(i,e)&&(Ho(i.prev,i,e.prev)||Ho(i,e.prev,e))||Bp(i,e)&&Ho(i.prev,i,i.next)>0&&Ho(e.prev,e,e.next)>0)}function Ho(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Bp(i,e){return i.x===e.x&&i.y===e.y}function Rx(i,e,n,o){const a=Eg(Ho(i,e,n)),u=Eg(Ho(i,e,o)),h=Eg(Ho(n,o,i)),p=Eg(Ho(n,o,e));return a!==u&&h!==p||!(a!==0||!Sg(i,n,e))||!(u!==0||!Sg(i,o,e))||!(h!==0||!Sg(n,i,o))||!(p!==0||!Sg(n,e,o))}function Sg(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Eg(i){return i>0?1:i<0?-1:0}function Em(i,e){return Ho(i.prev,i,i.next)<0?Ho(i,e,i.next)>=0&&Ho(i,i.prev,e)>=0:Ho(i,e,i.prev)<0||Ho(i,i.next,e)<0}function kx(i,e){const n=Q_(i.i,i.x,i.y),o=Q_(e.i,e.x,e.y),a=i.next,u=e.prev;return i.next=e,e.prev=i,n.next=a,a.prev=n,o.next=n,n.prev=o,u.next=o,o.prev=u,o}function zx(i,e,n,o){const a=Q_(i,e,n);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Im(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Q_(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Am(i,e){const n=i.length;if(n<=1)return[i];const o=[];let a,u;for(let h=0;h<n;h++){const p=Un(i[h]);p!==0&&(i[h].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(a&&o.push(a),a=[i[h]]):a.push(i[h]))}if(a&&o.push(a),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(ku(o[h],e,1,o[h].length-1,F2),o[h]=o[h].slice(0,e));return o}function F2(i,e){return e.area-i.area}function Lx(i,e,n=1){if(!i)return null;const o=typeof i=="string"?_s.from(i).getPrimary():i.getPrimary(),a=typeof i=="string"?null:i.getSecondary();for(const u of[o,a]){if(!u)continue;const h=u.id.toString();e.has(h)||e.set(h,[]),u.scaleSelf(n),e.get(h).push(u)}return{primary:o.toString(),secondary:a?a.toString():null}}function ey(i,e,n,o){const a=o.patternDependencies;let u=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(u=!0),Lx(p.constantOr(null),a,n)&&(u=!0)}return u}function ty(i,e,n,o,a,u){const h=u.patternDependencies;for(const p of e){const y=p.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o},n,{},u.availableImages);x=x&&x.name?x.name:x;const S=Lx(x,h,a);if(!S)continue;const{primary:E,secondary:A}=S;E&&(n.patterns[p.id]=[E,A].filter(Boolean))}}return n}class Dx{constructor(){this.polygons=new Map}add(e,...n){const o=this.polygons.get(e);o?o.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,o]of e.polygons)this.add(n,...o)}}class gd{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=Pt&&n>=Pt}static evaluate(e){if(e.length===0)return new gd;let n=[];for(const y of e)n.push(...y.portals);if(n.length===0)return new gd;for(const y of n){const x=y.va,S=y.vb;(gd.isOnBorder(x.x,S.x)||gd.isOnBorder(x.y,S.y))&&(y.type="border")}const o=n.filter((y=>y.type!=="unevaluated")),a=n.filter((y=>y.type==="unevaluated"));if(a.length===0)return new gd;a.sort(((y,x)=>y.hash===x.hash?y.isTunnel===x.isTunnel?0:y.isTunnel?-1:1:y.hash<x.hash?1:-1)),n=o.concat(a);let u=o.length,h=u,p=u;do if(h++,h===n.length||n[u].hash!==n[h].hash){if(h-u==2){p<u&&(n[p]=n[u],n[u]=null);const y=n[p],x=n[h-1];y.type=y.isTunnel!==x.isTunnel?"tunnel":"polygon",y.connection={a:y.connection.a,b:x.connection.a},p++}u=h}while(u!==n.length);return n.splice(p),n.sort(((y,x)=>y.hash<x.hash?1:-1)),{portals:n}}}qt(gd,"ElevationPortalGraph"),qt(Dx,"ElevationPolygons");class B2{constructor(e,n,o){this.outPositions=e,this.outNormals=n,this.outIndices=o,this.vertexLookup=new Map}addVertex(e,n,o){let a=e[2];o!=null&&(a*=o);const u=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,h=this.vertexLookup.get(u);if(h!=null)return h;const p=this.outPositions.length;this.vertexLookup.set(u,p);const y=Math.trunc(16384*n[0]),x=Math.trunc(16384*n[1]),S=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(y,x,S),p}addTriangle(e,n,o){this.outIndices.emplaceBack(e,n,o)}addTriangles(e,n,o){if(e.length===0)return;const a=o.length===1,u=dn(),h=dn();for(let p=0;p<e.length;p+=3){const y=n[e[p+0]],x=n[e[p+1]],S=n[e[p+2]],E=a?o[0]:o[e[p+1]],A=a?o[0]:o[e[p+2]];Jt(u,y.x,y.y,a?o[0]:o[e[p+0]]);const P=this.addVertex(u,h);Jt(u,x.x,x.y,E);const k=this.addVertex(u,h);Jt(u,S.x,S.y,A);const F=this.addVertex(u,h);this.outIndices.emplaceBack(P,k,F)}}addQuad(e,n,o,a,u,h){const p=this.addVertex(e,u,h),y=this.addVertex(n,u,h),x=this.addVertex(o,u,h),S=this.addVertex(a,u,h);this.addTriangle(p,y,x),this.addTriangle(x,S,p)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class fl{constructor(e,n,o,a){this.unevaluatedPortals=new gd,this.portalPolygons=new Dx,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new oh,this.vertexNormals=new af,this.indexArray=new Jr,this.tileToMeters=q(e),this.bridgeProgramConfigurations=new ca(n,{zoom:o,lut:a},(u=>u!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new ca(n,{zoom:o,lut:a},(u=>u!=="fill-bridge-guard-rail-color"))}addVertices(e,n){const o=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(n[a]);return o}addTriangles(e,n,o){const a=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const u of e)a.push(u+n)}addRenderableRing(e,n,o,a,u,h){const p=[new ct(u.min.x,u.min.y),new ct(u.max.x,u.min.y),new ct(u.max.x,u.max.y),new ct(u.min.x,u.max.y)];for(let y=0;y<o-1;y++){const x=n+y,S=x+1,E=this.unevalVertices[x],A=this.unevalVertices[S];if(!(E.x>=u.min.x&&E.x<=u.max.x&&E.y>=u.min.y&&E.y<=u.max.y||A.x>=u.min.x&&A.x<=u.max.x&&A.y>=u.min.y&&A.y<=u.max.y||Co(E,A,p))||this.isOnBorder(E.x,A.x)||this.isOnBorder(E.y,A.y))continue;const P=fl.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[S]);let k,F=this.vertexHashLookup.get(fl.computePosHash(E));F!=null?k=F.next:(F=this.vertexHashLookup.get(fl.computePosHash(A)),k=F!=null?F.prev:P),this.unevalEdges.push({polygonIdx:e,a:x,b:S,hash:P,portalHash:k,isTunnel:a,type:"unevaluated",featureInfo:h})}}addPortalCandidates(e,n,o,a,u){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:u});const h=n[0];this.vertexHashLookup.clear();let p=fl.computeEdgeHash(h[h.length-2],h[h.length-1]);for(let y=0;y<h.length-1;y++){const x=h[y+0],S=h[y+1],E=Zo(S.x-x.x,S.y-x.y),A=Ms(E);if(A===0)continue;let P="unevaluated";const k=a.pointElevation(x),F=a.pointElevation(S);Math.abs(k)<.01&&Math.abs(F)<.01?P="entrance":(this.isOnBorder(x.x,S.x)||this.isOnBorder(x.y,S.y))&&(P="border");const G=fl.computeEdgeHash(x,S);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:x,vb:S,vab:E,length:A,hash:G,isTunnel:o,type:P});const U=fl.computePosHash(x);this.vertexHashLookup.set(U,{prev:p,next:G}),p=G}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=A=>{A.primitiveLength=this.indexArray.length-A.primitiveOffset},a=new B2(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const u=n(),h=n(),p=n(),y=(A,P)=>{A.sort(((F,G)=>F.type===P&&G.type!==P?-1:F.type!==P&&G.type===P?1:0));const k=A.findIndex((F=>F.type!==P));return k>=0?k:A.length};let x=0;this.unevalEdges.length>0&&(x=y(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},this.tileToMeters)),o(p);const S=n(),E=n();if(this.unevalEdges.length>0){const A=this.unevalEdges.splice(x),P=y(A,"tunnel")+x;this.unevalEdges.push(...A),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},{min:x,max:P})}o(S),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(E),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(h),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(u),this.maskSegments=ki.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.depthSegments=ki.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength),this.renderableBridgeSegments=ki.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableTunnelSegments=ki.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.shadowCasterSegments=ki.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength)}update(e,n,o,a,u,h,p,y){this.bridgeProgramConfigurations.updatePaintArrays(e,n,u,o,a,h,p,y),this.tunnelProgramConfigurations.updatePaintArrays(e,n,u,o,a,h,p,y)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,I2.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,A2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,o,a,u){const h=(p,y)=>{for(let x=0;x<y.length-1;x++){const S=y[x].featureIndex,E=y[x+1].vertexStart,A=e.feature(S);p.populatePaintArrays(E,A,S,{},o,n,a,void 0,u)}};h(this.bridgeProgramConfigurations,this.bridgeFeatureSections),h(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,o,a,u){const h=new Map;for(let p=a;p<u;p++){const y=o[p],x=y.a,S=y.b,E=fl.computePosHash(e[x]),A=fl.computePosHash(e[S]);let P=h.get(E);P||(P={},h.set(E,P));let k=h.get(A);k||(k={},h.set(A,k)),n[x]<=0&&n[S]<=0||(P.to=S,k.from=x)}return h}isTerminalVertex(e,n){const o=fl.computePosHash(this.unevalVertices[e]),a=n.get(o);return!a||!a.from||!a.to}constructBridgeStructures(e,n,o,a,u,h){e.clearVertexLookup();const p=this.computeVertexConnections(n,o,a,u.min,u.max),y=1/h,x=.5*y,S=(gt,vt)=>Jt(gt,n[vt].x,n[vt].y,o[vt]*y),E=dn(),A=dn(),P=dn(),k=dn(),F=dn(),G=(gt,vt)=>{const ft=p.get(fl.computePosHash(n[vt])),pt=ft.from,Je=ft.to;if(!pt||!Je)return;S(E,pt),S(A,vt),S(P,Je),vo(k),Pr(E,A)||(Cr(F,A,E),xn(k,F)),Pr(P,A)||(Cr(F,P,A),nt(k,k,xn(F,F)));const Ye=Ca(k);return Ye>0?Gt(gt,k,1/Ye):void 0};let U=Number.POSITIVE_INFINITY;this.sortSubarray(a,u.min,u.max,((gt,vt)=>gt.featureInfo.featureIndex-vt.featureInfo.featureIndex));const Y=dn(),Q=dn(),ne=dn(),me=dn(),de=dn(),ve=dn(),Te=dn(),Ie=dn(),qe=dn(),ke=[dn(),dn(),dn(),dn()],Qe=[dn(),dn(),dn(),dn()],ut=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],ht=(gt,vt)=>gt>vt;for(let gt=u.min;gt<u.max;gt++){const vt=a[gt];if(!vt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ut,n,o,vt,ht))continue;const[ft,pt]=ut;if(Jt(Y,ft.coord.x,ft.coord.y,y*ft.height),Jt(Q,pt.coord.x,pt.coord.y,y*pt.height),Pr(Y,Q))continue;Cr(ne,Q,Y),xn(ne,ne);const Je=G(Ie,vt.a)||ne,Ye=G(qe,vt.b)||ne;Jt(me,Je[1],-Je[0],0),xn(me,me),Jt(de,Ye[1],-Ye[0],0),xn(de,de),_i(Ie,me,Je),xn(ve,Ie),_i(Ie,de,Ye),xn(Te,Ie),nt(ke[0],Y,Gt(Ie,Cr(Ie,me,ve),x)),nt(ke[1],Y,Gt(Ie,nt(Ie,me,ve),x)),nt(ke[2],Y,Gt(Ie,ve,x)),ke[3]=Y,nt(Qe[0],Q,Gt(Ie,Cr(Ie,de,Te),x)),nt(Qe[1],Q,Gt(Ie,nt(Ie,de,Te),x)),nt(Qe[2],Q,Gt(Ie,Te,x)),Qe[3]=Q,U=this.addFeatureSection(vt.featureInfo.featureIndex,U,this.bridgeFeatureSections,e);const mt=e.addVertex(ke[0],me,h),zt=e.addVertex(ke[1],me,h),St=e.addVertex(Qe[0],de,h),hn=e.addVertex(Qe[1],de,h);e.addTriangle(mt,zt,St),e.addTriangle(zt,hn,St);const Vt=e.addVertex(ke[1],ve,h),Zt=e.addVertex(ke[2],ve,h),nn=e.addVertex(Qe[1],Te,h),Qn=e.addVertex(Qe[2],Te,h);e.addTriangle(Vt,Zt,nn),e.addTriangle(Zt,Qn,nn),wn(me,me),wn(de,de);const It=e.addVertex(ke[2],me,h),on=e.addVertex(ke[3],me,h),Dn=e.addVertex(Qe[2],de,h),gi=e.addVertex(Qe[3],de,h);e.addTriangle(It,on,Dn),e.addTriangle(on,gi,Dn);const bi=this.isTerminalVertex(vt.a,p),qn=this.isTerminalVertex(vt.b,p);ft.height<.01&&bi&&e.addQuad(ke[3],ke[2],ke[1],ke[0],wn(Je,Je),h),pt.height<.01&&qn&&e.addQuad(Qe[0],Qe[1],Qe[2],Qe[3],Ye,h)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,o,a,u,h){e.clearVertexLookup();let p=Number.POSITIVE_INFINITY;const y=(U,Y)=>U.featureInfo.featureIndex-Y.featureInfo.featureIndex;this.sortSubarray(a,u.min,u.max,y),this.sortSubarray(a,h.min,h.max,y);const x=U=>xn(U,U),S=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],E=(U,Y)=>U<Y,A=dn(),P=dn(),k=dn(),F=dn(),G=dn();for(let U=u.min;U<u.max;U++){if(!this.prepareEdgePoints(S,n,o,a[U],E))continue;const[Y,Q]=S,ne=x(Jt(G,-(Q.coord.y-Y.coord.y),Q.coord.x-Y.coord.x,0));p=this.addFeatureSection(a[U].featureInfo.featureIndex,p,this.tunnelFeatureSections,e),e.addQuad(Jt(A,Y.coord.x,Y.coord.y,Y.height),Jt(P,Q.coord.x,Q.coord.y,Q.height),Jt(k,Q.coord.x,Q.coord.y,a[U].isTunnel?-.1:0),Jt(F,Y.coord.x,Y.coord.y,a[U].isTunnel?-.1:0),ne)}for(let U=h.min;U<h.max;U++){const Y=a[U];Y.isTunnel&&([Y.a,Y.b]=[Y.b,Y.a]);const Q=n[Y.a],ne=n[Y.b],me=x(Jt(G,-(ne.y-Q.y),ne.x-Q.x,0));p=this.addFeatureSection(Y.featureInfo.featureIndex,p,this.tunnelFeatureSections,e),e.addQuad(Jt(A,ne.x,ne.y,0),Jt(P,Q.x,Q.y,0),Jt(k,Q.x,Q.y,o[Y.a]+4),Jt(F,ne.x,ne.y,o[Y.b]+4),me),e.addQuad(Jt(A,Q.x,Q.y,0),Jt(P,ne.x,ne.y,0),Jt(k,ne.x,ne.y,o[Y.b]+4),Jt(F,Q.x,Q.y,o[Y.a]+4),me)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,o,a){e.coord.x=n,e.coord.y=o,e.height=a}prepareEdgePoints(e,n,o,a,u){let h=n[a.a].x,p=n[a.a].y,y=n[a.b].x,x=n[a.b].y,S=o[a.a],E=o[a.b];const A=u(S,0),P=u(E,0);if(A&&P)return this.setElevatedPoint(e[0],h,p,S),this.setElevatedPoint(e[1],y,x,E),!0;if(!A&&!P)return!1;if(A){if(!P){const k=E/(E-S);y=bn(y,h,k),x=bn(x,p,k),E=bn(E,S,k)}}else{const k=S/(S-E);h=bn(h,y,k),p=bn(p,x,k),S=bn(S,E,k)}return this.setElevatedPoint(e[0],h,p,S),this.setElevatedPoint(e[1],y,x,E),!0}prepareEdges(e,n){if(n.length===0)return;n.sort(((p,y)=>p.hash===y.hash?y.polygonIdx-p.polygonIdx:y.hash>p.hash?1:-1));let o=0,a=0,u=0,h=n[o].polygonIdx;do a++,(a===n.length||n[o].hash!==n[a].hash)&&((a-o==1||n[a-1].polygonIdx!==h)&&(u<o&&(n[u]=n[o],n[o]=null),n[u].type="none",u++),o=a,o!==n.length&&(h=n[o].polygonIdx));while(o!==n.length);if(n.splice(u),n.length!==0&&e.length!==0){n.sort(((x,S)=>x.portalHash<S.portalHash?1:-1));let p=0,y=0;for(;p!==n.length&&y!==e.length;){const x=n[p],S=e[y];x.portalHash>S.hash?p++:S.hash>x.portalHash?y++:(x.type=S.type,p++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Pt&&n>=Pt}addFeatureSection(e,n,o,a){return e!==n&&(n=e,o.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),n}sortSubarray(e,n,o,a){const u=e.slice(n,o);u.sort(a),e.splice(n,u.length,...u)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(fl.computePosHash(e))<<32n|BigInt(fl.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Ox,Fx={exports:{}},Bx=(Ox||(Ox=1,(function(i){function e(fe,_e){return fe>_e?1:fe<_e?-1:0}var n=function(fe,_e){fe===void 0&&(fe=e),_e===void 0&&(_e=!1),this._compare=fe,this._root=null,this._size=0,this._noDuplicates=!!_e},o={size:{configurable:!0}};function a(fe,_e,et,_t,Ot){var Ft=Ot-_t;if(Ft>0){var fn=_t+Math.floor(Ft/2),pn={key:_e[fn],data:et[fn],parent:fe};return pn.left=a(pn,_e,et,_t,fn),pn.right=a(pn,_e,et,fn+1,Ot),pn}return null}function u(fe,_e,et,_t,Ot){if(!(et>=_t)){for(var Ft=fe[et+_t>>1],fn=et-1,pn=_t+1;;){do fn++;while(Ot(fe[fn],Ft)<0);do pn--;while(Ot(fe[pn],Ft)>0);if(fn>=pn)break;var $n=fe[fn];fe[fn]=fe[pn],fe[pn]=$n,$n=_e[fn],_e[fn]=_e[pn],_e[pn]=$n}u(fe,_e,et,pn,Ot),u(fe,_e,pn+1,_t,Ot)}}n.prototype.rotateLeft=function(fe){var _e=fe.right;_e&&(fe.right=_e.left,_e.left&&(_e.left.parent=fe),_e.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=_e:fe.parent.right=_e:this._root=_e,_e&&(_e.left=fe),fe.parent=_e},n.prototype.rotateRight=function(fe){var _e=fe.left;_e&&(fe.left=_e.right,_e.right&&(_e.right.parent=fe),_e.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=_e:fe.parent.right=_e:this._root=_e,_e&&(_e.right=fe),fe.parent=_e},n.prototype._splay=function(fe){for(;fe.parent;){var _e=fe.parent;_e.parent?_e.left===fe&&_e.parent.left===_e?(this.rotateRight(_e.parent),this.rotateRight(_e)):_e.right===fe&&_e.parent.right===_e?(this.rotateLeft(_e.parent),this.rotateLeft(_e)):_e.left===fe&&_e.parent.right===_e?(this.rotateRight(_e),this.rotateLeft(_e)):(this.rotateLeft(_e),this.rotateRight(_e)):_e.left===fe?this.rotateRight(_e):this.rotateLeft(_e)}},n.prototype.splay=function(fe){for(var _e,et,_t,Ot,Ft;fe.parent;)(et=(_e=fe.parent).parent)&&et.parent?((_t=et.parent).left===et?_t.left=fe:_t.right=fe,fe.parent=_t):(fe.parent=null,this._root=fe),Ot=fe.left,Ft=fe.right,fe===_e.left?(et&&(et.left===_e?(_e.right?(et.left=_e.right,et.left.parent=et):et.left=null,_e.right=et,et.parent=_e):(Ot?(et.right=Ot,Ot.parent=et):et.right=null,fe.left=et,et.parent=fe)),Ft?(_e.left=Ft,Ft.parent=_e):_e.left=null,fe.right=_e,_e.parent=fe):(et&&(et.right===_e?(_e.left?(et.right=_e.left,et.right.parent=et):et.right=null,_e.left=et,et.parent=_e):(Ft?(et.left=Ft,Ft.parent=et):et.left=null,fe.right=et,et.parent=fe)),Ot?(_e.right=Ot,Ot.parent=_e):_e.right=null,fe.left=_e,_e.parent=fe)},n.prototype.replace=function(fe,_e){fe.parent?fe===fe.parent.left?fe.parent.left=_e:fe.parent.right=_e:this._root=_e,_e&&(_e.parent=fe.parent)},n.prototype.minNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.left;)fe=fe.left;return fe},n.prototype.maxNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.right;)fe=fe.right;return fe},n.prototype.insert=function(fe,_e){var et=this._root,_t=null,Ot=this._compare;if(this._noDuplicates)for(;et;){if(_t=et,Ot(et.key,fe)===0)return;et=Ot(et.key,fe)<0?et.right:et.left}else for(;et;)_t=et,et=Ot(et.key,fe)<0?et.right:et.left;return et={key:fe,data:_e,left:null,right:null,parent:_t},_t?Ot(_t.key,et.key)<0?_t.right=et:_t.left=et:this._root=et,this.splay(et),this._size++,et},n.prototype.find=function(fe){for(var _e=this._root,et=this._compare;_e;){var _t=et(_e.key,fe);if(_t<0)_e=_e.right;else{if(!(_t>0))return _e;_e=_e.left}}return null},n.prototype.contains=function(fe){for(var _e=this._root,et=this._compare;_e;){var _t=et(fe,_e.key);if(_t===0)return!0;_e=_t<0?_e.left:_e.right}return!1},n.prototype.remove=function(fe){var _e=this.find(fe);if(!_e)return!1;if(this.splay(_e),_e.left)if(_e.right){var et=this.minNode(_e.right);et.parent!==_e&&(this.replace(et,et.right),et.right=_e.right,et.right.parent=et),this.replace(_e,et),et.left=_e.left,et.left.parent=et}else this.replace(_e,_e.left);else this.replace(_e,_e.right);return this._size--,!0},n.prototype.removeNode=function(fe){if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var _e=this.minNode(fe.right);_e.parent!==fe&&(this.replace(_e,_e.right),_e.right=fe.right,_e.right.parent=_e),this.replace(fe,_e),_e.left=fe.left,_e.left.parent=_e}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},n.prototype.erase=function(fe){var _e=this.find(fe);if(_e){this.splay(_e);var et=_e.left,_t=_e.right,Ot=null;et&&(et.parent=null,Ot=this.maxNode(et),this.splay(Ot),this._root=Ot),_t&&(et?Ot.right=_t:this._root=_t,_t.parent=Ot),this._size--}},n.prototype.pop=function(){var fe=this._root,_e=null;if(fe){for(;fe.left;)fe=fe.left;_e={key:fe.key,data:fe.data},this.remove(fe.key)}return _e},n.prototype.next=function(fe){var _e=fe;if(_e)if(_e.right)for(_e=_e.right;_e&&_e.left;)_e=_e.left;else for(_e=fe.parent;_e&&_e.right===fe;)fe=_e,_e=_e.parent;return _e},n.prototype.prev=function(fe){var _e=fe;if(_e)if(_e.left)for(_e=_e.left;_e&&_e.right;)_e=_e.right;else for(_e=fe.parent;_e&&_e.left===fe;)fe=_e,_e=_e.parent;return _e},n.prototype.forEach=function(fe){for(var _e=this._root,et=[],_t=!1,Ot=0;!_t;)_e?(et.push(_e),_e=_e.left):et.length>0?(fe(_e=et.pop(),Ot++),_e=_e.right):_t=!0;return this},n.prototype.range=function(fe,_e,et,_t){for(var Ot=[],Ft=this._compare,fn=this._root;Ot.length!==0||fn;)if(fn)Ot.push(fn),fn=fn.left;else{if(Ft((fn=Ot.pop()).key,_e)>0)break;if(Ft(fn.key,fe)>=0&&et.call(_t,fn))return this;fn=fn.right}return this},n.prototype.keys=function(){for(var fe=this._root,_e=[],et=[],_t=!1;!_t;)fe?(_e.push(fe),fe=fe.left):_e.length>0?(fe=_e.pop(),et.push(fe.key),fe=fe.right):_t=!0;return et},n.prototype.values=function(){for(var fe=this._root,_e=[],et=[],_t=!1;!_t;)fe?(_e.push(fe),fe=fe.left):_e.length>0?(fe=_e.pop(),et.push(fe.data),fe=fe.right):_t=!0;return et},n.prototype.at=function(fe){for(var _e=this._root,et=[],_t=!1,Ot=0;!_t;)if(_e)et.push(_e),_e=_e.left;else if(et.length>0){if(_e=et.pop(),Ot===fe)return _e;Ot++,_e=_e.right}else _t=!0;return null},n.prototype.load=function(fe,_e,et){if(fe===void 0&&(fe=[]),_e===void 0&&(_e=[]),et===void 0&&(et=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var _t=fe.length;return et&&u(fe,_e,0,_t-1,this._compare),this._root=a(null,fe,_e,0,_t),this._size=_t,this},n.prototype.min=function(){var fe=this.minNode(this._root);return fe?fe.key:null},n.prototype.max=function(){var fe=this.maxNode(this._root);return fe?fe.key:null},n.prototype.isEmpty=function(){return this._root===null},o.size.get=function(){return this._size},n.createTree=function(fe,_e,et,_t,Ot){return new n(et,Ot).load(fe,_e,_t)},Object.defineProperties(n.prototype,o);var h=0,p=1,y=2,x=3,S=0,E=1,A=2,P=3;function k(fe,_e,et){_e===null?(fe.inOut=!1,fe.otherInOut=!0):(fe.isSubject===_e.isSubject?(fe.inOut=!_e.inOut,fe.otherInOut=_e.otherInOut):(fe.inOut=!_e.otherInOut,fe.otherInOut=_e.isVertical()?!_e.inOut:_e.inOut),_e&&(fe.prevInResult=!F(_e,et)||_e.isVertical()?_e.prevInResult:_e));var _t=F(fe,et);fe.resultTransition=_t?(function(Ot,Ft){var fn,pn=!Ot.inOut,$n=!Ot.otherInOut;switch(Ft){case S:fn=pn&&$n;break;case E:fn=pn||$n;break;case P:fn=pn^$n;break;case A:fn=Ot.isSubject?pn&&!$n:$n&&!pn}return fn?1:-1})(fe,et):0}function F(fe,_e){switch(fe.type){case h:switch(_e){case S:return!fe.otherInOut;case E:return fe.otherInOut;case A:return fe.isSubject&&fe.otherInOut||!fe.isSubject&&!fe.otherInOut;case P:return!0}break;case y:return _e===S||_e===E;case x:return _e===A;case p:return!1}return!1}var G=function(fe,_e,et,_t,Ot){this.left=_e,this.point=fe,this.otherEvent=et,this.isSubject=_t,this.type=Ot||h,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},U={inResult:{configurable:!0}};function Y(fe,_e){return fe[0]===_e[0]&&fe[1]===_e[1]}G.prototype.isBelow=function(fe){var _e=this.point,et=this.otherEvent.point;return this.left?(_e[0]-fe[0])*(et[1]-fe[1])-(et[0]-fe[0])*(_e[1]-fe[1])>0:(et[0]-fe[0])*(_e[1]-fe[1])-(_e[0]-fe[0])*(et[1]-fe[1])>0},G.prototype.isAbove=function(fe){return!this.isBelow(fe)},G.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},U.inResult.get=function(){return this.resultTransition!==0},G.prototype.clone=function(){var fe=new G(this.point,this.left,this.otherEvent,this.isSubject,this.type);return fe.contourId=this.contourId,fe.resultTransition=this.resultTransition,fe.prevInResult=this.prevInResult,fe.isExteriorRing=this.isExteriorRing,fe.inOut=this.inOut,fe.otherInOut=this.otherInOut,fe},Object.defineProperties(G.prototype,U);var Q=11102230246251565e-32,ne=134217729,me=(3+8*Q)*Q;function de(fe,_e,et,_t,Ot){var Ft,fn,pn,$n,Xn=_e[0],Jn=_t[0],di=0,Cn=0;Jn>Xn==Jn>-Xn?(Ft=Xn,Xn=_e[++di]):(Ft=Jn,Jn=_t[++Cn]);var Ln=0;if(di<fe&&Cn<et)for(Jn>Xn==Jn>-Xn?(pn=Ft-((fn=Xn+Ft)-Xn),Xn=_e[++di]):(pn=Ft-((fn=Jn+Ft)-Jn),Jn=_t[++Cn]),Ft=fn,pn!==0&&(Ot[Ln++]=pn);di<fe&&Cn<et;)Jn>Xn==Jn>-Xn?(pn=Ft-((fn=Ft+Xn)-($n=fn-Ft))+(Xn-$n),Xn=_e[++di]):(pn=Ft-((fn=Ft+Jn)-($n=fn-Ft))+(Jn-$n),Jn=_t[++Cn]),Ft=fn,pn!==0&&(Ot[Ln++]=pn);for(;di<fe;)pn=Ft-((fn=Ft+Xn)-($n=fn-Ft))+(Xn-$n),Xn=_e[++di],Ft=fn,pn!==0&&(Ot[Ln++]=pn);for(;Cn<et;)pn=Ft-((fn=Ft+Jn)-($n=fn-Ft))+(Jn-$n),Jn=_t[++Cn],Ft=fn,pn!==0&&(Ot[Ln++]=pn);return Ft===0&&Ln!==0||(Ot[Ln++]=Ft),Ln}function ve(fe){return new Float64Array(fe)}var Te=33306690738754716e-32,Ie=22204460492503146e-32,qe=11093356479670487e-47,ke=ve(4),Qe=ve(8),ut=ve(12),ht=ve(16),gt=ve(4);function vt(fe,_e,et){var _t=(function(Ot,Ft,fn,pn,$n,Xn){var Jn=(Ft-Xn)*(fn-$n),di=(Ot-$n)*(pn-Xn),Cn=Jn-di;if(Jn===0||di===0||Jn>0!=di>0)return Cn;var Ln=Math.abs(Jn+di);return Math.abs(Cn)>=Te*Ln?Cn:-(function(Pi,Li,Di,Wi,nr,Ki,Ni){var Ui,Yn,vi,Er,Tn,fi,er,rr,hr,Gr,sr,Sn,Ar,qi,yr,bo,Do,ao,lo=Pi-nr,Po=Di-nr,Ea=Li-Ki,ar=Wi-Ki;ke[0]=(yr=(rr=lo-(er=(fi=ne*lo)-(fi-lo)))*(Gr=ar-(hr=(fi=ne*ar)-(fi-ar)))-((qi=lo*ar)-er*hr-rr*hr-er*Gr))-((sr=yr-(Do=(rr=Ea-(er=(fi=ne*Ea)-(fi-Ea)))*(Gr=Po-(hr=(fi=ne*Po)-(fi-Po)))-((bo=Ea*Po)-er*hr-rr*hr-er*Gr)))+(Tn=yr-sr))+(Tn-Do),ke[1]=(Ar=qi-((Sn=qi+sr)-(Tn=Sn-qi))+(sr-Tn))-((sr=Ar-bo)+(Tn=Ar-sr))+(Tn-bo),ke[2]=Sn-((ao=Sn+sr)-(Tn=ao-Sn))+(sr-Tn),ke[3]=ao;var Br=(function(fh,hs){for(var ha=hs[0],ml=1;ml<4;ml++)ha+=hs[ml];return ha})(0,ke),$r=Ie*Ni;if(Br>=$r||-Br>=$r||(Ui=Pi-(lo+(Tn=Pi-lo))+(Tn-nr),vi=Di-(Po+(Tn=Di-Po))+(Tn-nr),Yn=Li-(Ea+(Tn=Li-Ea))+(Tn-Ki),Er=Wi-(ar+(Tn=Wi-ar))+(Tn-Ki),Ui===0&&Yn===0&&vi===0&&Er===0)||($r=qe*Ni+me*Math.abs(Br),(Br+=lo*Er+ar*Ui-(Ea*vi+Po*Yn))>=$r||-Br>=$r))return Br;gt[0]=(yr=(rr=Ui-(er=(fi=ne*Ui)-(fi-Ui)))*(Gr=ar-(hr=(fi=ne*ar)-(fi-ar)))-((qi=Ui*ar)-er*hr-rr*hr-er*Gr))-((sr=yr-(Do=(rr=Yn-(er=(fi=ne*Yn)-(fi-Yn)))*(Gr=Po-(hr=(fi=ne*Po)-(fi-Po)))-((bo=Yn*Po)-er*hr-rr*hr-er*Gr)))+(Tn=yr-sr))+(Tn-Do),gt[1]=(Ar=qi-((Sn=qi+sr)-(Tn=Sn-qi))+(sr-Tn))-((sr=Ar-bo)+(Tn=Ar-sr))+(Tn-bo),gt[2]=Sn-((ao=Sn+sr)-(Tn=ao-Sn))+(sr-Tn),gt[3]=ao;var Ha=de(4,ke,4,gt,Qe);gt[0]=(yr=(rr=lo-(er=(fi=ne*lo)-(fi-lo)))*(Gr=Er-(hr=(fi=ne*Er)-(fi-Er)))-((qi=lo*Er)-er*hr-rr*hr-er*Gr))-((sr=yr-(Do=(rr=Ea-(er=(fi=ne*Ea)-(fi-Ea)))*(Gr=vi-(hr=(fi=ne*vi)-(fi-vi)))-((bo=Ea*vi)-er*hr-rr*hr-er*Gr)))+(Tn=yr-sr))+(Tn-Do),gt[1]=(Ar=qi-((Sn=qi+sr)-(Tn=Sn-qi))+(sr-Tn))-((sr=Ar-bo)+(Tn=Ar-sr))+(Tn-bo),gt[2]=Sn-((ao=Sn+sr)-(Tn=ao-Sn))+(sr-Tn),gt[3]=ao;var To=de(Ha,Qe,4,gt,ut);gt[0]=(yr=(rr=Ui-(er=(fi=ne*Ui)-(fi-Ui)))*(Gr=Er-(hr=(fi=ne*Er)-(fi-Er)))-((qi=Ui*Er)-er*hr-rr*hr-er*Gr))-((sr=yr-(Do=(rr=Yn-(er=(fi=ne*Yn)-(fi-Yn)))*(Gr=vi-(hr=(fi=ne*vi)-(fi-vi)))-((bo=Yn*vi)-er*hr-rr*hr-er*Gr)))+(Tn=yr-sr))+(Tn-Do),gt[1]=(Ar=qi-((Sn=qi+sr)-(Tn=Sn-qi))+(sr-Tn))-((sr=Ar-bo)+(Tn=Ar-sr))+(Tn-bo),gt[2]=Sn-((ao=Sn+sr)-(Tn=ao-Sn))+(sr-Tn),gt[3]=ao;var zc=de(To,ut,4,gt,ht);return ht[zc-1]})(Ot,Ft,fn,pn,$n,Xn,Ln)})(fe[0],fe[1],_e[0],_e[1],et[0],et[1]);return _t>0?-1:_t<0?1:0}function ft(fe,_e){var et=fe.point,_t=_e.point;return et[0]>_t[0]?1:et[0]<_t[0]?-1:et[1]!==_t[1]?et[1]>_t[1]?1:-1:(function(Ot,Ft,fn,pn){return Ot.left!==Ft.left?Ot.left?1:-1:vt(fn,Ot.otherEvent.point,Ft.otherEvent.point)!==0?Ot.isBelow(Ft.otherEvent.point)?-1:1:!Ot.isSubject&&Ft.isSubject?1:-1})(fe,_e,et)}function pt(fe,_e,et){var _t=new G(_e,!1,fe,fe.isSubject),Ot=new G(_e,!0,fe.otherEvent,fe.isSubject);return Y(fe.point,fe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",fe),_t.contourId=Ot.contourId=fe.contourId,ft(Ot,fe.otherEvent)>0&&(fe.otherEvent.left=!0,Ot.left=!1),fe.otherEvent.otherEvent=Ot,fe.otherEvent=_t,et.push(Ot),et.push(_t),et}function Je(fe,_e){return fe[0]*_e[1]-fe[1]*_e[0]}function Ye(fe,_e){return fe[0]*_e[0]+fe[1]*_e[1]}function mt(fe,_e,et){var _t=(function($n,Xn,Jn,di,Cn){var Ln=[Xn[0]-$n[0],Xn[1]-$n[1]],Pi=[di[0]-Jn[0],di[1]-Jn[1]];function Li(fi,er,rr){return[fi[0]+er*rr[0],fi[1]+er*rr[1]]}var Di=[Jn[0]-$n[0],Jn[1]-$n[1]],Wi=Je(Ln,Pi),nr=Wi*Wi,Ki=Ye(Ln,Ln);if(nr>0){var Ni=Je(Di,Pi)/Wi;if(Ni<0||Ni>1)return null;var Ui=Je(Di,Ln)/Wi;return Ui<0||Ui>1?null:Ni===0||Ni===1?[Li($n,Ni,Ln)]:Ui===0||Ui===1?[Li(Jn,Ui,Pi)]:[Li($n,Ni,Ln)]}if((nr=(Wi=Je(Di,Ln))*Wi)>0)return null;var Yn=Ye(Ln,Di)/Ki,vi=Yn+Ye(Ln,Pi)/Ki,Er=Math.min(Yn,vi),Tn=Math.max(Yn,vi);return Er<=1&&Tn>=0?Er===1?[Li($n,Er>0?Er:0,Ln)]:Tn===0?[Li($n,Tn<1?Tn:1,Ln)]:[Li($n,Er>0?Er:0,Ln),Li($n,Tn<1?Tn:1,Ln)]:null})(fe.point,fe.otherEvent.point,_e.point,_e.otherEvent.point),Ot=_t?_t.length:0;if(Ot===0||Ot===1&&(Y(fe.point,_e.point)||Y(fe.otherEvent.point,_e.otherEvent.point))||Ot===2&&fe.isSubject===_e.isSubject)return 0;if(Ot===1)return Y(fe.point,_t[0])||Y(fe.otherEvent.point,_t[0])||pt(fe,_t[0],et),Y(_e.point,_t[0])||Y(_e.otherEvent.point,_t[0])||pt(_e,_t[0],et),1;var Ft=[],fn=!1,pn=!1;return Y(fe.point,_e.point)?fn=!0:ft(fe,_e)===1?Ft.push(_e,fe):Ft.push(fe,_e),Y(fe.otherEvent.point,_e.otherEvent.point)?pn=!0:ft(fe.otherEvent,_e.otherEvent)===1?Ft.push(_e.otherEvent,fe.otherEvent):Ft.push(fe.otherEvent,_e.otherEvent),fn&&pn||fn?(_e.type=p,fe.type=_e.inOut===fe.inOut?y:x,fn&&!pn&&pt(Ft[1].otherEvent,Ft[0].point,et),2):pn?(pt(Ft[0],Ft[1].point,et),3):Ft[0]!==Ft[3].otherEvent?(pt(Ft[0],Ft[1].point,et),pt(Ft[1],Ft[2].point,et),3):(pt(Ft[0],Ft[1].point,et),pt(Ft[3].otherEvent,Ft[2].point,et),3)}function zt(fe,_e){if(fe===_e)return 0;if(vt(fe.point,fe.otherEvent.point,_e.point)!==0||vt(fe.point,fe.otherEvent.point,_e.otherEvent.point)!==0)return Y(fe.point,_e.point)?fe.isBelow(_e.otherEvent.point)?-1:1:fe.point[0]===_e.point[0]?fe.point[1]<_e.point[1]?-1:1:ft(fe,_e)===1?_e.isAbove(fe.point)?-1:1:fe.isBelow(_e.point)?-1:1;if(fe.isSubject!==_e.isSubject)return fe.isSubject?-1:1;var et=fe.point,_t=_e.point;return et[0]===_t[0]&&et[1]===_t[1]?(et=fe.otherEvent.point)[0]===(_t=_e.otherEvent.point)[0]&&et[1]===_t[1]?0:fe.contourId>_e.contourId?1:-1:ft(fe,_e)===1?1:-1}var St=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function hn(fe,_e,et,_t){var Ot,Ft=fe+1,fn=_e[fe].point,pn=_e.length;for(Ft<pn&&(Ot=_e[Ft].point);Ft<pn&&Ot[0]===fn[0]&&Ot[1]===fn[1];){if(!et[Ft])return Ft;++Ft<pn&&(Ot=_e[Ft].point)}for(Ft=fe-1;et[Ft]&&Ft>_t;)Ft--;return Ft}St.prototype.isExterior=function(){return this.holeOf==null};var Vt=nn,Zt=nn;function nn(fe,_e){if(!(this instanceof nn))return new nn(fe,_e);if(this.data=fe||[],this.length=this.data.length,this.compare=_e||Qn,this.length>0)for(var et=(this.length>>1)-1;et>=0;et--)this._down(et)}function Qn(fe,_e){return fe<_e?-1:fe>_e?1:0}nn.prototype={push:function(fe){this.data.push(fe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var fe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),fe}},peek:function(){return this.data[0]},_up:function(fe){for(var _e=this.data,et=this.compare,_t=_e[fe];fe>0;){var Ot=fe-1>>1,Ft=_e[Ot];if(et(_t,Ft)>=0)break;_e[fe]=Ft,fe=Ot}_e[fe]=_t},_down:function(fe){for(var _e=this.data,et=this.compare,_t=this.length>>1,Ot=_e[fe];fe<_t;){var Ft=1+(fe<<1),fn=Ft+1,pn=_e[Ft];if(fn<this.length&&et(_e[fn],pn)<0&&(Ft=fn,pn=_e[fn]),et(pn,Ot)>=0)break;_e[fe]=pn,fe=Ft}_e[fe]=Ot}},Vt.default=Zt;var It=Math.max,on=Math.min,Dn=0;function gi(fe,_e,et,_t,Ot,Ft){var fn,pn,$n,Xn,Jn,di;for(fn=0,pn=fe.length-1;fn<pn;fn++)if(Xn=fe[fn+1],Jn=new G($n=fe[fn],!1,void 0,_e),di=new G(Xn,!1,Jn,_e),Jn.otherEvent=di,$n[0]!==Xn[0]||$n[1]!==Xn[1]){Jn.contourId=di.contourId=et,Ft||(Jn.isExteriorRing=!1,di.isExteriorRing=!1),ft(Jn,di)>0?di.left=!0:Jn.left=!0;var Cn=$n[0],Ln=$n[1];Ot[0]=on(Ot[0],Cn),Ot[1]=on(Ot[1],Ln),Ot[2]=It(Ot[2],Cn),Ot[3]=It(Ot[3],Ln),_t.push(Jn),_t.push(di)}}var bi=[];function qn(fe,_e,et){typeof fe[0][0][0]=="number"&&(fe=[fe]),typeof _e[0][0][0]=="number"&&(_e=[_e]);var _t=(function(Ln,Pi,Li){var Di=null;return Ln.length*Pi.length==0&&(Li===S?Di=bi:Li===A?Di=Ln:Li!==E&&Li!==P||(Di=Ln.length===0?Pi:Ln)),Di})(fe,_e,et);if(_t)return _t===bi?null:_t;var Ot=[1/0,1/0,-1/0,-1/0],Ft=[1/0,1/0,-1/0,-1/0],fn=(function(Ln,Pi,Li,Di,Wi){var nr,Ki,Ni,Ui,Yn,vi,Er=new Vt(null,ft);for(Ni=0,Ui=Ln.length;Ni<Ui;Ni++)for(Yn=0,vi=(nr=Ln[Ni]).length;Yn<vi;Yn++)(Ki=Yn===0)&&Dn++,gi(nr[Yn],!0,Dn,Er,Li,Ki);for(Ni=0,Ui=Pi.length;Ni<Ui;Ni++)for(Yn=0,vi=(nr=Pi[Ni]).length;Yn<vi;Yn++)Ki=Yn===0,Wi===A&&(Ki=!1),Ki&&Dn++,gi(nr[Yn],!1,Dn,Er,Di,Ki);return Er})(fe,_e,Ot,Ft,et);if(_t=(function(Ln,Pi,Li,Di,Wi){var nr=null;return(Li[0]>Di[2]||Di[0]>Li[2]||Li[1]>Di[3]||Di[1]>Li[3])&&(Wi===S?nr=bi:Wi===A?nr=Ln:Wi!==E&&Wi!==P||(nr=Ln.concat(Pi))),nr})(fe,_e,Ot,Ft,et))return _t===bi?null:_t;for(var pn=(function(Ln){var Pi,Li,Di=(function(Ni){var Ui,Yn,vi,Er,Tn=[];for(Yn=0,vi=Ni.length;Yn<vi;Yn++)((Ui=Ni[Yn]).left&&Ui.inResult||!Ui.left&&Ui.otherEvent.inResult)&&Tn.push(Ui);for(var fi=!1;!fi;)for(fi=!0,Yn=0,vi=Tn.length;Yn<vi;Yn++)Yn+1<vi&&ft(Tn[Yn],Tn[Yn+1])===1&&(Er=Tn[Yn],Tn[Yn]=Tn[Yn+1],Tn[Yn+1]=Er,fi=!1);for(Yn=0,vi=Tn.length;Yn<vi;Yn++)(Ui=Tn[Yn]).otherPos=Yn;for(Yn=0,vi=Tn.length;Yn<vi;Yn++)(Ui=Tn[Yn]).left||(Er=Ui.otherPos,Ui.otherPos=Ui.otherEvent.otherPos,Ui.otherEvent.otherPos=Er);return Tn})(Ln),Wi={},nr=[],Ki=function(){if(!Wi[Pi]){var Ni=nr.length,Ui=(function(Tn,fi,er){var rr=new St;if(Tn.prevInResult!=null){var hr=Tn.prevInResult,Gr=hr.outputContourId;if(hr.resultTransition>0){var sr=fi[Gr];if(sr.holeOf!=null){var Sn=sr.holeOf;fi[Sn].holeIds.push(er),rr.holeOf=Sn,rr.depth=fi[Gr].depth}else fi[Gr].holeIds.push(er),rr.holeOf=Gr,rr.depth=fi[Gr].depth+1}else rr.holeOf=null,rr.depth=fi[Gr].depth}else rr.holeOf=null,rr.depth=0;return rr})(Di[Pi],nr,Ni),Yn=function(Tn){Wi[Tn]=!0,Tn<Di.length&&Di[Tn]&&(Di[Tn].outputContourId=Ni)},vi=Pi,Er=Pi;for(Ui.points.push(Di[Pi].point);Yn(vi),Yn(vi=Di[vi].otherPos),Ui.points.push(Di[vi].point),!((vi=hn(vi,Di,Wi,Er))==Er||vi>=Di.length)&&Di[vi];);nr.push(Ui)}};for(Pi=0,Li=Di.length;Pi<Li;Pi++)Ki();return nr})((function(Ln,Pi,Li,Di,Wi,nr){for(var Ki,Ni,Ui,Yn=new n(zt),vi=[],Er=Math.min(Di[2],Wi[2]);Ln.length!==0;){var Tn=Ln.pop();if(vi.push(Tn),nr===S&&Tn.point[0]>Er||nr===A&&Tn.point[0]>Di[2])break;if(Tn.left){Ni=Ki=Yn.insert(Tn),Ki=Ki!==(Ui=Yn.minNode())?Yn.prev(Ki):null,Ni=Yn.next(Ni);var fi=Ki?Ki.key:null;if(k(Tn,fi,nr),Ni&&mt(Tn,Ni.key,Ln)===2&&(k(Tn,fi,nr),k(Ni.key,Tn,nr)),Ki&&mt(Ki.key,Tn,Ln)===2){var er=Ki;k(fi,(er=er!==Ui?Yn.prev(er):null)?er.key:null,nr),k(Tn,fi,nr)}}else Ni=Ki=Yn.find(Tn=Tn.otherEvent),Ki&&Ni&&(Ki=Ki!==Ui?Yn.prev(Ki):null,Ni=Yn.next(Ni),Yn.remove(Tn),Ni&&Ki&&mt(Ki.key,Ni.key,Ln))}return vi})(fn,0,0,Ot,Ft,et)),$n=[],Xn=0;Xn<pn.length;Xn++){var Jn=pn[Xn];if(Jn.isExterior()){for(var di=[Jn.points],Cn=0;Cn<Jn.holeIds.length;Cn++)di.push(pn[Jn.holeIds[Cn]].points);$n.push(di)}}return $n}var Yi={UNION:E,DIFFERENCE:A,INTERSECTION:S,XOR:P};i.diff=function(fe,_e){return qn(fe,_e,A)},i.intersection=function(fe,_e){return qn(fe,_e,S)},i.operations=Yi,i.union=function(fe,_e){return qn(fe,_e,E)},i.xor=function(fe,_e){return qn(fe,_e,P)},Object.defineProperty(i,"__esModule",{value:!0})})(Fx.exports)),Fx.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ig(i,e,n,o){const a=[],u=o===0?(h,p,y,x,S,E)=>{h.push(new ct(E,y+(E-p)/(x-p)*(S-y)))}:(h,p,y,x,S,E)=>{h.push(new ct(p+(E-y)/(S-y)*(x-p),E))};for(const h of i){const p=[];for(const y of h){if(y.length<=2)continue;const x=[];for(let A=0;A<y.length-1;A++){const P=y[A].x,k=y[A].y,F=y[A+1].x,G=y[A+1].y,U=o===0?P:k,Y=o===0?F:G;U<e?Y>e&&u(x,P,k,F,G,e):U>n?Y<n&&u(x,P,k,F,G,n):x.push(y[A]),Y<e&&U>=e&&u(x,P,k,F,G,e),Y>n&&U<=n&&u(x,P,k,F,G,n)}let S=y[y.length-1];const E=o===0?S.x:S.y;E>=e&&E<=n&&x.push(S),x.length&&(S=x[x.length-1],x[0].x===S.x&&x[0].y===S.y||x.push(x[0]),p.push(x))}p.length&&a.push(p)}return a}function N2(i,e){const n=ny(i),o=ny([e]),a=Bx.intersection(n,o);return a==null?[]:Nx(a)}function j2(i,e){let o=ny(i,65536);const a=[];for(;e.valid();e.next()){const[u,h]=e.get(),p=u.x*65536,y=u.y*65536,x=h.x*65536,S=h.y*65536,E=x-p,A=S-y,P=Math.hypot(E,A);if(P===0)continue;const k=Math.trunc(A/P*3),F=-Math.trunc(E/P*3);a.push([[[p,y],[x,S],[x+k,S+F],[p+k,y+F],[p,y]]])}return a.length>0&&(o=Bx.diff(o,a)),Nx(o,1/65536)}function ny(i,e=1){return[i.map((n=>n.map((o=>[o.x*e,o.y*e]))))]}function Nx(i,e=1){return i.map((n=>n.map(((o,a)=>{const u=o.map((h=>new ct(h[0]*e,h[1]*e).round()));return a>0&&u.reverse(),u}))))}class iy{constructor(e,n){this.layoutVertexArray=new Ac,this.indexArray=new Jr,this.lineIndexArray=new sa,this.triangleSegments=new ki,this.lineSegments=new ki,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new sl)}update(e,n,o,a,u,h,p,y){this.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,E2.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,o,a,u,h,p){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,o,a,u,h,void 0,p)}}class ry{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new iy(e,!1),this.elevationBufferData=new iy(e,!0),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,o,a){}populate(e,n,o,a){this.hasPattern=ey("fill",this.layers,this.pixelRatio,n);const u=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:p,id:y,index:x,sourceLayerIndex:S}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Re(p,E);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),A,o))continue;const P=u?u.evaluate(A,{},o,n.availableImages):void 0,k={id:y,properties:p.properties,type:p.type,sourceLayerIndex:S,index:x,geometry:E?A.geometry:xe(p,o,a),patterns:{},sortKey:P};h.push(k)}u&&h.sort(((p,y)=>p.sortKey-y.sortKey));for(const p of h){const{geometry:y,index:x,sourceLayerIndex:S}=p;if(this.hasPattern){const E=ty("fill",this.layers,p,this.zoom,this.pixelRatio,n);this.patternFeatures.push(E)}else this.addFeature(p,y,x,o,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[x].feature,y,x,S,this.index)}}update(e,n,o,a,u,h,p){this.bufferData.update(e,n,o,a,u,h,p,this.worldview),this.elevationBufferData.update(e,n,o,a,u,h,p,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,o,a,u,h,p,this.worldview)}addFeatures(e,n,o,a,u,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,a,h,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,o,a,u,h=[],p,y){const x=Am(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,x,a,o,y):this.addGeometry(x,this.bufferData),this.bufferData.populatePaintArrays(e,o,u,h,a,p,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,u,h,a,p,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,o,a,u){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,o,a,u,this.worldview))}addElevatedRoadFeature(e,n,o,a,u){const h=new Array,p=Ai.getElevationFeature(e,u);if(!p)return void this.addGeometry(n,this.bufferData);{const x=this.clipPolygonsToTile(n,1);x.length>0&&h.push({polygons:x,elevationFeature:p,elevationTileID:o})}const y={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:a};for(const x of h)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new fl(x.elevationTileID,this.layers,this.zoom,this.lut));const E=x.elevationFeature.isTunnel();let A=0;e.properties.hasOwnProperty(Ue)&&(A=+e.properties[Ue]);for(const P of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,P,E,x.elevationFeature,A)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const S=new ji(o,x.elevationTileID);this.addElevatedGeometry(x.polygons,S,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,y)}}addElevatedGeometry(e,n,o,a,u,h){const p={elevation:o,elevationSampler:n,bias:a,index:u,featureInfo:h},[y,x]=this.addGeometry(e,this.elevationBufferData,p);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,n,o){let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,h=null;o&&(h=o.elevationSampler.constantElevation(o.elevation,o.bias),h!=null&&(a=h,u=h));const p=(y,x,S)=>{if(o!=null)if(x.push(y),h!=null)n.elevatedLayoutVertexArray.emplaceBack(h),S.push(h);else{const E=o.elevationSampler.pointElevation(y,o.elevation,o.bias);n.elevatedLayoutVertexArray.emplaceBack(E),S.push(E),a=Math.min(a,E),u=Math.max(u,E)}};for(const y of e){let x=0;for(const Q of y)x+=Q.length;const S=n.triangleSegments.prepareSegment(x,n.layoutVertexArray,n.indexArray),E=S.vertexLength,A=[],P=[],k=[],F=[],G=[],U=n.layoutVertexArray.length;for(const Q of y){if(Q.length===0)continue;Q!==y[0]&&P.push(A.length/2);const ne=n.lineSegments.prepareSegment(Q.length,n.layoutVertexArray,n.lineIndexArray),me=ne.vertexLength;o&&G.push(n.layoutVertexArray.length-U),p(Q[0],k,F),n.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),n.lineIndexArray.emplaceBack(me+Q.length-1,me),A.push(Q[0].x),A.push(Q[0].y);for(let de=1;de<Q.length;de++)p(Q[de],k,F),n.layoutVertexArray.emplaceBack(Q[de].x,Q[de].y),n.lineIndexArray.emplaceBack(me+de-1,me+de),A.push(Q[de].x),A.push(Q[de].y);ne.vertexLength+=Q.length,ne.primitiveLength+=Q.length}const Y=Fp(A,P);for(let Q=0;Q<Y.length;Q+=3)n.indexArray.emplaceBack(E+Y[Q],E+Y[Q+1],E+Y[Q+2]);if(Y.length>0&&o&&this.elevationMode==="hd-road-base"){const Q=o.elevation.isTunnel(),ne=o.elevation.safeArea,me=this.elevatedStructures.addVertices(k,F);this.elevatedStructures.addTriangles(Y,me,Q);const de=G.length;if(de>0){for(let ve=0;ve<de-1;ve++)this.elevatedStructures.addRenderableRing(o.index,G[ve]+me,G[ve+1]-G[ve],Q,ne,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,G[de-1]+me,k.length-G[de-1],Q,ne,o.featureInfo)}}S.vertexLength+=x,S.primitiveLength+=Y.length/3}return[a,u]}prepareElevatedPolygons(e,n,o){const a=1/q(o),u=[];for(const h of e){const p=j2(h,new wi(n,a));u.push(...p)}return u}clipPolygonsToTile(e,n){const o=-n,a=-n,u=Pt+n,h=Pt+n;let p=0;const y=[],x=[];for(;p<e.length;p++){const A=e[p],P=ma(A);(P.min.x>=o&&P.max.x<=u&&P.min.y>=a&&P.max.y<=h?y:x).push(A)}if(y.length===e.length)return e;const S=[new ct(o,a),new ct(u,a),new ct(u,h),new ct(o,h),new ct(o,a)],E=y;for(const A of x)E.push(...N2(A,S));return E}}let jx,Vx,Ux,Gx;qt(ry,"FillBucket",{omit:["layers","patternFeatures"]}),qt(iy,"FillBufferData"),qt(fl,"ElevatedStructures");class Ag{constructor(e,n,o,a){if(this.triangleCount=n.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,h]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const A=e[E];u.x=Math.min(u.x,A.x),u.y=Math.min(u.y,A.y),h.x=Math.max(h.x,A.x),h.y=Math.max(h.y,A.y)}if(a){const E=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/a);o=Math.max(o,E)}if(o===0)return;this.min=u,this.max=h;const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const y=Math.max(p.x,p.y)/o;this.cellsX=Math.max(1,Math.ceil(p.x/y)),this.cellsY=Math.max(1,Math.ceil(p.y/y)),this.xScale=1/y,this.yScale=1/y;const x=[];for(let E=0;E<this.triangleCount;E++){const A=e[n[3*E+0]].sub(this.min),P=e[n[3*E+1]].sub(this.min),k=e[n[3*E+2]].sub(this.min),F=hh(Math.floor(Math.min(A.x,P.x,k.x)),this.xScale,this.cellsX),G=hh(Math.floor(Math.max(A.x,P.x,k.x)),this.xScale,this.cellsX),U=hh(Math.floor(Math.min(A.y,P.y,k.y)),this.yScale,this.cellsY),Y=hh(Math.floor(Math.max(A.y,P.y,k.y)),this.yScale,this.cellsY),Q=new ct(0,0),ne=new ct(0,0),me=new ct(0,0),de=new ct(0,0);for(let ve=U;ve<=Y;++ve){Q.y=ne.y=ve*y,me.y=de.y=(ve+1)*y;for(let Te=F;Te<=G;++Te)Q.x=me.x=Te*y,ne.x=de.x=(Te+1)*y,($o(A,P,k,Q,ne,de)||$o(A,P,k,Q,de,me))&&x.push({cellIdx:ve*this.cellsX+Te,triIdx:E})}}if(x.length===0)return;x.sort(((E,A)=>E.cellIdx-A.cellIdx||E.triIdx-A.triIdx));let S=0;for(;S<x.length;){const E=x[S].cellIdx,A={start:this.payload.length,len:0};for(;S<x.length&&x[S].cellIdx===E;)++A.len,this.payload.push(x[S++].triIdx);this.cells[E]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=hh(e.x-this.min.x,this.xScale,this.cellsX),a=hh(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[a*this.cellsX+o];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){const p=this.payload[u.start+h],y=Math.floor(p/8),x=1<<p%8;if(!(this.lookup[y]&x)&&(this.lookup[y]|=x,n.push(p),n.length===this.triangleCount))return}}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const a=hh(e.x-this.min.x,this.xScale,this.cellsX),u=hh(n.x-this.min.x,this.xScale,this.cellsX),h=hh(e.y-this.min.y,this.yScale,this.cellsY),p=hh(n.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=p;y++)for(let x=a;x<=u;x++){const S=this.cells[y*this.cellsX+x];if(S)for(let E=0;E<S.len;E++){const A=this.payload[S.start+E],P=Math.floor(A/8),k=1<<A%8;if(!(this.lookup[P]&k)&&(this.lookup[P]|=k,o.push(A),o.length===this.triangleCount))return}}}}function hh(i,e,n){return Math.max(0,Math.min(n-1,Math.floor(i*e)))}qt(Ag,"TriangleGridIndex");class $x{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const o of this.footprints)n.push({footprint:o,id:e})}updateAppearances(e,n,o,a){}populate(e,n,o,a){const u=[];for(const{feature:h,id:p,index:y,sourceLayerIndex:x}of e){const S=this.layers[0]._featureFilter.needGeometry,E=Re(h,S);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),E,o))continue;const A={id:p,properties:h.properties,type:h.type,sourceLayerIndex:x,index:y,geometry:S?E.geometry:xe(h,o,a),patterns:{}};u.push(A)}for(const h of u){const{geometry:p,index:y,sourceLayerIndex:x}=h;this.addFeature(h,p,y,o,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,p,y,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,o,a,u,h,p){}destroy(){}addFeature(e,n,o,a,u,h=[],p){for(const y of Am(n,2)){const x=[],S=[],E=[],A=new ct(1/0,1/0),P=new ct(-1/0,-1/0);for(const G of y)if(G.length!==0){G!==y[0]&&E.push(S.length/2);for(let U=0;U<G.length;U++)S.push(G[U].x),S.push(G[U].y),x.push(G[U]),A.x=Math.min(A.x,G[U].x),A.y=Math.min(A.y,G[U].y),P.x=Math.max(P.x,G[U].x),P.y=Math.max(P.y,G[U].y)}const k=Fp(S,E),F=new Ag(x,k,8,256);this.footprints.push({vertices:x,indices:k,grid:F,min:A,max:P})}}}qt($x,"ClipBucket",{omit:["layers"]});const V2=ni([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),U2=ni([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),G2=ni([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),$2=ni([{name:"a_centroid_pos",components:2,type:"Uint16"}]),H2=ni([{name:"a_join_normal_inside",components:3,type:"Int16"}]),W2=ni([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),q2=ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Z2}=V2,Cm=Number.MAX_SAFE_INTEGER,Hx=Cm-1;function Wx(i,e,n,o){return i.order<e||i.order===Cm||!(i.clipMask&n)||(function(a,u){return u.length!==0&&u.find((h=>h===a))===void 0})(o,i.clipScope)}function Cg(i,e){return i.x-e.x||i.y-e.y}function qx(i,e){return Cg(i.min,e.min)===0&&Cg(i.max,e.max)===0}function oy(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function Mg(i,e){if(i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(i[n].sourceId!==e[n].sourceId||!qx(i[n],e[n])||i[n].order!==e[n].order||i[n].clipMask!==e[n].clipMask||!qr(i[n].clipScope,e[n].clipScope))return!1;return!0}function Zx(i,e,n){const o=1/Pt,a=1/(1<<n.canonical.z),u=(e.x*o+n.canonical.x)*a+n.wrap,h=(e.y*o+n.canonical.y)*a;return{min:new ct((i.x*o+n.canonical.x)*a+n.wrap,(i.y*o+n.canonical.y)*a),max:new ct(u,h)}}function X2(i,e,n){const o=1<<n.canonical.z,a=((e.x-n.wrap)*o-n.canonical.x)*Pt,u=(e.y*o-n.canonical.y)*Pt;return{min:new ct(((i.x-n.wrap)*o-n.canonical.x)*Pt,(i.y*o-n.canonical.y)*Pt),max:new ct(a,u)}}function sy(i,e,n,o,a,u,h){const p=i.indices,y=i.vertices,x=[];for(let S=o;S<o+a;S+=3){const E=e[n[S+0]+u],A=e[n[S+1]+u],P=e[n[S+2]+u],k=Math.min(E.x,A.x,P.x),F=Math.max(E.x,A.x,P.x),G=Math.min(E.y,A.y,P.y),U=Math.max(E.y,A.y,P.y);x.length=0,i.grid.query(new ct(k,G),new ct(F,U),x);for(let Y=0;Y<x.length;Y++){const Q=x[Y];if($o(y[p[3*Q+0]],y[p[3*Q+1]],y[p[3*Q+2]],E,A,P,h))return!0}}return!1}function Xx(i,e,n,o){if(!i||!n)return!1;let a=i.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<i.vertices.length)return Xx(n,o,i,e);const u=e.canonical,h=o.canonical,p=Math.pow(2,h.z-u.z);a=i.vertices.map((y=>new ct((y.x+u.x*Pt)*p-h.x*Pt,(y.y+u.y*Pt)*p-h.y*Pt)))}return sy(n,a,i.indices,0,i.indices.length,0,0)}function Yx(i,e,n,o){const a=Math.pow(2,o.z-n.z);return new ct((i+n.x*Pt)*a-o.x*Pt,(e+n.y*Pt)*a-o.y*Pt)}function Kx(i,e){const n=[];e.grid.queryPoint(i,n);const o=e.indices,a=e.vertices;for(let u=0;u<n.length;u++){const h=n[u];if(Hi([a[o[3*h+0]],a[o[3*h+1]],a[o[3*h+2]]],i))return!0}return!1}const ay=[new ct(0,0),new ct(Pt,0),new ct(Pt,Pt),new ct(0,Pt)];function Jx(i,e){const n=[];let o=[];if(!e||i.length<2)return[i];if(i.length===2)return Co(i[0],i[1],ay)?[i]:[];for(let a=0;a<i.length+2;a++){const u=i[a%i.length],h=i[(a+1)%i.length],p=Co(a===0?i[i.length-1]:i[(a-1)%i.length],u,ay),y=Co(u,h,ay),x=p||y;x&&o.push(u),x&&y||o.length>0&&(o.length>1&&n.push(o),o=[])}return o.length>1&&n.push(o),n}const ly=Ae.types,Y2=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],K2=["fill-extrusion-flood-light-ground-radius"],J2=Math.pow(2,13),Q2=Math.pow(2,15)-1,Qx=new ct(0,1),_d=2147483648,e0=7,t0=450;function Mm(i,e,n,o,a,u,h,p){i.emplaceBack((e<<1)+h,(n<<1)+u,(Math.floor(o*J2)<<1)+a,Math.round(p))}function Pm(i,e,n){i.emplaceBack(e.x*Pt,e.y*Pt,n?1:0)}function Pg(i,e,n,o,a,u){i.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+a,u)}function Rm(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class n0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class i0{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class r0{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let a=!!this.borders;n.x<e.min.x?(e.min.x=n.x,a=!0):n.x>e.max.x&&(e.max.x=n.x,a=!0),n.y<e.min.y?(e.min.y=n.y,a=!0):n.y>e.max.y&&(e.max.y=n.y,a=!0),((n.x===0||n.x===Pt)&&n.x===o.x)!=((n.y===0||n.y===Pt)&&n.y===o.y)&&this.processBorderOverlap(n,o),a&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,bn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Pt!=e.x>Pt&&this.addBorderIntersection(1,bn(n.y,e.y,(Pt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,bn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Pt!=e.y>Pt&&this.addBorderIntersection(3,bn(n.x,e.x,(Pt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,n)=>e+ +(n[0]!==Number.MAX_VALUE)),0):0}}function o0(i,e){const n=i.add(e)._unit(),o=H(i.x*n.x+i.y*n.y,-1,1);var a,u,h;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*Q2*((u=i).x*(h=e).y-u.y*h.x<0?-1:1)}const eE=[i=>i.x<0,i=>i.x>Pt,i=>i.y<0,i=>i.y>Pt];function tE(i,e,n,o){const a=[4];if(o===0)return a;n._mult(o);const u=i.sub(n),h=e.sub(n),p=[i,e,u,h];for(let y=0;y<4;y++)for(const x of p)if(eE[y](x)){a.push(y);break}return a}class cy{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new lf,this.indexArray=new Jr,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut},(n=>K2.includes(n))),this._segments=new ki,this.hiddenByLandmarkVertexArray=new iu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ki}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,a=!1){const u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1);const p=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const x=e[0],S=e[1];y=o0(x.sub(e[u-1])._perp()._unit(),S.sub(x)._perp()._unit())}for(let x=0;x<u;x++){const S=x===u-1?0:x+1,E=e[x],A=e[S],P=e[S===u-1?0:S+1],k=A.sub(E)._perp()._unit(),F=o0(k,P.sub(A)._perp()._unit()),G=y,U=F;if(uy(E,A,n)||a&&l0(E,n)&&l0(A,n)){y=F;continue}const Y=p.vertexLength;Pg(this.vertexArray,E,A,1,1,G),Pg(this.vertexArray,E,A,1,0,G),Pg(this.vertexArray,E,A,0,1,U),Pg(this.vertexArray,E,A,0,0,U),p.vertexLength+=4;const Q=tE(E,A,k,o);for(const ne of Q)this._segmentToGroundQuads[h].push({id:Y,region:ne}),this._segmentToRegionTriCounts[h][ne]+=2,p.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort(((a,u)=>a.region-u.region));for(let o=0;o<n;o++){const a=this._segmentToGroundQuads[o],u=e[o],h=this._segmentToRegionTriCounts[o];h.reduce(((y,x)=>y+x),0);let p=0;for(let y=0;y<=4;y++){const x=h[y];if(x!==0){let S=this.regionSegments[y];S||(S=this.regionSegments[y]=new ki);const E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+p,vertexLength:u.vertexLength,primitiveLength:x};S.get().push(E)}p+=x}for(let y=0;y<a.length;y++){const x=a[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,a,u,h,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,a,u,h,void 0,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,U2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,G2.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,a,u,h,p,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,a,u,h,p,y)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&_d))}updateHiddenByLandmarkRange(e,n,o){if(!this.hasData())return;const a=n+e;if(n!==0){for(let u=e;u<a;++u)this.hiddenByLandmarkVertexArray.emplace(u,o?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,W2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Rg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Jr,this.footprintVertices=new Ac,this.footprintSegments=[],this.layoutVertexArray=new ws,this.centroidVertexArray=new rp,this.wallVertexArray=new zo,this.indexArray=new Jr,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut},(n=>Y2.includes(n))),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.groundEffect=new cy(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,o,a){}populate(e,n,o,a){this.features=[],this.hasPattern=ey("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=q(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:h,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,S=Re(u,x);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),S,o))continue;const E={id:h,sourceLayerIndex:y,index:p,geometry:x?S.geometry:xe(u,o,a),properties:u.properties,type:u.type,patterns:{}},A=this.layoutVertexArray.length,P=ly[E.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:u.id,feature:ty("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const k of E.geometry)for(const F of Jx(k,P))this.addFeature(u.id,E,[F],p,o,{},n.availableImages,a,n.brightness);else this.addFeature(u.id,E,E.geometry,p,o,{},n.availableImages,a,n.brightness);n.featureIndex.insert(u,E.geometry,p,y,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,a,u,h){for(const{featureId:p,feature:y}of this.features){const x=ly[y.type]==="Polygon",{geometry:S}=y;if(this.wallMode)for(const E of S)for(const A of Jx(E,x))this.addFeature(p,y,[A],y.index,n,o,a,u,h);else this.addFeature(p,y,S,y.index,n,o,a,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,a,u,h,p){this.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,this.worldview),this.groundEffect.update(e,n,u,o,a,h,p,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,H2.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,q2.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,a,u,h,p,y,x){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,E=[new ct(0,0),new ct(Pt,Pt)],A=y.projection,P=A.name==="globe",k=this.wallMode||ly[n.type]==="Polygon",F=new r0;F.centroidDataIndex=this.centroidData.length;const G=new i0;G.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(G.buildingId=n.properties.building_id);const U=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},u)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},u);let Q;if(G.height=Y,G.vertexArrayOffset=this.layoutVertexArray.length,G.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new sh),this.wallMode){if(P)return void $t("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;Q=(function(ke){const Qe=ke[0].x===ke[ke.length-1].x&&ke[0].y===ke[ke.length-1].y;(function(Zt){let nn=0;const Qn=Zt.length;for(let It=0;It<Qn;It++)nn+=(Zt[(It+1)%Qn].x-Zt[It].x)*(Zt[(It+1)%Qn].y+Zt[It].y);return nn>=0})(ke)||(ke=ke.reverse());const ht={geometry:[],joinNormals:[],indices:[]},gt=[],vt=[],ft=[];let pt=ke.length;for(;pt>=2&&ke[pt-1].equals(ke[pt-2]);)pt--;if(pt<(Qe?3:2))return ht;let Je,Ye,mt,zt,St,hn=0;for(;hn<pt-1&&ke[hn].equals(ke[hn+1]);)hn++;Qe&&(Je=ke[pt-2],St=ke[hn].sub(Je)._unit()._perp());for(let Zt=hn;Zt<pt;Zt++){if(mt=Zt===pt-1?Qe?ke[hn+1]:void 0:ke[Zt+1],mt&&ke[Zt].equals(mt))continue;St&&(zt=St),Je&&(Ye=Je),Je=ke[Zt],St=mt?mt.sub(Je)._unit()._perp():zt,zt=zt||St;let nn=zt.add(St);nn.x===0&&nn.y===0||nn._unit();const Qn=nn.x*St.x+nn.y*St.y,It=Qn!==0?1/Qn:1/0,on=zt.x*St.y-zt.y*St.x>0;let Dn="miter";const gi=2;Dn==="miter"&&It>gi&&(Dn="bevel"),Dn==="bevel"&&(It>100&&(Dn="flipbevel"),It<gi&&(Dn="miter"));const bi=(qn,Yi,fe,_e)=>{const et=new ct(qn.x,qn.y),_t=new ct(qn.x,qn.y);et.x+=Yi.x*_e,et.y+=Yi.y*_e,_t.x-=Yi.x*Math.max(fe,1),_t.y-=Yi.y*Math.max(fe,1),ft.push(Yi),gt.push(et),vt.push(_t)};if(Dn==="miter")nn._mult(It),bi(Je,nn,0,0);else if(Dn==="flipbevel")nn=St.mult(-1),bi(Je,nn,0,0),bi(Je,nn.mult(-1),0,0);else{const qn=-Math.sqrt(It*It-1),Yi=on?qn:0,fe=on?0:qn;Ye&&bi(Je,zt,Yi,fe),mt&&bi(Je,St,Yi,fe)}}ht.geometry=[...gt,...vt.reverse(),gt[0]],ht.joinNormals=[...ft,...ft.reverse(),ft[ft.length-1]];const Vt=ht.geometry.length-1;for(let Zt=0;Zt<Vt/2;Zt++)if(Zt+1<Vt/2){let nn=Zt,Qn=Zt+1,It=Vt-1-Zt,on=Vt-2-Zt;nn=nn===0?Vt-1:nn-1,Qn=Qn===0?Vt-1:Qn-1,It=It===0?Vt-1:It-1,on=on===0?Vt-1:on-1,ht.indices.push(It),ht.indices.push(Qn),ht.indices.push(nn),ht.indices.push(It),ht.indices.push(on),ht.indices.push(Qn)}return ht})(o[0]),o=[Q.geometry]}const ne=(ke,Qe)=>ke<(Qe.length-1)/2||ke===Qe.length-1,me=this.wallMode?[o]:Am(o,500);for(let ke=me.length-1;ke>=0;ke--){const Qe=me[ke];(Qe.length===0||(de=Qe[0]).every((ut=>ut.x<=0))||de.every((ut=>ut.x>=Pt))||de.every((ut=>ut.y<=0))||de.every((ut=>ut.y>=Pt)))&&me.splice(ke,1)}var de;let ve;if(P)ve=d0(me,E,u);else{ve=[];for(const ke of me)ve.push({polygon:ke,bounds:E})}const Te=k?this.edgeRadius:0,Ie=Te>0&&this.zoom<17,qe=(ke,Qe)=>{if(ke.length===0)return!1;const ut=ke[ke.length-1];return Qe.x===ut.x&&Qe.y===ut.y};for(const{polygon:ke,bounds:Qe}of ve){let ut=0,ht=0;for(const pt of ke)k&&!pt[0].equals(pt[pt.length-1])&&pt.push(pt[0]),ht+=k?pt.length-1:pt.length;const gt=this.segments.prepareSegment((k?5:4)*ht,this.layoutVertexArray,this.indexArray);G.footprintSegIdx<0&&(G.footprintSegIdx=this.footprintSegments.length),G.polygonSegIdx<0&&(G.polygonSegIdx=this.polygonSegments.length);const vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ft=new n0;if(ft.vertexOffset=this.footprintVertices.length,ft.indexOffset=3*this.footprintIndices.length,ft.ringIndices=[],k){const pt=[],Je=[];ut=gt.vertexLength;for(let mt=0;mt<ke.length;mt++){const zt=ke[mt];zt.length&&mt!==0&&Je.push(pt.length/2);const St=[];let hn,Vt;hn=zt[1].sub(zt[0])._perp()._unit(),ft.ringIndices.push(zt.length-1);for(let Zt=1;Zt<zt.length;Zt++){const nn=zt[Zt],Qn=zt[Zt===zt.length-1?1:Zt+1],It=nn.clone();if(Te){Vt=Qn.sub(nn)._perp()._unit();const on=hn.add(Vt)._unit(),Dn=Te*Math.min(4,1/(hn.x*on.x+hn.y*on.y));It.x+=Dn*on.x,It.y+=Dn*on.y,It.x=Math.round(It.x),It.y=Math.round(It.y),hn=Vt}if(!U||Te!==0&&!Ie||qe(St,It)||St.push(It),Mm(this.layoutVertexArray,It.x,It.y,0,0,1,1,0),this.wallMode){const on=ne(Zt,zt);Pm(this.wallVertexArray,Q.joinNormals[Zt],!on)}gt.vertexLength++,this.footprintVertices.emplaceBack(nn.x,nn.y),pt.push(nn.x,nn.y),P&&Rm(this.layoutVertexExtArray,A.projectTilePoint(It.x,It.y,u),A.upVector(u,It.x,It.y))}U&&(Te===0||Ie)&&(St.length!==0&&qe(St,St[0])&&St.pop(),this.groundEffect.addData(St,Qe,S))}const Ye=this.wallMode?Q.indices:Fp(pt,Je);for(let mt=0;mt<Ye.length;mt+=3)this.footprintIndices.emplaceBack(ft.vertexOffset+Ye[mt+0],ft.vertexOffset+Ye[mt+1],ft.vertexOffset+Ye[mt+2]),this.indexArray.emplaceBack(ut+Ye[mt],ut+Ye[mt+2],ut+Ye[mt+1]),gt.primitiveLength++;ft.indexCount+=Ye.length,ft.vertexCount+=this.footprintVertices.length-ft.vertexOffset}for(let pt=0;pt<ke.length;pt++){const Je=ke[pt];F.startRing(G,Je[0]);let Ye=Je.length>4&&c0(Je[Je.length-2],Je[0],Je[1]),mt=Te?nE(Je[Je.length-2],Je[0],Je[1],Te):0;const zt=[];let St,hn,Vt;hn=Je[1].sub(Je[0])._perp()._unit();let Zt=!0;for(let nn=1,Qn=0;nn<Je.length;nn++){let It=Je[nn-1],on=Je[nn];const Dn=Je[nn===Je.length-1?1:nn+1];if(F.appendEdge(G,on,It),uy(on,It,Qe)){Te&&(hn=Dn.sub(on)._perp()._unit(),Zt=!Zt);continue}const gi=on.sub(It)._perp(),bi=gi.x/(Math.abs(gi.x)+Math.abs(gi.y)),qn=gi.y>0?1:0,Yi=It.dist(on);if(Qn+Yi>32768&&(Qn=0),Te){Vt=Dn.sub(on)._perp()._unit();let _t=a0(It,on,Dn,s0(hn,Vt),Te);isNaN(_t)&&(_t=0);const Ot=on.sub(It)._unit();It=It.add(Ot.mult(mt))._round(),on=on.add(Ot.mult(-_t))._round(),mt=_t,hn=Vt,U&&this.zoom>=17&&(qe(zt,It)||zt.push(It),qe(zt,on)||zt.push(on))}const fe=gt.vertexLength,_e=Je.length>4&&c0(It,on,Dn);let et=u0(Qn,Ye,Zt);if(Mm(this.layoutVertexArray,It.x,It.y,bi,qn,0,0,et),Mm(this.layoutVertexArray,It.x,It.y,bi,qn,0,1,et),this.wallMode){const _t=ne(nn-1,Je),Ot=Q.joinNormals[nn-1];Pm(this.wallVertexArray,Ot,_t),Pm(this.wallVertexArray,Ot,_t)}if(Qn+=Yi,et=u0(Qn,_e,!Zt),Ye=_e,Mm(this.layoutVertexArray,on.x,on.y,bi,qn,0,0,et),Mm(this.layoutVertexArray,on.x,on.y,bi,qn,0,1,et),this.wallMode){const _t=ne(nn,Je),Ot=Q.joinNormals[nn];Pm(this.wallVertexArray,Ot,_t),Pm(this.wallVertexArray,Ot,_t)}if(gt.vertexLength+=4,this.indexArray.emplaceBack(fe+0,fe+1,fe+2),this.indexArray.emplaceBack(fe+1,fe+3,fe+2),gt.primitiveLength+=2,Te){const _t=ut+(nn===1?Je.length-2:nn-2),Ot=nn===1?ut:_t+1;if(this.indexArray.emplaceBack(fe+1,_t,fe+3),this.indexArray.emplaceBack(_t,Ot,fe+3),gt.primitiveLength+=2,St===void 0&&(St=fe),!uy(Dn,Je[nn],Qe)){const Ft=nn===Je.length-1?St:gt.vertexLength;this.indexArray.emplaceBack(fe+2,fe+3,Ft),this.indexArray.emplaceBack(fe+3,Ft+1,Ft),this.indexArray.emplaceBack(fe+3,Ot,Ft+1),gt.primitiveLength+=3}Zt=!Zt}if(P){const _t=this.layoutVertexExtArray,Ot=A.projectTilePoint(It.x,It.y,u),Ft=A.projectTilePoint(on.x,on.y,u),fn=A.upVector(u,It.x,It.y),pn=A.upVector(u,on.x,on.y);Rm(_t,Ot,fn),Rm(_t,Ot,fn),Rm(_t,Ft,pn),Rm(_t,Ft,pn)}}k&&(ut+=Je.length-1),U&&Te&&this.zoom>=17&&(zt.length!==0&&qe(zt,zt[0])&&zt.pop(),this.groundEffect.addData(zt,Qe,S,Te>0))}this.footprintSegments.push(ft),vt.triangleCount=this.indexArray.length-vt.triangleArrayOffset,this.polygonSegments.push(vt),++G.footprintSegLen,++G.polygonSegLen}if(G.vertexCount=this.layoutVertexArray.length-G.vertexArrayOffset,G.groundVertexCount=this.groundEffect.vertexArray.length-G.groundVertexArrayOffset,G.vertexCount!==0){if(G.centroidXY=F.borders?Qx:this.encodeCentroid(F,G),this.centroidData.push(G),F.borders){this.featuresOnBorder.push(F);const ke=this.featuresOnBorder.length-1;for(let Qe=0;Qe<F.borders.length;Qe++)F.borders[Qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Qe].push(ke)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,a,h,p,u,x,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,a,h,p,u,x,this.worldview),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0]))}splitToSubtiles(){const e=[];for(let p=0;p<this.centroidData.length;p++){const y=this.centroidData[p],x=+(y.min.y+y.max.y>Pt),S=2*x+(+(y.min.x+y.max.x>Pt)^x);for(let E=0;E<y.polygonSegLen;E++){const A=y.polygonSegIdx+E;e.push({centroidIdx:p,subtile:S,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const n=new Jr;e.sort(((p,y)=>p.triangleSegmentIdx===y.triangleSegmentIdx?p.subtile-y.subtile:p.triangleSegmentIdx-y.triangleSegmentIdx));let o=0,a=0,u=0;for(const p of e){if(p.triangleSegmentIdx!==o)break;u++}const h=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let p=0,y=a,x=a;for(let S=y;S<u&&e[S].subtile===p;S++)x++;for(;y!==u;){const S=e[y];p=S.subtile;const E=this.centroidData[S.centroidIdx].min.clone(),A=this.centroidData[S.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=y;k<x;k++){const F=e[k],G=this.polygonSegments[F.polygonSegmentIdx],U=this.centroidData[F.centroidIdx].min,Y=this.centroidData[F.centroidIdx].max,Q=this.indexArray.uint16;for(let ne=G.triangleArrayOffset;ne<G.triangleArrayOffset+G.triangleCount;ne++)n.emplaceBack(Q[3*ne],Q[3*ne+1],Q[3*ne+2]);P.primitiveLength+=G.triangleCount,E.x=Math.min(E.x,U.x),E.y=Math.min(E.y,U.y),A.x=Math.max(A.x,Y.x),A.y=Math.max(A.y,Y.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:E,max:A}),y=x;for(let k=y;k<u&&e[k].subtile===e[y].subtile;k++)x++}a=u;for(let S=a;S<h&&e[S].triangleSegmentIdx===e[a].triangleSegmentIdx;S++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){const a=new ki;if(this.wallMode){for(const F of this.triangleSubSegments)a.segments.push(F.segment);return a}let u=0,h=0;const p=1<<e.canonical.z;if(n){const F=n.getMinMaxForTile(e);F&&(u=F.min,h=F.max)}h+=this.maxHeight;const y=e.toUnwrapped();let x;const S=[y.canonical.x/p+y.wrap,y.canonical.y/p],E=[(y.canonical.x+1)/p+y.wrap,(y.canonical.y+1)/p],A=(F,G,U)=>[F[0]*(1-U[0])+G[0]*U[0],F[1]*(1-U[1])+G[1]*U[1]],P=[],k=[];for(const F of this.triangleSubSegments){P[0]=F.min.x/Pt,P[1]=F.min.y/Pt,k[0]=F.max.x/Pt,k[1]=F.max.y/Pt;const G=A(S,E,P),U=A(S,E,k);if(new Kt([G[0],G[1],u],[U[0],U[1],h]).intersectsPrecise(o)===0){x&&(a.segments.push(x),x=void 0);continue}const Y=F.segment;x&&x.vertexOffset!==Y.vertexOffset&&(a.segments.push(x),x=void 0),x?(x.vertexLength+=Y.vertexLength,x.primitiveLength+=Y.primitiveLength):x={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&a.segments.push(x),a}encodeCentroid(e,n){const o=e.centroid(),a=n.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new ct(H(o.x,1,Pt-1)<<3|u,H(o.y,1,Pt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new ct(0,0);const n=e.borders,o=Number.MAX_VALUE;if(n[0][0]!==o||n[1][0]!==o){const a=n[0][0]!==o?0:1;return new ct(6|(n[0][0]!==o?0:65528),(n[a][0]+n[a][1])/2<<3|6)}{const a=n[2][0]!==o?2:3;return new ct((n[a][0]+n[a][1])/2<<3|6,6|(n[2][0]!==o?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&_d?Qx:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==a.y||u!==a.x){for(let h=n;h<o;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,o){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped());if(Mg(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const u=[];for(const h of this.activeReplacements){if(h.order<o)continue;const p=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));if(h.footprint.buildingIds)for(const y of this.centroidData)y.flags&_d||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y||h.footprint.buildingIds.has(y.buildingId)&&(y.flags|=_d);else for(const y of this.centroidData)if(!(y.flags&_d||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let x=0;x<y.footprintSegLen;x++){const S=this.footprintSegments[y.footprintSegIdx+x];if(u.length=0,iE(this.footprintVertices,S.vertexOffset,S.vertexCount,h.footprintTileId.canonical,e.canonical,u),sy(h.footprint,u,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-p)){y.flags|=_d;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let a=!1;for(let u=0;u<o.footprintSegLen;u++){const h=this.footprintSegments[o.footprintSegIdx+u];let p=0;for(const y of h.ringIndices){for(let x=p,S=y+p-1;x<y+p;S=x++){const E=this.footprintVertices.int16[2*(x+h.vertexOffset)+0],A=this.footprintVertices.int16[2*(x+h.vertexOffset)+1],P=this.footprintVertices.int16[2*(S+h.vertexOffset)+1];A>n!=P>n&&e<(this.footprintVertices.int16[2*(S+h.vertexOffset)+0]-E)*(n-A)/(P-A)+E&&(a=!a)}p=y}}return a}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+Pt)*Pt+(n+Pt);if(this.partLookup.hasOwnProperty(u)){const h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&_d)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||n>h.max.y||h.min.y>n||h.height<=o||this.footprintContainsPoint(e,n,h)&&(o=h.height,this.partLookup[u]=h,a=!!(h.flags&_d));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[u]=void 0}}function s0(i,e){const n=i.add(e)._unit();return i.x*n.x+i.y*n.y}function nE(i,e,n,o){const a=e.sub(i)._perp()._unit(),u=n.sub(e)._perp()._unit();return a0(i,e,n,s0(a,u),o)}function a0(i,e,n,o,a){const u=Math.sqrt(1-o*o);return Math.min(i.dist(e)/3,e.dist(n)/3,a*u/o)}function uy(i,e,n){return i.x<n[0].x&&e.x<n[0].x||i.x>n[1].x&&e.x>n[1].x||i.y<n[0].y&&e.y<n[0].y||i.y>n[1].y&&e.y>n[1].y}function l0(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function c0(i,e,n){if(i.x<0||i.x>=Pt||e.x<0||e.x>=Pt||n.x<0||n.x>=Pt)return!1;const o=n.sub(e),a=o.perp(),u=i.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function u0(i,e,n){const o=e?2|i:-3&i;return n?1|o:-2&o}function h0(){const i=Math.PI/32,e=Math.tan(i),n=l;return n*Math.sqrt(1+2*e*e)-n}function d0(i,e,n){const o=1<<n.z,a=C(n.x/o),u=C((n.x+1)/o),h=O(n.y/o),p=O((n.y+1)/o);return(function(y,x,S,E,A=0,P){const k=[];if(!y.length||!S||!E)return k;const F=(de,ve)=>{for(const Te of de)k.push({polygon:Te,bounds:ve})},G=Math.ceil(Math.log2(S)),U=Math.ceil(Math.log2(E)),Y=G-U,Q=[];for(let de=0;de<Math.abs(Y);de++)Q.push(Y>0?0:1);for(let de=0;de<Math.min(G,U);de++)Q.push(0),Q.push(1);let ne=y;if(ne=Ig(ne,x[0].y-A,x[1].y+A,1),ne=Ig(ne,x[0].x-A,x[1].x+A,0),!ne.length)return k;const me=[];for(Q.length?me.push({polygons:ne,bounds:x,depth:0}):F(ne,x);me.length;){const de=me.pop(),ve=de.depth,Te=Q[ve],Ie=de.bounds[0],qe=de.bounds[1],ke=Te===0?Ie.x:Ie.y,Qe=Te===0?qe.x:qe.y,ut=P?P(Te,ke,Qe):.5*(ke+Qe),ht=Ig(de.polygons,ke-A,ut+A,Te),gt=Ig(de.polygons,ut-A,Qe+A,Te);if(ht.length){const vt=[Ie,new ct(Te===0?ut:qe.x,Te===1?ut:qe.y)];Q.length>ve+1?me.push({polygons:ht,bounds:vt,depth:ve+1}):F(ht,vt)}if(gt.length){const vt=[new ct(Te===0?ut:Ie.x,Te===1?ut:Ie.y),qe];Q.length>ve+1?me.push({polygons:gt,bounds:vt,depth:ve+1}):F(gt,vt)}}return k})(i,e,Math.ceil((u-a)/11.25),Math.ceil((h-p)/11.25),1,((y,x,S)=>{if(y===0)return .5*(x+S);{const E=O((n.y+x/Pt)/o);return(b(.5*(O((n.y+S/Pt)/o)+E))*o-n.y)*Pt}}))}function iE(i,e,n,o,a,u){const h=Math.pow(2,o.z-a.z);for(let p=0;p<n;p++){let y=i.int16[2*(p+e)+0],x=i.int16[2*(p+e)+1];y=(y+a.x*Pt)*h-o.x*Pt,x=(x+a.y*Pt)*h-o.y*Pt,u.push(new ct(y,x))}}let f0,p0;qt(Rg,"FillExtrusionBucket",{omit:["layers","features"]}),qt(i0,"PartData"),qt(n0,"FootprintSegment"),qt(r0,"BorderCentroidData"),qt(cy,"GroundEffect");class cp extends ct{constructor(e,n,o){super(e,n),this.z=o}}class m0 extends cp{constructor(e,n,o,a){super(e,n,o),this.w=a}}function g0(i,e,n,o){const a=n==="x"?"y":"x",u=(o-i[n])/(e[n]-i[n]);i[a]=Math.round(i[a]+(e[a]-i[a])*u),i[n]=o,i.hasOwnProperty("z")&&(i.z=bn(i.z,e.z,u)),i.hasOwnProperty("w")&&(i.w=bn(i.w,e.w,u))}function _0(i,e,n,o){const a=n,u=o;for(const h of["x","y"]){let p=i,y=e;p[h]>=y[h]&&(p=e,y=i),p[h]<a&&y[h]>a&&g0(p,y,h,a),p[h]<u&&y[h]>u&&g0(y,p,h,u)}}function kg(i,e,n,o,a,u){const h=[];for(let p=0;p<i.length;p++){const y=i[p];let x;const S=h.length;let E=0;for(let A=0;A<y.length-1;A++){let P=y[A],k=y[A+1],F=0;const G=E;let U,Y;u&&(F=Math.hypot(k.x-P.x,k.y-P.y),E+=F,U=P,Y=k),P.x<e&&k.x<e||(P.x<e?P=new ct(e,P.y+(e-P.x)/(k.x-P.x)*(k.y-P.y))._round():k.x<e&&(k=new ct(e,P.y+(e-P.x)/(k.x-P.x)*(k.y-P.y))._round()),P.y<n&&k.y<n||(P.y<n?P=new ct(P.x+(n-P.y)/(k.y-P.y)*(k.x-P.x),n)._round():k.y<n&&(k=new ct(P.x+(n-P.y)/(k.y-P.y)*(k.x-P.x),n)._round()),P.x>=o&&k.x>=o||(P.x>=o?P=new ct(o,P.y+(o-P.x)/(k.x-P.x)*(k.y-P.y))._round():k.x>=o&&(k=new ct(o,P.y+(o-P.x)/(k.x-P.x)*(k.y-P.y))._round()),P.y>=a&&k.y>=a||(P.y>=a?P=new ct(P.x+(a-P.y)/(k.y-P.y)*(k.x-P.x),a)._round():k.y>=a&&(k=new ct(P.x+(a-P.y)/(k.y-P.y)*(k.x-P.x),a)._round()),x&&P.equals(x[x.length-1])||(x=[P],h.push(x),u&&u.push({progress:{min:G+y0(U,Y,P)*F,max:1},parentIndex:p,prevPoint:U,nextPoint:Y})),x.push(k),u&&(u[u.length-1].progress.max=G+y0(U,Y,k)*F,u[u.length-1].nextPoint=Y)))))}if(u&&E>0)for(let A=S;A<h.length;A++)u[A].progress.min/=E,u[A].progress.max/=E}return h}function rE(i,e,n,o,a){if(i.length<2)return void o.push(i);const u=[];for(;e.valid();){const[x,S]=e.get();for(let E=0;E<i.length-1;E++){const A=i[E],P=i[E+1],k=Wn(A,P,x,S);if(k){const[F]=k,G=new ct(bn(A.x,P.x,F),bn(A.y,P.y,F));u.push({t:E+F,distance:0,point:G})}}e.next()}if(u.length===0)return void o.push(i);u.sort(((x,S)=>x.t-S.t));let h=0,p=0,y=[];for(o.push(y);h!==i.length;){if(p===u.length){for(;h!==i.length;)y.length!==0&&y[y.length-1].equals(i[h])||y.push(i[h]),h++;break}u[p].t<=h?(y.length!==0&&y[y.length-1].equals(u[p].point)||y.push(u[p].point),Math.trunc(u[p].t),p++):(y.length!==0&&y[y.length-1].equals(i[h])||y.push(i[h]),h++)}}function y0(i,e,n){return i.x!==e.x?(n.x-i.x)/(e.x-i.x):i.y!==e.y?(n.y-i.y)/(e.y-i.y):0}function km(i,e){return i.x*e.x+i.y*e.y}function v0(i,e){if(i.length===1){let n=0;const o=e[n++];let a;for(;!a||o.equals(a);)if(a=e[n++],!a)return 1/0;for(;n<e.length;n++){const u=e[n],h=i[0],p=a.sub(o),y=u.sub(o),x=h.sub(o),S=km(p,p),E=km(p,y),A=km(y,y),P=km(x,p),k=km(x,y),F=S*A-E*E,G=(A*P-E*k)/F,U=(S*k-E*P)/F,Y=o.z*(1-G-U)+a.z*G+u.z*U;if(isFinite(Y))return Y}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}function x0(i,e,n){let o=1/0;zi(n,e)&&(o=v0(n,e[0]));for(let a=0;a<e.length;a++){const u=e[a],h=i[a];for(let p=0;p<u.length-1;p++){const y=u[p],x=[y,u[p+1],h[p+1],h[p],y];Ii(n,x)&&(o=Math.min(o,v0(n,x)))}}return o!==1/0&&o}function w0(i,e,n,o,a,u,h,p,y,x,S){return i.projection.name==="globe"?(function(E,A,P,k,F,G,U,Y,Q,ne,me){const de=[],ve=[],Te=E.projection.upVectorScale(me,E.center.lat,E.worldSize).metersToTile,Ie=[0,0,0,1],qe=[0,0,0,1],ke=(ut,ht,gt,vt)=>{ut[0]=ht,ut[1]=gt,ut[2]=vt,ut[3]=1},Qe=h0();P>0&&(P+=Qe),k+=Qe;for(const ut of A){const ht=[],gt=[];for(const vt of ut){const ft=vt.x+F.x,pt=vt.y+F.y,Je=E.projection.projectTilePoint(ft,pt,me),Ye=E.projection.upVector(me,vt.x,vt.y);let mt=P,zt=k;if(U){const St=b0(ft,pt,P,k,U,Y,Q,ne);mt+=St.base,zt+=St.top}P!==0?ke(Ie,Je.x+Ye[0]*Te*mt,Je.y+Ye[1]*Te*mt,Je.z+Ye[2]*Te*mt):ke(Ie,Je.x,Je.y,Je.z),ke(qe,Je.x+Ye[0]*Te*zt,Je.y+Ye[1]*Te*zt,Je.z+Ye[2]*Te*zt),Gi(Ie,Ie,G),Gi(qe,qe,G),ht.push(new cp(Ie[0],Ie[1],Ie[2])),gt.push(new cp(qe[0],qe[1],qe[2]))}de.push(ht),ve.push(gt)}return[de,ve]})(i,e,n,o,a,u,h,p,y,x,S):h?(function(E,A,P,k,F,G,U,Y,Q){const ne=[],me=[],de=[0,0,0,1];for(const ve of E){const Te=[],Ie=[];for(const qe of ve){const ke=qe.x+k.x,Qe=qe.y+k.y,ut=b0(ke,Qe,A,P,G,U,Y,Q);de[0]=ke,de[1]=Qe,de[2]=ut.base,de[3]=1,So(de,de,F),de[3]=Math.max(de[3],1e-5);const ht=new cp(de[0]/de[3],de[1]/de[3],de[2]/de[3]);de[0]=ke,de[1]=Qe,de[2]=ut.top,de[3]=1,So(de,de,F),de[3]=Math.max(de[3],1e-5);const gt=new cp(de[0]/de[3],de[1]/de[3],de[2]/de[3]);Te.push(ht),Ie.push(gt)}ne.push(Te),me.push(Ie)}return[ne,me]})(e,n,o,a,u,h,p,y,x):(function(E,A,P,k,F){const G=[],U=[],Y=F[8]*A,Q=F[9]*A,ne=F[10]*A,me=F[11]*A,de=F[8]*P,ve=F[9]*P,Te=F[10]*P,Ie=F[11]*P;for(const qe of E){const ke=[],Qe=[];for(const ut of qe){const ht=ut.x+k.x,gt=ut.y+k.y,vt=F[0]*ht+F[4]*gt+F[12],ft=F[1]*ht+F[5]*gt+F[13],pt=F[2]*ht+F[6]*gt+F[14],Je=F[3]*ht+F[7]*gt+F[15],Ye=vt+Y,mt=ft+Q,zt=pt+ne,St=Math.max(Je+me,1e-5),hn=vt+de,Vt=ft+ve,Zt=pt+Te,nn=Math.max(Je+Ie,1e-5);ke.push(new cp(Ye/St,mt/St,zt/St)),Qe.push(new cp(hn/nn,Vt/nn,Zt/nn))}G.push(ke),U.push(Qe)}return[G,U]})(e,n,o,a,u)}function b0(i,e,n,o,a,u,h,p){const y=h*a.getElevationAt(i,e,!0,!0),x=u[0]!==0,S=x?u[1]===0?h*(u[0]/e0-t0):h*(function(E,A,P){const k=Math.floor(A[0]/8),F=Math.floor(A[1]/8),G=10*(A[0]-8*k),U=10*(A[1]-8*F),Y=E.getElevationAt(k,F,!0,!0),Q=E.getMeterToDEM(P),ne=Math.floor(.5*(G*Q-1)),me=Math.floor(.5*(U*Q-1)),de=E.tileCoordToPixel(k,F),ve=2*ne+1,Te=2*me+1,Ie=(function(gt,vt,ft,pt,Je){return[gt.getElevationAtPixel(vt,ft,!0),gt.getElevationAtPixel(vt+Je,ft,!0),gt.getElevationAtPixel(vt,ft+Je,!0),gt.getElevationAtPixel(vt+pt,ft+Je,!0)]})(E,de.x-ne,de.y-me,ve,Te),qe=Math.abs(Ie[0]-Ie[1]),ke=Math.abs(Ie[2]-Ie[3]),Qe=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),ut=Math.min(.25,.5*Q*(qe+ke)/ve),ht=Math.min(.25,.5*Q*Qe/Te);return Y+Math.max(ut*G,ht*U)})(a,u,p):y;return{base:y+(n===0?-1:n),top:x?Math.max(S+o,y+n+2):y+o}}class oE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sE{constructor(){this.tasks={},this.taskQueue=[],ze(["process"],this),this.invoker=new oE(this.process),this.nextId=0}add(e,n){const o=this.nextId++,a=(function({type:u,isSymbolTile:h,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-p:u==="maybePrepare"&&h?400-p:500:200-p:100-p})(n);if(a===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:n,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((o=>!!this.tasks[o])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<n&&(n=u.priority,e=a)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class T0{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new sE}send(e,n,o,a,u=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[p]=o);const y=new Set;return this.target.postMessage({id:p,type:e,hasCallback:!!o,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:ja(n,y)},y),{cancel:()=>{o&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(n.mustQueue||xi(self)){const a=this.callbacks[o],u=this.scheduler.add((()=>this.processTask(o,n)),a&&a.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(nc(n.error)):o(null,nc(n.data)))}else{const o=new Set,a=n.hasCallback?(h,p)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?ja(h):null,data:ja(p,o)},o)}:()=>{},u=nc(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,a);else if(this.parent.getWorkerSource){const h=n.type.split("."),{source:p,scope:y}=u;this.parent.getWorkerSource(n.sourceMapId,h[0],p,y)[h[1]](u,a)}else a(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var zm={workerUrl:"",workerClass:null,workerParams:void 0};const hy="mapboxgl_preloaded_worker_pool";class up{constructor(e){this.active={},this.name=e}acquire(e,n=up.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;){const a=(o=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,zm.workerClass!=null?new zm.workerClass:new self.Worker(zm.workerUrl,Object.assign({name:o},zm.workerParams)));this.workers.push(a)}var o;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[hy]}numActive(){return Object.keys(this.active).length}}up.workerCount=2;class Np{constructor(e,n,o="Worker",a=up.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Pe();const u=this.workerPool.acquire(this.id,a);for(let h=0;h<u.length;h++){const p=new Np.Actor(u[h],n,this.id);p.name=`${o} ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,n,o){Se(this.actors,((a,u)=>{a.send(e,n,u)}),o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Lm,dy;function zg(){return Lm||(Lm=new up),Lm}Np.Actor=T0;const fy=4096;class aE{constructor(e){this.module=e,this.memoryStack=this.module.malloc(fy),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>fy?-1:(new Int32Array(this.module.heap32.buffer,n,e.length).set(e),n)}createFloatArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>fy?-1:(new Float32Array(this.module.heapF32.buffer,n,e.length).set(e),n)}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.normalScale;this.module.setStyle(n[0],n[1],n[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,o){this.module.setFauxFacadeOptions(e?1:0,n?1:0,o)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){this.memoryStackNextFree=this.memoryStack;for(const p of e){const y=this.createIntArray(p.ringIndices),x=this.createFloatArray(p.coordinates);if(y===-1||x===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(p.id,p.sourceId,p.minHeight,p.height,p.roofType,x,y,p.ringIndices.length-1)}for(const p of n){let y;y=p.entrances?JSON.parse(p.entrances):[];const x=this.createFloatArray(y),S=this.createFloatArray(p.coordinates);if(x===-1||S===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(p.sourceId,p.crossPerc,p.distanceToRoad,x,y.length,S,p.coordinates.length)}if(!this.module.generateMesh()){const p=this.module.getLastError();return this.readStringBuffer(p)}const o=this.module.getMeshCount(),a=new Array(o);for(let p=0;p<o;p++){const y=this.module.getPositionsPtr(p),x=this.module.getPositionsLength(p),S=new Float32Array(this.module.heapF32.buffer,y,x),E=this.module.getNormalsPtr(p),A=this.module.getNormalsLength(p),P=new Float32Array(this.module.heapF32.buffer,E,A),k=this.module.getAOPtr(p),F=this.module.getAOLength(p),G=new Float32Array(this.module.heapF32.buffer,k,F),U=this.module.getUVPtr(p),Y=this.module.getUVLength(p),Q=new Float32Array(this.module.heapF32.buffer,U,Y),ne=this.module.getFauxFacadePtr(p),me=this.module.getFauxFacadeLength(p),de=new Uint8Array(this.module.heapU8.buffer,ne,me),ve=this.module.getIndicesPtr(p),Te=this.module.getIndicesLength(p),Ie=new Int16Array(this.module.heap16.buffer,ve,Te),qe=this.module.getBuildingPart(p);a[p]={positions:S,normals:P,ao:G,uv:Q,isFauxFacade:de,indices:Ie,buildingPart:qe}}const u=this.module.getRingCount(),h=[];for(let p=0;p<u;p++){const y=this.module.getRingPtr(p),x=this.module.getRingLength(p),S=new Float32Array(this.module.heapF32.buffer,y,x);h.push(S)}return{meshes:a,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:h}}}let Dm,py,cu,jp,my,Vp=null,Up=null,S0=null,Lg=null;function E0(){return xi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:py||ri.DRACO_URL}function I0(){if(xi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(jp)return jp;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return jp=WebAssembly.validate(i)?ri.MESHOPT_SIMD_URL:ri.MESHOPT_URL,jp}function lE(){return Lg}const Dg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Om={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function A0(i,e,n){const o=n.json.bufferViews.length,a=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:a,byteLength:i.byteLength},n.buffers[a]=i}const gy="KHR_draco_mesh_compression";function uE(i,e){const n=i.extensions&&i.extensions[gy];if(!n)return;const o=new cu.Decoder,a=R0(e,n.bufferView),u=new cu.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[i.indices],p=Dg[h.componentType],y=h.count*p.BYTES_PER_ELEMENT,x=cu._malloc(y);p===Uint16Array?o.GetTrianglesUInt16Array(u,y,x):o.GetTrianglesUInt32Array(u,y,x),A0(cu.memory.buffer.slice(x,x+y),h,e),cu._free(x);for(const S of Object.keys(n.attributes)){const E=o.GetAttributeByUniqueId(u,n.attributes[S]),A=e.json.accessors[i.attributes[S]],P=cE[A.componentType],k=A.count*Om[A.type]*Dg[A.componentType].BYTES_PER_ELEMENT,F=cu._malloc(k);o.GetAttributeDataArrayForAllPoints(u,E,cu[P],k,F),A0(cu.memory.buffer.slice(F,F+k),A,e),cu._free(F)}o.destroy(),u.destroy(),delete i.extensions[gy]}const Og="EXT_meshopt_compression";function hE(i,e){if(!i.extensions||!i.extensions[Og])return;const n=i.extensions[Og],o=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),a=new Uint8Array(n.count*n.byteStride);my.decodeGltfBuffer(a,n.count,n.byteStride,o,n.mode,n.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=a.buffer,delete i.extensions[Og]}const C0=1179937895,M0=new TextDecoder("utf8");function P0(i,e){return new URL(i,e).href}function dE(i,e,n,o){return fetch(P0(i.uri,o)).then((a=>a.arrayBuffer())).then((a=>{e.buffers[n]=a}))}function R0(i,e){const n=i.json.bufferViews[e];return new Uint8Array(i.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function fE(i,e,n,o){if(i.uri){const a=P0(i.uri,o);return fetch(a).then((u=>u.blob())).then((u=>createImageBitmap(u))).then((u=>{e.images[n]=u}))}if(i.bufferView!==void 0){const a=R0(e,i.bufferView),u=new Blob([a],{type:i.mimeType});return createImageBitmap(u).then((h=>{e.images[n]=h}))}}function k0(i,e=0,n){const o={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===C0){const S=new Uint32Array(i,e);let E=2;const A=(S[E++]>>2)-3,P=S[E++]>>2;if(E++,o.json=JSON.parse(M0.decode(S.subarray(E,E+P))),E+=P,E<A){const k=S[E++];E++;const F=e+(E<<2);o.buffers[0]=i.slice(F,F+k)}}else o.json=JSON.parse(M0.decode(new Uint8Array(i,e)));const{buffers:a,images:u,meshes:h,extensionsUsed:p,bufferViews:y}=o.json;let x=Promise.resolve();if(a){const S=[];for(let E=0;E<a.length;E++){const A=a[E];A.uri?S.push(dE(A,o,E,n)):o.buffers[E]||(o.buffers[E]=null)}x=Promise.all(S)}return x.then((()=>{const S=[],E=p&&p.includes(gy),A=p&&p.includes(Og);if(E&&S.push((function(){if(!cu)return Dm??(Dm=(function(P){let k,F=null;function G(){k=new Uint8Array(F.buffer)}function U(){throw new Error("Unexpected Draco error.")}const Y={a:{a:U,d:function(Q,ne,me){return k.copyWithin(Q,ne,ne+me)},c:function(Q){const ne=k.length,me=Math.max(Q>>>0,Math.ceil(1.2*ne)),de=Math.ceil((me-ne)/65536);try{return F.grow(de),G(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,Y):P.then((Q=>Q.arrayBuffer())).then((Q=>WebAssembly.instantiate(Q,Y)))).then((Q=>{const{Rb:ne,Qb:me,P:de,T:ve,X:Te,Ja:Ie,La:qe,Qa:ke,Va:Qe,Wa:ut,eb:ht,jb:gt,f:vt,e:ft,yb:pt,zb:Je,Ab:Ye,Bb:mt,Db:zt,Gb:St}=Q.instance.exports;F=ft;const hn=(()=>{let Vt=0,Zt=0,nn=0,Qn=0;return It=>{nn&&(ne(Qn),ne(Vt),Zt+=nn,nn=Vt=0),Vt||(Zt+=128,Vt=me(Zt));const on=It.length+7&-8;let Dn=Vt;on>=Zt&&(nn=on,Dn=Qn=me(on));for(let gi=0;gi<It.length;gi++)k[Dn+gi]=It[gi];return Dn}})();return G(),vt(),{memory:ft,_free:ne,_malloc:me,Mesh:class{constructor(){this.ptr=de()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=Ie()}destroy(){gt(this.ptr)}DecodeArrayToMesh(Vt,Zt,nn){const Qn=hn(Vt),It=qe(this.ptr,Qn,Zt,nn.ptr);return!!Te(It)}GetAttributeByUniqueId(Vt,Zt){return{ptr:ke(this.ptr,Vt.ptr,Zt)}}GetTrianglesUInt16Array(Vt,Zt,nn){Qe(this.ptr,Vt.ptr,Zt,nn)}GetTrianglesUInt32Array(Vt,Zt,nn){ut(this.ptr,Vt.ptr,Zt,nn)}GetAttributeDataArrayForAllPoints(Vt,Zt,nn,Qn,It){ht(this.ptr,Vt.ptr,Zt.ptr,nn,Qn,It)}},DT_INT8:pt(),DT_UINT8:Je(),DT_INT16:Ye(),DT_UINT16:mt(),DT_UINT32:zt(),DT_FLOAT32:St()}}))})(fetch(E0())),Dm.then((P=>{cu=P,Dm=void 0})))})()),A&&S.push((function(){if(my)return;const P=(function(k){let F;const G=WebAssembly.instantiateStreaming(k,{}).then((Q=>{F=Q.instance,F.exports.__wasm_call_ctors()})),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:G,supported:!0,decodeGltfBuffer(Q,ne,me,de,ve,Te){(function(Ie,qe,ke,Qe,ut,ht,gt){const vt=Ie.exports.sbrk,ft=Qe+3&-4,pt=vt(ft*ut),Je=vt(ht.length),Ye=new Uint8Array(Ie.exports.memory.buffer);Ye.set(ht,Je);const mt=qe(pt,Qe,ut,Je,ht.length);if(mt===0&&gt&&gt(pt,ft,ut),ke.set(Ye.subarray(pt,pt+Qe*ut)),vt(pt-vt(0)),mt!==0)throw new Error(`Malformed buffer data: ${mt}`)})(F,F.exports[Y[ve]],Q,ne,me,de,F.exports[U[Te]])}}})(fetch(I0()));return P.ready.then((()=>{my=P}))})()),u)for(let P=0;P<u.length;P++)S.push(fE(u[P],o,P,n));return(S.length?Promise.all(S):Promise.resolve()).then((()=>{if(E&&h)for(const{primitives:P}of h)for(const k of P)uE(k,o);if(A&&h&&y)for(const P of y)hE(P,o);return o}))}))}function z0(i){return fetch(i).then((e=>e.arrayBuffer())).then((e=>k0(e,0,i)))}function _y(i){switch(i){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function yy(i){switch(i){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class vy{constructor(e,n,o,a){this.context=e,this.format=o,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:a&&a.premultiply})}update(e,n){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:h}=u,{x:p,y}=n&&n.position?n.position:{x:0,y:0},x=p+o,S=y+a;!this.size||this.size[0]===x&&this.size[1]===S||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!n||n.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&x>0&&S>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(x,S)))+1:1;h.texStorage2D(h.TEXTURE_2D,A,this.format,x,S),this.size=[x,S]}this.size&&(E?h.texSubImage2D(h.TEXTURE_2D,0,p,y,_y(this.format),yy(this.format),e):"data"in e&&e.data&&h.texSubImage2D(h.TEXTURE_2D,0,p,y,o,a,_y(this.format),yy(this.format),e.data)),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,n,o=!1){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,a,u){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapT=a),u!==this.compareMode&&(u?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_FUNC,u)):p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.NONE),this.compareMode=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Fm{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}}const pE=ni([{name:"a_pos_3f",components:3,type:"Float32"}]),mE=ni([{name:"a_color_3f",components:3,type:"Float32"}]),gE=ni([{name:"a_color_4f",components:4,type:"Float32"}]),_E=ni([{name:"a_uv_2f",components:2,type:"Float32"}]),yE=ni([{name:"a_normal_3f",components:3,type:"Float32"}]),vE=ni([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),xE=ni([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function L0(i,e){const n=Fg(i.projection,i.zoom,i.width,i.height),o=(function(u,h,p,y,x){const S=new r(p.lng-180*wf,p.lat),E=new r(p.lng+180*wf,p.lat),A=u.project(S.lng,S.lat),P=u.project(E.lng,E.lat),k=-Math.atan2(P.y-A.y,P.x-A.x),F=ee.fromLngLat(p);F.y=H(F.y,-1+wf,1-wf);const G=F.toLngLat(),U=u.project(G.lng,G.lat),Y=ee.fromLngLat(G);Y.x+=wf;const Q=Y.toLngLat(),ne=u.project(Q.lng,Q.lat),me=O0(ne.x-U.x,ne.y-U.y,k),de=ee.fromLngLat(G);de.y+=wf;const ve=de.toLngLat(),Te=u.project(ve.lng,ve.lat),Ie=O0(Te.x-U.x,Te.y-U.y,k),qe=Math.abs(me.x)/Math.abs(Ie.y),ke=Be([]);jt(ke,ke,-k*(1-(x?0:y)));const Qe=Be([]);return Ct(Qe,Qe,[1,1-(1-qe)*y,1]),Qe[4]=-Ie.x/Ie.y*y,jt(Qe,Qe,k),ot(Qe,ke,Qe),Qe})(i.projection,0,i.center,n,e),a=D0(i);return Ct(o,o,[a,a,1]),o}function D0(i){const e=i.projection,n=Fg(i.projection,i.zoom,i.width,i.height),o=xy(e,i.center),a=xy(e,r.convert(e.center));return Math.pow(2,o*n+(1-n)*a)}function Fg(i,e,n,o,a=1/0){const u=i.range;if(!u)return 0;const h=Math.min(a,Math.max(n,o)),p=Math.log2(h/1024);return K(u[0]+p,u[1]+p,e)}const wf=1/4e4;function xy(i,e){const n=H(e.lat,-D,D),o=new r(e.lng-180*wf,n),a=new r(e.lng+180*wf,n),u=i.project(o.lng,n),h=i.project(a.lng,n),p=ee.fromLngLat(o),y=ee.fromLngLat(a),x=h.x-u.x,S=h.y-u.y,E=y.x-p.x,A=y.y-p.y,P=Math.sqrt((E*E+A*A)/(x*x+S*S));return Math.log2(P)}function O0(i,e,n){const o=Math.cos(n),a=Math.sin(n);return{x:i*o-e*a,y:i*a+e*o}}function F0(i,e,n){Be(i),jt(i,i,ti(e[2])),tt(i,i,ti(e[0])),Nt(i,i,ti(e[1])),Ct(i,i,n),ot(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Bg(i,e,n,o,a,u,h,p){const y=[n[0]-e[0],n[1]-e[1],0],x=[o[0]-e[0],o[1]-e[1],0];if(Hn(y)<1e-12||Hn(x)<1e-12)return Pa(i);const S=_i([],y,x);xn(S,S),mn(x,o,e),y[2]=(u-a)*p,x[2]=(h-a)*p;const E=y;return _i(E,y,x),xn(E,E),Ul(i,S,E)}function Ng(i,e,n=!1){const o=vf(e.zoom),a=(function(u,h,p){const y=h.worldSize,x=[u[12],u[13],u[14]],S=O(x[1]/y),E=C(x[0]/y),A=Be([]),P=I(1,S)*y,k=I(1,0)*y*j(S,h.zoom),F=1/Ir(y);let G=k*F;if(p){const ne=Fg(h.projection,h.zoom,h.width,h.height,1024);G=F*h.projection.pixelSpaceConversion(h.center.lat,y,ne)}const U=Uo(S,E);nt(U,U,Gt([],xn([],U),P*G*x[2]));const Y=(function(ne){const me=[ne[0],ne[1],ne[2]];let de=[0,1,0];const ve=_i([],de,me);return _i(de,me,ve),cn(de)===0&&(de=[0,1,0],_i(ve,me,de)),xn(ve,ve),xn(de,de),xn(me,me),[ve[0],ve[1],ve[2],0,de[0],de[1],de[2],0,me[0],me[1],me[2],0,ne[0],ne[1],ne[2],1]})(U);Ct(A,A,[G,G,G*P]),Ke(A,A,[-x[0],-x[1],-x[2]]);const Q=ot([],h.globeMatrix,Y);return ot(Q,Q,A),ot(Q,Q,u),Q})(i,e,n);if(o>0){const u=(function(h,p){const y=p.worldSize,x=I(1,0)*y*j(p.center.lat,p.zoom)/Ir(y),S=I(1,p.center.lat)*y,E=Be([]);Nt(E,E,ti(p.center.lng)),tt(E,E,ti(p.center.lat)),Ke(E,E,[0,0,gr]),Ct(E,E,[x,x,x*S]);const A=p.point;return Ke(E,E,[-A.x,-A.y,0]),ot(E,E,h),ot(E,p.globeMatrix,E)})(i,e);return(function(h,p,y){const x=(k,F,G)=>{const U=Hn(k),Y=Hn(F),Q=Lr(k,F,G);return Gt(Q,Q,1/Hn(Q)*bn(U,Y,G))},S=x([h[0],h[1],h[2]],[p[0],p[1],p[2]],y),E=x([h[4],h[5],h[6]],[p[4],p[5],p[6]],y),A=x([h[8],h[9],h[10]],[p[8],p[9],p[10]],y),P=Lr([h[12],h[13],h[14]],[p[12],p[13],p[14]],y);return[S[0],S[1],S[2],0,E[0],E[1],E[2],0,A[0],A[1],A[2],0,P[0],P[1],P[2],1]})(a,u,o)}return a}function wy(i,e,n,o){const a=Kt.projectAabbCorners(o,n);let u=Number.MAX_VALUE;for(let p=0;p<a.length;++p){const y=a[p];y[0]=(.5*y[0]+.5)*e.width,y[1]=(.5-.5*y[1])*e.height,y[2]<u&&(u=y[2])}const h=(function(p){const y=[];let x=0;for(let P=1;P<p.length;P++)(p[P][0]<p[x][0]||p[P][0]===p[x][0]&&p[P][1]<p[x][1])&&(x=P);let S,E=x;const A=new Uint8Array(p.length);do{if(A[E])break;y.push(new ct(p[E][0],p[E][1])),A[E]=1,S=(E+1)%p.length;for(let P=0;P<p.length;P++){if(p[P][0]===p[S][0]&&p[P][1]===p[S][1]||p[P][0]===p[E][0]&&p[P][1]===p[E][1])continue;const k=[p[P][0]-p[E][0],p[P][1]-p[E][1]],F=[p[S][0]-p[E][0],p[S][1]-p[E][1]],G=k[0]*F[1]-k[1]*F[0];(G>0||G===0&&k[0]*F[0]+k[1]*F[1]>=0&&k[0]*k[0]+k[1]*k[1]>F[0]*F[0]+F[1]*F[1])&&(S=P)}E=S}while(E!==x);return y.length>0&&y.push(y[0]),y})(a);if(Ii(i,h))return u}const hp=64,Gp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jg(i,e,n,o,a,u,h,p,y,x=!1){const S=n.zoom,E=n.project(o),A=j(o.lat,S),P=1/A;Be(i),Ke(i,i,[E.x+h[0]*P,E.y+h[1]*P,h[2]]);let k=1,F=1;const G=n.worldSize;if(x){if(n.projection.name==="mercator"){let ne=0;n.elevation&&(ne=n.elevation.getAtPointOrZero(new ee(E.x/G,E.y/G),0));const me=So([],[E.x,E.y,ne,1],n.projMatrix)[3]/n.cameraToCenterDistance;k=me,F=me*j(n.center.lat,S)}else if(n.projection.name==="globe"){const ne=Ng(i,n),me=[0,0,0,1];So(me,me,ot([],n.projMatrix,ne));const de=me[3]/n.cameraToCenterDistance,ve=vf(S),Te=n.projection.pixelsPerMeter(o.lat,G)*j(o.lat,S),Ie=n.projection.pixelsPerMeter(n.center.lat,G)*j(n.center.lat,S);k=de/bn(Te,V(n.center.lat),ve),F=de*A/Te,k*=Ie,F*=Ie}}else k=P;Ct(i,i,[k,k,F]);const U=[...i],Y=e.orientation,Q=[];if(F0(Q,[Y[0]+(a?a[0]:0),Y[1]+(a?a[1]:0),Y[2]+(a?a[2]:0)],u),ot(i,U,Q),p&&n.elevation){let ne=0;const me=[];if(y&&n.elevation){ne=(function(ve,Te,Ie,qe,ke){const Qe=Te.elevation;if(!Qe)return 0;const ut=Kt.projectAabbCorners(Ie,qe),ht=I(1,ke.lat)*Te.worldSize,gt=(function(Zt,nn){const Qn=[0,0,1],It=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const on of It){const Dn=Zt[on.corners[0]],gi=Zt[on.corners[1]],bi=Zt[on.corners[2]],qn=[gi[0]-Dn[0],gi[1]-Dn[1],nn*(gi[2]-Dn[2])],Yi=_i(qn,qn,[bi[0]-Dn[0],bi[1]-Dn[1],nn*(bi[2]-Dn[2])]);xn(Yi,Yi),on.dotProductWithUp=kn(Yi,Qn)}return It.sort(((on,Dn)=>on.dotProductWithUp-Dn.dotProductWithUp)),It[0].corners})(ut,ht),vt=ut[gt[0]],ft=ut[gt[1]],pt=ut[gt[2]],Je=ut[gt[3]],Ye=Qe.getAtPointOrZero(new ee(vt[0]/Te.worldSize,vt[1]/Te.worldSize),0),mt=Qe.getAtPointOrZero(new ee(ft[0]/Te.worldSize,ft[1]/Te.worldSize),0),zt=Qe.getAtPointOrZero(new ee(pt[0]/Te.worldSize,pt[1]/Te.worldSize),0),St=Qe.getAtPointOrZero(new ee(Je[0]/Te.worldSize,Je[1]/Te.worldSize),0),hn=(Ye+St)/2,Vt=(mt+zt)/2;return hn>Vt?mt<zt?Bg(ve,ft,Je,vt,mt,St,Ye,ht):Bg(ve,pt,vt,Je,zt,Ye,St,ht):Ye<St?Bg(ve,vt,ft,pt,Ye,mt,zt,ht):Bg(ve,Je,pt,ft,St,zt,mt,ht),Math.max(hn,Vt)})(me,n,e.aabb,i,o);const de=ot([],Ti([],me),Q);ot(i,U,de)}else ne=n.elevation.getAtPointOrZero(new ee(E.x/G,E.y/G),0);ne!==0&&(i[14]+=ne)}}class B0{constructor(e,n,o,a,u){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=o!=null?new r(o[0],o[1]):new r(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Kt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){ot(e.globalMatrix,n,e.localMatrix);const o=this.nodeOverrides.get(e.name);if(o!==void 0){const h=[];u=o.orientation,Be(a=h),Nt(a,a,ti(u[1])),jt(a,a,ti(u[2])),tt(a,a,ti(u[0])),ot(e.globalMatrix,e.globalMatrix,h)}var a,u;if(e.meshes)for(const h of e.meshes){const p=Kt.applyTransformFast(h.aabb,e.globalMatrix);this.aabb.encapsulate(p)}if(e.children)for(const h of e.children)this._applyTransformations(h,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Be([]);this.aabb=new Kt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,o,a,u,h,p=!1){jg(this.matrix,this,e.transform,this.position,n,o,a,u,h,p)}upload(e){if(!this.uploaded){for(const n of this.nodes)by(n,e);for(const n of this.nodes)Vg(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)Ty(e)}}function Bm(i,e,n=!1){i.uploaded||(i.gfxTexture=new vy(e,i.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function wE(i,e,n){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,pE.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,yE.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,_E.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?mE:gE).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,xE.members,!0)),i.segments=ki.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const o=i.material;o.pbrMetallicRoughness.baseColorTexture&&Bm(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Bm(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Bm(o.normalTexture,e),o.occlusionTexture&&Bm(o.occlusionTexture,e,n),o.emissionTexture&&Bm(o.emissionTexture,e)}function by(i,e,n){if(i.meshes)for(const o of i.meshes)wE(o,e,n);if(i.children)for(const o of i.children)by(o,e,n)}function Vg(i){if(i.meshes)for(const e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(const e of i.children)Vg(e)}function Ty(i){if(i.meshes)for(const n of i.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(const n of i.children)Ty(n)}function dp(i,e){const n=i.json.bufferViews[e.bufferView],o=Dg[e.componentType];return new o(i.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Om[e.type]*o.BYTES_PER_ELEMENT?n.byteStride/o.BYTES_PER_ELEMENT:Om[e.type]))}function Sy(i,e,n,o){const a=Dg[e.componentType],u=(function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(a),h=i.json.bufferViews[e.bufferView],p=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:Om[e.type],y=n.float32,x=y.length/n.capacity;for(let S=0,E=0;S<e.count*p;S+=p,E+=x)for(let A=0;A<x;A++)y[E+A]=o[S+A]*u;n._trim()}function bE(i,e,n){const o=i.indices,a=i.attributes,u={};u.indexArray=new Jr;const h=e.json.accessors[o],p=h.count/3;u.indexArray.reserve(p);const y=dp(e,h);for(let A=0;A<p;A++)u.indexArray.emplaceBack(y[3*A],y[3*A+1],y[3*A+2]);u.indexArray._trim(),u.vertexArray=new Fs;const x=e.json.accessors[a.POSITION];u.vertexArray.reserve(x.count);const S=dp(e,x);for(let A=0;A<x.count;A++)u.vertexArray.emplaceBack(S[3*A],S[3*A+1],S[3*A+2]);if(u.vertexArray._trim(),u.aabb=new Kt(x.min,x.max),u.centroid=(function(A,P){const k=[0,0,0],F=A.length;if(F>0){for(let G=0;G<F;G++){const U=3*A[G];k[0]+=P[U],k[1]+=P[U+1],k[2]+=P[U+2]}k[0]/=F,k[1]/=F,k[2]/=F}return k})(y,S),a.COLOR_0!==void 0){const A=e.json.accessors[a.COLOR_0],P=Om[A.type],k=dp(e,A);u.colorArray=P===3?new Fs:new sc,u.colorArray.resize(A.count),Sy(e,A,u.colorArray,k)}if(a.NORMAL!==void 0){u.normalArray=new Fs;const A=e.json.accessors[a.NORMAL];u.normalArray.resize(A.count);const P=dp(e,A);Sy(e,A,u.normalArray,P)}if(a.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new al;const A=e.json.accessors[a.TEXCOORD_0];u.texcoordArray.resize(A.count);const P=dp(e,A);Sy(e,A,u.texcoordArray,P)}if(a._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=dp(e,A))}a._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(dp(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const E=i.material;return u.material=(function(A,P){const{emissiveFactor:k=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:G=.5,normalTexture:U,occlusionTexture:Y,emissiveTexture:Q,doubleSided:ne,name:me}=A,{baseColorFactor:de=[1,1,1,1],metallicFactor:ve=1,roughnessFactor:Te=1,baseColorTexture:Ie,metallicRoughnessTexture:qe}=A.pbrMetallicRoughness||{},ke=Y?P[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&ke){const Qe=Y.extensions.KHR_texture_transform;ke.offsetScale=[Qe.offset[0],Qe.offset[1],Qe.scale[0],Qe.scale[1]]}return{name:me,pbrMetallicRoughness:{baseColorFactor:new Vi(...de),metallicFactor:ve,roughnessFactor:Te,baseColorTexture:Ie?P[Ie.index]:void 0,metallicRoughnessTexture:qe?P[qe.index]:void 0},doubleSided:ne,emissiveFactor:new Vi(...k),alphaMode:F,alphaCutoff:G,normalTexture:U?P[U.index]:void 0,occlusionTexture:ke,emissionTexture:Q?P[Q.index]:void 0,defined:A.defined===void 0}})(E!==void 0?e.json.materials[E]:{defined:!1},n),u}function N0(i,e,n){const{matrix:o,rotation:a,translation:u,scale:h,mesh:p,extras:y,children:x,name:S}=i,E={};if(E.name=S,E.localMatrix=o||(function(A,P,k,F){var G=P[0],U=P[1],Y=P[2],Q=P[3],ne=G+G,me=U+U,de=Y+Y,ve=G*ne,Te=G*me,Ie=G*de,qe=U*me,ke=U*de,Qe=Y*de,ut=Q*ne,ht=Q*me,gt=Q*de,vt=F[0],ft=F[1],pt=F[2];return A[0]=(1-(qe+Qe))*vt,A[1]=(Te+gt)*vt,A[2]=(Ie-ht)*vt,A[3]=0,A[4]=(Te-gt)*ft,A[5]=(1-(ve+Qe))*ft,A[6]=(ke+ut)*ft,A[7]=0,A[8]=(Ie+ht)*pt,A[9]=(ke-ut)*pt,A[10]=(1-(ve+qe))*pt,A[11]=0,A[12]=k[0],A[13]=k[1],A[14]=k[2],A[15]=1,A})([],a||[0,0,0,1],u||[0,0,0],h||[1,1,1]),E.globalMatrix=Ce(E.localMatrix),p!==void 0){E.meshes=n[p];const A=E.anchor=[0,0];for(const P of E.meshes){const{min:k,max:F}=P.aabb;A[0]+=k[0]+F[0],A[1]+=k[1]+F[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(y&&(y.id&&(E.id=y.id),y.lights&&(E.lights=(function(A){if(!A.length)return[];const P=(function(Y){const Q=atob(Y),ne=new Uint8Array(Q.length);for(let me=0;me<Q.length;me++)ne[me]=Q.codePointAt(me);return ne})(A),k=[],F=P.length/24,G=new Uint16Array(P.buffer),U=new Float32Array(P.buffer);for(let Y=0;Y<F;Y++){const Q=G[2*Y*6]/30,ne=G[2*Y*6+1]/30,me=G[2*Y*6+10]/100,de=U[6*Y+1],ve=U[6*Y+2],Te=U[6*Y+3],Ie=U[6*Y+4],qe=Te-de,ke=Ie-ve,Qe=Math.hypot(qe,ke);k.push({pos:[de+.5*qe,ve+.5*ke,ne],normal:[ke/Qe,-qe/Qe,0],width:Qe,height:Q,depth:me,points:[de,ve,Te,Ie]})}return k})(y.lights)),y.MAPBOX_geometry_bloom&&(E.isGeometryBloom=y.MAPBOX_geometry_bloom)),x){const A=[];for(const P of x)A.push(N0(e.json.nodes[P],e,n));E.children=A}return E}function TE(i){if(i.vertices.length===0||i.indices.length===0)return null;const e=new Ag(i.vertices,i.indices,8,256),[n,o]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:n,max:o}}function SE(i){if(!i.extras||!i.extras.ground)return null;const e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const o=[];for(const h of n){if(!Array.isArray(h)||h.length!==2)continue;const p=h[0],y=h[1];typeof p=="number"&&typeof y=="number"&&o.push(new ct(p,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let h=0;h<o.length;h++){const p=o[h],y=o[(h+1)%o.length],x=o[(h+2)%o.length];a+=(p.x-y.x)*(x.y-y.y)-(x.x-y.x)*(p.y-y.y)}a>0&&o.reverse();const u=Fp(o.flatMap((h=>[h.x,h.y])),[]);return u.length===0?null:{vertices:o,indices:u}}function EE(i,e){const n=[],o=[];let a=0;const u=[];for(const h of i){a=n.length;const p=h.vertexArray.float32,y=h.indexArray.uint16;for(let x=0;x<h.vertexArray.length;x++)u[0]=p[3*x+0],u[1]=p[3*x+1],u[2]=p[3*x+2],Gi(u,u,e),n.push(new ct(u[0],u[1]));for(let x=0;x<3*h.indexArray.length;x++)o.push(y[x]+a)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){const p=n[o[h+0]],y=n[o[h+1]],x=n[o[h+2]];(p.x-y.x)*(x.y-y.y)-(x.x-y.x)*(p.y-y.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:n,indices:o}}function Ey(i){const e=(function(y,x){const S=[],E=WebGL2RenderingContext;if(y.json.textures)for(const A of y.json.textures){const P={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};A.sampler!==void 0&&Object.assign(P,y.json.samplers[A.sampler]),S.push({image:x[A.source],sampler:P,uploaded:!1})}return S})(i,i.images),n=(function(y,x){const S=[];for(const E of y.json.meshes){const A=[];for(const P of E.primitives)A.push(bE(P,y,x));S.push(A)}return S})(i,e),{scenes:o,scene:a,nodes:u}=i.json,h=o?o[a||0].nodes:[...u.keys()],p=[];for(const y of h)p.push(N0(u[y],i,n));return(function(y,x,S){const E={},A=new Set;for(let P=0;P<y.length;P++){const k=S[x[P]];if(!k.extras)continue;const F=k.extras["mapbox:footprint:version"],G=k.extras["mapbox:footprint:id"];(F||G)&&A.add(P),F==="1.0.0"&&G&&(E[G]=P)}for(let P=0;P<y.length;P++){if(A.has(P))continue;const k=y[P],F=S[x[P]];if(!F.extras)continue;let G=null;k.id in E&&(G=EE(y[E[k.id]].meshes,k.localMatrix)),G||(G=SE(F)),G&&(k.footprint=TE(G))}if(A.size>0){const P=Array.from(A.values()).sort(((k,F)=>k-F));for(let k=P.length-1;k>=0;k--)y.splice(P[k],1)}})(p,h,i.json.nodes),p}function IE(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const e=i.vertexArray.float32,n=i.aabb.min[0]-1,o=i.aabb.min[1]-1,a=hp/(i.aabb.max[0]-n+2),u=hp/(i.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){const p=e[h+2],y=(e[h+0]-n)*a|0,x=(e[h+1]-o)*u|0;p>i.heightmap[x*hp+y]&&(i.heightmap[x*hp+y]=p)}}function j0(i,e,n,o,a){n.reserve(n.length+4*i.length),o.reserve(o.length+10*i.length),a.reserve(a.length+10*i.length);let u=o.length;for(const h of i){const p=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],x=Math.min(.29,.1*h.width/h.depth),S=h.width-2*h.depth*e*(x+.01),E=gn([],h.pos,y,S/2),A=gn([],h.pos,y,-S/2),P=[E[0],E[1],E[2]+h.height],k=[A[0],A[1],A[2]+h.height],F=gn([],h.normal,y,x);Gt(F,F,p);const G=gn([],h.normal,y,-x);Gt(G,G,p),nt(F,E,F),nt(G,A,G),E[2]+=.1,A[2]+=.1,o.emplaceBack(F[0],F[1],F[2]),o.emplaceBack(G[0],G[1],G[2]),o.emplaceBack(E[0],E[1],E[2]),o.emplaceBack(A[0],A[1],A[2]),o.emplaceBack(P[0],P[1],P[2]),o.emplaceBack(k[0],k[1],k[2]),o.emplaceBack(E[0],E[1],E[2]),o.emplaceBack(A[0],A[1],A[2]),o.emplaceBack(F[0],F[1],F[2]),o.emplaceBack(G[0],G[1],G[2]);const U=S/p/2;a.emplaceBack(-U-x,-1,U,.8),a.emplaceBack(U+x,-1,U,.8),a.emplaceBack(-U,0,U,1.3),a.emplaceBack(U,0,U,1.3),a.emplaceBack(U+x,-.8,U,.7),a.emplaceBack(U+x,-.8,U,.7),a.emplaceBack(0,0,U,1.3),a.emplaceBack(0,0,U,1.3),a.emplaceBack(U+x,-1.2,U,.8),a.emplaceBack(U+x,-1.2,U,.8),n.emplaceBack(6+u,4+u,8+u),n.emplaceBack(7+u,9+u,5+u),n.emplaceBack(0+u,1+u,2+u),n.emplaceBack(1+u,3+u,2+u),u+=10}}function AE(i,e){const n={};n.indexArray=new Jr,n.vertexArray=new Fs,n.colorArray=new sc,j0(i,e,n.indexArray,n.vertexArray,n.colorArray);const o={defined:!0};o.emissiveFactor=Vi.black;const a={};return a.baseColorFactor=Vi.white,o.pbrMetallicRoughness=a,n.material=o,n.aabb=new Kt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const V0=ni([{name:"a_pos_3f",components:3,type:"Float32"}]),CE=ni([{name:"a_normal_3",components:3,type:"Int16"}]),ME=ni([{name:"a_centroid_3",components:3,type:"Int16"}]),U0=ni([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),PE=ni([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),RE=ni([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),kE=ni([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),zE=ni([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),LE=ni([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),G0=Ae.types,Ug=32767;function DE(i,e){const n=Pt+e;for(const o of i)for(const a of o)if(a.x<-e||a.x>n||a.y<-e||a.y>n)return!1;return!0}function OE(i){switch(i){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${i}`)}}class Iy{constructor(){this.layoutVertexArray=new Fs,this.layoutAttenuationArray=new sc,this.layoutColorArray=new sa,this.indexArray=new Jr,this.indexArrayForConflation=new Jr,this.segmentsBucket=new ki}}class Ay{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new ki,this.entranceBloom=new Iy;const n=66560;this.layoutVertexArray=new Fs,this.layoutVertexArray.reserve(n),this.layoutNormalArray=new rh,this.layoutNormalArray.reserve(n),this.layoutCentroidArray=new rh,this.layoutCentroidArray.reserve(n),this.layoutColorArray=new sa,this.layoutColorArray.reserve(n),this.layoutFloodLightDataArray=new Dl,this.layoutFloodLightDataArray.reserve(n),this.layoutAOArray=new iu,this.layoutAOArray.reserve(n),this.indexArray=new Jr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Jr,this.segmentsBucket=new ki,this.entranceBloom=new Iy,e&&(this.layoutFacadePaintArray=new sa,this.layoutFacadeDataArray=new oc,this.layoutFacadeVerticalRangeArray=new sa)}reserve(e,n,o){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(n),o&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class $0{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new al,this.footprintsIndices=new Dl,this.footprintsMin=new ct(1/0,1/0),this.footprintsMax=new ct(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new Ay(!1),this.buildingWithFacade=new Ay(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.projection=e.projection,this.groundEffect=new cy(e),this.groundEffect.groundRadiusArray=new sl,this.hasAppearances=null}updateFootprints(e,n){const o=new Ag([],[],1),a={vertices:[],indices:new Uint32Array(0),grid:o,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};n.push({footprint:a,id:e})}updateAppearances(e,n,o,a){}prepare(){return(function(){if(Lg!=null||S0!=null)return null;if(Up!=null)return Up;const e=fetch(ri.BUILDING_GEN_URL);return Up=(function(n){let o,a,u,h,p;function y(){o=new Uint8Array(p.buffer),a=new Int16Array(p.buffer),u=new Int32Array(p.buffer),h=new Float32Array(p.buffer)}function x(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},E={a:{a:x,f:function(A){const P=o.length,k=Math.max(A>>>0,Math.ceil(1.2*P)),F=Math.ceil((k-P)/65536);try{return p.grow(F),y(),!0}catch{return!1}},g:x,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,E):n.then((A=>A.arrayBuffer())).then((A=>WebAssembly.instantiate(A,E)))).then((A=>{const P=A.instance.exports;return(0,P.g)(),p=P.f,y(),new aE({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setStructuralOptions:P.k,setFacadeOptions:P.l,setFauxFacadeOptions:P.m,setFacadeClassifierOptions:P.n,addFeature:P.o,addFacade:P.p,generateMesh:P.q,getLastError:P.r,getOuterRingLength:P.s,getMeshCount:P.t,getPositionsPtr:P.u,getPositionsLength:P.v,getNormalsPtr:P.w,getNormalsLength:P.x,getAOPtr:P.y,getAOLength:P.z,getUVPtr:P.A,getUVLength:P.B,getFauxFacadePtr:P.C,getFauxFacadeLength:P.D,getIndicesPtr:P.E,getIndicesLength:P.F,getBuildingPart:P.G,getRingCount:P.H,getRingPtr:P.I,getRingLength:P.J,malloc:P.K,free:P.L,heapU8:o,heap16:a,heap32:u,heapF32:h})}))})(e).then((n=>(Up=null,Lg=n,Lg))).catch((n=>{$t("Could not load building-gen"),Up=null,S0=n})),Up})()}populate(e,n,o,a){const u=lE();if(!u)return;const h=q(o);this.tileToMeter=h,this.brightness=n.brightness,u.setStyle({normalScale:[1,-1,h],tileToMeters:h}),u.setAOOptions(!1,.3),u.setMetricOptions(!1,16),u.setStructuralOptions(!0),u.setFacadeClassifierOptions(3);const p=new Map,y=new Map;let x=0;for(const{feature:U}of e){if(G0[U.type]!=="LineString"){p.set(U.id,U.properties.source_id);continue}const Y=this.layers[0]._featureFilter.needGeometry;if(Y&&!this.layers[0]._featureFilter.filter(new Xi(this.zoom),U,o))continue;const Q=Re(U,Y);if(!Y&&!this.layers[0]._featureFilter.filter(new Xi(this.zoom),Q,o))continue;const ne=Y?Q.geometry:xe(U,o,a),me=[];for(const Ie of ne)for(const qe of Ie)me.push(qe.x),me.push(qe.y);const de={coordinates:me,crossPerc:U.properties.cross_perc,distanceToRoad:U.properties.distance_to_road,entrances:U.properties.entrances,sourceId:0},ve=U.properties.source_id;let Te=y.get(ve);Te||(Te=[],y.set(ve,Te)),Te.push(de),++x}this.maxHeight=0;const S=new Array,E=new Set,A=U=>{U!=null&&E.add(U)},P=(U,Y)=>{U!=null&&S.push({buildingId:U,footprintIndex:Y})},k=64*(e.length-x),F=k/2;this.buildingWithFacade.reserve(k,F,!0),this.buildingWithoutFacade.reserve(2*k,2*F,!1),this.footprintsIndices.reserve(16*(e.length-x)),this.footprintsVertices.reserve(8*(e.length-x));for(const{feature:U,id:Y,index:Q,sourceLayerIndex:ne}of e){if(G0[U.type]==="LineString")continue;const me=this.layers[0]._featureFilter.needGeometry;if(me&&!this.layers[0]._featureFilter.filter(new Xi(this.zoom),U,o))continue;let de=null;if(U.properties&&U.properties.hasOwnProperty("building_id")&&(de=U.properties.building_id,E.has(de)))continue;const ve=Re(U,me);if(!me&&!this.layers[0]._featureFilter.filter(new Xi(this.zoom),ve,o))continue;const Te=me?ve.geometry:xe(U,o,a),Ie=Am(Te,500);let qe=!1;for(const Sn of Ie)if(Sn.length!==1){qe=!0;break}if(qe){A(de);continue}if(!DE(Te,163)){A(de);continue}const ke=this.layers[0],Qe=OE(ke.layout.get("building-roof-shape").evaluate(U,{},o)),ut=ke.layout.get("building-base").evaluate(U,{},o),ht=ke.layout.get("building-height").evaluate(U,{},o),gt=ke.layout.get("building-flood-light-ground-radius").evaluate(U,{},o),vt=ke.paint.get("building-ambient-occlusion-intensity"),ft=gt/this.tileToMeter;U.properties["building-part"]="roof";const pt=ke.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),Je=ke.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="wall";const Ye=ke.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),mt=ke.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="window";const zt=ke.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),St=ke.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="door";const hn=ke.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),Vt=ke.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);let Zt=ke.layout.get("building-flood-light-wall-radius").evaluate(U,{},o);Zt=H(Zt,0,2048);const nn=Zt/2048*Ug,Qn=p.get(Y),It=y.get(Qn)||[],on=It.length!==0&&ke.layout.get("building-facade").evaluate(U,{},o);u.setFacadeOptions(4,!0),u.setFauxFacadeOptions(on,!1,1);let Dn=0,gi=0,bi=0,qn=0,Yi=0,fe=0,_e=0,et=0,_t=0,Ot=0,Ft=0;if(on){let Sn=Math.round(ke.layout.get("building-facade-floors").evaluate(U,{},o));if(ut===0){Sn=Math.max(1,Sn-(It.length>0?1:0));let qi=4;if(ht>100){const yr=[10,13,15];qi=yr[U.id?U.id%yr.length:0]}else ht<=10&&(qi=3);u.setFacadeOptions(qi,!0),Yi=(ht<15?1.3:1.61803)*qi/h}else Yi=ut/h;fe=ht/h,Yi=Math.min(Yi,fe),bi=ke.layout.get("building-facade-unit-width").evaluate(U,{},o)/h,qn=(fe-Yi)/Sn,u.setFauxFacadeOptions(!0,!0,bi);const Ar=ke.layout.get("building-facade-window").evaluate(U,{},o);Dn=Ar[0],gi=Ar[1],_e=Math.floor(65535*Math.min(1,Yi/Pt)),et=Math.floor(65535*Math.min(1,fe/Pt)),_t=Math.floor(255*Dn)<<8|Math.floor(255*gi),Ot=Math.floor(65535*Math.min(1,bi/Pt)),Ft=Math.floor(65535*Math.min(1,qn/Pt))}const fn=Array(Ie.length),pn={x:1/0,y:1/0},$n={x:-1/0,y:-1/0},Xn={x:0,y:0};let Jn=0;for(let Sn=0;Sn<Ie.length;Sn++){const Ar=Ie[Sn];if(Ar.length>0){const qi=[],yr=Array(Ar.length+1);yr[0]=0;for(let bo=0;bo<Ar.length;bo++){const Do=Ar[bo];for(let ao=0;ao<Do.length;ao++){const lo=Do[Do.length-ao-1];pn.x=Math.min(pn.x,lo.x),pn.y=Math.min(pn.y,lo.y),$n.x=Math.max($n.x,lo.x),$n.y=Math.max($n.y,lo.y),Xn.x+=lo.x,Xn.y+=lo.y,Jn++,qi.push(lo.x),qi.push(lo.y)}yr[bo+1]=qi.length}fn[Sn]={id:U.id?U.id:0,height:ht,minHeight:ut,sourceId:0,roofType:Qe,coordinates:qi,ringIndices:yr}}}Xn.x/=Jn||1,Xn.y/=Jn||1;const di=u.generateMesh(fn,It);if(typeof di=="string"){$t(`Unable to generate building ${U.id}: ${di}`),A(de);continue}if(di.meshes.length===0||di.modifiedPolygonRings.length===0){A(de);continue}const Cn=on?this.buildingWithFacade:this.buildingWithoutFacade;let Ln=0;for(const Sn of di.meshes)Ln+=Sn.positions.length/3;const Pi=Cn.segmentsBucket.prepareSegment(Ln,Cn.layoutVertexArray,Cn.indexArray),Li=[];let Di=null,Wi=0,nr=-1;const Ki=Cn.layoutVertexArray.length,Ni=Ki+Ln;Cn.layoutVertexArray.resize(Ni),Cn.layoutCentroidArray.resize(Ni),Cn.layoutNormalArray.resize(Ni),Cn.layoutAOArray.resize(Ni),Cn.layoutColorArray.resize(Ni),Cn.layoutFloodLightDataArray.resize(Ni),on&&(Cn.layoutFacadePaintArray.resize(Ni),Cn.layoutFacadeDataArray.resize(Ni),Cn.layoutFacadeVerticalRangeArray.resize(Ni));const Ui=Cn.indexArray.length;let Yn=0,vi=Ki;for(const Sn of di.meshes){let Ar,qi;if(Sn.buildingPart===1)Ar=pt,qi=Je;else if(Sn.buildingPart===0)Ar=Ye,qi=mt;else if(Sn.buildingPart===2)Ar=zt,qi=St;else{if(Sn.buildingPart!==3)continue;Ar=hn,qi=Vt}if(qi=H(qi,0,1),Sn.buildingPart===3){const ar=new Array;for(let To=0;To<Sn.positions.length;To+=12){const zc=Sn.positions[To+0],fh=Sn.positions[To+1],hs=Sn.positions[To+3],ha=Sn.positions[To+4],ml=Sn.positions[To+2],Ef=Sn.positions[To+8]-ml,nm=1,pu=hs-zc,mu=ha-fh,lg=Math.hypot(pu,mu);ar.push({pos:[zc+.5*pu,fh+.5*mu,ml],normal:[mu/lg,-pu/lg,0],width:lg,height:Ef,depth:nm,points:[zc,fh,hs,ha]})}const Br=Cn.entranceBloom.segmentsBucket.prepareSegment(10*ar.length,Cn.entranceBloom.layoutVertexArray,Cn.entranceBloom.indexArray),$r=Cn.entranceBloom.layoutVertexArray.length;Wi=Cn.entranceBloom.indexArray.length,j0(ar,.5/this.tileToMeter,Cn.entranceBloom.indexArray,Cn.entranceBloom.layoutVertexArray,Cn.entranceBloom.layoutAttenuationArray);const Ha=Cn.entranceBloom.layoutVertexArray.length-$r;nr=Cn.entranceBloom.indexArray.length-Wi;for(let To=0;To<Ha;To++)Cn.entranceBloom.layoutColorArray.emplaceBack(255*hn.r<<8|255*hn.g,255*hn.b<<8|51*Vt);Br.vertexLength+=Ha,Br.primitiveLength+=nr,Di={part:Sn.buildingPart,vertexOffset:$r,vertexLength:Ha}}Cn.layoutVertexArray.float32.set(Sn.positions,3*vi);const yr=Sn.positions.length/3;for(let ar=0;ar<yr;++ar){const Br=3*ar;Yn=Math.max(Yn,Sn.positions[Br+2]);const $r=Sn.normals[Br+1]*Ug,Ha=Sn.normals[Br+2]*Ug,To=3*(vi+ar);Cn.layoutNormalArray.int16[To]=Sn.normals[Br]*Ug,Cn.layoutNormalArray.int16[To+1]=$r,Cn.layoutNormalArray.int16[To+2]=Ha;const zc=Sn.ao[ar];Cn.layoutAOArray.uint8[vi+ar]=255*zc;const fh=1+(zc-1)*vt,hs=255*Ar.b*fh<<8|255*qi;Cn.layoutColorArray.uint16[2*(vi+ar)]=255*Ar.r*fh<<8|255*Ar.g*fh,Cn.layoutColorArray.uint16[2*(vi+ar)+1]=hs}const bo=Math.floor(Xn.x),Do=Math.floor(Xn.y),ao=Math.floor(ht);for(let ar=0;ar<yr;++ar){const Br=3*(vi+ar);Cn.layoutCentroidArray.int16[Br]=bo,Cn.layoutCentroidArray.int16[Br+1]=Do,Cn.layoutCentroidArray.int16[Br+2]=ao}if(Cn.layoutFloodLightDataArray.uint16.fill(Sn.buildingPart===0?nn:0,vi,vi+yr),on){const ar=255*zt.r<<8|255*zt.g,Br=255*zt.b<<8|255*St;for(let $r=0;$r<yr;++$r){const Ha=2*(vi+$r);Cn.layoutFacadePaintArray.uint16[Ha]=ar,Cn.layoutFacadePaintArray.uint16[Ha+1]=Br}for(let $r=0;$r<yr;++$r)if(Sn.isFauxFacade[$r]){const Ha=Math.min(65535,Math.floor(Sn.uv[2*$r]*di.outerRingLength));Cn.layoutFacadeDataArray.emplace(vi+$r,1|Ha,_t,Ot,Ft),Cn.layoutFacadeVerticalRangeArray.emplace(vi+$r,_e,et)}else Cn.layoutFacadeDataArray.emplace(vi+$r,0,0,0,0),Cn.layoutFacadeVerticalRangeArray.emplace(vi+$r,0,0)}const lo=Pi.vertexLength,Po=Sn.indices.length/3,Ea=Cn.indexArray.length;Cn.indexArray.resize(Ea+Po);for(let ar=0;ar<Po;++ar){const Br=3*ar,$r=3*Ea+Br;Cn.indexArray.uint16[$r]=lo+Sn.indices[Br],Cn.indexArray.uint16[$r+1]=lo+Sn.indices[Br+1],Cn.indexArray.uint16[$r+2]=lo+Sn.indices[Br+2]}Sn.buildingPart!==1&&Sn.buildingPart!==0&&Sn.buildingPart!==2&&Sn.buildingPart!==3||Li.push({part:Sn.buildingPart,vertexOffset:vi,vertexLength:Sn.positions.length/3}),vi+=yr,Pi.vertexLength+=yr,Pi.primitiveLength+=Sn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Yn);const Er=Cn.indexArray.length-Ui,Tn=this.footprintsIndices.length,fi=this.footprintsVertices.length,er=[],rr=new ct(1/0,1/0),hr=new ct(-1/0,-1/0),Gr=this.groundEffect.vertexArray.length;for(const Sn of di.modifiedPolygonRings){const Ar=[],qi=new ct(1/0,1/0),yr=new ct(-1/0,-1/0);for(let bo=0;bo<Sn.length;bo+=2){const Do=Sn.length-bo-2;qi.x=Math.min(qi.x,Sn[Do]),qi.y=Math.min(qi.y,Sn[Do+1]),yr.x=Math.max(yr.x,Sn[Do]),yr.y=Math.max(yr.y,Sn[Do+1]);const ao=new ct(Sn[Do],Sn[Do+1]);Ar.push(ao),er.push(ao.x,ao.y),this.footprintsVertices.emplaceBack(ao.x,ao.y)}rr.x=Math.min(rr.x,qi.x),rr.y=Math.min(rr.y,qi.y),hr.x=Math.max(hr.x,yr.x),hr.y=Math.max(hr.y,yr.y),this.groundEffect.addData(Ar,[qi,yr],ft)}const sr=this.groundEffect.vertexArray.length-Gr;this.groundEffect.groundRadiusArray.reserveForAdditional(sr);for(let Sn=0;Sn<sr;Sn++)this.groundEffect.groundRadiusArray.emplaceBack(gt);(pn.x<0||$n.x>Pt||pn.y<0||$n.y>Pt)&&this.featuresOnBorder.push({featureId:U.id,footprintIndex:this.footprints.length});{const Sn=Fp(er,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Sn.length),this.footprintsIndices.uint16.set(Sn,Tn),this.buildingIds.add(de??U.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,rr.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,rr.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,hr.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,hr.y);const Ar={footprintVertexOffset:fi,footprintVertexLength:this.footprintsVertices.length-fi,footprintIndexOffset:Tn,footprintIndexLength:this.footprintsIndices.length-Tn,min:rr,max:hr,hiddenFlags:0,indicesOffset:Ui,indicesLength:Er,bloomIndicesOffset:Wi,bloomIndicesLength:nr,groundEffectVertexOffset:Gr,groundEffectVertexLength:sr,hasFauxFacade:on,height:Yn,promoteId:Y,feature:ve,parts:Li,buildingBloom:Di},qi=this.footprints.length;U.id!==void 0&&this.featureFootprintLookup.set(U.id,qi),P(de,qi),this.footprints.push(Ar)}this.programConfigurations.populatePaintArrays(Cn.layoutVertexArray.length,U,Q,{},n.availableImages,o,n.brightness),this.groundEffect.addPaintPropertiesData(U,Q,{},n.availableImages,o,n.brightness),n.featureIndex.insert(U,Te,Q,ne,this.index,Ki)}S.forEach((({buildingId:U,footprintIndex:Y})=>{E.has(U)&&(this.footprints[Y].hiddenFlags|=4)}));const G=new Set;this.buildingIds.forEach(((U,Y,Q)=>{E.has(U)||G.add(U)})),this.buildingIds=G,this.groundEffect.prepareBorderSegments()}update(e,n,o,a,u,h,p){this.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p),this.groundEffect.update(e,n,u,o,a,h,p),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=o=>{o.layoutVertexBuffer=e.createVertexBuffer(o.layoutVertexArray,V0.members),o.layoutNormalBuffer=e.createVertexBuffer(o.layoutNormalArray,CE.members),o.layoutCentroidBuffer=e.createVertexBuffer(o.layoutCentroidArray,ME.members),o.layoutFloodLightDataBuffer=e.createVertexBuffer(o.layoutFloodLightDataArray,LE.members),o.layoutFacadeDataArray&&o.layoutFacadeDataArray.length&&(o.layoutFacadeDataBuffer=e.createVertexBuffer(o.layoutFacadeDataArray,RE.members)),o.layoutFacadeVerticalRangeArray&&o.layoutFacadeVerticalRangeArray.length&&(o.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(o.layoutFacadeVerticalRangeArray,kE.members)),o.entranceBloom.layoutVertexArray.length&&(o.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(o.entranceBloom.layoutVertexArray,V0.members),o.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(o.entranceBloom.layoutAttenuationArray,zE.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,o=!0){let a=!1;const u=o?n:0,h=0|(o?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of e){const y=this.footprints[p],x=y.hiddenFlags&h|u;y.hiddenFlags!==x&&(y.hiddenFlags=x,a=!0,this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0))}return a&&(this.indexArrayForConflationUploaded=!1),a}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=a=>{a.indexArray.length!==0&&(a.indexArrayForConflation.resize(a.indexArray.length),a.indexArrayForConflation.uint16.set(a.indexArray.uint16),a.entranceBloom.indexArrayForConflation.resize(a.entranceBloom.indexArray.length),a.entranceBloom.indexArrayForConflation.uint16.set(a.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const a of this.footprints){const u=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,h=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let y=a.indicesOffset;y<h;y++)u.indexArrayForConflation.uint16[3*y+0]=0,u.indexArrayForConflation.uint16[3*y+1]=0,u.indexArrayForConflation.uint16[3*y+2]=0;const p=a.bloomIndicesOffset+a.bloomIndicesLength;for(let y=a.bloomIndicesOffset;y<p;y++)u.entranceBloom.indexArrayForConflation.uint16[3*y+0]=0,u.entranceBloom.indexArrayForConflation.uint16[3*y+1]=0,u.entranceBloom.indexArrayForConflation.uint16[3*y+2]=0}}const o=a=>{a.indexArray.length!==0&&(a.indexBuffer?a.indexBuffer.updateData(a.indexArrayForConflation):a.indexBuffer=e.createIndexBuffer(a.indexArrayForConflation,!0),a.entranceBloom.indexBuffer?a.entranceBloom.indexBuffer.updateData(a.entranceBloom.indexArrayForConflation):a.entranceBloom.indexBuffer=e.createIndexBuffer(a.entranceBloom.indexArrayForConflation,!0))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=o=>{o.layoutColorBuffer?o.layoutColorBuffer.updateData(o.layoutColorArray):o.layoutColorBuffer=e.createVertexBuffer(o.layoutColorArray,U0.members,!0),o.layoutFacadePaintArray&&(o.layoutFacadePaintBuffer?o.layoutFacadePaintBuffer.updateData(o.layoutFacadePaintArray):o.layoutFacadePaintBuffer=e.createVertexBuffer(o.layoutFacadePaintArray,PE.members,!0)),o.entranceBloom.layoutColorBuffer?o.entranceBloom.layoutColorBuffer.updateData(o.entranceBloom.layoutColorArray):o.entranceBloom.layoutColorBuffer=e.createVertexBuffer(o.entranceBloom.layoutColorArray,U0.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const o=e.paint.get("building-ambient-occlusion-intensity");for(const a of this.footprints){if(4&a.hiddenFlags)continue;const u=n[a.promoteId],h=a.feature;h.properties["building-part"]="roof";const p=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),y=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="wall";const x=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="window";const E=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="door";const P=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical),F=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const U of a.parts){let Y,Q=p;U.part===1?(Q=p,Y=y):U.part===0?(Q=x,Y=S):U.part===2?(Q=E,Y=A):U.part===3&&(Q=P,Y=k),Y=H(Y,0,1);for(let ne=0;ne<U.vertexLength;ne++){const me=U.vertexOffset+ne,de=1+(F.layoutAOArray.uint8[me]/255-1)*o;F.layoutColorArray.emplace(me,Q.r*de*255<<8|Q.g*de*255,Q.b*de*255<<8|255*Y),a.hasFauxFacade&&F.layoutFacadePaintArray.emplace(me,255*E.r<<8|255*E.g,255*E.b<<8|255*A)}}const G=a.buildingBloom;if(G)for(let U=0;U<G.vertexLength;U++)F.entranceBloom.layoutColorArray.emplace(G.vertexOffset+U,255*P.r<<8|255*P.g,255*P.b<<8|51*k)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,o){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped());if(Mg(this.activeReplacements,a))return;this.activeReplacements=a;for(const h of this.footprints)h.hiddenFlags&=-2;const u=[];for(const h of this.activeReplacements){if(h.order<=Hx)continue;const p=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));for(const y of this.footprints)y.min.x>h.max.x||y.max.x<h.min.x||y.min.y>h.max.y||y.max.y<h.min.y||(u.length=0,BE(this.footprintsVertices,y.footprintVertexOffset,y.footprintVertexLength,h.footprintTileId.canonical,e.canonical,u),sy(h.footprint,u,this.footprintsIndices.uint16,y.footprintIndexOffset,y.footprintIndexLength,0,-p)&&(y.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const h of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(h.groundEffectVertexOffset,h.groundEffectVertexLength,h.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+Pt)*Pt+(n+Pt);if(this.footprintLookup.hasOwnProperty(u)){const p=this.footprintLookup[u];return p?{height:p.height,hidden:p.hiddenFlags!==0}:void 0}const h=new ct(e,n);for(const p of this.footprints)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||p.height<=o||FE(h,this.footprintsVertices.float32.subarray(2*p.footprintVertexOffset,2*(p.footprintVertexOffset+p.footprintVertexLength)),this.footprintsIndices.uint16.subarray(p.footprintIndexOffset,p.footprintIndexOffset+p.footprintIndexLength))&&(o=p.height,this.footprintLookup[u]=p,a=p.hiddenFlags!==0);if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.footprintLookup[u]=void 0}}function FE(i,e,n){for(let o=0;o<n.length;o+=3){const a=n[o],u=n[o+1],h=n[o+2],p=e[2*a+0],y=e[2*a+1],x=e[2*u+0],S=e[2*u+1],E=e[2*h+0],A=e[2*h+1],P=(p-E)*(i.y-A)-(y-A)*(i.x-E),k=(x-p)*(i.y-y)-(S-y)*(i.x-p);if(P<0!=k<0&&P!==0&&k!==0)continue;const F=(E-x)*(i.y-S)-(A-S)*(i.x-x);if(F===0||F<0==P+k<=0)return!0}return!1}function BE(i,e,n,o,a,u){const h=Math.pow(2,o.z-a.z);for(let p=0;p<n;p++){let y=i.float32[2*(p+e)+0],x=i.float32[2*(p+e)+1];y=(y+a.x*Pt)*h-o.x*Pt,x=(x+a.y*Pt)*h-o.y*Pt,u.push(new ct(y,x))}}let H0,W0;qt($0,"BuildingBucket",{omit:["layers"]}),qt(Ay,"BuildingGeometry"),qt(Iy,"BuildingBloomGeometry");const NE=ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),jE=ni([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:VE}=NE,UE=ni([{name:"a_packed",components:3,type:"Float32"}]),{members:GE}=UE,$E=ni([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:HE}=$E;class q0{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new xf({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const o=this.getKey(e,n);return this.positions[o]}trim(){const e=this.width,n=this.height=Ge(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){const a=[];let u=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,p=!0;a.push({left:u,right:h,isDash:p,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){p=!p;const S=e[x];u=y*o,y+=S,h=y*o,a.push({left:u,right:h,isDash:p,zeroLength:S===0})}return a}addRoundDash(e,n,o){const a=n/2;for(let u=-o;u<=o;u++){const h=this.width*(this.nextRow+o+u);let p=0,y=e[p];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++p]);const S=Math.abs(x-y.left),E=Math.abs(x-y.right),A=Math.min(S,E);let P;const k=u/o*(a+1);if(y.isDash){const F=a-Math.abs(k);P=Math.sqrt(A*A+F*F)}else P=a-Math.sqrt(A*A+k*k);this.image.data[h+x]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const x=e[y],S=e[y+1];x.zeroLength?e.splice(y,1):S&&S.isDash===x.isDash&&(S.left=x.left,e.splice(y,1))}const o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);const u=this.width*this.nextRow;let h=0,p=e[h];for(let y=0;y<this.width;y++){y/p.right>1&&(p=e[++h]);const x=Math.abs(y-p.left),S=Math.abs(y-p.right),E=Math.min(x,S);this.image.data[u+y]=Math.max(0,Math.min(255,(p.isDash?E:-E)+n+128))}}addDash(e,n){const o=this.getKey(e,n);if(this.positions[o])return this.positions[o];const a=n==="round",u=a?7:0,h=2*u+1;if(this.nextRow+h>this.height)return $t("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let S=0;S<e.length;S++)e[S]<0&&($t("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),p+=e[S];if(p!==0){const S=this.width/p,E=this.getDashRanges(e,this.width,S);a?this.addRoundDash(E,S,u):this.addRegularDash(E,n==="square"?.5*S:0)}const y=this.nextRow+u;this.nextRow+=h;const x={tl:[y,u],br:[p,0]};return this.positions[o]=x,x}}qt(q0,"LineAtlas");const WE=Ae.types,qE=Math.cos(Math.PI/180*37.5),ZE=Math.cos(Math.PI/180*5);class Cy{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new id,this.layoutVertexArray2=new Fs,this.patternVertexArray=new Fs,this.indexArray=new Jr,this.programConfigurations=new ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ki,this.maxLineLength=0,this.zOffsetVertexArray=new Fs,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Pt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,o,a){}populate(e,n,o,a){this.hasPattern=ey("line",this.layers,this.pixelRatio,n);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=q(o);const h=this.layers[0].layout.get("line-elevation-reference");if(h==="hd-road-markup")this.elevationType="road";else{const A=this.layers[0].layout.get("line-z-offset"),P=A.isConstant()&&!A.constantOr(0);this.elevationType=h!=="sea"&&h!=="ground"&&P?"none":"offset",this.elevationType==="offset"&&h==="none"&&$t(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const p=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&p!==void 0;const y=[];for(const{feature:A,id:P,index:k,sourceLayerIndex:F}of e){const G=this.layers[0]._featureFilter.needGeometry,U=Re(A,G);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),U,o))continue;const Y=u?u.evaluate(U,{},o):void 0,Q={id:P,properties:A.properties,type:A.type,sourceLayerIndex:F,index:k,geometry:G?U.geometry:xe(A,o,a),patterns:{},sortKey:Y};y.push(Q)}u&&y.sort(((A,P)=>A.sortKey-P.sortKey));const{lineAtlas:x,featureIndex:S}=n,E=this.addConstantDashes(x);for(const A of y){const{geometry:P,index:k,sourceLayerIndex:F}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const G=ty("line",this.layers,A,this.zoom,this.pixelRatio,n);this.patternFeatures.push(G)}else this.addFeature(A,P,k,o,x.positions,n.availableImages,n.brightness,n.elevationFeatures);S.insert(e[k].feature,P,k,F,this.index)}}addConstantDashes(e){let n=!1;for(const o of this.layers){const a=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")n=!0;else{const h=u.value,p=a.value;if(!p)continue;e.addDash(p,h)}}return n}addFeatureDashes(e,n){const o=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let p,y;if(u.kind==="constant"){if(p=u.value,!p)continue}else p=u.evaluate({zoom:o},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),n.addDash(p,y),e.patterns[a.id]=[n.getKey(p,y)]}}update(e,n,o,a,u,h,p,y){this.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,y)}addFeatures(e,n,o,a,u,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,a,h,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,GE)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,HE)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,jE.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VE),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let o,a;if(n&&n>0?(o=`mapbox_clip_start_${n}`,a=`mapbox_clip_end_${n}`):(o="mapbox_clip_start",a="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(o)&&e.properties.hasOwnProperty(a))return{start:+e.properties[o],end:+e.properties[a]}}addFeature(e,n,o,a,u,h,p,y){const x=this.layers[0].layout,S=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const k=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=x.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const G=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,a,y,S,E,A,P)){const[U,Y]=this.clipRuntimeLinesToTile(n,1);for(let Q=0;Q<U.length;Q++){const ne=U[Q],me=Y[Q],de={progress:{min:me.progress.min,max:me.progress.max},nextDir:this.computeSegNextDir(me,ne),prevDir:this.computeSegPrevDir(me,ne)};this.addLine(ne,e,a,S,E,A,P,de,k&&me.parentIndex>0?me.parentIndex:null)}this.fillNonElevatedRoadSegment(G)}}else for(let G=0;G<n.length;G++)this.addLine(n[G],e,a,S,E,A,P,void 0,k&&G>0?G:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,a,p,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return kg(e,-n,-n,Pt+n,Pt+n)}clipRuntimeLinesToTile(e,n){const o=[];return[kg(e,-n,-n,Pt+n,Pt+n,o),o]}addElevatedRoadFeature(e,n,o,a,u,h,p,y){const x=[],S=Ai.getElevationFeature(e,a);if(S){const E=this.clipLinesToTile(n,1),A=this.prepareElevatedLines(E,S,o);for(const P of A)x.push({geometry:P,elevation:S,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(x.length===0)return!1;for(const E of x){const A=this.layoutVertexArray.length;this.addLine(E.geometry,e,o,u,h,p,y);const P=new ji(o,E.elevationTileID);if(E.elevation)for(let k=A;k<this.layoutVertexArray.length;k++){const F=new ct(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),G=P.pointElevation(F,E.elevation,.05);this.updateHeightRange(G),this.zOffsetVertexArray.emplaceBack(G,0,0)}else this.fillNonElevatedRoadSegment(A)}return!0}prepareElevatedLines(e,n,o){if(n.constantHeight!=null)return e;const a=[],u=1/q(o);for(const h of e)rE(h,new wi(n,u),0,a);return a}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,o,a,u,h,p,y,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=x?this.lineFeatureClips(n,x):this.lineClips;const S=a==="none";this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const E=y&&y.progress.min>0,A=y&&y.progress.max<1;if(this.lineClips){let Ie={min:this.lineClips.start,max:this.lineClips.end},qe=1;if(y){const ut=this.lineClips.end-this.lineClips.start;Ie=(function(ht,gt,vt){return{min:Qi(ht.min,gt,vt),max:Qi(ht.max,gt,vt)}})(y.progress,{min:0,max:1},Ie),ut>0&&(qe=(Ie.max-Ie.min)/ut)}const ke=+n.properties.mapbox_clip_feature_len,Qe=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(ke)||Number.isNaN(Qe)){for(let ht=0;ht<e.length-1;ht++)this.totalDistance+=e[ht].dist(e[ht+1]);const ut=this.totalDistance/(Ie.max-Ie.min);this.totalFeatureLength=Number.isFinite(ut)?ut:0,this.lineClips.start=Ie.min,this.lineClips.end=Ie.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ke,this.distance=Qe*qe,this.lineClips.start=Ie.min,this.lineClips.end=Ie.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const P=WE[n.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let F=0;for(;F<k-1&&e[F].equals(e[F+1]);)F++;if(k<(P?3:2))return;a==="bevel"&&(h=1.05);const G=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let U,Y,Q,ne,me,de,ve,Te;y&&y.prevDir&&(de=y.prevDir.perp()),y&&y.nextDir&&(ve=y.nextDir.perp()),this.e1=this.e2=-1,P&&(U=e[k-2],me=e[F].sub(U)._unit()._perp());for(let Ie=F;Ie<k;Ie++){if(Q=Ie===k-1?P?e[F+1]:void 0:e[Ie+1],Q&&e[Ie].equals(Q))continue;me&&(ne=me),U&&(Y=U),U=e[Ie],Te=this.evaluateLineProgressFeatures(Y?Y.dist(U):0),me=Q?Q.sub(U)._unit()._perp():ne,ne=ne||me;const qe=Y&&Q;let ke=qe?a:P||S?"butt":u;const Qe=ne.x*me.x+ne.y*me.y;if(S){const Ye=function(mt){if(mt.patternJoinNone){const zt=mt.segmentPoints.length/2,St=mt.lineSoFar-mt.segmentStart;for(let hn=0;hn<zt;++hn){const Vt=mt.segmentPoints[2*hn+1],Zt=Math.round(mt.segmentPoints[2*hn])+.5+.25*Vt;mt.patternVertexArray.emplaceBack(Zt,St,mt.segmentStart),mt.patternVertexArray.emplaceBack(Zt,St,mt.segmentStart)}mt.segmentPoints.length=0}mt.e1=mt.e2=-1};if(qe&&Qe<ZE){this.updateDistance(Y,U),this.addCurrentVertex(U,ne,1,1,G,Te),Ye(this),this.addCurrentVertex(U,me,-1,-1,G,Te);continue}if(Y){if(!Q){this.updateDistance(Y,U),this.addCurrentVertex(U,ne,1,1,G,Te),Ye(this);continue}ke="miter"}}let ut=ne.add(me);ut.x===0&&ut.y===0||ut._unit();const ht=ut.x*me.x+ut.y*me.y,gt=ht!==0?1/ht:1/0,vt=2*Math.sqrt(2-2*ht),ft=ht<qE&&Y&&Q,pt=ne.x*me.y-ne.y*me.x>0,Je=this.overscaling<=16?15*Pt/(512*this.overscaling):0;if(qe&&ke==="round"){if(gt<p)ke="miter";else if(gt<=2){const Ye=My(U,-10,Pt+10);ke=this.elevationType==="offset"&&(Ye||this.hasCrossSlope)?"miter":"fakeround"}}if(ke==="miter"&&gt>h&&(ke="bevel"),ke==="bevel"&&(gt>2&&(ke="flipbevel"),gt<h&&(ke="miter")),Y&&!(ke==="miter"&&ft)&&this.updateDistance(Y,U),ke==="miter")if(ft){const Ye=U.dist(Y);if(Ye>2*Je){const zt=U.sub(U.sub(Y)._mult(Je/Ye)._round());this.updateDistance(Y,zt),this.addCurrentVertex(zt,ne,0,0,G,Te),Y=zt}this.updateDistance(Y,U),ut._mult(gt),this.addCurrentVertex(U,ut,0,0,G,Te);const mt=U.dist(Q);if(mt>2*Je){const zt=U.add(Q.sub(U)._mult(Je/mt)._round());this.updateDistance(U,zt),this.addCurrentVertex(zt,me,0,0,G,Te),U=zt}}else ut._mult(gt),this.addCurrentVertex(U,ut,0,0,G,Te);else if(ke==="flipbevel"){if(gt>100)ut=me.mult(-1);else{const Ye=gt*ne.add(me).mag()/ne.sub(me).mag();ut._perp()._mult(Ye*(pt?-1:1))}this.addCurrentVertex(U,ut,0,0,G,Te),this.addCurrentVertex(U,ut.mult(-1),0,0,G,Te)}else if(ke==="bevel"||ke==="fakeround"){Te!=null&&Y&&this.addCurrentVertex(U,ve||ne,-1,-1,G,Te);const Ye=U.dist(Y)<=2*Je&&ke!=="bevel",mt=ut.mult(pt?1:-1);mt._mult(gt);const zt=me.mult(pt?-1:1),St=ne.mult(pt?-1:1),hn=this.evaluateLineProgressFeatures(this.distance);if(Te==null&&(this.addHalfVertex(U,mt.x,mt.y,!1,!pt,0,G,hn),Ye||this.addHalfVertex(U,mt.x+2*St.x,mt.y+2*St.y,!1,pt,0,G,hn)),ke==="fakeround"){const Vt=Math.round(180*vt/Math.PI/20);this.addHalfVertex(U,St.x,St.y,!1,pt,0,G,hn);for(let Zt=0;Zt<Vt;Zt++){let nn=Zt/Vt;if(nn!==.5){const It=nn-.5;nn+=nn*It*(nn-1)*((1.0904+Qe*(Qe*(3.55645-1.43519*Qe)-3.2452))*It*It+(.848013+Qe*(.215638*Qe-1.06021)))}const Qn=zt.sub(St)._mult(nn)._add(St)._unit();this.addHalfVertex(U,Qn.x,Qn.y,!1,pt,0,G,hn)}this.addHalfVertex(U,zt.x,zt.y,!1,pt,0,G,hn)}Ye||Te!=null||this.addHalfVertex(U,mt.x+2*zt.x,mt.y+2*zt.y,!1,pt,0,G,hn),Te!=null&&Q&&this.addCurrentVertex(U,de||me,1,1,G,Te)}else if(ke==="butt")this.addCurrentVertex(U,ut,0,0,G,Te);else if(ke==="square"){if(!Y){const Ye=E?0:-1;this.addCurrentVertex(U,ut,Ye,Ye,G,Te)}if(this.addCurrentVertex(U,ut,0,0,G,Te),Y){const Ye=A?0:1;this.addCurrentVertex(U,ut,Ye,Ye,G,Te)}}else if(ke==="round"){if(Y){const Ye=!qe&&ve?ve:ne;this.addCurrentVertex(U,Ye,0,0,G,Te),!qe&&A||this.addCurrentVertex(U,Ye,1,1,G,Te,!0)}if(Q){const Ye=!qe&&de?de:me;!qe&&E||this.addCurrentVertex(U,Ye,-1,-1,G,Te,!0),this.addCurrentVertex(U,Ye,0,0,G,Te)}}}}addVerticesTo(e,n,o,a,u,h,p,y,x,S){const E=(n.w-e.w)/this.tessellationStep|0;let A=0;const P=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const F=(n.x-e.x)/E,G=(n.y-e.y)/E,U=(n.z-e.z)/E,Y=(n.w-e.w)/E;for(let Q=1;Q<E;++Q){e.x+=F,e.y+=G,e.z+=U,this.lineSoFar+=Y,A+=Y;const ne=this.evaluateLineProgressFeatures(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(e,o,a,S,!1,p,x,ne),this.addHalfVertex(e,u,h,S,!0,-y,x,ne)}}this.lineSoFar=n.w,this.scaledDistance=P;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,o,a,S,!1,p,x,k),this.addHalfVertex(n,u,h,S,!0,-y,x,k)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):$t(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,o,a,u,h,p=!1){const y=n.x+n.y*o,x=n.y-n.x*o,S=n.y*a-n.x,E=-n.y-n.x*a;if(h!=null){const A=this.elevationType==="offset",P=-10,k=Pt+10,F=h.zOffset,G=new m0(e.x,e.y,F,this.lineSoFar),U=!!A&&My(e,P,k),Y=this.lineSoFar,Q=this.distance;if(this.currentVertex)if(U){const ne=this.currentVertexIsOutside,me=this.currentVertex,de=new m0(e.x,e.y,F,this.lineSoFar);if(_0(me,de,P,k),!My(de,P,k)){if(ne){this.e1=this.e2=-1,this.distance-=me.dist(G),this.lineSoFar=me.w;const ve=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,y,x,p,!1,o,u,ve),this.addHalfVertex(me,S,E,p,!0,-a,u,ve),this.prevDistance=this.distance}this.distance=this.prevDistance+me.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(me,de,y,x,S,E,o,a,u,p),this.distance=Q,this.scaledDistance=this.distance/this.totalDistance}}else{const ne=this.currentVertex;if(this.currentVertexIsOutside){_0(ne,G,P,k),this.e1=this.e2=-1,this.distance-=ne.dist(G),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ne.w;const me=this.evaluateLineProgressFeatures(ne.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ne,y,x,p,!1,o,u,me),this.addHalfVertex(ne,S,E,p,!0,-a,u,me),this.prevDistance=this.distance,this.distance=Q,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ne,G,y,x,S,E,o,a,u,p)}else U||(this.addHalfVertex(e,y,x,p,!1,o,u,h),this.addHalfVertex(e,S,E,p,!0,-a,u,h));this.currentVertex=G,this.currentVertexIsOutside=U,this.lineSoFar=Y}else this.addHalfVertex(e,y,x,p,!1,o,u,h),this.addHalfVertex(e,S,E,p,!0,-a,u,h)}addHalfVertex({x:e,y:n},o,a,u,h,p,y,x){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,p)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=bn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const S=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),y.primitiveLength++),h?this.e2=S:this.e1=S,x!=null&&this.zOffsetVertexArray.emplaceBack(x.zOffset,x.variableWidth,x.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function My(i,e,n){return i.x<e||i.x>n||i.y<e||i.y>n}let Z0,X0;function Y0(i,e,n){return e*(Pt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}qt(Cy,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const K0=(i,e,n)=>(1-n)*i+n*e;function J0(i,e){return 1/Y0(i,1,e.tileZoom)}function Q0(i,e,n,o){return i.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const e1=i=>{const e=[];t1(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=i.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=i.layout.get("line-join").constantOr("miter")==="none",a=!!i.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function t1(i){const e=i.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Py;const n1=()=>Py||(Py={layout:Z0||(Z0=new Tr({"line-cap":new Dt(Le.layout_line["line-cap"]),"line-join":new Dt(Le.layout_line["line-join"]),"line-miter-limit":new Tt(Le.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Le.layout_line["line-round-limit"]),"line-sort-key":new Dt(Le.layout_line["line-sort-key"]),"line-z-offset":new Dt(Le.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(Le.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(Le.layout_line["line-cross-slope"]),visibility:new Tt(Le.layout_line.visibility),"line-width-unit":new Tt(Le.layout_line["line-width-unit"])})),paint:X0||(X0=new Tr({"line-opacity":new Dt(Le.paint_line["line-opacity"]),"line-color":new Dt(Le.paint_line["line-color"]),"line-translate":new Tt(Le.paint_line["line-translate"]),"line-translate-anchor":new Tt(Le.paint_line["line-translate-anchor"]),"line-width":new Dt(Le.paint_line["line-width"]),"line-gap-width":new Dt(Le.paint_line["line-gap-width"]),"line-offset":new Dt(Le.paint_line["line-offset"]),"line-blur":new Dt(Le.paint_line["line-blur"]),"line-dasharray":new Dt(Le.paint_line["line-dasharray"]),"line-pattern":new Dt(Le.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt(Le.paint_line["line-pattern-cross-fade"]),"line-gradient":new rc(Le.paint_line["line-gradient"]),"line-trim-offset":new Tt(Le.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(Le.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(Le.paint_line["line-trim-color"]),"line-emissive-strength":new Dt(Le.paint_line["line-emissive-strength"]),"line-border-width":new Dt(Le.paint_line["line-border-width"]),"line-border-color":new Dt(Le.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(Le.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},Py);class XE extends Dt{possiblyEvaluate(e,n){return n=new Xi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,a){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,a)}}let Nm;function i1(i,e){return e>0?e+2*i:i}const YE=ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KE=ni([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),JE=ni([{name:"a_projected_pos",components:4,type:"Float32"}],4);ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const QE=ni([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),eI=ni([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),tI=ni([{name:"a_texb",components:2,type:"Uint16"}]),nI=ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),iI=ni([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const r1=ni([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rI=ni([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ni([{name:"triangle",components:3,type:"Uint16"}]),ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ni([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ni([{type:"Float32",name:"offsetX"}]),ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Lo=24;function oI(i,e,n){return i.sections.forEach((o=>{o.text=(function(a,u,h){const p=u.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?a=a.toLocaleUpperCase():p==="lowercase"&&(a=a.toLocaleLowerCase()),Ua.applyArabicShaping&&(a=Ua.applyArabicShaping(a)),a})(o.text,e,n)})),i}const jm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function sI(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function aI(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const Ry=4294967296,o1=1/Ry,s1=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Gg=class{constructor(i=new Uint8Array(16)){this.buf=ArrayBuffer.isView(i)?i:new Uint8Array(i),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(i,e,n=this.length){for(;this.pos<n;){const o=this.readVarint(),a=o>>3,u=this.pos;this.type=7&o,i(a,e,this),this.pos===u&&this.skip(o)}return e}readMessage(i,e){return this.readFields(i,e,this.readVarint()+this.pos)}readFixed32(){const i=this.dataView.getUint32(this.pos,!0);return this.pos+=4,i}readSFixed32(){const i=this.dataView.getInt32(this.pos,!0);return this.pos+=4,i}readFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ry;return this.pos+=8,i}readSFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ry;return this.pos+=8,i}readFloat(){const i=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,i}readDouble(){const i=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,i}readVarint(i){const e=this.buf;let n,o;return o=e[this.pos++],n=127&o,o<128?n:(o=e[this.pos++],n|=(127&o)<<7,o<128?n:(o=e[this.pos++],n|=(127&o)<<14,o<128?n:(o=e[this.pos++],n|=(127&o)<<21,o<128?n:(o=e[this.pos],n|=(15&o)<<28,(function(a,u,h){const p=h.buf;let y,x;if(x=p[h.pos++],y=(112&x)>>4,x<128||(x=p[h.pos++],y|=(127&x)<<3,x<128)||(x=p[h.pos++],y|=(127&x)<<10,x<128)||(x=p[h.pos++],y|=(127&x)<<17,x<128)||(x=p[h.pos++],y|=(127&x)<<24,x<128)||(x=p[h.pos++],y|=(1&x)<<31,x<128))return $p(a,y,u);throw new Error("Expected varint not more than 10 bytes")})(n,i,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const i=this.readVarint();return i%2==1?(i+1)/-2:i/2}readBoolean(){return!!this.readVarint()}readString(){const i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&s1?s1.decode(this.buf.subarray(e,i)):(function(n,o,a){let u="",h=o;for(;h<a;){const p=n[h];let y,x,S,E=null,A=p>239?4:p>223?3:p>191?2:1;if(h+A>a)break;A===1?p<128&&(E=p):A===2?(y=n[h+1],(192&y)==128&&(E=(31&p)<<6|63&y,E<=127&&(E=null))):A===3?(y=n[h+1],x=n[h+2],(192&y)==128&&(192&x)==128&&(E=(15&p)<<12|(63&y)<<6|63&x,(E<=2047||E>=55296&&E<=57343)&&(E=null))):A===4&&(y=n[h+1],x=n[h+2],S=n[h+3],(192&y)==128&&(192&x)==128&&(192&S)==128&&(E=(15&p)<<18|(63&y)<<12|(63&x)<<6|63&S,(E<=65535||E>=1114112)&&(E=null))),E===null?(E=65533,A=1):E>65535&&(E-=65536,u+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),u+=String.fromCharCode(E),h+=A}return u})(this.buf,e,i)}readBytes(){const i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e}readPackedVarint(i=[],e){const n=this.readPackedEnd();for(;this.pos<n;)i.push(this.readVarint(e));return i}readPackedSVarint(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readSVarint());return i}readPackedBoolean(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readBoolean());return i}readPackedFloat(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readFloat());return i}readPackedDouble(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readDouble());return i}readPackedFixed32(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readFixed32());return i}readPackedSFixed32(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readSFixed32());return i}readPackedFixed64(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readFixed64());return i}readPackedSFixed64(i=[]){const e=this.readPackedEnd();for(;this.pos<e;)i.push(this.readSFixed64());return i}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(i){const e=7&i;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(i,e){this.writeVarint(i<<3|e)}realloc(i){let e=this.length||16;for(;e<this.pos+i;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeSFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*o1),!0),this.pos+=8}writeSFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*o1),!0),this.pos+=8}writeVarint(i){(i=+i||0)>268435455||i<0?(function(e,n){let o,a;if(e>=0?(o=e%4294967296|0,a=e/4294967296|0):(o=~(-e%4294967296),a=~(-e/4294967296),4294967295^o?o=o+1|0:(o=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(u,h,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)})(o,0,n),(function(u,h){const p=(7&u)<<4;h.buf[h.pos++]|=p|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))})(a,n)})(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))}writeSVarint(i){this.writeVarint(i<0?2*-i-1:2*i)}writeBoolean(i){this.writeVarint(+i)}writeString(i){i=String(i),this.realloc(4*i.length),this.pos++;const e=this.pos;this.pos=(function(o,a,u){for(let h,p,y=0;y<a.length;y++){if(h=a.charCodeAt(y),h>55295&&h<57344){if(!p){h>56319||y+1===a.length?(o[u++]=239,o[u++]=191,o[u++]=189):p=h;continue}if(h<56320){o[u++]=239,o[u++]=191,o[u++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(o[u++]=239,o[u++]=191,o[u++]=189,p=null);h<128?o[u++]=h:(h<2048?o[u++]=h>>6|192:(h<65536?o[u++]=h>>12|224:(o[u++]=h>>18|240,o[u++]=h>>12&63|128),o[u++]=h>>6&63|128),o[u++]=63&h|128)}return u})(this.buf,i,this.pos);const n=this.pos-e;n>=128&&a1(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(i){this.realloc(4),this.dataView.setFloat32(this.pos,i,!0),this.pos+=4}writeDouble(i){this.realloc(8),this.dataView.setFloat64(this.pos,i,!0),this.pos+=8}writeBytes(i){const e=i.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=i[n]}writeRawMessage(i,e){this.pos++;const n=this.pos;i(e,this);const o=this.pos-n;o>=128&&a1(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeMessage(i,e,n){this.writeTag(i,2),this.writeRawMessage(e,n)}writePackedVarint(i,e){e.length&&this.writeMessage(i,lI,e)}writePackedSVarint(i,e){e.length&&this.writeMessage(i,cI,e)}writePackedBoolean(i,e){e.length&&this.writeMessage(i,dI,e)}writePackedFloat(i,e){e.length&&this.writeMessage(i,uI,e)}writePackedDouble(i,e){e.length&&this.writeMessage(i,hI,e)}writePackedFixed32(i,e){e.length&&this.writeMessage(i,fI,e)}writePackedSFixed32(i,e){e.length&&this.writeMessage(i,pI,e)}writePackedFixed64(i,e){e.length&&this.writeMessage(i,mI,e)}writePackedSFixed64(i,e){e.length&&this.writeMessage(i,gI,e)}writeBytesField(i,e){this.writeTag(i,2),this.writeBytes(e)}writeFixed32Field(i,e){this.writeTag(i,5),this.writeFixed32(e)}writeSFixed32Field(i,e){this.writeTag(i,5),this.writeSFixed32(e)}writeFixed64Field(i,e){this.writeTag(i,1),this.writeFixed64(e)}writeSFixed64Field(i,e){this.writeTag(i,1),this.writeSFixed64(e)}writeVarintField(i,e){this.writeTag(i,0),this.writeVarint(e)}writeSVarintField(i,e){this.writeTag(i,0),this.writeSVarint(e)}writeStringField(i,e){this.writeTag(i,2),this.writeString(e)}writeFloatField(i,e){this.writeTag(i,5),this.writeFloat(e)}writeDoubleField(i,e){this.writeTag(i,1),this.writeDouble(e)}writeBooleanField(i,e){this.writeVarintField(i,+e)}};function $p(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function a1(i,e,n){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(let a=n.pos-1;a>=i;a--)n.buf[a+o]=n.buf[a]}function lI(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function cI(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function uI(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function hI(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function dI(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function fI(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function pI(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function mI(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function gI(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}const ky=3;function _I(i,e,n){e.glyphs=[],i===1&&n.readMessage(yI,e)}function yI(i,e,n){if(i===3){const{id:o,bitmap:a,width:u,height:h,left:p,top:y,advance:x}=n.readMessage(vI,{});e.glyphs.push({id:o,bitmap:new xf({width:u+2*ky,height:h+2*ky},a),metrics:{width:u,height:h,left:p,top:y,advance:x}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function vI(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}const l1=ky,pl={horizontal:1,vertical:2,horizontalOnly:3};class Vm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const o=new Vm;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Vm;return n.image=e,n}}class Hp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,o){const a=new Hp;for(let u=0;u<e.sections.length;u++){const h=e.sections[u];h.image?a.addImageSection(h,o):a.addTextSection(h,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(n,o){let a="";for(let u=0;u<n.length;u++){const h=n.charCodeAt(u+1)||null,p=n.charCodeAt(u-1)||null;a+=!o&&(h&&eh(h)&&!jm[n[u+1]]||p&&eh(p)&&!jm[n[u-1]])||!jm[n[u]]?n[u]:jm[n[u]]}return a})(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&$g[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&$g[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Hp;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Vm.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e,n){const o=e.image?e.image.getPrimary():null;if(!o)return void $t("Can't add FormattedSection with an empty image.");o.scaleSelf(n);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Vm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zy(i,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F=1){const G=Hp.fromFeature(i,a,F);E===pl.vertical&&G.verticalizePunctuation(A);let U=[];const Y=(function(ve,Te,Ie,qe,ke,Qe){if(!ve)return[];const ut=[],ht=(function(pt,Je,Ye,mt,zt,St){let hn=0;for(let Vt=0;Vt<pt.length();Vt++){const Zt=pt.getSection(Vt);hn+=c1(pt.getCodePoint(Vt),Zt,mt,zt,Je,St)}return hn/Math.max(1,Math.ceil(hn/Ye))})(ve,Te,Ie,qe,ke,Qe),gt=ve.text.indexOf("")>=0;let vt=0;for(let pt=0;pt<ve.length();pt++){const Je=ve.getSection(pt),Ye=ve.getCodePoint(pt);if($g[Ye]||(vt+=c1(Ye,Je,qe,ke,Te,Qe)),pt<ve.length()-1){const mt=!((ft=Ye)<11904||!(yn["Bopomofo Extended"](ft)||yn.Bopomofo(ft)||yn["CJK Compatibility Forms"](ft)||yn["CJK Compatibility Ideographs"](ft)||yn["CJK Compatibility"](ft)||yn["CJK Radicals Supplement"](ft)||yn["CJK Strokes"](ft)||yn["CJK Symbols and Punctuation"](ft)||yn["CJK Unified Ideographs Extension A"](ft)||yn["CJK Unified Ideographs"](ft)||yn["Enclosed CJK Letters and Months"](ft)||yn["Halfwidth and Fullwidth Forms"](ft)||yn.Hiragana(ft)||yn["Ideographic Description Characters"](ft)||yn["Kangxi Radicals"](ft)||yn["Katakana Phonetic Extensions"](ft)||yn.Katakana(ft)||yn["Vertical Forms"](ft)||yn["Yi Radicals"](ft)||yn["Yi Syllables"](ft)));(xI[Ye]||mt||Je.image)&&ut.push(h1(pt+1,vt,ht,ut,wI(Ye,ve.getCodePoint(pt+1),mt&&gt),!1))}}var ft;return d1(h1(ve.length(),vt,ht,ut,0,!0))})(G,x,u,e,o,P),{processBidirectionalText:Q,processStyledBidirectionalText:ne}=Ua;if(Q&&G.sections.length===1){const ve=Q(G.toString(),Y);for(const Te of ve){const Ie=new Hp;Ie.text=Te,Ie.sections=G.sections;for(let qe=0;qe<Te.length;qe++)Ie.sectionIndex.push(0);U.push(Ie)}}else if(ne){const ve=ne(G.text,G.sectionIndex,Y);for(const Te of ve){const Ie=new Hp;Ie.text=Te[0],Ie.sectionIndex=Te[1],Ie.sections=G.sections,U.push(Ie)}}else U=(function(ve,Te){const Ie=[],qe=ve.text;let ke=0;for(const Qe of Te)Ie.push(ve.substring(ke,Qe)),ke=Qe;return ke<qe.length&&Ie.push(ve.substring(ke,qe.length)),Ie})(G,Y);const me=[],de={positionedLines:me,text:G.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(ve,Te,Ie,qe,ke,Qe,ut,ht,gt,vt,ft,pt){let Je=0,Ye=0,mt=0;const zt=ht==="right"?1:ht==="left"?0:.5;let St=!1;for(const It of ke){const on=It.getSections();for(const Dn of on){if(Dn.image)continue;const gi=Te[Dn.fontStack];if(gi&&(St=gi.ascender!==void 0&&gi.descender!==void 0,!St))break}if(!St)break}let hn=0;for(const It of ke){It.trim();const on=It.getMaxScale(),Dn=(on-1)*Lo,gi={positionedGlyphs:[],lineOffset:0};ve.positionedLines[hn]=gi;const bi=gi.positionedGlyphs;let qn=0;if(!It.length()){Ye+=Qe,++hn;continue}let Yi=0,fe=0;for(let et=0;et<It.length();et++){const _t=It.getSection(et),Ot=It.getSectionIndex(et),Ft=It.getCodePoint(et);let fn=_t.scale,pn=null,$n=null,Xn=null,Jn=Lo,di=0,Cn=gt;Cn===pl.vertical&&((Vt=Ft)===12312||Vt===12313||Vt===12316||Vt===12540||Vt===12448)&&(Cn=pl.horizontal);const Ln=!(Cn===pl.horizontal||!ft&&!kl(Ft)||ft&&($g[Ft]||ic(Ft)));if(_t.image){const Pi=qe.get(_t.image.toString());if(!Pi)continue;Xn=_t.image,ve.iconsInText=ve.iconsInText||!0,$n=Pi.paddedRect;const Li=Pi.displaySize;fn=fn*Lo/pt,pn={width:Li[0],height:Li[1],left:0,top:-l1,advance:Ln?Li[1]:Li[0],localGlyph:!1},di=St?-pn.height*fn:on*Lo-17-Li[1]*fn,Jn=pn.advance;const Di=(Ln?Li[0]:Li[1])*fn-Lo*on;Di>0&&Di>qn&&(qn=Di)}else{const Pi=Ie[_t.fontStack];if(!Pi)continue;Pi[Ft]&&($n=Pi[Ft]);const Li=Te[_t.fontStack];if(!Li)continue;const Di=Li.glyphs[Ft];if(!Di)continue;if(pn=Di.metrics,Jn=Ft!==8203?Lo:0,St){const Wi=Li.ascender!==void 0?Math.abs(Li.ascender):0,nr=Li.descender!==void 0?Math.abs(Li.descender):0,Ki=(Wi+nr)*fn;Yi<Ki&&(Yi=Ki,fe=(Wi-nr)/2*fn),di=-Wi*fn}else di=(on-fn)*Lo-17}Ln?(ve.verticalizable=!0,bi.push({glyph:Ft,image:Xn,x:Je,y:Ye+di,vertical:Ln,scale:fn,localGlyph:pn.localGlyph,fontStack:_t.fontStack,sectionIndex:Ot,metrics:pn,rect:$n}),Je+=Jn*fn+vt):(bi.push({glyph:Ft,image:Xn,x:Je,y:Ye+di,vertical:Ln,scale:fn,localGlyph:pn.localGlyph,fontStack:_t.fontStack,sectionIndex:Ot,metrics:pn,rect:$n}),Je+=pn.advance*fn+vt)}bi.length!==0&&(mt=Math.max(Je-vt,mt),St?f1(bi,zt,qn,fe,Qe*on/2):f1(bi,zt,qn,0,Qe/2)),Je=0;const _e=Qe*on+qn;gi.lineOffset=Math.max(qn,Dn),Ye+=_e,++hn}var Vt;const Zt=Ye,{horizontalAlign:nn,verticalAlign:Qn}=Ly(ut);(function(It,on,Dn,gi,bi,qn){const Yi=(on-Dn)*bi,fe=-qn*gi;for(const _e of It)for(const et of _e.positionedGlyphs)et.x+=Yi,et.y+=fe})(ve.positionedLines,zt,nn,Qn,mt,Zt),ve.top+=-Qn*Zt,ve.bottom=ve.top+Zt,ve.left+=-nn*mt,ve.right=ve.left+mt,ve.hasBaseline=St})(de,e,n,o,U,h,p,y,E,x,A,k),!(function(ve){for(const Te of ve)if(Te.positionedGlyphs.length!==0)return!1;return!0})(me))return de}const $g={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function c1(i,e,n,o,a,u){if(e.image){const h=o.get(e.image.toString());return h?h.displaySize[0]*e.scale*Lo/u+a:0}{const h=n[e.fontStack],p=h&&h.glyphs[i];return p?p.metrics.advance*e.scale+a:0}}function u1(i,e,n,o){const a=Math.pow(i-e,2);return o?i<e?a/2:2*a:a+Math.abs(n)*n}function wI(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function h1(i,e,n,o,a,u){let h=null,p=u1(e,n,a,u);for(const y of o){const x=u1(e-y.x,n,a,u)+y.badness;x<=p&&(h=y,p=x)}return{index:i,x:e,priorBreak:h,badness:p}}function d1(i){return i?d1(i.priorBreak).concat(i.index):[]}function Ly(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function f1(i,e,n,o,a){if(!(e||n||o||a))return;const u=i.length-1,h=i[u],p=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=u;y++)i[y].x-=p,i[y].y+=n+o+a}function Dy(i){return i.imagePrimary!==void 0&&i.top!==void 0&&i.bottom!==void 0&&i.left!==void 0&&i.right!==void 0}function Hg(i,e,n,o){const{horizontalAlign:a,verticalAlign:u}=Ly(o),h=n[0]-i.displaySize[0]*a,p=n[1]-i.displaySize[1]*u;return{imagePrimary:i,imageSecondary:e,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Oy(i,e,n,o,a,u){const h=i.imagePrimary;let p;if(h.content){const G=h.content,U=h.pixelRatio||1;p=[G[0]/U,G[1]/U,h.displaySize[0]-G[2]/U,h.displaySize[1]-G[3]/U]}const y=e.left*u,x=e.right*u;let S,E,A,P;n==="width"||n==="both"?(P=a[0]+y-o[3],E=a[0]+x+o[1]):(P=a[0]+(y+x-h.displaySize[0])/2,E=P+h.displaySize[0]);const k=e.top*u,F=e.bottom*u;return n==="height"||n==="both"?(S=a[1]+k-o[0],A=a[1]+F+o[2]):(S=a[1]+(k+F-h.displaySize[1])/2,A=S+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:S,right:E,bottom:A,left:P,collisionPadding:p}}function p1(i){return!i.imagePrimary.stretchX}function m1(i){return!i.imagePrimary.stretchY}function g1(i){return{width:i.right-i.left,height:i.bottom-i.top}}const uu=128;function Wp(i,e,n){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Xi(i+1,{worldview:n}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=o;let h=0;for(;h<a.length&&a[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<i+1;)p++;p=Math.min(a.length-1,p);const y=a[h],x=a[p];return o.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:o.evaluate(new Xi(y,{worldview:n})),maxSize:o.evaluate(new Xi(x,{worldview:n})),interpolationType:u}}}function Fy(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:a}){return i.kind==="source"?o/uu:i.kind==="composite"?bn(o/uu,a/uu,n):e}function qp(i,e,n=1){let o=0,a=0;if(i.kind==="constant")a=i.layoutSize*n;else if(i.kind!=="source"){const{interpolationType:u,minZoom:h,maxZoom:p}=i,y=u?H(ea.interpolationFactor(u,e,h,p),0,1):0;i.kind==="camera"?a=bn(i.minSize,i.maxSize,y)*n:o=y*n}return{uSizeT:o,uSize:a}}class yd extends ct{constructor(e,n,o,a,u){super(e,n),this.angle=a,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new yd(this.x,this.y,this.z,this.angle,this.segment)}}function _1(i,e,n,o,a){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,p=0;for(;p>-n/2;){if(h--,h<0)return!1;p-=i[h].dist(u),u=i[h]}p+=i[h].dist(i[h+1]),h++;const y=[];let x=0;for(;p<n/2;){const S=i[h],E=i[h+1];if(!E)return!1;let A=i[h-1].angleTo(S)-S.angleTo(E);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:p,angleDelta:A}),x+=A;p-y[0].distance>o;)x-=y.shift().angleDelta;if(x>a)return!1;h++,p+=S.dist(E)}return!0}function y1(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function v1(i,e,n){return i?.6*e*n:0}function x1(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function bI(i,e,n,o,a,u){const h=v1(n,a,u),p=x1(n,o)*u;let y=0;const x=y1(i)/2;for(let S=0;S<i.length-1;S++){const E=i[S],A=i[S+1],P=E.dist(A);if(y+P>x){const k=(x-y)/P,F=bn(E.x,A.x,k),G=bn(E.y,A.y,k),U=new yd(F,G,0,A.angleTo(E),S);return!h||_1(i,U,p,h,e)?U:void 0}y+=P}}function TI(i,e,n,o,a,u,h,p,y){const x=v1(o,u,h),S=x1(o,a),E=S*h,A=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-E<e/4&&(e=E+e/4),w1(i,A?e/2*p%e:(S/2+2*u)*h*p%e,e,x,n,E,A,!1,y)}function w1(i,e,n,o,a,u,h,p,y){const x=u/2,S=y1(i);let E=0,A=e-n,P=[];for(let k=0;k<i.length-1;k++){const F=i[k],G=i[k+1],U=F.dist(G),Y=G.angleTo(F);for(;A+n<E+U;){A+=n;const Q=(A-E)/U,ne=bn(F.x,G.x,Q),me=bn(F.y,G.y,Q);if(ne>=0&&ne<y&&me>=0&&me<y&&A-x>=0&&A+x<=S){const de=new yd(ne,me,0,Y,k);o&&!_1(i,de,u,o,a)||P.push(de)}}E+=U}return p||P.length||h||(P=w1(i,E/2,n,o,a,u,h,!0,y)),P}function b1(i){let e=0,n=0;for(const h of i)e+=h.w*h.h,n=Math.max(n,h.w);i.sort(((h,p)=>p.h-h.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let a=0,u=0;for(const h of i)for(let p=o.length-1;p>=0;p--){const y=o[p];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,u=Math.max(u,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===y.w&&h.h===y.h){const x=o.pop();x&&p<o.length&&(o[p]=x)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(o.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}qt(yd,"Anchor");const fp=1;class Um{static getImagePositionScale(e,n,o){if(n&&e){const{sx:a,sy:u}=e;return{x:a,y:u}}return{x:o,y:o}}constructor(e,n,o,a){this.paddedRect=e;const{pixelRatio:u,version:h,stretchX:p,stretchY:y,content:x,sdf:S,usvg:E}=n;this.pixelRatio=u,this.stretchX=p,this.stretchY=y,this.content=x,this.version=h,this.padding=o,this.sdf=S,this.usvg=E,this.scale=Um.getImagePositionScale(a,E,u)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function By(i,e,n){const o=ql.parse(i),a=(function(u,h,p=[1,1]){return{x:0,y:0,w:(u.data?u.data.width:u.width*p[0])+2*h,h:(u.data?u.data.height:u.height*p[1])+2*h}})(e,n,[o.sx,o.sy]);return{bin:a,imagePosition:new Um(a,e,n,o),imageVariant:o}}class T1{constructor(e,n,o){const a=new Map,u=new Map;this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,fp,h),this.addImages(n,u,2,h);const{w:p,h:y}=b1(h),x=new Ss({width:p||1,height:y||1});for(const[S,E]of e.entries()){const A=a.get(S).paddedRect;Ss.copy(E.data,x,{x:0,y:0},{x:A.x+fp,y:A.y+fp},E.data,null,E.sdf)}for(const[S,E]of n.entries()){const A=u.get(S),P=A.paddedRect;let k=A.padding;const F=P.x+k,G=P.y+k,U=E.data.width,Y=E.data.height;k=k>1?k-1:k,Ss.copy(E.data,x,{x:0,y:0},{x:F,y:G},E.data,o),Ss.copy(E.data,x,{x:0,y:Y-k},{x:F,y:G-k},{width:U,height:k},o),Ss.copy(E.data,x,{x:0,y:0},{x:F,y:G+Y},{width:U,height:k},o),Ss.copy(E.data,x,{x:U-k,y:0},{x:F-k,y:G},{width:k,height:Y},o),Ss.copy(E.data,x,{x:0,y:0},{x:F+U,y:G},{width:k,height:Y},o),Ss.copy(E.data,x,{x:U-k,y:Y-k},{x:F-k,y:G-k},{width:k,height:k},o),Ss.copy(E.data,x,{x:0,y:Y-k},{x:F+U,y:G-k},{width:k,height:k},o),Ss.copy(E.data,x,{x:0,y:0},{x:F+U,y:G+Y},{width:k,height:k},o),Ss.copy(E.data,x,{x:U-k,y:0},{x:F-k,y:G+Y},{width:k,height:k},o)}this.lut=o,this.image=x,this.iconPositions=a,this.patternPositions=u}addImages(e,n,o,a){for(const[u,h]of e.entries()){const{bin:p,imagePosition:y,imageVariant:x}=By(u,h,o);n.set(u,y),a.push(p),h.hasRenderCallback&&this.haveRenderCallbacks.push(x.id)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((a=>e.hasImage(a,o))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const a of e.getUpdatedImages(o)){for(const u of this.iconPositions.keys()){const h=ql.parse(u);if(kr.isEqual(h.id,a)){const p=e.getImage(a,o);this.patchUpdatedImage(this.iconPositions.get(u),p,n,null)}}for(const u of this.patternPositions.keys()){const h=ql.parse(u);if(kr.isEqual(h.id,a)){const p=e.getImage(a,o);this.patchUpdatedImage(this.patternPositions.get(u),p,n,this.lut)}}}}patchUpdatedImage(e,n,o,a=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,h]=e.tl,p=e.sdf;if(this.lut||p){const y={width:n.data.width,height:n.data.height},x=new Ss(y);Ss.copy(n.data,x,{x:0,y:0},{x:0,y:0},y,a,p),o.update(x,{position:{x:u,y:h}})}else o.update(n.data,{position:{x:u,y:h}})}}qt(Um,"ImagePosition"),qt(T1,"ImageAtlas");const Gm=1e20;function S1(i,e,n,o,a,u,h,p,y){for(let x=e;x<e+o;x++)E1(i,n*u+x,u,a,h,p,y);for(let x=n;x<n+a;x++)E1(i,x*u+e,1,o,h,p,y)}function E1(i,e,n,o,a,u,h){u[0]=0,h[0]=-Gm,h[1]=Gm,a[0]=i[e];for(let p=1,y=0,x=0;p<o;p++){a[p]=i[e+p*n];const S=p*p;do{const E=u[y];x=(a[p]-a[E]+S-E*E)/(p-E)/2}while(x<=h[y]&&--y>-1);y++,u[y]=p,h[y]=x,h[y+1]=Gm}for(let p=0,y=0;p<o;p++){for(;h[y+1]<p;)y++;const x=u[y],S=p-x;i[e+p*n]=a[x]+S*S}}const hu=2,Ny={none:0,ideographs:1,all:2};class Zp{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const o=[],a=this.url||ri.GLYPHS_URL;for(const u in e)for(const h of e[u])o.push({stack:u,id:h});Se(o,(({stack:u,id:h},p)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[h];if(x!==void 0)return void p(null,{stack:u,id:h,glyph:x});if(x=this._tinySDF(y,u,h),x)return y.glyphs[h]=x,void p(null,{stack:u,id:h,glyph:x});const S=Math.floor(h/256);if(256*S>65535)return $t("glyphs > 65535 not supported"),void p(null,{stack:u,id:h,glyph:x});if(y.ranges[S])return void p(null,{stack:u,id:h,glyph:x});let E=y.requests[S];E||(E=y.requests[S]=[],Zp.loadGlyphRange(u,S,a,this.requestManager,((A,P)=>{if(P){y.ascender=P.ascender,y.descender=P.descender;for(const k in P.glyphs)this._doesCharSupportLocalGlyph(+k)||(y.glyphs[+k]=P.glyphs[+k]);y.ranges[S]=!0}for(const k of E)k(A,P);delete y.requests[S]}))),E.push(((A,P)=>{A?p(A):P&&p(null,{stack:u,id:h,glyph:P.glyphs[h]||null})}))}),((u,h)=>{if(u)n(u);else if(h){const p={};for(const{stack:y,id:x,glyph:S}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;n(null,p)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ny.none&&(this.localGlyphMode===Ny.all?!!this.localFontFamily:!!this.localFontFamily&&(yn["CJK Unified Ideographs"](e)||yn["Hangul Syllables"](e)||yn.Hiragana(e)||yn.Katakana(e)||yn["CJK Symbols and Punctuation"](e)||yn["CJK Unified Ideographs Extension A"](e)||yn["CJK Unified Ideographs Extension B"](e)||yn.Osage(e)))}_tinySDF(e,n,o){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let F="400";/bold/i.test(n)?F="900":/medium/i.test(n)?F="500":/light/i.test(n)&&(F="200"),u=e.tinySDF=new Zp.TinySDF({fontFamily:a,fontWeight:F,fontSize:24*hu,buffer:3*hu,radius:8*hu}),u.fontWeight=F}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];const h=String.fromCodePoint(o),{data:p,width:y,height:x,glyphWidth:S,glyphHeight:E,glyphLeft:A,glyphTop:P,glyphAdvance:k}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new xf({width:y,height:x},p),metrics:{width:S/hu,height:E/hu,left:A/hu,top:P/hu-27,advance:k/hu,localGlyph:!0}}}}Zp.loadGlyphRange=function(i,e,n,o,a){const u=256*e,h=u+255,p=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${u}-${h}`),$l.Glyphs);xl(p,((y,x)=>{if(y)a(y);else if(x){const S={},E=(function(A){return new Gg(A).readFields(_I,{})})(x);for(const A of E.glyphs)S[A.id]=A;a(null,{glyphs:S,ascender:E.ascender,descender:E.descender})}}))},Zp.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:h="normal",lang:p=null}={}){this.buffer=e,this.cutoff=o,this.radius=n,this.lang=p;const y=this.size=i+4*e,x=this._createCanvas(y),S=this.ctx=x.getContext("2d",{willReadFrequently:!0});S.font=`${h} ${u} ${i}px ${a}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(i),h=Math.ceil(n),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),y=Math.min(this.size-this.buffer,h+Math.ceil(o)),x=p+2*this.buffer,S=y+2*this.buffer,E=Math.max(x*S,0),A=new Uint8ClampedArray(E),P={data:A,width:x,height:S,glyphWidth:p,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(p===0||y===0)return P;const{ctx:k,buffer:F,gridInner:G,gridOuter:U}=this;this.lang&&(k.lang=this.lang),k.clearRect(F,F,p,y),k.fillText(i,F,F+h);const Y=k.getImageData(F,F,p,y);U.fill(Gm,0,E),G.fill(0,0,E);for(let Q=0;Q<y;Q++)for(let ne=0;ne<p;ne++){const me=Y.data[4*(Q*p+ne)+3]/255;if(me===0)continue;const de=(Q+F)*x+ne+F;if(me===1)U[de]=0,G[de]=Gm;else{const ve=.5-me;U[de]=ve>0?ve*ve:0,G[de]=ve<0?ve*ve:0}}S1(U,0,0,x,S,x,this.f,this.v,this.z),S1(G,F,F,p,y,x,this.f,this.v,this.z);for(let Q=0;Q<E;Q++){const ne=Math.sqrt(U[Q])-Math.sqrt(G[Q]);A[Q]=Math.round(255-255*(ne/this.radius+this.cutoff))}return P}};const dh=fp;function I1(i,e){return i+e[1]-e[0]}function jy(i,e,n,o,a=1){const u=[],h=i.imagePrimary,p=h.pixelRatio,y=h.paddedRect.w-2*dh,x=h.paddedRect.h-2*dh,S=(i.right-i.left)*a,E=(i.bottom-i.top)*a,A=h.stretchX||[[0,y]],P=h.stretchY||[[0,x]],k=A.reduce(I1,0),F=P.reduce(I1,0),G=y-k,U=x-F;let Y=0,Q=k,ne=0,me=F,de=0,ve=G,Te=0,Ie=U;if(h.content&&o){const ke=h.content;Y=Wg(A,0,ke[0]),ne=Wg(P,0,ke[1]),Q=Wg(A,ke[0],ke[2]),me=Wg(P,ke[1],ke[3]),de=ke[0]-Y,Te=ke[1]-ne,ve=ke[2]-ke[0]-Q,Ie=ke[3]-ke[1]-me}const qe=(ke,Qe,ut,ht)=>{const gt=qg(ke.stretch-Y,Q,S,i.left*a),vt=Zg(ke.fixed-de,ve,ke.stretch,k),ft=qg(Qe.stretch-ne,me,E,i.top*a),pt=Zg(Qe.fixed-Te,Ie,Qe.stretch,F),Je=qg(ut.stretch-Y,Q,S,i.left*a),Ye=Zg(ut.fixed-de,ve,ut.stretch,k),mt=qg(ht.stretch-ne,me,E,i.top*a),zt=Zg(ht.fixed-Te,Ie,ht.stretch,F),St=new ct(gt,ft),hn=new ct(Je,ft),Vt=new ct(Je,mt),Zt=new ct(gt,mt),nn=new ct(vt/p,pt/p),Qn=new ct(Ye/p,zt/p),It=e*Math.PI/180;if(It){const Yi=Math.sin(It),fe=Math.cos(It),_e=[fe,-Yi,Yi,fe];St._matMult(_e),hn._matMult(_e),Zt._matMult(_e),Vt._matMult(_e)}const on=ke.stretch+ke.fixed,Dn=ut.stretch+ut.fixed,gi=Qe.stretch+Qe.fixed,bi=ht.stretch+ht.fixed,qn=i.imageSecondary;return{tl:St,tr:hn,bl:Zt,br:Vt,texPrimary:{x:h.paddedRect.x+dh+on,y:h.paddedRect.y+dh+gi,w:Dn-on,h:bi-gi},texSecondary:qn?{x:qn.paddedRect.x+dh+on,y:qn.paddedRect.y+dh+gi,w:Dn-on,h:bi-gi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:nn,pixelOffsetBR:Qn,minFontScaleX:ve/p/S,minFontScaleY:Ie/p/E,isSDF:n}};if(o&&(h.stretchX||h.stretchY)){const ke=A1(A,G,k),Qe=A1(P,U,F);for(let ut=0;ut<ke.length-1;ut++){const ht=ke[ut],gt=ke[ut+1];for(let vt=0;vt<Qe.length-1;vt++)u.push(qe(ht,Qe[vt],gt,Qe[vt+1]))}}else u.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function SI(i,e){const n=i.stretchY||[[0,i.paddedRect.h-2*dh]];return e&&(i.stretchX||i.stretchY)?C1(i.stretchX||[[0,i.paddedRect.w-2*dh]])*C1(n):1}function Wg(i,e,n){let o=0;for(const a of i)o+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]));return o}function A1(i,e,n){const o=[{fixed:-dh,stretch:0}];for(const[a,u]of i){const h=o[o.length-1];o.push({fixed:a-h.stretch,stretch:h.stretch}),o.push({fixed:a-h.stretch,stretch:h.stretch+(u-a)})}return o.push({fixed:e+dh,stretch:n}),o}function C1(i){return 2*i.length+1}function qg(i,e,n,o){return i/e*n+o}function Zg(i,e,n,o){return i-e*n/o}function EI(i,e,n,o){const a=e+i.positionedLines[o].lineOffset;return o===0?n+a/2:n+(a+(e+i.positionedLines[o-1].lineOffset))/2}function II(i,e=1,n=!1){let o=1/0,a=1/0,u=-1/0,h=-1/0;const p=i[0];for(let P=0;P<p.length;P++){const k=p[P];(!P||k.x<o)&&(o=k.x),(!P||k.y<a)&&(a=k.y),(!P||k.x>u)&&(u=k.x),(!P||k.y>h)&&(h=k.y)}const y=Math.min(u-o,h-a);let x=y/2;const S=new Rh([],AI);if(y===0)return new ct(o,a);for(let P=o;P<u;P+=y)for(let k=a;k<h;k+=y)S.push(new Xp(P+x,k+x,x,i));let E=(function(P){let k=0,F=0,G=0;const U=P[0];for(let Y=0,Q=U.length,ne=Q-1;Y<Q;ne=Y++){const me=U[Y],de=U[ne],ve=me.x*de.y-de.x*me.y;F+=(me.x+de.x)*ve,G+=(me.y+de.y)*ve,k+=3*ve}return new Xp(F/k,G/k,0,P)})(i),A=S.length;for(;S.length;){const P=S.pop();(P.d>E.d||!E.d)&&(E=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,A)),P.max-E.d<=e||(x=P.h/2,S.push(new Xp(P.p.x-x,P.p.y-x,x,i)),S.push(new Xp(P.p.x+x,P.p.y-x,x,i)),S.push(new Xp(P.p.x-x,P.p.y+x,x,i)),S.push(new Xp(P.p.x+x,P.p.y+x,x,i)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${E.d}`)),E.p}function AI(i,e){return e.max-i.max}class Xp{constructor(e,n,o,a){this.p=new ct(e,n),this.h=o,this.d=(function(u,h){let p=!1,y=1/0;for(let x=0;x<h.length;x++){const S=h[x];for(let E=0,A=S.length,P=A-1;E<A;P=E++){const k=S[E],F=S[P];k.y>u.y!=F.y>u.y&&u.x<(F.x-k.x)*(u.y-k.y)/(F.y-k.y)+k.x&&(p=!p),y=Math.min(y,Mr(u,k,F))}}return(p?1:-1)*Math.sqrt(y)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const CI=Object.keys,Vy=Number.POSITIVE_INFINITY,MI=Math.sqrt(2);function bf(i,e,n,o,a){const u=Dy(i)&&i.collisionPadding?i.collisionPadding:[0,0,0,0],h={top:i.top-u[1],bottom:i.bottom+u[3],left:i.left-u[0],right:i.right+u[2],scaled:!1};return o!==void 0&&(function(p,y){p.top*=y,p.bottom*=y,p.left*=y,p.right*=y,p.scaled=!0})(h,o),n&&(function(p,y){if(!y)return;const x=ti(y),S=new ct(p.left,p.top),E=new ct(p.right,p.top),A=new ct(p.left,p.bottom),P=new ct(p.right,p.bottom),k=new ct(0,0);S._rotateAround(x,k),E._rotateAround(x,k),A._rotateAround(x,k),P._rotateAround(x,k),p.left=Math.min(S.x,E.x,A.x,P.x),p.right=Math.max(S.x,E.x,A.x,P.x),p.top=Math.min(S.y,E.y,A.y,P.y),p.bottom=Math.max(S.y,E.y,A.y,P.y)})(h,n),a&&(h.left+=a[0],h.right+=a[0],h.top+=a[1],h.bottom+=a[1]),e?{top:Math.min(e.top,h.top),bottom:Math.max(e.bottom,h.bottom),left:Math.min(e.left,h.left),right:Math.max(e.right,h.right),scaled:e.scaled||h.scaled}:h}function M1(i,[e,n]){let o=0,a=0;if(n===Vy){e<0&&(e=0);const u=e/MI;switch(i){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(i){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),i){case"top-right":case"top-left":case"top":a=n-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-n}switch(i){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function PI(i,e,n,o,a,u,h,p,y,x,S,E,A,P){const k=i.layers[0],F=k.appearances;if(F.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const G={iconBBox:null,iconVerticalBBox:null},U={textBBox:null,textVerticalBBox:null},{baseIconRotate:Y,baseTextRotate:Q,iconScaleFactor:ne}=(function(de,ve,Te){const Ie=de.get("icon-rotate").evaluate(ve,{},Te),qe=de.get("text-rotate").evaluate(ve,{},Te),[ke,Qe]=de.get("icon-size-scale-range");return{baseIconRotate:Ie,baseTextRotate:qe,iconScaleFactor:H(1,ke,Qe)}})(o,a,u);e&&(G.iconBBox=bf(e,G.iconBBox,Y,h),n)&&(G.iconVerticalBBox=bf(n,G.iconVerticalBBox,Y+90,h));const me=Yg(E.horizontal);me&&(U.textBBox=bf(me,U.textBBox,Q,1,P)),E.vertical&&(U.textVerticalBBox=bf(E.vertical,U.textVerticalBBox,Q+90,1,P));for(const de of F)de.hasIconProperties()&&RI(G,i,k,de,a,u,p,Y,h,y,e,x,ne,S),de.hasTextProperties()&&kI(U,k,de,a,u,P,Q,A,me,E.vertical);return{iconBBox:G.iconBBox,iconVerticalBBox:G.iconVerticalBBox,textBBox:U.textBBox,textVerticalBBox:U.textVerticalBBox}}function RI(i,e,n,o,a,u,h,p,y,x,S,E,A,P){const{appearanceIconOffset:k,appearanceIconRotate:F,appearanceIconSize:G}=(function(ne,me,de,ve,Te,Ie,qe,ke){const Qe=ne.hasProperty("icon-offset")?me.getAppearanceValueAndResolveTokens(ne,"icon-offset",de,ve,[]):null,ut=Qe&&Array.isArray(Qe)?Qe:Te,ht=ne.hasProperty("icon-rotate")?me.getAppearanceValueAndResolveTokens(ne,"icon-rotate",de,ve,[]):null,gt=typeof ht=="number"?ht:Ie,vt=ne.hasProperty("icon-size")?me.getAppearanceValueAndResolveTokens(ne,"icon-size",de,ve,[]):null;return{appearanceIconOffset:ut,appearanceIconRotate:gt,appearanceIconSize:typeof vt=="number"?vt*ke.iconScaleFactor:qe}})(o,n,a,u,h,p,y,x);let U=null,Y=null,Q=null;o.hasProperty("icon-image")?Q=(function(ne,me,de,ve,Te,Ie,qe){let ke=null;const Qe=me.getAppearanceValueAndResolveTokens(de,"icon-image",ve,Te,[]);if(Qe){const ut=ne.getResolvedImageFromTokens(Qe),ht=de.getUnevaluatedProperty("icon-size"),gt=$m(ut,Wp(ne.zoom,ht,ne.worldview),ht,Te,ne.zoom,ve,ne.pixelRatio,qe,ne.worldview);ke=Ie.get(gt.iconPrimary.toString())}return ke})(e,n,o,a,u,E,A):S&&(Q=S.imagePrimary),Q&&(U=Hg(Q,null,k,P),e.allowVerticalPlacement&&(Y=Hg(Q,null,k,P))),U&&(i.iconBBox=bf(U,i.iconBBox,F,G)),Y&&(i.iconVerticalBBox=bf(Y,i.iconVerticalBBox,F+90,G))}function kI(i,e,n,o,a,u,h,p,y,x){const{appearanceTextOffset:S,appearanceTextRotate:E,appearanceTextSize:A}=(function(k,F,G,U,Y,Q,ne){const me=k.hasProperty("text-offset")?F.getAppearanceValueAndResolveTokens(k,"text-offset",G,U,[]):null,de=me&&Array.isArray(me)?[me[0]*Lo,me[1]*Lo]:Y,ve=k.hasProperty("text-rotate")?F.getAppearanceValueAndResolveTokens(k,"text-rotate",G,U,[]):null,Te=typeof ve=="number"?ve:Q,Ie=k.hasProperty("text-size")?F.getAppearanceValueAndResolveTokens(k,"text-size",G,U,[]):null;return{appearanceTextOffset:de,appearanceTextRotate:Te,appearanceTextSize:typeof Ie=="number"?Ie:ne}})(n,e,o,a,u,h,p),P=A/p;y&&(i.textBBox=bf(y,i.textBBox,E,P,S)),x&&(i.textVerticalBBox=bf(x,i.textVerticalBBox,E+90,P,S))}function Xg(i,e,n,o,a,u,h,p,y){if(!e||!e.usvg)return;const x=g1(o),S=g1(a),E=u!=="both"&&u!=="width"||!p1(o)?1:S.width/x.width,A=u!=="both"&&u!=="height"||!m1(o)?1:S.height/x.height;n.scaleSelf(E,A);const P=n.toString();h.set(P,n),p.set(P,e);const{imagePosition:k}=By(P,e,fp);y.set(P,k)}function P1(i,e,n,o,a,u,h,p,y){if(!i)return;const x=(function(S,E,A,P,k,F){if(S.kind==="camera")return S.maxSize;if(S.kind==="composite"){const G=E.possiblyEvaluate(new Xi(S.maxZoom,{worldview:F}),A).evaluate(k,{},A),U=E.possiblyEvaluate(new Xi(S.minZoom,{worldview:F}),A).evaluate(k,{},A);return Math.max(G,U)}return E.possiblyEvaluate(new Xi(P,{worldview:F})).evaluate(k,{},A)})(e,n,o,a,u,y);return i.scaleSelf(x*p*h)}function $m(i,e,n,o,a,u,h,p,y){return{iconPrimary:P1(i.getPrimary(),e,n,o,a,u,h,p,y),iconSecondary:P1(i.getSecondary(),e,n,o,a,u,h,p,y)}}function zI(i,e,n){if(!e)return;const o=n.get(i.toString()),a=n.get(e.toString());o&&a&&(o.paddedRect.w===a.paddedRect.w&&o.paddedRect.h===a.paddedRect.h||$t(`Mismatch in icon variant sizes: ${i.toString()} and ${e.toString()}`),o.usvg!==a.usvg&&$t(`Mismatch in icon variant image types: ${i.id} and ${e.id}`))}function R1(i,e,n,o){if(!i)return;const a=e.get(n.toString());if(i.imagePrimary=a,o){const u=e.get(o.toString());i.imageSecondary=u}}function LI(i,e){for(const n in i.horizontal)k1(i.horizontal[n],e);k1(i.vertical,e)}function k1(i,e){if(i){for(const n of i.positionedLines)for(const o of n.positionedGlyphs)if(o.image!==null){const a=o.image.toString();o.rect=e.get(a).paddedRect}}}function Uy(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DI(i,e,n,o,a,u,h,p,y){const x=Yg(u.horizontal)||u.vertical,S=n.get("icon-text-fit-padding").evaluate(o,{},a);let E,A=e;return e&&y!=="none"&&(i.allowVerticalPlacement&&u.vertical&&(E=Oy(e,u.vertical,y,S,p,h)),x&&(A=Oy(e,x,y,S,p,h))),{defaultShapedIcon:A,verticallyShapedIcon:E}}function OI(i,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y,Q,ne,me,de,ve){let Te=h.textMaxSize.evaluate(e,{},A);Te===void 0?Te=p*h.textScaleFactor:Te*=h.textScaleFactor;const Ie=i.layers[0].layout,qe=Lo,ke=p*h.textScaleFactor/qe,Qe=Yg(n.horizontal)||n.vertical;if(G!=="none"&&i.appearanceFeatureData&&e.index<i.appearanceFeatureData.length){const Vt=i.appearanceFeatureData[e.index];Vt&&(Vt.textShaping=Qe,Vt.iconTextFitPadding=Ie.get("icon-text-fit-padding").evaluate(e,{},A),Vt.fontScale=ke)}const ut=P.name==="globe",ht=i.tilePixelRatio*Te/qe,gt=(mt=i.overscaling,i.zoom>18&&mt>2&&(mt>>=1),Math.max(Pt/(512*mt),1)*Ie.get("symbol-spacing")),vt=Ie.get("text-padding")*i.tilePixelRatio,ft=Ie.get("icon-padding")*i.tilePixelRatio,pt=ti(Ie.get("text-max-angle")),Je=Ie.get("icon-rotation-alignment")==="map"&&Q!=="point",Ye=gt/2;var mt;i.hasAnyIconTextFit===!1&&G!=="none"&&(i.hasAnyIconTextFit=!0);const zt=e.properties?+e.properties[We]:null,St=zt&&i.elevationFeatureIdToIndex?i.elevationFeatureIdToIndex.get(zt):65535,hn=(Vt,Zt,nn)=>{if(Zt.x<0||Zt.x>=Pt||Zt.y<0||Zt.y>=Pt)return;let Qn=null;if(ut){const{x:It,y:on,z:Dn}=P.projectTilePoint(Zt.x,Zt.y,nn);Qn={anchor:new yd(It,on,Dn,0,void 0),up:P.upVector(nn,Zt.x,Zt.y)}}(function(It,on,Dn,gi,bi,qn,Yi,fe,_e,et,_t,Ot,Ft,fn,pn,$n,Xn,Jn,di,Cn,Ln,Pi,Li,Di,Wi,nr,Ki,Ni,Ui,Yn,vi,Er,Tn){const fi=It.addToLineVertexArray(on,gi);let er,rr,hr,Gr,sr,Sn,Ar,qi=0,yr=0,bo=0,Do=0,ao=-1,lo=-1;const Po={};let Ea=Iu("");const ar=Dn?Dn.anchor:on,Br=Ni!=="none";let $r=0,Ha=0;if(_e._unevaluatedLayout.getValue("text-radial-offset")===void 0){const hs=_e.layout.get("text-offset").evaluate(Ln,{},Wi);$r=hs[0]*Lo,Ha=hs[1]*Lo}else $r=_e.layout.get("text-radial-offset").evaluate(Ln,{},Wi)*Lo,Ha=Vy;if(It.allowVerticalPlacement&&bi.vertical){const hs=bi.vertical;if(pn)Sn=Gy(hs),fe&&(Ar=Gy(fe));else{const ha=_e.layout.get("text-rotate").evaluate(Ln,{},Wi)+90;hr=Kg(et,ar,on,_t,Ot,Ft,hs,fn,ha,$n,Er),fe&&(Gr=Kg(et,ar,on,_t,Ot,Ft,fe,Jn,ha,null,vi))}}if(qn){const hs=It.iconSizeData,ha=_e.layout.get("icon-rotate").evaluate(Ln,{},Wi),ml=jy(qn,ha,Li,Br,Pi.iconScaleFactor),Ef=fe?jy(fe,ha,Li,Br,Pi.iconScaleFactor):void 0;rr=Kg(et,ar,on,_t,Ot,Ft,qn,Jn,ha,null,Yn);const nm=(function(mu,lg,Kw,ZA,Jw,Qw,XA,YA){const eb=mu.layers[0],tb=eb.appearances;let im=lg.length;if(Kw&&(im=Math.max(im,Kw.length)),tb.length===0)return im;const[KA,JA]=ZA.get("icon-size-scale-range"),QA=H(1,KA,JA);for(const nb of tb){const ib=nb.getUnevaluatedProperties();if(ib._values["icon-image"].value!==void 0){const rb=eb.getAppearanceValueAndResolveTokens(nb,"icon-image",Jw,Qw,[]);if(rb){const ob=mu.getResolvedImageFromTokens(rb);if(ob){const sb=ib._values["icon-size"],eC=$m(ob,Wp(mu.zoom,sb,mu.worldview),sb,Qw,mu.zoom,Jw,mu.pixelRatio,QA,mu.worldview),tC=XA.get(eC.iconPrimary.toString());im=Math.max(im,SI(tC,YA))}}}}return im})(It,ml,Ef,_e.layout,Ln,Wi,It.iconAtlasPositions,Br);qi=4*nm;let pu=null;hs.kind==="source"?(pu=[uu*_e.layout.get("icon-size").evaluate(Ln,{},Wi)*Pi.iconScaleFactor],pu[0]>vd&&$t(`${It.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)):hs.kind==="composite"&&(pu=[uu*Pi.compositeIconSizes[0].evaluate(Ln,{},Wi)*Pi.iconScaleFactor,uu*Pi.compositeIconSizes[1].evaluate(Ln,{},Wi)*Pi.iconScaleFactor],(pu[0]>vd||pu[1]>vd)&&$t(`${It.layerIds[0]}: Value for "icon-size" is >= ${Hm}. Reduce your "icon-size".`)),It.addSymbols(It.icon,ml,pu,Cn,di,Ln,void 0,Dn,on,fi.lineStartIndex,fi.lineLength,-1,Di,Wi,nr,Ki,It.symbolInstances.length,nm),ao=It.icon.placedSymbolArray.length-1,Ef&&(yr=4*nm,It.addSymbols(It.icon,Ef,pu,Cn,di,Ln,pl.vertical,Dn,on,fi.lineStartIndex,fi.lineLength,-1,Di,Wi,nr,Ki,It.symbolInstances.length,nm),lo=It.icon.placedSymbolArray.length-1)}for(const hs in bi.horizontal){const ha=hs,ml=bi.horizontal[ha];er||(Ea=Iu(ml.text),pn?sr=Gy(ml):er=Kg(et,ar,on,_t,Ot,Ft,ml,fn,_e.layout.get("text-rotate").evaluate(Ln,{},Wi),$n,Er));const Ef=ml.positionedLines.length===1;if(bo+=z1(It,Dn,on,ml,Yi,_e,pn,Ln,$n,fi,bi.vertical?pl.horizontal:pl.horizontalOnly,Ef?CI(bi.horizontal):[ha],Po,ao,Pi,Di,Wi,It.symbolInstances.length,nr),Ef)break}bi.vertical&&(Do+=z1(It,Dn,on,bi.vertical,Yi,_e,pn,Ln,$n,fi,pl.vertical,["vertical"],Po,lo,Pi,Di,Wi,It.symbolInstances.length,nr));let To=-1;const zc=(hs,ha)=>hs?Math.max(hs,ha):ha;To=zc(sr,To),To=zc(Sn,To),To=zc(Ar,To);const fh=To>-1?1:0;It.glyphOffsetArray.length>=65535&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ln.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,Ln.sortKey),It.symbolInstances.emplaceBack(on.x,on.y,ar.x,ar.y,ar.z,Po.right>=0?Po.right:-1,Po.center>=0?Po.center:-1,Po.left>=0?Po.left:-1,Po.vertical>=0?Po.vertical:-1,ao,lo,Ea,er!==void 0?er:It.collisionBoxArray.length,er!==void 0?er+1:It.collisionBoxArray.length,hr!==void 0?hr:It.collisionBoxArray.length,hr!==void 0?hr+1:It.collisionBoxArray.length,rr!==void 0?rr:It.collisionBoxArray.length,rr!==void 0?rr+1:It.collisionBoxArray.length,Gr||It.collisionBoxArray.length,Gr?Gr+1:It.collisionBoxArray.length,_t,bo,Do,qi,yr,fh,0,$r,Ha,To,0,Br?1:0,Ui)})(i,Zt,Qn,Vt,n,o,u,a,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,vt,Y,x,0,ft,Je,U,e,h,S,E,A,k,F,G,St,ne,me,de)};if(Q==="line")for(const Vt of kg(e.geometry,0,0,Pt,Pt)){const Zt=TI(Vt,gt,pt,n.vertical||Qe,o,qe,ht,i.overscaling,Pt);for(const nn of Zt)Qe&&FI(i,Qe.text,Ye,nn)||hn(Vt,nn,A)}else if(Q==="line-center"){for(const Vt of e.geometry)if(Vt.length>1){const Zt=bI(Vt,pt,n.vertical||Qe,o,qe,ht);Zt&&hn(Vt,Zt,A)}}else if(e.type==="Polygon")for(const Vt of Am(e.geometry,0)){const Zt=II(Vt,16);hn(Vt[0],new yd(Zt.x,Zt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Vt of e.geometry)hn(Vt,new yd(Vt[0].x,Vt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Vt of e.geometry)for(const Zt of Vt)hn([Zt],new yd(Zt.x,Zt.y,0,0,void 0),A)}const Hm=255,vd=Hm*uu;function z1(i,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y){const Q=(function(de,ve,Te,Ie,qe,ke,Qe,ut){const ht=[];if(ve.positionedLines.length===0)return ht;const gt=Ie.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,vt=(function(mt){const zt=mt[0],St=mt[1],hn=zt*St;return hn>0?[zt,-St]:hn<0?[-zt,St]:zt===0?[St,zt]:[St,-zt]})(Te);let ft=Math.abs(ve.top-ve.bottom);for(const mt of ve.positionedLines)ft-=mt.lineOffset;const pt=ve.positionedLines.length,Je=ft/pt;let Ye=ve.top-Te[1];for(let mt=0;mt<pt;++mt){const zt=ve.positionedLines[mt];Ye=EI(ve,Je,Ye,mt);for(const St of zt.positionedGlyphs){if(!St.rect)continue;const hn=St.rect||{};let Vt=l1+1,Zt=!0,nn=1,Qn=0;if(St.image){const Xn=Qe.get(St.image.toString());if(!Xn)continue;if(Xn.sdf){$t("SDF images are not supported in formatted text and will be ignored.");continue}Zt=!1,nn=Xn.pixelRatio,Vt=fp/nn}const It=(qe||ut)&&St.vertical,on=St.metrics.advance*St.scale/2,Dn=St.metrics,gi=St.rect;if(gi===null)continue;ut&&ve.verticalizable&&(Qn=St.image?on-St.metrics.width*St.scale/2:0);const bi=qe?[St.x+on,St.y]:[0,0];let qn=[0,0],Yi=[0,0],fe=!1;qe||(It?(Yi=[St.x+on+vt[0],St.y+vt[1]-Qn],fe=!0):qn=[St.x+on+Te[0],St.y+Te[1]-Qn]);const _e=gi.w*St.scale/(nn*(St.localGlyph?hu:1)),et=gi.h*St.scale/(nn*(St.localGlyph?hu:1));let _t,Ot,Ft,fn;if(It){const Xn=St.y-Ye,Jn=new ct(-on,on-Xn),di=-Math.PI/2,Cn=new ct(...Yi);_t=new ct(-on+qn[0],qn[1]),_t._rotateAround(di,Jn)._add(Cn),_t.x+=-Xn+on,_t.y-=(Dn.left-Vt)*St.scale;const Ln=St.image?Dn.advance*St.scale:Lo*St.scale,Pi=String.fromCodePoint(St.glyph);sI(Pi)?_t.x+=(1-Vt)*St.scale:aI(Pi)?_t.x+=Ln-Dn.height*St.scale+(-Vt-1)*St.scale:_t.x+=St.image||Dn.width+2*Vt===gi.w&&Dn.height+2*Vt===gi.h?(Ln-et)/2:(Ln-(Dn.height+2*Vt)*St.scale)/2,Ot=new ct(_t.x,_t.y-_e),Ft=new ct(_t.x+et,_t.y),fn=new ct(_t.x+et,_t.y-_e)}else{const Xn=(Dn.left-Vt)*St.scale-on+qn[0],Jn=(-Dn.top-Vt)*St.scale+qn[1],di=Xn+_e,Cn=Jn+et;_t=new ct(Xn,Jn),Ot=new ct(di,Jn),Ft=new ct(Xn,Cn),fn=new ct(di,Cn)}if(gt){let Xn;Xn=qe?new ct(0,0):fe?new ct(vt[0],vt[1]):new ct(Te[0],Te[1]),_t._rotateAround(gt,Xn),Ot._rotateAround(gt,Xn),Ft._rotateAround(gt,Xn),fn._rotateAround(gt,Xn)}const pn=new ct(0,0),$n=new ct(0,0);ht.push({tl:_t,tr:Ot,bl:Ft,br:fn,texPrimary:hn,texSecondary:void 0,writingMode:ve.writingMode,glyphOffset:bi,sectionIndex:St.sectionIndex,isSDF:Zt,pixelOffsetTL:pn,pixelOffsetBR:$n,minFontScaleX:0,minFontScaleY:0})}}return ht})(0,o,y,u,h,p,a,i.allowVerticalPlacement),ne=i.textSizeData;let me=null;ne.kind==="source"?(me=[uu*u.layout.get("text-size").evaluate(p,{},G)*k.textScaleFactor],me[0]>vd&&$t(`${i.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)):ne.kind==="composite"&&(me=[uu*k.compositeTextSizes[0].evaluate(p,{},G)*k.textScaleFactor,uu*k.compositeTextSizes[1].evaluate(p,{},G)*k.textScaleFactor],(me[0]>vd||me[1]>vd)&&$t(`${i.layerIds[0]}: Value for "text-size" is >= ${Hm}. Reduce your "text-size".`)),i.addSymbols(i.text,Q,me,y,h,p,S,e,n,x.lineStartIndex,x.lineLength,P,F,G,Y,!1,U,Q.length);for(const de of E)A[de]=i.text.placedSymbolArray.length-1;return 4*Q.length}function Yg(i){for(const e in i)return i[e];return null}function Kg(i,e,n,o,a,u,h,p,y,x,S){let E,A,P,k;if(E=S?S.top:h.top,A=S?S.bottom:h.bottom,P=S?S.left:h.left,k=S?S.right:h.right,Dy(h)&&h.collisionPadding){const F=h.collisionPadding;P-=F[0],E-=F[1],k+=F[2],A+=F[3]}if(y){const F=new ct(P,E),G=new ct(k,E),U=new ct(P,A),Y=new ct(k,A),Q=ti(y);let ne=new ct(0,0);x&&(ne=new ct(x[0],x[1])),F._rotateAround(Q,ne),G._rotateAround(Q,ne),U._rotateAround(Q,ne),Y._rotateAround(Q,ne),P=Math.min(F.x,G.x,U.x,Y.x),k=Math.max(F.x,G.x,U.x,Y.x),E=Math.min(F.y,G.y,U.y,Y.y),A=Math.max(F.y,G.y,U.y,Y.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,P,E,k,A,p,o,a,u),i.length-1}function Gy(i){Dy(i)&&i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function FI(i,e,n,o){const a=i.compareText;if(e in a){const u=a[e];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<n)return!0}else a[e]=[];return a[e].push(o),!1}function L1(i,e){const n=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,a=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),u=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01));let h=Math.sin(i._pitch)*u+a;const p=a*(1/i._horizonShift);if(!i.elevation||i.elevation.exaggeration()===0){let y=Math.max(i.zoom-17,0);i.isOrthographic&&(y/=10),h*=1+y}return Math.min(1.01*h,p)}function Wm(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const n=Math.pow(2,-i.z),o=i.x*n,a=(i.x+1)*n,u=i.y*n,h=(i.y+1)*n,p=C(o),y=C(a),x=O(u),S=O(h),E=e.project(p,x),A=e.project(y,x),P=e.project(y,S),k=e.project(p,S);let F=Math.min(E.x,A.x,P.x,k.x),G=Math.min(E.y,A.y,P.y,k.y),U=Math.max(E.x,A.x,P.x,k.x),Y=Math.max(E.y,A.y,P.y,k.y);const Q=n/16;function ne(de,ve,Te,Ie,qe,ke){const Qe=(Te+qe)/2,ut=(Ie+ke)/2,ht=e.project(C(Qe),O(ut)),gt=Math.max(0,F-ht.x,G-ht.y,ht.x-U,ht.y-Y);F=Math.min(F,ht.x),U=Math.max(U,ht.x),G=Math.min(G,ht.y),Y=Math.max(Y,ht.y),gt>Q&&(ne(de,ht,Te,Ie,Qe,ut),ne(ht,ve,Qe,ut,qe,ke))}ne(E,A,o,u,a,u),ne(A,P,a,u,a,h),ne(P,k,a,h,o,h),ne(k,E,o,h,o,u),F-=Q,G-=Q,U+=Q,Y+=Q;const me=1/Math.max(U-F,Y-G);return{scale:me,x:F*me,y:G*me,x2:U*me,y2:Y*me,projection:e}}function D1(i,{x:e,y:n},o=0){return new ct(((e-o)*i.scale-i.x)*Pt,(n*i.scale-i.y)*Pt)}const BI=Be(new Float32Array(16));class Tf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new r(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o,a=!0){return e._coordinatePoint(e.locationCoordinate(n,o),a)}pixelsPerMeter(e,n){return I(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return L1(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,a){const u=e.horizonLineFromTop(!1),h=new ct(n,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,n,o){const a=new ct(n,o);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return BI}createTileMatrix(e,n,o){let a,u,h;const p=o.canonical,y=Be(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Wm(p,this);a=1,u=x.x+o.wrap*x.scale,h=x.y,Ct(y,y,[a/x.scale,a/x.scale,e.pixelsPerMeter/n])}else a=n/e.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*o.wrap)*a,h=p.y*a;return Ke(y,y,[u,h,0]),Ct(y,y,[a/Pt,a/Pt,1]),y}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class NI extends Tf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(ti(n));this.n=(a+Math.sin(ti(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:o,c:a,r0:u}=this,h=ti(e-this.center[0]),p=ti(n),y=Math.sqrt(a-2*o*Math.sin(p))/o;return{x:y*Math.sin(h*o),y:y*Math.cos(h*o)-u,z:0}}unproject(e,n){const{n:o,c:a,r0:u}=this,h=u+n;let p=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(p-=Math.PI*Math.sign(e)*Math.sign(h));const y=ti(this.center[0])*o;p=se(p,-Math.PI-y,Math.PI-y);const x=H(ro(p/o)+this.center[0],-180,180),S=Math.asin(H((a-(e*e+h*h)*o*o)/(2*o),-1,1)),E=H(ro(S),-D,D);return new r(x,E)}}const qm=1.340264,Zm=-.081106,Xm=893e-6,Ym=.003796,Jg=Math.sqrt(3)/2;class jI extends Tf{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Jg*Math.sin(n)),a=o*o,u=a*a*a;return{x:.5*(e*Math.cos(o)/(Jg*(qm+3*Zm*a+u*(7*Xm+9*Ym*a)))/Math.PI+.5),y:1-.5*(o*(qm+Zm*a+u*(Xm+Ym*a))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,a=o*o,u=a*a*a;for(let S,E,A,P=0;P<12&&(E=o*(qm+Zm*a+u*(Xm+Ym*a))-n,A=qm+3*Zm*a+u*(7*Xm+9*Ym*a),S=E/A,o=H(o-S,-Math.PI/3,Math.PI/3),a=o*o,u=a*a*a,!(Math.abs(S)<1e-12));++P);const h=Jg*e*(qm+3*Zm*a+u*(7*Xm+9*Ym*a))/Math.cos(o),p=Math.asin(Math.sin(o)/Jg),y=H(180*h/Math.PI,-180,180),x=H(180*p/Math.PI,-D,D);return new r(y,x)}}class VI extends Tf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const o=360*(e-.5),a=H(360*(.5-n),-D,D);return new r(o,a)}}const Yp=Math.PI/2;function Qg(i){return Math.tan((Yp+i)/2)}class UI extends Tf{constructor(e){super(e),this.center=e.center||[0,30];const[n,o]=this.parallels=e.parallels||[30,30];let a=ti(n),u=ti(o);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const h=Math.cos(a),p=Qg(a);this.n=a===u?Math.sin(a):Math.log(h/Math.cos(u))/Math.log(Qg(u)/p),this.f=h*Math.pow(Qg(a),this.n)/this.n}project(e,n){n=ti(n),this.southernCenter&&(n=-n),e=ti(e-this.center[0]);const o=1e-6,{n:a,f:u}=this;u>0?n<-Yp+o&&(n=-Yp+o):n>Yp-o&&(n=Yp-o);const h=u/Math.pow(Qg(n),a);let p=h*Math.sin(a*e),y=u-h*Math.cos(a*e);return p=.5*(p/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:p,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:o,f:a}=this,u=a-n,h=Math.sign(u),p=Math.sign(o)*Math.sqrt(e*e+u*u);let y=Math.atan2(e,Math.abs(u))*h;u*o<0&&(y-=Math.PI*Math.sign(e)*h);const x=H(ro(y/o)+this.center[0],-180,180),S=H(ro(2*Math.atan(Math.pow(a/p,1/o))-Yp),-D,D);return new r(x,this.southernCenter?-S:S)}}class O1 extends Tf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:v(e),y:b(n),z:0}}unproject(e,n){const o=C(e),a=O(n);return new r(o,a)}}const F1=ti(D);class GI extends Tf{project(e,n){const o=(n=ti(n))*n,a=o*o;return{x:.5*((e=ti(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,a=25,u=0,h=o*o;do{h=o*o;const x=h*h;u=(o*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-n)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),o=H(o-u,-F1,F1)}while(Math.abs(u)>1e-6&&--a>0);h=o*o;const p=H(ro(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=ro(o);return new r(p,y)}}const B1=ti(D);class $I extends Tf{project(e,n){n=ti(n),e=ti(e);const o=Math.cos(n),a=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),h=Math.sin(u)/u,p=.5*(e*a+2*o*Math.sin(e/2)/h)||0,y=.5*(n+Math.sin(n)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,u=25;const h=1e-6;let p=0,y=0;do{const x=Math.cos(a),S=Math.sin(a),E=2*S*x,A=S*S,P=x*x,k=Math.cos(o/2),F=Math.sin(o/2),G=2*k*F,U=F*F,Y=1-P*k*k,Q=Y?1/Y:0,ne=Y?Math.acos(x*k)*Math.sqrt(1/Y):0,me=.5*(2*ne*x*F+2*o/Math.PI)-e,de=.5*(ne*S+a)-n,ve=.5*Q*(P*U+ne*x*k*A)+1/Math.PI,Te=Q*(G*E/4-ne*S*F),Ie=.125*Q*(E*F-ne*S*P*G),qe=.5*Q*(A*k+ne*U*x)+.5,ke=Te*Ie-qe*ve;p=(de*Te-me*qe)/ke,y=(me*Ie-de*ve)/ke,o=H(o-p,-Math.PI,Math.PI),a=H(a-y,-B1,B1)}while((Math.abs(p)>h||Math.abs(y)>h)&&--u>0);return new r(ro(o),ro(a))}}class N1 extends Tf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ti(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:o,cosPhi:a}=this;return{x:ti(e)*a*o+.5,y:-Math.sin(ti(n))/a*o+.5,z:0}}unproject(e,n){const{scale:o,cosPhi:a}=this,u=-(n-.5)/o,h=H(ro((e-.5)/o)/a,-180,180),p=Math.asin(H(u*a,-1,1)),y=H(ro(p),-D,D);return new r(h,y)}}class HI extends O1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){const a=ii(e,n,o);return Gi(a,a,Bi(Nn(o))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,n,o){const a=Uo(n.lat,n.lng),u=xn([],a),h=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;gn(a,a,u,I(1,0)*Pt*h);const p=Be(new Float64Array(16));return ot(p,e.pixelMatrix,e.globeMatrix),Gi(a,a,p),new ct(a[0],a[1])}pixelsPerMeter(e,n){return I(1,0)*n}pixelSpaceConversion(e,n,o){const a=I(1,e)*n,u=bn(I(1,45)*n,a,o);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,o){const a=ts(Nn(o.canonical));return ot(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,n){const{center:o}=e,a=Bi(Nn(n));return Nt(a,a,ti(o.lng)),tt(a,a,ti(o.lat)),Ct(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,n,o,a){return rn(e,n,o,!0)||new ee(0,0)}pointCoordinate3D(e,n,o){const a=this.pointCoordinate(e,n,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,n){return!rn(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=(function(a,u){const h=a.cameraToCenterDistance,p=a._centerAltitude*u,y=a._camera,x=a._camera.forward(),S=nt([],Gt([],x,-h),[0,0,p]),E=a.worldSize/(2*Math.PI),A=[0,0,-E],P=a.width/a.height,k=Math.tan(a.fovAboveCenter),F=Gt([],y.up(),k),G=Gt([],y.right(),k*P),U=xn([],nt([],nt([],x,F),G)),Y=[];let Q;if(new Yt(S,U).closestPointOnSphere(A,E,Y)){const ne=nt([],Y,A),me=Cr([],ne,S);Q=Math.cos(a.fovAboveCenter)*Hn(me)}else{const ne=Cr([],S,A),me=Cr([],A,S);xn(me,me);const de=Hn(ne)-E;Q=Math.sqrt(de*(de+2*E));const ve=Math.acos(Q/(E+de))-Math.acos(kn(x,me));Q*=Math.cos(ve)}return 1.01*Q})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=vf(e.zoom);if(o>0){const a=L1(e,I(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return bn(n,a+u*(1-Math.cos(h)),Math.pow(o,10))}return n}upVector(e,n,o){return ii(n,o,e,1)}upVectorScale(e){return{metersToTile:en(Si(Nn(e)))}}}function j1(i){const e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new O1(i);case"equirectangular":return new VI(i);case"naturalEarth":return new GI(i);case"equalEarth":return new jI(i);case"winkelTripel":return new $I(i);case"albers":return n?new N1(i):new NI(i);case"lambertConformalConic":return n?new N1(i):new UI(i);case"globe":return new HI(i)}throw new Error(`Invalid projection name: ${i.name}`)}const WI=Ae.types,qI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Km(i,e,n,o,a,u,h,p,y,x,S,E,A){const P=p?Math.min(vd,Math.round(p[0])):0,k=p?Math.min(vd,Math.round(p[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*a),u,h,(P<<1)+(y?1:0),0+(k<<1),16*x,16*S,256*E,256*A)}function Jm(i,e,n){i.emplaceBack(e,n)}function Qm(i,e,n,o,a,u,h){i.emplaceBack(e,n,o,a,u,h)}const e_=(i,e,n,o)=>{for(let a=0;a<e;a++)i.emplaceBack(n[0],n[1],n[2],o[0],o[1],o[2])};function Kp(i,e,n,o,a){i.emplaceBack(e,n,o,a),i.emplaceBack(e,n,o,a),i.emplaceBack(e,n,o,a),i.emplaceBack(e,n,o,a)}function ZI(i){for(const e of i.sections)if(po(e.text))return!0;return!1}class $y{constructor(e){this.layoutVertexArray=new ep,this.indexArray=new Jr,this.programConfigurations=e,this.segments=new ki,this.dynamicLayoutVertexArray=new sc,this.opacityVertexArray=new rd,this.placedSymbolArray=new np,this.iconTransitioningVertexArray=new sa,this.globeExtVertexArray=new cf,this.zOffsetVertexArray=new sl,this.orientationVertexArray=new df,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,n){const o=[],a=this.layoutVertexArray.uint16;for(let u=0;u<n;++u){const h=12*(e+u);o.push(...a.slice(h,h+12))}return o}updateIconVertexData(e,n,o,a,u,h,p,y,x,S,E,A,P){const k=this.layoutVertexArray.uint16,F=12*e;k[F]=n,k[F+1]=o,k[F+2]=a,k[F+3]=u,k[F+4]=h,k[F+5]=p,k[F+6]=y,k[F+7]=x,k[F+8]=S,k[F+9]=E,k[F+10]=A,k[F+11]=P}upload(e,n,o,a,u,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YE.members,!!h),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,JE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,tI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,QE.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,eI.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qt($y,"SymbolBuffers");class Hy{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new ki,this.collisionVertexArray=new us,this.collisionVertexArrayExt=new sc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nI.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,iI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(Hy,"CollisionBuffers");class t_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((h=>h.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Be([]),this.placementViewportMatrix=Be([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Wp(this.zoom,n["text-size"],this.worldview),this.iconSizeData=Wp(this.zoom,n["icon-size"],this.worldview);const o=this.layers[0].layout,a=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.lut=e.lut,this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map((h=>pl[h])),this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();return!(!n||n.length===0)&&n.some((o=>o.getProperty(e)!=null))}createArrays(){this.text=new $y(new ca(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new $y(new ca(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new mf,this.lineVertexArray=new ip,this.symbolInstances=new ll}calculateGlyphDependencies(e,n,o,a,u){for(const h of e){const p=h.codePointAt(0);if(p===void 0)break;if(n[p]=!0,a&&u&&p<=65535){const y=jm[h];y&&(n[y.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,o,a,u,h){let p=1;const y=e.getUnevaluatedProperties()._values["icon-size"],x=Wp(this.zoom,y,this.worldview),S=qp(x,n);if(x.kind!=="constant"&&x.kind!=="camera"||(p=S.uSize),x.kind==="composite"){const{minZoom:E,maxZoom:A}=x,P=y.possiblyEvaluate(new Xi(E,{worldview:this.worldview}),a),k=y.possiblyEvaluate(new Xi(A,{worldview:this.worldview}),a),F=P.evaluate(o,{},a,u);p=F+(k.evaluate(o,{},a,u)-F)*S.uSizeT}return x.kind==="source"&&(p=y.possiblyEvaluate(new Xi(this.zoom,{worldview:this.worldview}),a).evaluate(o,{},a,u)),p*h}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const o=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Mg(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?_s.build(e):e}populate(e,n,o,a){const u=this.layers[0],h=u.layout,p=this.projection.name==="globe",y=h.get("text-font"),x=h.get("text-field"),S=h.get("icon-image"),[E,A]=h.get("icon-size-scale-range"),P=H(n.scaleFactor||1,E,A),k=(x.value.kind!=="constant"||x.value.value instanceof gs&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),F=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,G=this.hasAnyAppearanceProperty("icon-image"),U=h.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!k&&!F&&!G)return;const Y=n.iconDependencies,Q=n.glyphDependencies,ne=n.availableImages,me=new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),de=ve=>{const Te=ve.id.toString();Y.has(Te)?Y.get(Te).push(ve):Y.set(Te,[ve])};for(const ve of e){const{feature:Te,id:Ie,index:qe,sourceLayerIndex:ke}=ve,Qe=u._featureFilter.needGeometry,ut=Re(Te,Qe);if(!u._featureFilter.filter(me,ut,o))continue;if(Qe||(ut.geometry=xe(Te,o,a)),p&&Te.type!==1&&o.z<=5){const mt=ut.geometry,zt=.98078528056,St=(hn,Vt)=>kn(ii(hn.x,hn.y,o,1),ii(Vt.x,Vt.y,o,1))<zt;for(let hn=0;hn<mt.length;hn++)mt[hn]=pe(mt[hn],St)}let ht,gt;if(k){const mt=u.getValueAndResolveTokens("text-field",ut,o,ne),zt=gs.factory(mt);ZI(zt)&&(this.hasRTLText=!0),(!this.hasRTLText||mo()==="unavailable"||this.hasRTLText&&Ua.isParsed())&&(ht=oI(zt,u,ut))}if(F){const mt=u.getValueAndResolveTokens("icon-image",ut,o,ne);gt=this.getResolvedImageFromTokens(mt)}const vt=this.layers[0];let ft=!1;if(!gt&&G){const mt=vt.getAppearances();for(const zt of mt)if(zt.getProperty("icon-image")){const St=vt.getAppearanceValueAndResolveTokens(zt,"icon-image",ut,o,ne);if(St){gt=this.getResolvedImageFromTokens(St),ft=!0;break}}}if(!ht&&!gt)continue;const pt=this.sortFeaturesByKey?U.evaluate(ut,{},o):void 0,Je={id:Ie,text:ht,icon:gt,index:qe,sourceLayerIndex:ke,geometry:ut.geometry,properties:Te.properties,type:WI[Te.type],sortKey:pt};if(this.features.push(Je),this.featureToAppearanceIndex[qe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Ie,properties:Te.properties,usesAppearanceIconAsPlaceholder:ft,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),gt){const mt=vt._unevaluatedLayout._values,{iconPrimary:zt,iconSecondary:St}=$m(gt,this.iconSizeData,mt["icon-size"],o,this.zoom,Je,this.pixelRatio,P,this.worldview);de(zt),St&&(this.hasAnySecondaryIcon=!0,de(St))}const Ye=vt.getAppearances();if(Ye.length!==0&&Ye.forEach((mt=>{if(!mt.getProperty("icon-image"))return;const zt=this.getCombinedIconPrimary(mt,vt,ut,o,ne,Je,P);zt&&de(zt)})),ht){const mt=y.evaluate(ut,{},o).join(","),zt=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pl.vertical)>=0;for(const St of ht.sections)if(St.image){const hn=St.image.getPrimary().scaleSelf(this.pixelRatio),Vt=hn.id.toString(),Zt=Y.get(Vt)||[];Zt.push(hn),Y.set(Vt,Zt)}else{const hn=oa(ht.toString()),Vt=St.fontStack||mt,Zt=Q[Vt]=Q[Vt]||{};this.calculateGlyphDependencies(St.text,Zt,zt,this.allowVerticalPlacement,hn)}}}if(h.get("symbol-placement")==="line"&&(this.features=(function(ve){const Te={},Ie={},qe=[];let ke=0;function Qe(vt){qe.push(ve[vt]),ke++}function ut(vt,ft,pt){const Je=Ie[vt];return delete Ie[vt],Ie[ft]=Je,qe[Je].geometry[0].pop(),qe[Je].geometry[0]=qe[Je].geometry[0].concat(pt[0]),Je}function ht(vt,ft,pt){const Je=Te[ft];return delete Te[ft],Te[vt]=Je,qe[Je].geometry[0].shift(),qe[Je].geometry[0]=pt[0].concat(qe[Je].geometry[0]),Je}function gt(vt,ft,pt){const Je=pt?ft[0][ft[0].length-1]:ft[0][0];return`${vt}:${Je.x}:${Je.y}`}for(let vt=0;vt<ve.length;vt++){const ft=ve[vt],pt=ft.geometry,Je=ft.text?ft.text.toString():null;if(!Je){Qe(vt);continue}const Ye=gt(Je,pt),mt=gt(Je,pt,!0);if(Ye in Ie&&mt in Te&&Ie[Ye]!==Te[mt]){const zt=ht(Ye,mt,pt),St=ut(Ye,mt,qe[zt].geometry);delete Te[Ye],delete Ie[mt],Ie[gt(Je,qe[St].geometry,!0)]=St,qe[zt].geometry=null}else Ye in Ie?ut(Ye,mt,pt):mt in Te?ht(Ye,mt,pt):(Qe(vt),Te[Ye]=ke-1,Ie[mt]=ke-1)}return qe.filter((vt=>vt.geometry))})(this.features)),h.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ve of n.elevationFeatures)this.elevationFeatureIdToIndex.set(ve.id,this.elevationFeatures.length),this.elevationFeatures.push(ve)}}else h.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((ve,Te)=>ve.sortKey-Te.sortKey))}getCombinedIconPrimary(e,n,o,a,u,h,p){let y,x;const S=e.getUnevaluatedProperties();if(S._values["icon-image"].value!==void 0){const E=n.getAppearanceValueAndResolveTokens(e,"icon-image",o,a,u);y=this.getResolvedImageFromTokens(E)}else{const E=n.getValueAndResolveTokens("icon-image",o,a,u);y=this.getResolvedImageFromTokens(E)}if(y){const E=S._values["icon-size"]||n._unevaluatedLayout._values["icon-size"];x=$m(y,Wp(this.zoom,E,this.worldview),E,a,this.zoom,h,this.pixelRatio,p,this.worldview).iconPrimary}return x}updateAppearanceBasedIconTextures(e,n,o,a){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const u=this.layers[0];let h=!1,p=0;const y=u.layout,[x,S]=y.get("icon-size-scale-range"),E=H(1,x,S);for(let A=0;A<this.symbolInstances.length;A++){const P=this.symbolInstances.get(A),k=this.featureToAppearanceIndex[P.featureIndex],F=k!==void 0?this.appearanceFeatureData[k]:void 0;if(F&&P.placedIconSymbolIndex>=0){const G=F.id,U=n&&G!==void 0?n[String(G)]:void 0,Y={type:"Point",id:F.id,properties:F.properties,geometry:[]},Q=this.layers[0].appearances&&this.layers[0].appearances.find((ne=>ne.isActive({globals:a,feature:Y,canonical:e,featureState:U})));if(F.activeAppearance===Q){p+=P.numIconVertices;continue}if(Q){F.activeAppearance=Q;const ne=this.getCombinedIconPrimary(Q,u,Y,e,o,{sortKey:void 0,text:void 0,icon:null,index:P.featureIndex,sourceLayerIndex:P.featureIndex,geometry:[],properties:F.properties,type:"Point",id:F.id},E);if(!ne)continue;const me=ne.toString(),de=this.iconAtlasPositions&&this.iconAtlasPositions.get(me);if(de){const ve=u.getAppearanceValueAndResolveTokens(Q,"icon-offset",Y,e,o),Te=ve&&Array.isArray(ve)?ve:[0,0];let Ie=Hg(de,void 0,Te,u.layout.get("icon-anchor").evaluate(Y,{},e));const qe=u.getAppearanceValueAndResolveTokens(Q,"icon-rotate",Y,e,o),ke=typeof qe=="number"?qe:0,Qe=de.sdf,ut=u.layout.get("icon-text-fit").constantOr("none");ut!=="none"&&F.textShaping&&F.iconTextFitPadding&&F.fontScale&&(Ie=Oy(Ie,F.textShaping,ut,F.iconTextFitPadding,Te,F.fontScale));const ht=this.calculateEffectiveAppearanceIconSize(Q,a.zoom,Y,e,o,E),gt=0,vt=1+(Math.min(vd,Math.round(ht*uu))<<1),ft=jy(Ie,ke,Qe,ut!=="none",E);F.isUsingAppearanceVertexData||(F.isUsingAppearanceVertexData=!0,F.layoutBasedVertexData=this.icon.getIconVertexData(p,P.numIconVertices));for(let Je=0;Je<ft.length;++Je){const Ye=ft[Je],mt=F.layoutBasedVertexData[0]||P.tileAnchorX,zt=F.layoutBasedVertexData[1]||P.tileAnchorY,St=16*Ye.pixelOffsetTL.x,hn=16*Ye.pixelOffsetTL.y,Vt=16*Ye.pixelOffsetBR.x,Zt=16*Ye.pixelOffsetBR.y,nn=16*Ye.minFontScaleX,Qn=16*Ye.minFontScaleY;this.icon.updateIconVertexData(p,mt,zt,Math.round(32*Ye.tl.x),Math.round(32*Ye.tl.y),Ye.texPrimary.x,Ye.texPrimary.y,gt,vt,St,hn,nn,Qn),this.icon.updateIconVertexData(p+1,mt,zt,Math.round(32*Ye.tr.x),Math.round(32*Ye.tr.y),Ye.texPrimary.x+Ye.texPrimary.w,Ye.texPrimary.y,gt,vt,Vt,hn,nn,Qn),this.icon.updateIconVertexData(p+2,mt,zt,Math.round(32*Ye.bl.x),Math.round(32*Ye.bl.y),Ye.texPrimary.x,Ye.texPrimary.y+Ye.texPrimary.h,gt,vt,St,Zt,nn,Qn),this.icon.updateIconVertexData(p+3,mt,zt,Math.round(32*Ye.br.x),Math.round(32*Ye.br.y),Ye.texPrimary.x+Ye.texPrimary.w,Ye.texPrimary.y+Ye.texPrimary.h,gt,vt,Vt,Zt,nn,Qn),p+=4}const pt=P.numIconVertices-4*ft.length;for(let Je=0;Je<pt;++Je)this.icon.updateIconVertexData(p+Je,0,0,0,0,0,0,0,0,0,0,0,0);h=!0}else p+=P.numIconVertices}else if(F.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(p,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+3,0,0,0,0,0,0,0,0,0,0,0,0),h=!0),p+=P.numIconVertices,F.activeAppearance=null;else if(F.isUsingAppearanceVertexData){const me=F.layoutBasedVertexData.length/12;for(let de=0;de<me;++de){const ve=de*12;this.icon.updateIconVertexData(p+de,F.layoutBasedVertexData[ve+0],F.layoutBasedVertexData[ve+1],F.layoutBasedVertexData[ve+2],F.layoutBasedVertexData[ve+3],F.layoutBasedVertexData[ve+4],F.layoutBasedVertexData[ve+5],F.layoutBasedVertexData[ve+6],F.layoutBasedVertexData[ve+7],F.layoutBasedVertexData[ve+8],F.layoutBasedVertexData[ve+9],F.layoutBasedVertexData[ve+10],F.layoutBasedVertexData[ve+11])}p+=me,F.isUsingAppearanceVertexData=!1,F.activeAppearance=null,h=!0}else p+=P.numIconVertices,F.activeAppearance=null}}return h}update(e,n,o,a,u,h,p){this.text.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,u,o,a,h,p,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const o=q(e),a=1/o;let u=!1,h=!1;for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p),x=Wt(1,0,0),S=Wt(0,1,0),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:A,numIconVertices:P,numVerticalIconVertices:k}=y,F=E>0||A>0,G=P>0,U=this.elevationFeatures[y.elevationFeatureIndex];if(U){const Y=new ct(y.tileAnchorX,y.tileAnchorY),Q=.075+U.pointElevation(Y);y.zOffset!==Q&&(n=!0,y.zOffset=Q),Q!==0&&(this.hasAnyZOffset=!0);const ne=U.computeSlopeNormal(Y,a),me=Ul(Ma(),Wt(0,0,1),ne);Es(x,x,me),Es(S,S,me),x[2]*=o,S[2]*=o,x[0]===1&&x[1]===0&&x[2]===0&&S[0]===0&&S[1]===1&&S[2]===0||(u=u||F,h=h||G)}if(F&&(e_(this.text.orientationVertexArray,E,x,S),e_(this.text.orientationVertexArray,A,x,S)),G){const{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:Q}=y;Y>=0&&e_(this.icon.orientationVertexArray,P,x,S),Q>=0&&e_(this.icon.orientationVertexArray,k,x,S)}}u||(this.text.orientationVertexArray=void 0),h||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(u,h,p)=>{o+=h,o>u.length&&u.resize(o);for(let y=-h;y<0;y++)u.emplace(y+o,p)},n=(u,h,p)=>{a+=h,a>u.length&&u.resize(a);for(let y=-h;y<0;y++)u.emplace(y+a,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:y,numIconVertices:x}=h,S=h.zOffset,E=x>0;if((p>0||y>0)&&(e(this.text.zOffsetVertexArray,p,S),e(this.text.zOffsetVertexArray,y,S)),E){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:P}=h;A>=0&&n(this.icon.zOffsetVertexArray,x,S),P>=0&&n(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,o,a,u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((h=>h.appearances&&h.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,o,a){return!!(e&&n&&o)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,n,o,a)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=j1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:u}of n)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,a,u,h,p,y,x,S,E,A,P,k,F,G,U,Y){const Q=e.indexArray,ne=e.layoutVertexArray,me=e.globeExtVertexArray,de=e.segments.prepareSegment(4*Y,ne,Q,this.canOverlap?h.sortKey:void 0),ve=this.glyphOffsetArray.length,Te=de.vertexLength,Ie=this.allowVerticalPlacement&&p===pl.vertical?Math.PI/2:0,qe=h.text&&h.text.sections;for(let ut=0;ut<n.length;ut++){const{tl:ht,tr:gt,bl:vt,br:ft,texPrimary:pt,texSecondary:Je,pixelOffsetTL:Ye,pixelOffsetBR:mt,minFontScaleX:zt,minFontScaleY:St,glyphOffset:hn,isSDF:Vt,sectionIndex:Zt}=n[ut],nn=de.vertexLength,Qn=hn[1];if(Km(ne,x.x,x.y,ht.x,Qn+ht.y,pt.x,pt.y,o,Vt,Ye.x,Ye.y,zt,St),Km(ne,x.x,x.y,gt.x,Qn+gt.y,pt.x+pt.w,pt.y,o,Vt,mt.x,Ye.y,zt,St),Km(ne,x.x,x.y,vt.x,Qn+vt.y,pt.x,pt.y+pt.h,o,Vt,Ye.x,mt.y,zt,St),Km(ne,x.x,x.y,ft.x,Qn+ft.y,pt.x+pt.w,pt.y+pt.h,o,Vt,mt.x,mt.y,zt,St),y){const{x:It,y:on,z:Dn}=y.anchor,[gi,bi,qn]=y.up;Qm(me,It,on,Dn,gi,bi,qn),Qm(me,It,on,Dn,gi,bi,qn),Qm(me,It,on,Dn,gi,bi,qn),Qm(me,It,on,Dn,gi,bi,qn),Kp(e.dynamicLayoutVertexArray,It,on,Dn,Ie)}else Kp(e.dynamicLayoutVertexArray,x.x,x.y,x.z,Ie);if(G){const It=Je||pt;Jm(e.iconTransitioningVertexArray,It.x,It.y),Jm(e.iconTransitioningVertexArray,It.x+It.w,It.y),Jm(e.iconTransitioningVertexArray,It.x,It.y+It.h),Jm(e.iconTransitioningVertexArray,It.x+It.w,It.y+It.h)}Q.emplaceBack(nn,nn+1,nn+2),Q.emplaceBack(nn+1,nn+2,nn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(hn[0]),ut!==n.length-1&&Zt===n[ut+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,h,h.index,{},P,k,F,qe&&qe[Zt],this.worldview)}const ke=Y-n.length;ke!==0&&this._addNullVertices(ke,ne,o,y,me,e,G,de,Q);const Qe=y?y.anchor:x;e.placedSymbolArray.emplaceBack(Qe.x,Qe.y,Qe.z,x.x,x.y,ve,this.glyphOffsetArray.length-ve,Te,S,E,x.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],p,0,0,0,A,0),e.symbolInstanceIndices.push(U)}_addNullVertices(e,n,o,a,u,h,p,y,x){for(let S=0;S<e;S++){for(let A=0;A<4;A++)Km(n,0,0,0,0,0,0,o,!1,0,0,0,0),a&&Qm(u,0,0,0,0,0,0),Kp(h.dynamicLayoutVertexArray,0,0,0,0),p&&Jm(h.iconTransitioningVertexArray,0,0);const E=y.vertexLength;x.emplaceBack(E,E+1,E+2),x.emplaceBack(E+1,E+2,E+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,o,a,u,h,p){e.emplaceBack(n,o,a,u,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,n,o,a,u,h,p){const y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=y.vertexLength,S=p.tileAnchorX,E=p.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,p.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,S,E,new ct(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,S,E,new ct(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,S,E,new ct(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,S,E,new ct(e.x1,e.y2)),y.vertexLength+=4;const A=o.indexArray;A.emplaceBack(x,x+1),A.emplaceBack(x+1,x+2),A.emplaceBack(x+2,x+3),A.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,a,u,h){for(let p=a;p<u;p++){const y=o.get(p),x=this.getSymbolInstanceTextSize(e,h,n,p);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,n,o,a,u,h){for(let p=a;p<u;p++){const y=o.get(p),x=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hy(uf,r1.members,sa),this.iconCollisionBox=new Hy(uf,r1.members,sa);const a=qp(this.iconSizeData,e),u=qp(this.textSizeData,e,o);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(u,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,o,a){const u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),h=Fy(this.textSizeData,e,u)/Lo;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,n,o){const a=this.icon.placedSymbolArray.get(o),u=Fy(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,o,a){e.emplaceBack(n,-o,-o,a),e.emplaceBack(n,o,-o,a),e.emplaceBack(n,o,o,a),e.emplaceBack(n,-o,o,a)}_updateTextDebugCollisionBoxes(e,n,o,a,u,h,p){for(let y=a;y<u;y++){const x=o.get(y),S=this.getSymbolInstanceTextSize(e,h,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,x.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,a,u,h,p){for(let y=a;y<u;y++){const x=o.get(y),S=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,x.padding,h.zOffset)}}updateCollisionDebugBuffers(e,n,o,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=qp(this.iconSizeData,e,a),h=qp(this.textSizeData,e,o);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y,o),this._updateTextDebugCollisionBoxes(h,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,o),this._updateIconDebugCollisionBoxes(u,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y,a),this._updateIconDebugCollisionBoxes(u,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,a,u,h,p,y,x){const S={};if(n<o){const{x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne,featureIndex:me}=e.get(n);S.textBox={x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne},S.textFeatureIndex=me}if(a<u){const{x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne,featureIndex:me}=e.get(a);S.verticalTextBox={x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne},S.verticalTextFeatureIndex=me}if(h<p){const{x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne,featureIndex:me}=e.get(h);S.iconBox={x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne},S.iconFeatureIndex=me}if(y<x){const{x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne,featureIndex:me}=e.get(y);S.verticalIconBox={x1:E,y1:A,x2:P,y2:k,padding:F,projectedAnchorX:G,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:Q,tileAnchorY:ne},S.verticalIconFeatureIndex=me}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),a=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),a=[],u=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);const y=this.symbolInstances.get(p);a.push(0|Math.round(n*y.tileAnchorX+o*y.tileAnchorY)),u.push(y.featureIndex)}return h.sort(((p,y)=>a[p]-a[y]||u[y]-u[p])),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let o;return this.elevationFeatures&&n<this.elevationFeatures.length&&(o=this.elevationFeatures[n]),o}}function V1(i,e){return e.replace(/{([^{}]+)}/g,((n,o)=>o in i?String(i[o]):""))}let U1,G1,Wy;qt(t_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),t_.addDynamicAttributes=Kp;class $1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:pa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt($1,"FormatSectionOverride",{omit:["defaultValue"]});const qy=()=>Wy||(Wy={layout:U1||(U1=new Tr({"symbol-placement":new Tt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Le.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(Le.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(Le.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(Le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(Le.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(Le.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(Le.layout_symbol["icon-image"]),"icon-image-use-theme":new Tt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Dt(Le.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(Le.layout_symbol["icon-offset"]),"icon-anchor":new Dt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(Le.layout_symbol["text-field"]),"text-font":new Dt(Le.layout_symbol["text-font"]),"text-size":new Dt(Le.layout_symbol["text-size"]),"text-size-scale-range":new Tt(Le.layout_symbol["text-size-scale-range"]),"text-max-width":new Dt(Le.layout_symbol["text-max-width"]),"text-line-height":new Dt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(Le.layout_symbol["text-justify"]),"text-radial-offset":new Dt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new Dt(Le.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(Le.layout_symbol["text-rotate"]),"text-padding":new Tt(Le.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Le.layout_symbol["text-keep-upright"]),"text-transform":new Dt(Le.layout_symbol["text-transform"]),"text-offset":new Dt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Le.layout_symbol["text-optional"]),visibility:new Tt(Le.layout_symbol.visibility)})),paint:G1||(G1=new Tr({"icon-opacity":new Dt(Le.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dt(Le.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dt(Le.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dt(Le.paint_symbol["text-emissive-strength"]),"icon-color":new Dt(Le.paint_symbol["icon-color"]),"icon-halo-color":new Dt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Le.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Le.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dt(Le.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dt(Le.paint_symbol["text-occlusion-opacity"]),"text-color":new Dt(Le.paint_symbol["text-color"],{runtimeType:zs,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Dt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(Le.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Le.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(Le.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(Le.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(Le.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(Le.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dt(Le.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},Wy);class n_ extends xs{constructor(e,n,o,a){super(e,qy(),n,o,a,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Be([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach((a=>{a.recalculate(e,n,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const a=[];for(const u of o)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,o,a){return this._saturation===e&&this._contrast===n&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=(function(u,h,p,y){u=wr(u),h=Ei(h);const x=st(),S=u/3,E=1-2*S,A=[E,S,S,0,S,E,S,0,S,S,E,0,0,0,0,1],P=.5-.5*h,k=y-p;return ot(x,[k,0,0,0,0,k,0,0,0,0,k,0,p,p,p,1],[h,0,0,0,0,h,0,0,0,0,h,0,P,P,P,1]),ot(x,x,A),x})(e,n,o,a),this._saturation=e,this._contrast=n,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,o,a){const u=this.layout.get(e).evaluate(n,{},o,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Qc(h.value)||!u?u:V1(n.properties,u)}getAppearanceValueAndResolveTokens(e,n,o,a,u){const h=e.getProperty(n);if(!h)return;const p=h.evaluate(o,{},a,u),y=e.getUnevaluatedProperties()._values[n];return y.isDataDriven()||Qc(y.value)||!p||typeof p!="string"?p:V1(o.properties,p)}createBucket(e){return new t_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of qy().paint.overridableProperties){if(!n_.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new $1(n),a=new Ku(o,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new ss("source",a):new ba("composite",a,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new vs(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&n_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),a=qy().paint.properties[n];let u=!1;const h=p=>{for(const y of p)if(a.overrides&&a.overrides.hasOverride(y))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof gs)h(o.value.value.sections);else if(o.value.kind==="source"){const p=x=>{u||(x instanceof Tl&&Zr(x.value)===Sh?h(x.value.sections):x instanceof Ja?h(x.sections):x.eachChild(p))},y=o.value;y._styleExpression&&p(y._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,o){return{config:new Rc(this,{zoom:n,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let H1,W1,q1,Z1;var Zy=ni([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function i_(i,e,n,o,a,u,h,p){const y=[i,e,1,n,o,1,a,u,1],x=[h,p,1],S=Oe([],y),[E,A,P]=yo(x,x,S);return je(y,y,[E,0,0,0,A,0,0,0,P])}function X1(i,e,n,o,a,u,h,p){const y=(function(x,S,E,A,P,k,F,G){const U=i_(0,0,1,0,1,1,0,1),Y=i_(x,S,E,A,P,k,F,G);return je(Y,Y,Oe([],U))})(i,e,n,o,a,u,h,p);return[y[2]/y[8]/Pt,y[5]/y[8]/Pt]}function r_(i){return[i[0],Math.min(Math.max(i[1],-D),D)]}class Y1 extends fc{constructor(e,n,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new fa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Oc(this.map._requestManager.transformRequest(this.url,$l.Image),((o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Au(o)):a&&(this.image=a instanceof HTMLImageElement?xo.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Fm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new fa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Fm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(const u of e)u[1]>o&&(o=u[1]),u[1]<n&&(n=u[1]);const a=(o+n)/2;if(a>D?this.onNorthPole=!0:a<-D&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(ee.fromLngLat);this.tileID=(function(h){let p=1/0,y=1/0,x=-1/0,S=-1/0;for(const F of h)p=Math.min(p,F.x),y=Math.min(y,F.y),x=Math.max(x,F.x),S=Math.max(S,F.y);const E=Math.max(x-p,S-y),A=Math.max(0,Math.floor(-Math.log2(E))),P=Math.pow(2,A);let k=Math.floor((p+x)/2*P);return k>1&&(k-=1),new m(A,k,Math.floor((y+S)/2*P))})(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new fa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Fm||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const U in this.tiles){const Y=this.tiles[U];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=Wm(new m(0,0,0),this.map.transform.projection),o=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(U){const Y=U[1].x-U[0].x,Q=U[1].y-U[0].y,ne=U[2].x-U[1].x,me=U[2].y-U[1].y,de=U[3].x-U[2].x,ve=U[3].y-U[2].y,Te=U[0].x-U[3].x,Ie=U[0].y-U[3].y,qe=Y*me-ne*Q,ke=ne*ve-de*me,Qe=de*Ie-Te*ve,ut=Te*Q-Y*Ie;return qe>0&&ke>0&&Qe>0&&ut>0||qe<0&&ke<0&&Qe<0&&ut<0})(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Wm(this.tileID,this.map.transform.projection),[u,h,p,y]=this.coordinates.map((U=>{const Y=a.projection.project(U[0],U[1]);return D1(a,Y)._round()}));this.perspectiveTransform=X1(u.x,u.y,h.x,h.y,p.x,p.y,y.x,y.y);const x=this._boundsArray=new ws;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(h.x,h.y,Pt,0),x.emplaceBack(y.x,y.y,0,Pt),x.emplaceBack(p.x,p.y,Pt,Pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,Zy.members),this.boundsSegments=ki.simpleSegment(0,0,4,2);const S=[],E=[r_((A=this.coordinates)[0]),r_(A[1]),r_(A[2]),r_(A[3])];var A;const[P,k,F,G]=(function(U){let Y=U[0][0],Q=Y,ne=U[0][1],me=ne;for(let de=1;de<U.length;de++)U[de][0]<Y?Y=U[de][0]:U[de][0]>Q&&(Q=U[de][0]),U[de][1]<ne?ne=U[de][1]:U[de][1]>me&&(me=U[de][1]);return[Y,ne,Q-Y,me-ne]})(E);{const U=new ws,[Y,Q,ne,me]=(function(ft){let pt=ft[0].x,Je=pt,Ye=ft[0].y,mt=Ye;for(let zt=1;zt<ft.length;zt++)ft[zt].x<pt?pt=ft[zt].x:ft[zt].x>Je&&(Je=ft[zt].x),ft[zt].y<Ye?Ye=ft[zt].y:ft[zt].y>mt&&(mt=ft[zt].y);return[pt,Ye,Je-pt,mt-Ye]})(o),de=ft=>[(ft.x-Y)/ne,(ft.y-Q)/me],[ve,Te,Ie,qe]=o.map(de),ke=(function(ft,pt,Je,Ye,mt,zt,St,hn){const Vt=i_(0,0,1,0,1,1,0,1);return je(Vt,Vt,Oe([],i_(ft,pt,Je,Ye,mt,zt,St,hn)))})(ve[0],ve[1],Te[0],Te[1],Ie[0],Ie[1],qe[0],qe[1]);this.elevatedGlobePerspectiveTransform=X1(ve[0],ve[1],Te[0],Te[1],Ie[0],Ie[1],qe[0],qe[1]);const Qe=(ft,pt)=>{S.push(ft.lng);const Je=Math.round((ft.lng-P)/F*Pt),Ye=Math.round((ft.lat-k)/G*Pt),mt=de(pt),zt=yo([],[mt[0],mt[1],1],ke),St=Math.round(zt[0]/zt[2]*Pt),hn=Math.round(zt[1]/zt[2]*Pt);U.emplaceBack(Je,Ye,St,hn)},ut=o[3].x-o[0].x,ht=o[3].y-o[0].y,gt=o[2].x-o[1].x,vt=o[2].y-o[1].y;for(let ft=0;ft<65;ft++){const pt=ft/64,Je=[o[0].x+pt*ut,o[0].y+pt*ht],Ye=[o[1].x+pt*gt,o[1].y+pt*vt],mt=Ye[0]-Je[0],zt=Ye[1]-Je[1];for(let St=0;St<65;St++){const hn=St/64,Vt={x:Je[0]+mt*hn,y:Je[1]+zt*hn};Qe(n.projection.unproject(Vt.x,Vt.y),Vt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(U,Zy.members)}{this.maxLongitudeTriangleSize=0;let U=[],Y=new Jr;const Q=(ne,me,de)=>{Y.emplaceBack(ne,me,de);const ve=S[ne],Te=S[me],Ie=S[de],qe=Math.min(Math.min(ve,Te),Ie),ke=Math.max(Math.max(ve,Te),Ie)-qe;ke>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ke),U.push(qe+ke/2)};for(let ne=0;ne<64;ne++)for(let me=0;me<64;me++){const de=65*ne+me,ve=de+1,Te=de+65,Ie=Te+1;Q(de,Te,ve),Q(ve,Te,Ie)}[U,Y]=(function(ne,me){const de=Array.from({length:ne.length},((Ie,qe)=>qe));de.sort(((Ie,qe)=>ne[Ie]-ne[qe]));const ve=[],Te=new Jr;for(let Ie=0;Ie<de.length;Ie++){const qe=de[Ie];ve.push(ne[qe]);const ke=3*qe,Qe=ke+1;Te.emplaceBack(me.uint16[ke],me.uint16[Qe],me.uint16[Qe+1])}return[ve,Te]})(U,Y),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Y)}this.elevatedGlobeSegments=ki.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/Pt,0,G/Pt,0,0,k,P,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof Fm||(this.texture?this.texture.update(this.image):(this.texture=new vy(n,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let a=(u=e+180)+360*Math.round((o[0]-u)/360);var u;const h=new ki,p=(E,A)=>{h.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:n.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=y){const E=Zi(o,0,o.length,a+y);return E===o.length||p(E,Kr(o,E+1,o.length,a+360-y)-E),h}a<o[0]&&(a+=360);const x=Kr(o,0,o.length,a-y);if(x===o.length)return p(0,o.length),h;p(0,x-0);const S=Zi(o,x+1,o.length,a+y);return S!==o.length&&p(S,o.length-S),h}}const XI=(Math.pow(256,2)-1)/16907520;class K1 extends xs{constructor(e,n,o,a){super(e,{layout:q1||(q1=new Tr({visibility:new Tt(Le.layout_raster.visibility)})),paint:Z1||(Z1=new Tr({"raster-opacity":new Tt(Le.paint_raster["raster-opacity"]),"raster-color":new rc(Le.paint_raster["raster-color"]),"raster-color-mix":new Tt(Le.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(Le.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Le.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Le.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Le.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(Le.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(Le.paint_raster["raster-array-band"]),"raster-elevation":new Tt(Le.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},n,o,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Y1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=bm({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}let J1,Q1,ew,tw,nw;class iw extends xs{constructor(e,n,o,a){super(e,{layout:J1||(J1=new Tr({visibility:new Tt(Le["layout_raster-particle"].visibility)})),paint:Q1||(Q1=new Tr({"raster-particle-array-band":new Tt(Le["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(Le["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new rc(Le["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(Le["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(Le["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(Le["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(Le["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(Le["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},n,o,a),this._updateColorRamp(),this.lastInvalidatedAt=xo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=bm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=xo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class YI extends xs{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Xy(i,e,n){const o=[0,0,1],a=Pa([]);return Cs(a,a,n?-ti(i)+Math.PI:ti(i)),As(a,a,-ti(e)),Es(o,o,a),xn(o,o)}const rw={None:0,Model:1,Symbol:2,FillExtrusion:4};class o_{constructor(e,n,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),n!=null&&n.__line__&&(this.line=n.__line__)}}function Yy(i,e){const n=i.indexOf("://")===-1;try{return new URL(i,n&&e?"http://example.com":void 0),!0}catch{return!1}}class ow{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sw{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new ad,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,o=this.instancedDataArray.float32;let a=Math.floor(o[n+2]);const u=1.05*(o[n+2]-a);return a/=100,[o[n]%1*1.05,o[n+1]%1*1.05,u,a]}tileCoordinatesForInstance(e){const n=16*e,o=this.instancedDataArray.float32;let a=o[n+0];return a=a>Pt?a-Pt:a,new ct(Math.trunc(a),Math.trunc(o[n+1]))}translationForInstance(e){const n=16*e,o=this.instancedDataArray.float32;return[o[n+4],o[n+5],o[n+6]]}rotationScaleForInstance(e){const n=16*e,o=this.instancedDataArray.float32;return[o[n+7],o[n+8],o[n+9],o[n+10],o[n+11],o[n+12],o[n+13],o[n+14],o[n+15]]}transformForInstance(e){const n=16*e,o=this.instancedDataArray.float32;return[o[n+7],o[n+8],o[n+9],o[n+4],o[n+10],o[n+11],o[n+12],o[n+5],o[n+13],o[n+14],o[n+15],o[n+6],0,0,0,1]}}class Ky{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((n=>n.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,o,a){}populate(e,n,o,a){this.tileToMeter=q(o);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:p,index:y,sourceLayerIndex:x}of e){const S=p??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),E=Re(h,u);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),E,o))continue;const A={id:S,sourceLayerIndex:x,index:y,geometry:u?E.geometry:xe(h,o,a),properties:h.properties,type:h.type,patterns:{}},P=this.addFeature(A,A.geometry,E);P&&n.featureIndex.insert(h,A.geometry,y,x,this.index,this.instancesPerModel[P].instancedDataArray.length,Pt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let o=0;for(const a of this.modelUris){const u=e.getModel(a,n);if(!u)continue;const h=this.instancesPerModel[a];if(h){const p=.5*jn(u.aabb.max,u.aabb.min)*h.maxScale+h.maxXYTranslationDistance,y=Math.min(Pt,Math.max(p/this.tileToMeter,Pt/32));o=Math.max(y,o)}}return o}update(e,n,o,a){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];for(const p in e)h.idToFeaturesIndex.hasOwnProperty(p)&&(this.evaluate(h.features[h.idToFeaturesIndex[p]],e[p],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const o=this.instancesPerModel[n];for(const a of o.features){const u=this.layers[0],h=a.feature,p=this.canonical,y=u.paint.get("model-rotation").evaluate(h,{},p),x=u.paint.get("model-scale").evaluate(h,{},p),S=u.paint.get("model-translation").evaluate(h,{},p);Pr(a.rotation,y)&&Pr(a.scale,x)&&Pr(a.translation,S)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,n,o,a){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Mg(this.activeReplacements,u))return!1;this.activeReplacements=u;let h=!1;for(const p in this.instancesPerModel){const y=this.instancesPerModel[p],x=y.instancedDataArray;for(const S of y.features){const E=S.instancedDataOffset,A=S.instancedDataCount;for(let P=0;P<A;P++){const k=16*(P+E);let F=x.float32[k+0];const G=F>Pt;F=G?F-Pt:F;const U=Math.floor(F),Y=Math.floor(x.float32[k+1]);let Q=!1;for(const ne of this.activeReplacements)if(!Wx(ne,o,rw.Model,a)&&!(ne.min.x>U||U>ne.max.x||ne.min.y>Y||Y>ne.max.y)&&(Q=Kx(Yx(U,Y,e.canonical,ne.footprintTileId.canonical),ne.footprint),Q))break;x.float32[k]=Q?F+Pt:F,h=h||Q!==G}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,vE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const o in this.instancesPerModel){const a=this.instancesPerModel[o];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(e&&n&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)n.removeModel(o,"",!0)}addFeature(e,n,o){const a=this.layers[0],u=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return $t(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;(Yy(u,!1)||this.styleDefinedModelURLs[u]!==void 0)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new sw);const h=this.instancesPerModel[u],p=h.instancedDataArray,y=new ow(o,p.length);for(const x of n)for(const S of x){if(S.x<0||S.x>=Pt||S.y<0||S.y>=Pt)continue;if(this.lookupDim!==0){const A=(this.lookupDim-1)/Pt,P=this.lookupDim*(S.y*A|0)+S.x*A|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}}this.instanceCount++;const E=p.length;p.resize(E+1),h.instancesEvaluatedElevation.push(0),p.float32[16*E]=S.x,p.float32[16*E+1]=S.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,n,o,a){const u=this.layers[0],h=e.feature,p=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(h,n,p),x=e.scale=u.paint.get("model-scale").evaluate(h,n,p),S=e.translation=u.paint.get("model-translation").evaluate(h,n,p),E=Object.assign({},u.paint.get("model-color").evaluate(h,n,p));E.a=u.paint.get("model-color-mix-intensity").evaluate(h,n,p);const A=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]);const P=S[0]*S[0]+S[1]*S[1],k=P>0?Math.sqrt(P):0;o.maxScale=Math.max(Math.max(o.maxScale,x[0]),Math.max(x[1],x[2])),o.maxXYTranslationDistance=Math.max(o.maxXYTranslationDistance,k),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),F0(A,y,x);const F=Math.round(100*E.a)+E.b/1.05;for(let G=0;G<e.instancedDataCount;++G){const U=e.instancedDataOffset+G,Y=16*U,Q=o.instancedDataArray.float32;let ne=0;a&&(ne=Q[Y+6]-o.instancesEvaluatedElevation[U]);const me=0|Q[Y+1];Q[Y]=(0|Q[Y])+E.r/1.05,Q[Y+1]=me+E.g/1.05,Q[Y+2]=F,Q[Y+3]=1/(p.z>10?this.tileToMeter:q(p,me)),Q[Y+4]=S[0],Q[Y+5]=S[1],Q[Y+6]=S[2]+ne,Q[Y+7]=A[0],Q[Y+8]=A[1],Q[Y+9]=A[2],Q[Y+10]=A[4],Q[Y+11]=A[5],Q[Y+12]=A[6],Q[Y+13]=A[8],Q[Y+14]=A[9],Q[Y+15]=A[10],o.instancesEvaluatedElevation[U]=S[2]}}}let aw,lw;qt(Ky,"ModelBucket",{omit:["layers"]}),qt(sw,"PerModelAttributes"),qt(ow,"ModelFeature");class Jp{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){const a=o||e.findDEMTileFor(n);if(!a||!a.dem)return;const u=a.dem,h=a.tileID,p=1<<n.canonical.z-h.canonical.z;return new Jp(a,u.dim/Pt/p,[(n.canonical.x/p-h.canonical.x)*u.dim,(n.canonical.y/p-h.canonical.y)*u.dim])}tileCoordToPixel(e,n){const o=n*this._scale+this._offset[1];return new ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(o))}getElevationAt(e,n,o,a){const u=e*this._scale+this._offset[0],h=n*this._scale+this._offset[1],p=Math.floor(u),y=Math.floor(h),x=this._dem;return a=!!a,o?bn(bn(x.get(p,y,a),x.get(p,y+1,a),h-y),bn(x.get(p+1,y,a),x.get(p+1,y+1,a),h-y),u-p):x.get(p,y,a)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*I(1,e)*this._dem.stride}}const Jy=new Float32Array(262144),pp=new Uint8Array(262144);function cw(i){let e=0;if(i.meshes)for(const n of i.meshes)e=Math.max(e,n.aabb.max[2]);if(i.children)for(const n of i.children)e=Math.max(e,cw(n));return e}function uw(i,e,n){if(i.meshes)for(const o of i.meshes){if(o.aabb.min[0]===1/0)continue;const a=Kt.applyTransform(o.aabb,i.globalMatrix);n.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(i.children)for(const o of i.children)uw(o,e,n)}const hw=["","wall","door","roof","window","lamp","logo"];class dw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:cw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Kt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Kt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Kt.applyTransformFast(o.aabb,this.node.globalMatrix),n.encapsulate(o.transformedAabb)),e++;this.aabb=n}return this.aabb}}class s_{constructor(e,n,o,a,u,h,p,y){this.id=o,this.layers=e,this.layerIds=this.layers.map((x=>x.fqid)),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.modelTraits|=Gp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Gp.HasMapboxMeshFeatures),u&&(this.modelTraits|=Gp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.worldview=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of n)this.nodesInfo.push(new dw(x)),uw(x,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const o of this.getNodesInfo()){const a=o.node;a.footprint&&n.push({footprint:a.footprint,id:e})}}updateAppearances(e,n,o,a){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const o=n?this.stateDependentLayers:this.layers;if(!qr(e,this.states))for(const a of o)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const o of n){const a=o.node;this.uploaded?this.updatePbrBuffer(a):by(a,e,!0)}for(const o of n)Vg(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){const a=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;if(!this.uploaded||this.dirty||a.name!==this.projection.name||eg(o.paint.get("model-color").value,h)||eg(o.paint.get("model-color-mix-intensity").value,h)||eg(o.paint.get("model-roughness").value,h)||eg(o.paint.get("model-emissive-strength").value,h)||eg(o.paint.get("model-height-based-emissive-strength-multiplier").value,h)){this.projection=a,this.brightness=u;const p=this.getNodesInfo();for(const y of p)y.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),a=this.id.canonical;for(const u of o){const h=u.feature;u.evaluatedTranslation=n.paint.get("model-translation").evaluate(h,{},a),u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e,n){const o=this.getNodesInfo();for(const a of o){if(!a.node.meshes)continue;const u=a.feature,h=n&&n[u.id];if(qr(h,a.state))continue;a.state=structuredClone(h);const p=a.node.meshes&&a.node.meshes[0].featureData,y=a.evaluatedColor[2],x=a.evaluatedRMEA[2],S=this.id.canonical;if(a.hasTranslucentParts=!1,p){for(let E=0;E<hw.length;E++){const A=hw[E];A.length&&(u.properties.part=A);const P=e.paint.get("model-color").evaluate(u,h,S).toPremultipliedRenderColor(null),k=e.paint.get("model-color-mix-intensity").evaluate(u,h,S);a.evaluatedColor[E]=[P.r,P.g,P.b,k],a.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(u,h,S),a.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(u,h,S),a.evaluatedRMEA[E][3]=P.a,a.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,h,S),!a.hasTranslucentParts&&P.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,JI(a,y!==a.evaluatedColor[2]||x!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,h,S);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(u,h,S),a.evaluatedScale=e.paint.get("model-scale").evaluate(u,h,S),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,a){const u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const h=Jp.create(e,o,u);if(!h)return;this.modelTraits&Gp.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,a);for(const p of this.getNodesInfo()){const y=p.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const x=y.footprint.vertices;let S=h.getElevationAt(x[0].x,x[0].y,!0,!0);for(let E=1;E<x.length;E++)S=Math.min(S,h.getElevationAt(x[E].x,x[E].y,!0,!0));y.elevation=S}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,a){let u=n._dem._modifiedForSources[a];if(u===void 0&&(n._dem._modifiedForSources[a]=[],u=n._dem._modifiedForSources[a]),u.includes(o.canonical))return;const h=n._dem.dim;u.push(o.canonical);let p=!1;for(const y of this.getNodesInfo()){const x=y.node;if(!x.footprint||!x.footprint.grid)continue;const S=x.footprint.grid,E=n.tileCoordToPixel(S.min.x,S.min.y),A=n.tileCoordToPixel(S.max.x,S.max.y),P=Math.min(Math.min(h-A.y,E.x),Math.min(E.y,h-A.x));if(P<0)continue;const k=H(P,2,5);let F=Math.max(0,E.x-k),G=Math.max(0,E.y-k),U=Math.min(A.x+k,h-1),Y=Math.min(A.y+k,h-1);for(let de=G;de<=Y;++de)for(let ve=F;ve<=U;++ve)pp[de*h+ve]=255;let Q=0,ne=0;for(let de=0;de<S.cellsY;++de)for(let ve=0;ve<S.cellsX;++ve){if(!S.cells[de*S.cellsX+ve])continue;const Te=n.tileCoordToPixel(S.min.x+ve/S.xScale,S.min.y+de/S.yScale),Ie=n.tileCoordToPixel(S.min.x+(ve+1)/S.xScale,S.min.y+(de+1)/S.yScale);for(let qe=Te.y;qe<=Math.min(Ie.y+1,h-1);++qe)for(let ke=Te.x;ke<=Math.min(Ie.x+1,h-1);++ke)pp[qe*h+ke]===255&&(pp[qe*h+ke]=0,Q+=n.getElevationAtPixel(ke,qe),ne++)}const me=Q/ne;F=Math.max(1,E.x-k),G=Math.max(1,E.y-k),U=Math.min(A.x+k,h-2),Y=Math.min(A.y+k,h-2),p=!0;for(let de=G;de<=Y;++de)for(let ve=F;ve<=U;++ve)pp[de*h+ve]===0&&(Jy[de*h+ve]=n._dem.set(ve,de,me));for(let de=1;de<k;++de){F=Math.max(1,E.x-de),G=Math.max(1,E.y-de),U=Math.min(A.x+de,h-2),Y=Math.min(A.y+de,h-2);for(let ve=G;ve<=Y;++ve)for(let Te=F;Te<=U;++Te){const Ie=ve*h+Te;if(pp[Ie]===255){let qe=0,ke=0,Qe=-1,ut=-1;for(let ht=-1;ht<=1;++ht)for(let gt=-1;gt<=1;++gt){const vt=(ve+ht)*h+Te+gt;if(pp[vt]>=de)continue;const ft=Jy[vt],pt=Math.abs(ft);pt>ke&&(qe=ft,ke=pt,Qe=gt,ut=ht)}if(ke>.1){const ht=1-(de+.5*Math.abs(Qe*ut))/k;let gt=n._dem.get(Te,ve)+qe*ht;const vt=n._dem.get(Te+Qe,ve+ut),ft=n._dem.get(Te-Qe,ve-ut,!0);(gt-vt)*(gt-ft)>0&&(gt=(vt+ft)/2),Jy[Ie]=n._dem.set(Te,ve,gt),pp[Ie]=de}}}}}p&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=xo.now())}setFilter(e){this.filter=e?Jh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Xi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Vg(n.node),Ty(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const o=n.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const u=a.node.footprint;a.hiddenByReplacement=!!u&&!o.find((h=>h.footprint===u))}}getHeightAtTileCoord(e,n){const o=[],a=[0,0,0],u=Be([]);for(const h of this.getNodesInfo()){const p=h.node.meshes[0],y=p.transformedAabb;if(e<y.min[0]||n<y.min[1]||e>y.max[0]||n>y.max[1])continue;if(h.node.hidden===!0)return{height:1/0,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};Xe(u,h.node.globalMatrix),a[0]=e,a[1]=n,Gi(a,a,u);const x=(a[0]-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*hp|0,S=Math.min(63,(a[1]-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*hp|0)*hp+Math.min(63,x),E=p.heightmap[S];if(!(E<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:E,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new ct(e,n),new ct(e,n),o),o.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function eg(i,e){return i instanceof ss&&!i.isLightConstant&&e}function KI(i,e,n,o,a,u,h,p){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;n[3]>0&&(y=bn(y,255*n[0],n[3]),x=bn(x,255*n[1],n[3]),S=bn(S,255*n[2],n[3]));const E=y<<8|x,A=S<<8|Math.floor(255*o[3]),P=(function(de){const ve=H(de,0,2);return Math.min(Math.round(.5*ve*255),255)})(o[2])<<8|15*o[0]<<4|15*o[1],k=H(a[0],0,1),F=H(a[1],0,1),G=H(a[2],0,1),U=H(a[3],0,1);let Y,Q,ne,me;if(k!==F&&h!==u&&F!==k){const de=h-u;Q=1/(de*(F-k)),ne=-(u+de*k)/(de*(F-k));const ve=H(a[4],-1,1);me=Math.pow(10,ve),Y=255*G<<8|255*U}else Y=65535,Q=0,ne=1,me=1;if(i.emplaceBack(E,A,P,Y,Q,ne,me),p){const de=p.length;p.clear();for(let ve=0;ve<de;ve++)p.emplaceBack(E,A,P,Y,Q,ne,me)}}function JI(i,e,n){const o=i.node;let a=0;const u=n&Gp.HasMeshoptCompression;for(const h of o.meshes){if(o.lights&&o.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new ld,h.featureArray.reserve(h.featureData.length);let p=e;for(const y of h.featureData){const x=u?65535&y:y>>16&65535,S=u?y>>16&65535:65535&y,E=(15&S)<8?15&S:0,A=i.evaluatedRMEA[E],P=i.evaluatedColor[E],k=i.emissionHeightBasedParams[E];let F;if(p&&E===2&&o.lights&&(F=new ld,F.resize(10*o.lights.length)),KI(h.featureArray,x,P,A,k,h.aabb.min[2],h.aabb.max[2],F),F&&p){p=!1;const G=o.meshes[o.lightMeshIndex];G.featureArray=F,G.featureArray._trim()}}h.featureArray._trim(),a++}}qt(s_,"Tiled3dModelBucket",{omit:["layers"]}),qt(dw,"Tiled3dModelFeature");const QI=["id","tile","layer","source","sourceLayer","state"];class mp{constructor(e,n,o,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=a,this.properties=e?e.properties:{},this.id=u}clone(){const e=new mp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of QI)this[n]!==void 0&&(e[n]=this[n]);return e}}class gp extends fc{constructor(e,n,o,a){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=n,this._modelsInfo=new Map}load(){const e=[];for(const n in this._options.models){const o=this._options.models[n],a=this._modelsInfo.get(n);if(a){const u=a.model;u.position=o.position!=null?new r(o.position[0],o.position[1]):new r(0,0),u.orientation=o.orientation!=null?o.orientation:[0,0,0],a.modelSpec=o,gp.applyModelSpecification(u,o),u.computeBoundsAndApplyParent(),this.models.push(u)}else{const u=z0(this.map._requestManager.transformRequest(o.uri,$l.Model).url).then((h=>{if(!h)return;const p=Ey(h),y=new B0(n,o.uri,o.position,o.orientation,p);gp.applyModelSpecification(y,o),y.computeBoundsAndApplyParent(),this.models.push(y),this._modelsInfo.set(n,{modelSpec:o,model:y})})).catch((h=>{this.fire(new Au(new Error(`Could not load model ${n} from ${o.uri}: ${h.message}`)))}));e.push(u)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new fa("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new Au(new Error(`Could not load models: ${n.message}`)))}))}static applyModelSpecification(e,n){n.nodeOverrides&&gp.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&gp.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every((o=>typeof o=="string"))){e.nodeOverrideNames=[];for(const o of n)e.nodeOverrideNames.push(o)}else Object.entries(n).forEach((([o,a])=>{const u={orientation:[0,0,0]};if(a.hasOwnProperty("orientation")){const h=a.orientation;h&&(u.orientation=h)}e.nodeOverrides.set(o,u)}))}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every((o=>typeof o=="string"))){e.materialOverrideNames=[];for(const o of n)e.materialOverrideNames.push(o)}else Object.entries(n).forEach((([o,a])=>{const u={color:new Vi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},h=a["model-color"];h!==void 0&&(u.color.r=h[0],u.color.g=h[1],u.color.b=h[2]);const p=a["model-color-mix-intensity"];p!==void 0&&(u.colorMix=p);const y=a["model-emissive-strength"];y!==void 0&&(u.emissionStrength=y);const x=a["model-opacity"];x!==void 0&&(u.opacity=x),e.materialOverrides.set(o,u)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=Ta(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const n=new Map;for(const o in e){const a=e[o];if(this._modelsInfo.has(o)){const u=this._modelsInfo.get(o);u&&u.modelSpec.uri===a.uri&&n.set(o,u)}}this._modelsInfo=n,this._options.models=e,this._loaded=!1,this.load()}}function Qy(i,e,n,o){const a=1<<i.z;e.lat=O((o/Pt+i.y)/a),e.lng=C((n/Pt+i.x)/a)}function eA(i,e,n,o){const a=i.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let u=Number.MAX_VALUE;const h=a.node,p=n.tile,y=o.calculatePosMatrix(p.tileID.toUnwrapped(),o.worldSize),x=a.evaluatedScale;let S=0;o.elevation&&h.elevation&&(S=h.elevation*o.elevation.exaggeration()),Ke(y,y,[(h.anchor?h.anchor[0]:0)*(x[0]-1),(h.anchor?h.anchor[1]:0)*(x[1]-1),S]),Ct(y,y,x);const E=n.queryGeometry,A=E.isPointQuery()?E.screenBounds:E.screenGeometry,P=function(F){const G=ot([],y,F.globalMatrix);ot(G,o.expandedFarZProjMatrix,G);for(let U=0;U<F.meshes.length;++U){const Y=F.meshes[U];if(U===F.lightMeshIndex)continue;const Q=wy(A,o,G,Y.aabb);Q!=null&&(u=Math.min(Q,u))}if(F.children)for(const U of F.children)P(U)};if(P(h),u===Number.MAX_VALUE)return;const k=new r(0,0);return Qy(p.tileID.canonical,k,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:u,position:k,feature:a.feature}}const tA={circle:class extends xs{constructor(i,e,n,o){super(i,{layout:Ns||(Ns=new Tr({"circle-sort-key":new Dt(Le.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(Le.layout_circle["circle-elevation-reference"]),visibility:new Tt(Le.layout_circle.visibility)})),paint:fr||(fr=new Tr({"circle-radius":new Dt(Le.paint_circle["circle-radius"]),"circle-color":new Dt(Le.paint_circle["circle-color"]),"circle-blur":new Dt(Le.paint_circle["circle-blur"]),"circle-opacity":new Dt(Le.paint_circle["circle-opacity"]),"circle-translate":new Tt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(Le.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(Le.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o)}createBucket(i){return new Fi(i)}queryRadius(i){const e=i;return es("circle-radius",this,e)+es("circle-stroke-width",this,e)+go(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,o,a,u,h,p){const y=Ts(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return vx(i,o,u,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,n){const o=yx(this);return{config:new Rc(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}is3D(i){return!i&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends xs{createBucket(i){return new wx(i)}constructor(i,e,n,o){super(i,{layout:bx||(bx=new Tr({visibility:new Tt(Le.layout_heatmap.visibility)})),paint:Tx||(Tx=new Tr({"heatmap-radius":new Dt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Le.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(i){return es("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,o,a,u,h,p){const y=this.paint.get("heatmap-radius").evaluate(e,n);return vx(i,o,u,h,p,!0,!0,new ct(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,n){return i==="heatmap"?{config:new Rc(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends xs{constructor(i,e,n,o){super(i,{layout:Sx||(Sx=new Tr({visibility:new Tt(Le.layout_hillshade.visibility)})),paint:Ex||(Ex=new Tr({"hillshade-illumination-direction":new Tt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(Le.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}},fill:class extends xs{constructor(i,e,n,o){super(i,{layout:jx||(jx=new Tr({"fill-sort-key":new Dt(Le.layout_fill["fill-sort-key"]),visibility:new Tt(Le.layout_fill.visibility),"fill-elevation-reference":new Tt(Le.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Dt(Le.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Vx||(Vx=new Tr({"fill-antialias":new Tt(Le.paint_fill["fill-antialias"]),"fill-opacity":new Dt(Le.paint_fill["fill-opacity"]),"fill-color":new Dt(Le.paint_fill["fill-color"]),"fill-outline-color":new Dt(Le.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dt(Le.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt(Le.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt(Le.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dt(Le.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Dt(Le.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Dt(Le.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(i,e,n){return{config:new Rc(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ry(i)}queryRadius(){return go(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,o,a,u){return!i.queryGeometry.isAboveHorizon&&zi(Sa(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(i){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return i!=null?e&&!i:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends xs{constructor(i,e,n,o){super(i,{layout:f0||(f0=new Tr({visibility:new Tt(Le["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(Le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:p0||(p0=new Tr({"fill-extrusion-opacity":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dt(Le["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(Le["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Rg(i)}queryRadius(){return go(this.paint.get("fill-extrusion-translate"))}is3D(i){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,n,o,a,u,h,p,y){const x=Ts(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,n),E=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],P=p&&u.elevation,k=u.elevation?u.elevation.exaggeration():1,F=i.tile.getBucket(this);if(P&&F instanceof Rg){const ne=F.centroidVertexArray,me=y+1;me<ne.length&&(A[0]=ne.geta_centroid_pos0(me),A[1]=ne.geta_centroid_pos1(me))}if(A[0]===0&&A[1]===1)return!1;u.projection.name==="globe"&&(o=d0([o],[new ct(0,0),new ct(Pt,Pt)],i.tileID.canonical).map((ne=>ne.polygon)).flat());const G=P?p:null,[U,Y]=w0(u,o,E,S,x,h,G,A,k,u.center.lat,i.tileID.canonical),Q=i.queryGeometry;return x0(U,Y,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},building:class extends xs{constructor(i,e,n,o){super(i,{layout:H0||(H0=new Tr({visibility:new Tt(Le.layout_building.visibility),"building-facade":new Dt(Le.layout_building["building-facade"]),"building-facade-floors":new Dt(Le.layout_building["building-facade-floors"]),"building-facade-unit-width":new Dt(Le.layout_building["building-facade-unit-width"]),"building-facade-window":new Dt(Le.layout_building["building-facade-window"]),"building-roof-shape":new Dt(Le.layout_building["building-roof-shape"]),"building-height":new Dt(Le.layout_building["building-height"]),"building-base":new Dt(Le.layout_building["building-base"]),"building-flood-light-wall-radius":new Dt(Le.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Dt(Le.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Dt(Le.layout_building["building-flip-roof-orientation"])})),paint:W0||(W0=new Tr({"building-opacity":new Tt(Le.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Tt(Le.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt(Le.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt(Le.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt(Le.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt(Le.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt(Le.paint_building["building-cast-shadows"]),"building-color":new Dt(Le.paint_building["building-color"]),"building-emissive-strength":new Dt(Le.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Tt(Le.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Tt(Le.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Tt(Le.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Tt(Le.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Tt(Le.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new $0(i)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(i){return!0}queryRadius(i){return 0}queryIntersectsFeature(i,e,n,o,a,u,h,p,y){let x=this.layout.get("building-height").evaluate(e,n);const S=this.layout.get("building-base").evaluate(e,n),E=i.tile.getBucket(this).getFootprint(e);if(E){if(E.hiddenFlags!==0)return!1;x=E.height}const[A,P]=w0(u,o,S,x,new ct(0,0),h,null,[0,0],1,u.center.lat,i.tileID.canonical),k=i.queryGeometry;return x0(A,P,k.isPointQuery()?k.screenBounds:k.screenGeometry)}},line:class extends xs{constructor(i,e,n,o){const a=n1();super(i,a,e,n,o),a.layout&&(this.layout=new Jo(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=(()=>{if(Nm)return Nm;const n=n1();return Nm=new XE(n.paint.properties["line-width"].specification),Nm.useIntegerZoom=!0,Nm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Cy(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,n){const o=e1(this);return{config:new Rc(this,{zoom:e,lut:n}),defines:o,overrideFog:!1}}queryRadius(i){const e=i,n=i1(es("line-width",this,e),es("line-gap-width",this,e)),o=es("line-offset",this,e);return n/2+Math.abs(o)+go(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,o,a,u){if(i.queryGeometry.isAboveHorizon)return!1;const h=Sa(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),p=i.pixelToTileUnitsFactor/2*i1(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(o=(function(x,S){const E=[],A=new ct(0,0);for(let P=0;P<x.length;P++){const k=x[P],F=[];for(let G=0;G<k.length;G++){const U=k[G],Y=k[G+1],Q=G===0?A:U.sub(k[G-1])._unit()._perp(),ne=G===k.length-1?A:Y.sub(U)._unit()._perp(),me=Q._add(ne)._unit();me._mult(1/(me.x*ne.x+me.y*ne.y)),F.push(me._mult(S)._add(U))}E.push(F)}return E})(o,y*i.pixelToTileUnitsFactor)),(function(x,S,E){for(let A=0;A<S.length;A++){const P=S[A];if(x.length>=3){for(let k=0;k<P.length;k++)if(Hi(x,P[k]))return!0}if(_r(x,P,E))return!0}return!1})(h,o,p)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(i){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:n_,background:class extends xs{constructor(i,e,n,o){super(i,{layout:H1||(H1=new Tr({visibility:new Tt(Le.layout_background.visibility)})),paint:W1||(W1=new Tr({"background-pitch-alignment":new Tt(Le.paint_background["background-pitch-alignment"]),"background-color":new Tt(Le.paint_background["background-color"]),"background-pattern":new Tt(Le.paint_background["background-pattern"]),"background-opacity":new Tt(Le.paint_background["background-opacity"]),"background-emissive-strength":new Tt(Le.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,n){return{overrideFog:!1}}is3D(i){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:K1,"raster-particle":iw,sky:class extends xs{constructor(i,e,n,o){super(i,{layout:ew||(ew=new Tr({visibility:new Tt(Le.layout_sky.visibility)})),paint:tw||(tw=new Tr({"sky-type":new Tt(Le.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(Le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(Le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(Le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(Le.paint_sky["sky-gradient-radius"]),"sky-gradient":new rc(Le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(Le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(Le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(Le.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),a=!o,u=i.style.light,h=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&$t("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Xy(h.azimuthal,90-h.polar,e):Xy(o[0],90-o[1],e)}const n=this.paint.get("sky-gradient-center");return Xy(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends xs{constructor(i,e,n,o){super(i,{paint:nw||(nw=new Tr({}))},e,null)}},model:class extends xs{constructor(i,e,n,o){super(i,{layout:aw||(aw=new Tr({visibility:new Tt(Le.layout_model.visibility),"model-id":new Dt(Le.layout_model["model-id"])})),paint:lw||(lw=new Tr({"model-opacity":new Dt(Le.paint_model["model-opacity"]),"model-rotation":new Dt(Le.paint_model["model-rotation"]),"model-scale":new Dt(Le.paint_model["model-scale"]),"model-translation":new Dt(Le.paint_model["model-translation"]),"model-color":new Dt(Le.paint_model["model-color"]),"model-color-mix-intensity":new Dt(Le.paint_model["model-color-mix-intensity"]),"model-type":new Tt(Le.paint_model["model-type"]),"model-cast-shadows":new Tt(Le.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(Le.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(Le.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dt(Le.paint_model["model-emissive-strength"]),"model-roughness":new Dt(Le.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dt(Le.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(Le.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(Le.paint_model["model-front-cutoff"]),"model-elevation-reference":new Tt(Le.paint_model["model-elevation-reference"]),"model-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,o),this.layer=i,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Ky(i)}getProgramIds(){return["model"]}is3D(i){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof s_?Pt-1:0}queryRenderedFeatures(i,e,n){const o=e.getSource();if(!(o&&o instanceof gp))return{};const a=o,u={};u[this.id]=[];const h=u[this.id];let p=0;for(const y of a.models){const x=e.getFeatureState(this.sourceLayer,y.id),S={type:"Unknown",id:y.id,properties:y.featureProperties},E=this.paint.get("model-rotation").evaluate(S,x),A=this.paint.get("model-scale").evaluate(S,x),P=this.paint.get("model-translation").evaluate(S,x),k=this.paint.get("model-elevation-reference");let F=[];jg(F,y,n,y.position,E,A,P,k==="ground",k==="ground",!1),n.projection.name==="globe"&&(F=Ng(F,n));const G=ot([],n.projMatrix,F),U=wy(i.isPointQuery()?i.screenBounds:i.screenGeometry,n,G,y.aabb);if(U!=null){const Y=new mp(void 0,0,0,0,y.id);Y.layer=this.layer,Y.properties=structuredClone(y.featureProperties),Y.properties.layer=this.id,Y.properties.uri=y.uri,Y.properties.orientation=y.orientation,Y.sourceLayer=this.sourceLayer,Y.geometry={type:"Point",coordinates:[y.position.lng,y.position.lat]},Y.state=x,Y.source=this.source,h.push({featureIndex:p,feature:Y,intersectionZ:U})}++p}return u}queryIntersectsFeature(i,e,n,o,a,u){if(!this.modelManager)return!1;const h=this.modelManager,p=i.tile.getBucket(this);if(!(p&&p instanceof Ky))return!1;for(const y in p.instancesPerModel){const x=p.instancesPerModel[y],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(S)){const E=x.features[x.idToFeaturesIndex[S]],A=h.getModel(y,this.scope);if(!A)return!1;let P=[];const k=new r(0,0),F=p.canonical;let G=Number.MAX_VALUE;for(let U=0;U<E.instancedDataCount;++U){const Y=16*(E.instancedDataOffset+U),Q=x.instancedDataArray.float32,ne=[Q[Y+4],Q[Y+5],Q[Y+6]];Qy(F,k,Math.floor(Q[Y]),Math.floor(Q[Y+1])),jg(P,A,u,k,E.rotation,E.scale,ne,!1,!1,!1),u.projection.name==="globe"&&(P=Ng(P,u));const me=ot([],u.projMatrix,P),de=i.queryGeometry,ve=wy(de.isPointQuery()?de.screenBounds:de.screenGeometry,u,me,A.aabb);ve!=null&&(G=Math.min(ve,G))}return G!==Number.MAX_VALUE&&G}}return!1}_handleOverridablePaintPropertyUpdate(i,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ba}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends xs{constructor(i,e,n,o){super(i,{layout:Ux||(Ux=new Tr({"clip-layer-types":new Tt(Le.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(Le.layout_clip["clip-layer-scope"])})),paint:Gx||(Gx=new Tr({}))},e,n,o)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new $x(i)}is3D(i){return!0}}},ev=new Vi(0,0,0),tv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},nv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},a_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},nA={PAINT_ORDER_FILL_AND_STROKE:1},tg={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},fw={MASK_TYPE_LUMINANCE:1};function iA(i,e,n){i===1&&e.icons.push((function(o,a){return(function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:h}=u;if(h.content_area){const{content_area:p}=h;p.left==null&&(p.left=0),p.top==null&&(p.top=p.left),p.width==null&&(p.width=u.usvg_tree.width),p.height==null&&(p.height=p.width)}if(h.text_placeholder){const{text_placeholder:p}=h;p.top==null&&(p.top=p.left),p.height==null&&(p.height=p.width)}return h.stretch_x&&h.stretch_x.length&&pw(h,"x"),h.stretch_y&&h.stretch_y.length&&pw(h,"y"),u})(o.readFields(rA,{name:void 0},a))})(n,n.readVarint()+n.pos))}function pw(i,e){const n=[],o=i[`stretch_${e}`];let a=null;for(let u=0;u<o.length;u++)a===null?a=n.length===0?o[0]:n[n.length-1][1]+o[u]:(n.push([a,a+o[u]]),a=null);i[`stretch_${e}_areas`]=n}function rA(i,e,n){i===1?e.name=n.readString():i===2?e.metadata=(function(o,a){return o.readFields(oA,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)})(n,n.readVarint()+n.pos):i===3&&(e.usvg_tree=(function(o,a){return o.readFields(lA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)})(n,n.readVarint()+n.pos),e.data="usvg_tree")}function oA(i,e,n){i===1?e.stretch_x=n.readPackedVarint():i===2?e.stretch_y=n.readPackedVarint():i===3?e.content_area=mw(n,n.readVarint()+n.pos):i===4?e.variables.push((function(o,a){return o.readFields(aA,{name:void 0},a)})(n,n.readVarint()+n.pos)):i===5&&(e.text_placeholder=mw(n,n.readVarint()+n.pos))}function mw(i,e){return i.readFields(sA,{},e)}function sA(i,e,n){i===1?e.left=n.readVarint():i===2?e.width=n.readVarint():i===3?e.top=n.readVarint():i===4&&(e.height=n.readVarint())}function aA(i,e,n){i===1?e.name=n.readString():i===2&&(e.rgb_color=u_(n.readVarint()),e.value="rgb_color")}function lA(i,e,n){i===1?e.width=e.height=n.readVarint():i===2?e.height=n.readVarint():i===3?e.children.push(l_(n,n.readVarint()+n.pos)):i===4?e.linear_gradients.push((function(o,a){return o.readFields(mA,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)})(n,n.readVarint()+n.pos)):i===5?e.radial_gradients.push((function(o,a){return o.readFields(_A,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)})(n,n.readVarint()+n.pos)):i===7?e.clip_paths.push((function(o,a){return o.readFields(yA,{children:[]},a)})(n,n.readVarint()+n.pos)):i===8&&e.masks.push((function(o,a){const u=o.readFields(vA,{left:0,width:20,mask_type:fw.MASK_TYPE_LUMINANCE,children:[]},a);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u})(n,n.readVarint()+n.pos))}function l_(i,e){return i.readFields(cA,{},e)}function cA(i,e,n){i===1?(e.group=(function(o,a){return o.readFields(uA,{opacity:255,children:[]},a)})(n,n.readVarint()+n.pos),e.node="group"):i===2&&(e.path=(function(o,a){return o.readFields(dA,{paint_order:1,commands:[],step:1,diffs:[],rule:tv.PATH_RULE_NON_ZERO},a)})(n,n.readVarint()+n.pos),e.node="path")}function uA(i,e,n){i===1?e.transform=c_(n,n.readVarint()+n.pos):i===2?e.opacity=n.readVarint():i===5?e.clip_path_idx=n.readVarint():i===6?e.mask_idx=n.readVarint():i===7&&e.children.push(l_(n,n.readVarint()+n.pos))}function c_(i,e){return i.readFields(hA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function hA(i,e,n){i===1?e.sx=n.readFloat():i===2?e.ky=n.readFloat():i===3?e.kx=n.readFloat():i===4?e.sy=n.readFloat():i===5?e.tx=n.readFloat():i===6&&(e.ty=n.readFloat())}function dA(i,e,n){i===1?e.fill=(function(o,a){return o.readFields(fA,{rgb_color:ev,paint:"rgb_color",opacity:255},a)})(n,n.readVarint()+n.pos):i===2?e.stroke=(function(o,a){return o.readFields(pA,{rgb_color:ev,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)})(n,n.readVarint()+n.pos):i===3?e.paint_order=n.readVarint():i===5?n.readPackedVarint(e.commands):i===6?e.step=n.readFloat():i===7?n.readPackedSVarint(e.diffs):i===8&&(e.rule=n.readVarint())}function fA(i,e,n){i===1?(e.rgb_color=u_(n.readVarint()),e.paint="rgb_color"):i===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):i===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):i===5&&(e.opacity=n.readVarint())}function u_(i){return new Vi((i>>16&255)/255,(i>>8&255)/255,(255&i)/255,1)}function pA(i,e,n){i===1?(e.rgb_color=u_(n.readVarint()),e.paint="rgb_color"):i===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):i===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):i===5?n.readPackedFloat(e.dasharray):i===6?e.dashoffset=n.readFloat():i===7?e.miterlimit=n.readFloat():i===8?e.opacity=n.readVarint():i===9?e.width=n.readFloat():i===10?e.linecap=n.readVarint():i===11&&(e.linejoin=n.readVarint())}function mA(i,e,n){i===1?e.transform=c_(n,n.readVarint()+n.pos):i===2?e.spread_method=n.readVarint():i===3?e.stops.push(gw(n,n.readVarint()+n.pos)):i===4?e.x1=n.readFloat():i===5?e.y1=n.readFloat():i===6?e.x2=n.readFloat():i===7&&(e.y2=n.readFloat())}function gw(i,e){return i.readFields(gA,{offset:0,opacity:255,rgb_color:ev},e)}function gA(i,e,n){i===1?e.offset=n.readFloat():i===2?e.opacity=n.readVarint():i===3&&(e.rgb_color=u_(n.readVarint()))}function _A(i,e,n){i===1?e.transform=c_(n,n.readVarint()+n.pos):i===2?e.spread_method=n.readVarint():i===3?e.stops.push(gw(n,n.readVarint()+n.pos)):i===4?e.cx=n.readFloat():i===5?e.cy=n.readFloat():i===6?e.r=n.readFloat():i===7?e.fx=n.readFloat():i===8?e.fy=n.readFloat():i===9&&(e.fr=n.readFloat())}function yA(i,e,n){i===1?e.transform=c_(n,n.readVarint()+n.pos):i===2?e.clip_path_idx=n.readVarint():i===3&&e.children.push(l_(n,n.readVarint()+n.pos))}function vA(i,e,n){i===1?e.left=e.top=n.readFloat():i===2?e.width=e.height=n.readFloat():i===3?e.top=n.readFloat():i===4?e.height=n.readFloat():i===5?e.mask_type=n.readVarint():i===6?e.mask_idx=n.readVarint():i===7&&e.children.push(l_(n,n.readVarint()+n.pos))}class xA{static calculate(e={},n=[]){const o=new Map,a=new Map;if(Object.keys(e).length===0)return o;n.forEach((u=>{a.set(u.name,u.rgb_color||new Vi(0,0,0))}));for(const[u,h]of Object.entries(e))a.has(u)?o.set(a.get(u).toString(),h):console.warn(`Ignoring unknown image variable "${u}"`);return o}}function Qp(i,e=255,n){const o=e/255,a=i.toString(),u=n.has(a)?n.get(a).clone():i.clone();return u.a*=o,u.toString()}function ng(i,e){if(!Zs()){const n=document.createElement("canvas");return n.width=i,n.height=e,n}return new OffscreenCanvas(i,e)}let iv,ig=null;function rv(i,e,n,o,a){for(const u of o.children)_w(i,e,n,u,a)}function _w(i,e,n,o,a){o.group?(i.save(),(function(u,h,p,y,x){const S=y.mask_idx!=null?p.masks[y.mask_idx]:null,E=y.clip_path_idx!=null?p.clip_paths[y.clip_path_idx]:null;if(y.transform&&(h=em(y.transform).preMultiplySelf(h)),!(function(k,F,G){return k.opacity!==255||F||G})(y,E!=null,S!=null))return void rv(u,h,p,y,x);const A=ng(u.canvas.width,u.canvas.height),P=A.getContext("2d");rv(P,h,p,y,x),E&&Sw(P,h,p,E),S&&Ew(P,h,p,S,x),u.globalAlpha=y.opacity/255,u.drawImage(A,0,0)})(i,e,n,o.group,a),i.restore()):o.path&&(i.save(),(function(u,h,p,y,x){u.setTransform(h),y.paint_order===nA.PAINT_ORDER_FILL_AND_STROKE?(yw(u,p,y,x),xw(u,p,y,x)):(xw(u,p,y,x),yw(u,p,y,x))})(i,e,n,o.path,a),i.restore())}function yw(i,e,n,o){const a=n.fill;if(!a)return;const u=a.opacity/255;switch(i.save(),i.beginPath(),Iw(n,i),a.paint){case"rgb_color":i.fillStyle=Qp(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":{const h=e.linear_gradients[a.linear_gradient_idx];h.transform&&i.setTransform(em(h.transform).preMultiplySelf(i.getTransform())),i.fillStyle=ww(i,h,u,o);break}case"radial_gradient_idx":{const h=e.radial_gradients[a.radial_gradient_idx];h.transform&&i.setTransform(em(h.transform).preMultiplySelf(i.getTransform())),i.fillStyle=bw(i,h,u,o)}}i.fill(vw(n)),i.restore()}function vw(i){return i.rule===tv.PATH_RULE_NON_ZERO?"nonzero":i.rule===tv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function xw(i,e,n,o){const a=n.stroke;if(!a)return;const u=Aw(n);i.lineWidth=a.width,i.miterLimit=a.miterlimit,i.setLineDash(a.dasharray),i.lineDashOffset=a.dashoffset;const h=a.opacity/255;switch(a.paint){case"rgb_color":i.strokeStyle=Qp(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":i.strokeStyle=ww(i,e.linear_gradients[a.linear_gradient_idx],h,o,!0);break;case"radial_gradient_idx":i.strokeStyle=bw(i,e.radial_gradients[a.radial_gradient_idx],h,o,!0)}switch(a.linejoin){case a_.LINE_JOIN_MITER_CLIP:case a_.LINE_JOIN_MITER:i.lineJoin="miter";break;case a_.LINE_JOIN_ROUND:i.lineJoin="round";break;case a_.LINE_JOIN_BEVEL:i.lineJoin="bevel"}switch(a.linecap){case nv.LINE_CAP_BUTT:i.lineCap="butt";break;case nv.LINE_CAP_ROUND:i.lineCap="round";break;case nv.LINE_CAP_SQUARE:i.lineCap="square"}i.stroke(u)}function ww(i,e,n,o,a=!1){if(e.stops.length===1){const A=e.stops[0];return Qp(A.rgb_color,A.opacity*n,o)}const{x1:u,y1:h,x2:p,y2:y}=e;let x=new DOMPoint(u,h),S=new DOMPoint(p,y);if(a){const A=em(e.transform);x=A.transformPoint(x),S=A.transformPoint(S)}const E=i.createLinearGradient(x.x,x.y,S.x,S.y);for(const A of e.stops)E.addColorStop(A.offset,Qp(A.rgb_color,A.opacity*n,o));return E}function bw(i,e,n,o,a=!1){if(e.stops.length===1){const U=e.stops[0];return Qp(U.rgb_color,U.opacity*n,o)}const u=em(e.transform),{fx:h,fy:p,fr:y,cx:x,cy:S,r:E}=e;let A=new DOMPoint(h,p),P=new DOMPoint(x,S),k=y,F=E;if(a){A=u.transformPoint(A),P=u.transformPoint(P);const U=(u.a+u.d)/2;k=y*U,F=e.r*U}const G=i.createRadialGradient(A.x,A.y,k,P.x,P.y,F);for(const U of e.stops)G.addColorStop(U.offset,Qp(U.rgb_color,U.opacity*n,o));return G}function Tw(i,e,n,o){const a=o.transform?em(o.transform).preMultiplySelf(e):e,u=ng(i.canvas.width,i.canvas.height),h=u.getContext("2d");for(const y of o.children)if(y.group)Tw(h,a,n,y.group);else if(y.path){const x=y.path,S=new Path2D;S.addPath(Aw(x),a),h.fill(S,vw(x))}const p=o.clip_path_idx!=null?n.clip_paths[o.clip_path_idx]:null;p&&Sw(h,a,n,p),i.globalCompositeOperation="source-over",i.drawImage(u,0,0)}function Sw(i,e,n,o){const a=ng(i.canvas.width,i.canvas.height);Tw(a.getContext("2d"),e,n,o),i.globalCompositeOperation="destination-in",i.drawImage(a,0,0)}function Ew(i,e,n,o,a){if(o.children.length===0)return;const u=o.mask_idx!=null?n.masks[o.mask_idx]:null;u&&Ew(i,e,n,u,a);const h=i.canvas.width,p=i.canvas.height,y=ng(h,p),x=y.getContext("2d"),S=o.width,E=o.height,A=o.left,P=o.top,k=new Path2D,F=new Path2D;F.rect(A,P,S,E),k.addPath(F,e),x.clip(k);for(const Y of o.children)_w(x,e,n,Y,a);const G=x.getImageData(0,0,h,p),U=G.data;if(o.mask_type===fw.MASK_TYPE_LUMINANCE)for(let Y=0;Y<U.length;Y+=4)U[Y+3]=U[Y+3]/255*(.2126*U[Y]+.7152*U[Y+1]+.0722*U[Y+2]);x.putImageData(G,0,0),i.globalCompositeOperation="destination-in",i.drawImage(y,0,0)}function em(i){return i?new DOMMatrix([i.sx,i.ky,i.kx,i.sy,i.tx,i.ty]):new DOMMatrix}function Iw(i,e){const n=i.step;let o=i.diffs[0]*n,a=i.diffs[1]*n;e.moveTo(o,a);for(let u=0,h=2;u<i.commands.length;u++)switch(i.commands[u]){case tg.PATH_COMMAND_MOVE:o+=i.diffs[h++]*n,a+=i.diffs[h++]*n,e.moveTo(o,a);break;case tg.PATH_COMMAND_LINE:o+=i.diffs[h++]*n,a+=i.diffs[h++]*n,e.lineTo(o,a);break;case tg.PATH_COMMAND_QUAD:{const p=o+i.diffs[h++]*n,y=a+i.diffs[h++]*n;o=p+i.diffs[h++]*n,a=y+i.diffs[h++]*n,e.quadraticCurveTo(p,y,o,a);break}case tg.PATH_COMMAND_CUBIC:{const p=o+i.diffs[h++]*n,y=a+i.diffs[h++]*n,x=p+i.diffs[h++]*n,S=y+i.diffs[h++]*n;o=x+i.diffs[h++]*n,a=S+i.diffs[h++]*n,e.bezierCurveTo(p,y,x,S,o,a);break}case tg.PATH_COMMAND_CLOSE:e.closePath()}return e}function Aw(i){return Iw(i,new Path2D)}class h_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}qt(h_,"LRUCache");class ov{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ss(e,e.data)}getFromCache(e,n,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new h_(150)),this.cacheMap.get(o).get(Ta(e.toString(),n))}setInCache(e,n,o,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new h_(150));const u=this.cacheDependenciesMap.get(a),h=Ta(e.id.toString(),o);u.get(h)||u.set(h,new Set);const p=this.cacheMap.get(a),y=e.toString();u.get(h).add(y),p.put(Ta(e.toString(),o),n)}removeImagesFromCacheByIds(e,n,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const a=this.cacheMap.get(o),u=this.cacheDependenciesMap.get(o);for(const h of e){const p=Ta(h.toString(),n);if(u.has(p)){for(const y of u.get(p))a.delete(y);u.delete(p)}}}rasterize(e,n,o,a){const u=this.getFromCache(e,o,a);if(u)return u.clone();const h=(function(y,x){const S=xA.calculate(x.params,y.metadata?y.metadata.variables:[]),E=y.usvg_tree,A=E.width,P=E.height,k=Math.max(1,Math.round(A*x.sx)),F=Math.max(1,Math.round(P*x.sy)),G=new DOMMatrix([k/A,0,0,F/P,0,0]);return ig===null&&(ig=ng(10,10),iv=ig.getContext("2d",{willReadFrequently:!0})),ig.width=k,ig.height=F,rv(iv,G,E,E,S),iv.getImageData(0,0,k,F)})(n.icon,e),p=ov._getImage(h);return this.setInCache(e,p,o,a),p.clone()}}class Cw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Mw(i,e,n,o){let a=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(n[h]<i[h]||n[h]>e[h])return null}else{const p=1/o[h];let y=(i[h]-n[h])*p,x=(e[h]-n[h])*p;if(y>x){const S=y;y=x,x=S}if(y>a&&(a=y),x<u&&(u=x),a>u)return null}return a}function Pw(i,e,n,o,a,u,h,p,y,x,S){const E=o-i,A=a-e,P=u-n,k=h-i,F=p-e,G=y-n,U=S[1]*G-S[2]*F,Y=S[2]*k-S[0]*G,Q=S[0]*F-S[1]*k,ne=E*U+A*Y+P*Q;if(Math.abs(ne)<1e-15)return null;const me=1/ne,de=x[0]-i,ve=x[1]-e,Te=x[2]-n,Ie=(de*U+ve*Y+Te*Q)*me;if(Ie<0||Ie>1)return null;const qe=ve*P-Te*A,ke=Te*E-de*P,Qe=de*A-ve*E,ut=(S[0]*qe+S[1]*ke+S[2]*Qe)*me;return ut<0||Ie+ut>1?null:(k*qe+F*ke+G*Qe)*me}function Rw(i,e,n){return(i-e)/(n-e)}function kw(i,e,n,o,a,u,h,p,y){const x=1<<n,S=u-o,E=h-a,A=(i+1)/x*S+o,P=(e+0)/x*E+a,k=(e+1)/x*E+a;p[0]=(i+0)/x*S+o,p[1]=P,y[0]=A,y[1]=k}class zw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=(function(u){const h=Math.ceil(Math.log2(u.dim/8)),p=[];let y=Math.ceil(Math.pow(2,h));const x=1/y,S=(P,k,F,G,U)=>{const Y=G?1:0,Q=(P+1)*F-Y,ne=k*F,me=(k+1)*F-Y;U[0]=P*F,U[1]=ne,U[2]=Q,U[3]=me};let E=new Cw(y);const A=[];for(let P=0;P<y*y;P++){S(P%y,Math.floor(P/y),x,!1,A);const k=Sf(A[0],A[1],u),F=Sf(A[2],A[1],u),G=Sf(A[2],A[3],u),U=Sf(A[0],A[3],u);E.minimums.push(Math.min(k,F,G,U)),E.maximums.push(Math.max(k,F,G,U)),E.leaves.push(1)}for(p.push(E),y/=2;y>=1;y/=2){const P=p[p.length-1];E=new Cw(y);for(let k=0;k<y*y;k++){S(k%y,Math.floor(k/y),2,!0,A);const F=P.getElevation(A[0],A[1]),G=P.getElevation(A[2],A[1]),U=P.getElevation(A[2],A[3]),Y=P.getElevation(A[0],A[3]),Q=P.isLeaf(A[0],A[1]),ne=P.isLeaf(A[2],A[1]),me=P.isLeaf(A[2],A[3]),de=P.isLeaf(A[0],A[3]),ve=Math.min(F.min,G.min,U.min,Y.min),Te=Math.max(F.max,G.max,U.max,Y.max),Ie=Q&&ne&&me&&de;E.maximums.push(Te),E.minimums.push(ve),E.leaves.push(Te-ve<=5&&Ie?1:0)}p.push(E)}return p})(this.dem),o=n.length-1,a=n[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,a,u,h,p=1){return Mw([e,n,-100],[o,a,this.maximums[0]*p],u,h)}raycast(e,n,o,a,u,h,p=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,o,a,u,h,p);if(y==null)return null;const x=[],S=[],E=[],A=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:k,t:F,nodex:G,nodey:U,depth:Y}=P.pop();if(this.leaves[k]){kw(G,U,Y,e,n,o,a,E,A);const ne=1<<Y,me=(G+0)/ne,de=(G+1)/ne,ve=(U+0)/ne,Te=(U+1)/ne,Ie=Sf(me,ve,this.dem)*p,qe=Sf(de,ve,this.dem)*p,ke=Sf(de,Te,this.dem)*p,Qe=Sf(me,Te,this.dem)*p,ut=Pw(E[0],E[1],Ie,A[0],E[1],qe,A[0],A[1],ke,u,h),ht=Pw(A[0],A[1],ke,E[0],A[1],Qe,E[0],E[1],Ie,u,h),gt=Math.min(ut!==null?ut:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(gt!==Number.MAX_VALUE)return gt;{const vt=gn([],u,h,F);if(Lw(Ie,qe,Qe,ke,Rw(vt[0],E[0],A[0]),Rw(vt[1],E[1],A[1]))>=vt[2])return F}continue}let Q=0;for(let ne=0;ne<this._siblingOffset.length;ne++){kw((G<<1)+this._siblingOffset[ne][0],(U<<1)+this._siblingOffset[ne][1],Y+1,e,n,o,a,E,A),E[2]=-100,A[2]=this.maximums[this.childOffsets[k]+ne]*p;const me=Mw(E,A,u,h);if(me!=null){const de=me;x[ne]=de;let ve=!1;for(let Te=0;Te<Q&&!ve;Te++)de>=x[S[Te]]&&(S.splice(Te,0,ne),ve=!0);ve||(S[Q]=ne),Q++}}for(let ne=0;ne<Q;ne++){const me=S[ne];P.push({idx:this.childOffsets[k]+me,t:x[me],nodex:(G<<1)+this._siblingOffset[me][0],nodey:(U<<1)+this._siblingOffset[me][1],depth:Y+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,a,u){if(e[a].isLeaf(n,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const h=a-1,p=e[h];let y=0,x=0;for(let S=0;S<this._siblingOffset.length;S++){const E=2*n+this._siblingOffset[S][0],A=2*o+this._siblingOffset[S][1],P=p.getElevation(E,A),k=p.isLeaf(E,A),F=this._addNode(P.min,P.max,k);k&&(y|=1<<S),x||(x=F)}for(let S=0;S<this._siblingOffset.length;S++)y&1<<S||this._construct(e,2*n+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],h,x+S)}}function Lw(i,e,n,o,a,u){return bn(bn(i,n,u),bn(e,o,u),a)}function Sf(i,e,n){const o=n.dim,a=H(i*o-.5,0,o-1),u=H(e*o-.5,0,o-1),h=Math.floor(a),p=Math.floor(u),y=Math.min(h+1,o-1),x=Math.min(p+1,o-1);return Lw(n.get(h,p),n.get(y,p),n.get(h,x),n.get(y,x),a-h,u-p)}const wA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function bA(i,e,n){return(256*i*256+256*e+n)/10-1e4}function TA(i,e,n){return 256*i+e+n/256-32768}class d_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,a=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void $t(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2,h=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<u;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(u,y)]=h[this._idx(u-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,u)]=h[this._idx(y,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}const p=o==="terrarium"?TA:bA;for(let y=0;y<h.length;++y){const x=4*y;this.floatView[y]=p(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=xo.now()}_buildQuadTree(){this._tree=new zw(this)}get(e,n,o=!1){o&&(e=H(e,-1,this.dim),n=H(n,-1,this.dim));const a=this._idx(e,n);return this.floatView[a]}set(e,n,o){const a=this._idx(e,n),u=this.floatView[a];return this.floatView[a]=o,o-u}static getUnpackVector(e){return wA[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const o=[0,0,0,0],a=d_.getUnpackVector(n);let u=Math.floor((e+a[3])/a[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new Cx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,u=n*this.dim+this.dim,h=o*this.dim,p=o*this.dim+this.dim;switch(n){case-1:a=u-1;break;case 1:u=a+1}switch(o){case-1:h=p-1;break;case 1:p=h+1}const y=-n*this.dim,x=-o*this.dim;for(let S=h;S<p;S++)for(let E=a;E<u;E++){const A=4*this._idx(E,S),P=4*this._idx(E+y,S+x);this.pixels[A+0]=e.pixels[P+0],this.pixels[A+1]=e.pixels[P+1],this.pixels[A+2]=e.pixels[P+2],this.pixels[A+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function SA(i,e,n){i===1?e.headerLength=n.readFixed32():i===2?e.x=n.readVarint():i===3?e.y=n.readVarint():i===4?e.z=n.readVarint():i===5&&e.layers.push((function(o,a){return o.readFields(MA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)})(n,n.readVarint()+n.pos))}function EA(i,e,n){i===1?(e.delta_filter=(function(o,a){return o.readFields(IA,{blockSize:0},a)})(n,n.readVarint()+n.pos),e.filter="delta_filter"):i===2?(n.readVarint(),e.filter="zigzag_filter"):i===3?(n.readVarint(),e.filter="bitshuffle_filter"):i===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function IA(i,e,n){i===1&&(e.blockSize=n.readVarint())}function AA(i,e,n){i===1?(n.readVarint(),e.codec="gzip_data"):i===2?(n.readVarint(),e.codec="jpeg_image"):i===3?(n.readVarint(),e.codec="webp_image"):i===4&&(n.readVarint(),e.codec="png_image")}function CA(i,e,n){let o=0,a=0;i===1?e.firstByte=n.readFixed64():i===2?e.lastByte=n.readFixed64():i===3?e.filters.push((function(u,h){return u.readFields(EA,{},h)})(n,n.readVarint()+n.pos)):i===4?e.codec=(function(u,h){return u.readFields(AA,{},h)})(n,n.readVarint()+n.pos):i===5?a=n.readFloat():i===6?o=n.readFloat():i===7?e.bands.push(n.readString()):i===8?e.offset=n.readDouble():i===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=o)}function MA(i,e,n){i===1?e.version=n.readVarint():i===2?e.name=n.readString():i===3?e.units=n.readString():i===4?e.tileSize=n.readVarint():i===5?e.buffer=n.readVarint():i===6?e.pixelFormat=n.readVarint():i===7&&e.dataIndex.push((function(o,a){return o.readFields(CA,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)})(n,n.readVarint()+n.pos))}function PA(i,e,n){if(i===2)(function(o,a,u){o.readFields(RA,u,a)})(n,n.readVarint()+n.pos,e);else if(i===3)throw new Error("Not implemented")}function RA(i,e,n){if(i===1){let o=0;const a=n.readVarint()+n.pos;for(;n.pos<a;)e[o++]=n.readVarint()}}function kA(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let o=2;o>=1;o--){const a=o===1?1:0,u=o===2?1:0;for(let h=0;h<e[0];h++){const p=e[1]*h;for(let y=a;y<e[1];y++){const x=e[2]*(y+p);for(let S=u;S<e[2];S++){const E=e[3]*(S+x);for(let A=0;A<e[3];A++){const P=E+A;i[P]+=i[P-n]}}}}n*=e[o]}return i}function zA(i){for(let e=0,n=i.length;e<n;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function LA(i,e){switch(e){case"uint32":return i;case"uint16":for(let n=0;n<i.length;n+=2){const o=i[n],a=i[n+1];i[n]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,i[n+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return i;case"uint8":for(let n=0;n<i.length;n+=4){const o=i[n],a=i[n+1],u=i[n+2],h=i[n+3];i[n+0]=(192&o)>>6|(192&a)>>4|(192&u)>>2|192&h,i[n+1]=(48&o)>>4|(48&a)>>2|48&u|(48&h)<<2,i[n+2]=(12&o)>>2|12&a|(12&u)<<2|(12&h)<<4,i[n+3]=3&o|(3&a)<<2|(3&u)<<4|(3&h)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}qt(d_,"DEMData"),qt(zw,"DemMinMaxQuadTree",{omit:["dem"]});var cc=Uint8Array,rg=Uint16Array,DA=Int32Array,Dw=new cc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ow=new cc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OA=new cc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fw=function(i,e){for(var n=new rg(31),o=0;o<31;++o)n[o]=e+=1<<i[o-1];var a=new DA(n[30]);for(o=1;o<30;++o)for(var u=n[o];u<n[o+1];++u)a[u]=u-n[o]<<5|o;return{b:n,r:a}},Bw=Fw(Dw,2),Nw=Bw.b,FA=Bw.r;Nw[28]=258,FA[258]=28;for(var BA=Fw(Ow,0).b,jw=new rg(32768),Mo=0;Mo<32768;++Mo){var tm=(43690&Mo)>>1|(21845&Mo)<<1;jw[Mo]=((65280&(tm=(61680&(tm=(52428&tm)>>2|(13107&tm)<<2))>>4|(3855&tm)<<4))>>8|(255&tm)<<8)>>1}var og=function(i,e,n){for(var o=i.length,a=0,u=new rg(e);a<o;++a)i[a]&&++u[i[a]-1];var h,p=new rg(e);for(a=1;a<e;++a)p[a]=p[a-1]+u[a-1]<<1;h=new rg(1<<e);var y=15-e;for(a=0;a<o;++a)if(i[a])for(var x=a<<4|i[a],S=e-i[a],E=p[i[a]-1]++<<S,A=E|(1<<S)-1;E<=A;++E)h[jw[E]>>y]=x;return h},sg=new cc(288);for(Mo=0;Mo<144;++Mo)sg[Mo]=8;for(Mo=144;Mo<256;++Mo)sg[Mo]=9;for(Mo=256;Mo<280;++Mo)sg[Mo]=7;for(Mo=280;Mo<288;++Mo)sg[Mo]=8;var Vw=new cc(32);for(Mo=0;Mo<32;++Mo)Vw[Mo]=5;var NA=og(sg,9),jA=og(Vw,5),sv=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},du=function(i,e,n){var o=e/8|0;return(i[o]|i[o+1]<<8)>>(7&e)&n},av=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(7&e)},VA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fu=function(i,e,n){var o=new Error(e||VA[i]);if(o.code=i,Error.captureStackTrace&&Error.captureStackTrace(o,fu),!n)throw o;return o},UA=new cc(0),GA=typeof TextDecoder<"u"&&new TextDecoder;try{GA.decode(UA,{stream:!0})}catch{}const $A={gzip_data:"gzip"};class kc extends Error{constructor(e){super(e),this.name="MRTError"}}const HA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Uw={uint32:1,uint16:2,uint8:4},WA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let lv;class f_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new kc(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),o=new DataView(e);if(n[0]!==13)throw new kc("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),o=this.getHeaderLength(e);if(n.length<o)throw new kc(`Expected header with length >= ${o} but got buffer of length ${n.length}`);const a=new lv(n.subarray(0,o)).readFields(SA,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new kc(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const u of a.layers)this.layers[u.name]=new Gw(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],o=this.getLayer(e.layerName);for(let a of e.blockIndices){const u=o.dataIndex[a],h=u.firstByte-e.firstByte,p=u.lastByte-e.firstByte;if(o._blocksInProgress.has(a))continue;const y={layerName:o.name,firstByte:h,lastByte:p,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map((x=>x.filter))};o._blocksInProgress.add(a),n.push(y)}return new $w(n,(()=>{n.forEach((a=>o._blocksInProgress.delete(a.blockIndex)))}),((a,u)=>{if(n.forEach((h=>o._blocksInProgress.delete(h.blockIndex))),a)throw a;u.forEach((h=>{this.getLayer(h.layerName).processDecodedData(h)}))}))}}class Gw{constructor({version:e,name:n,units:o,tileSize:a,pixelFormat:u,buffer:h,dataIndex:p},y){if(this.version=e,this.version!==1)throw new kc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=o,this.tileSize=a,this.buffer=h,this.pixelFormat=HA[u],this.dataIndex=p,this.bandShape=[a+2*h,a+2*h,Uw[this.pixelFormat]],this._decodedBlocks=new h_(y?y.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Uw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[o,a]of this.dataIndex.entries()){for(const[u,h]of a.bands.entries())if(h===e)return{bandIndex:n+u,blockIndex:o,blockBandIndex:u};n+=a.bands.length}break;case"number":for(const[o,a]of this.dataIndex.entries()){if(e>=n&&e<n+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-n};n+=a.bands.length}break;default:throw new kc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,o=-1/0;const a=[],u=new Set;for(const h of e){const{blockIndex:p}=this.getBlockForBand(h);if(p<0)throw new kc(`Invalid band: ${JSON.stringify(h)}`);const y=this.dataIndex[p];a.includes(p)||a.push(p),u.add(p),n=Math.min(n,y.firstByte),o=Math.max(o,y.lastByte)}if(u.size>this.cacheSize)throw new kc(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:o,blockIndices:a}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:o}=this.getBlockForBand(e);if(n<0)throw new kc(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(n.toString());if(!a)throw new kc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[n],h=this.bandShape.reduce(((x,S)=>x*S),1),p=o*h,y=a.subarray(p,p+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}f_.setPbf=function(i){lv=i};class $w{constructor(e,n,o){this.tasks=e,this._onCancel=n,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}f_.performDecoding=function(i,e){const n=new Uint8Array(i);return Promise.all(e.tasks.map((o=>{const{layerName:a,firstByte:u,lastByte:h,pixelFormat:p,blockShape:y,blockIndex:x,filters:S,codec:E}=o,A=n.subarray(u,h+1),P=new Uint32Array(y[0]*y[1]*y[2]);let k;if(E!=="gzip_data")throw new kc(`Unhandled codec: ${E}`);return k=(function(F,G){if(!globalThis.DecompressionStream&&G==="gzip_data")return Promise.resolve(((ne=(function(ve){ve[0]==31&&ve[1]==139&&ve[2]==8||fu(6,"invalid gzip data");var Te=ve[3],Ie=10;4&Te&&(Ie+=2+(ve[10]|ve[11]<<8));for(var qe=(Te>>3&1)+(Te>>4&1);qe>0;qe-=!ve[Ie++]);return Ie+(2&Te)})(Q=F))+8>Q.length&&fu(6,"invalid gzip data"),(function(ve,Te,Ie,qe){var ke=ve.length;if(!ke||Te.f&&!Te.l)return Ie||new cc(0);var Qe=!Ie,ut=Qe||Te.i!=2,ht=Te.i;Qe&&(Ie=new cc(3*ke));var gt,vt,ft=function(Ki){var Ni=Ie.length;if(Ki>Ni){var Ui=new cc(Math.max(2*Ni,Ki));Ui.set(Ie),Ie=Ui}},pt=Te.f||0,Je=Te.p||0,Ye=Te.b||0,mt=Te.l,zt=Te.d,St=Te.m,hn=Te.n,Vt=8*ke;do{if(!mt){pt=du(ve,Je,1);var Zt=du(ve,Je+1,3);if(Je+=3,!Zt){var nn=ve[(et=4+((Je+7)/8|0))-4]|ve[et-3]<<8,Qn=et+nn;if(Qn>ke){ht&&fu(0);break}ut&&ft(Ye+nn),Ie.set(ve.subarray(et,Qn),Ye),Te.b=Ye+=nn,Te.p=Je=8*Qn,Te.f=pt;continue}if(Zt==1)mt=NA,zt=jA,St=9,hn=5;else if(Zt==2){var It=du(ve,Je,31)+257,on=du(ve,Je+10,15)+4,Dn=It+du(ve,Je+5,31)+1;Je+=14;for(var gi=new cc(Dn),bi=new cc(19),qn=0;qn<on;++qn)bi[OA[qn]]=du(ve,Je+3*qn,7);Je+=3*on;var Yi=sv(bi),fe=(1<<Yi)-1,_e=og(bi,Yi);for(qn=0;qn<Dn;){var et,_t=_e[du(ve,Je,fe)];if(Je+=15&_t,(et=_t>>4)<16)gi[qn++]=et;else{var Ot=0,Ft=0;for(et==16?(Ft=3+du(ve,Je,3),Je+=2,Ot=gi[qn-1]):et==17?(Ft=3+du(ve,Je,7),Je+=3):et==18&&(Ft=11+du(ve,Je,127),Je+=7);Ft--;)gi[qn++]=Ot}}var fn=gi.subarray(0,It),pn=gi.subarray(It);St=sv(fn),hn=sv(pn),mt=og(fn,St),zt=og(pn,hn)}else fu(1);if(Je>Vt){ht&&fu(0);break}}ut&&ft(Ye+131072);for(var $n=(1<<St)-1,Xn=(1<<hn)-1,Jn=Je;;Jn=Je){var di=(Ot=mt[av(ve,Je)&$n])>>4;if((Je+=15&Ot)>Vt){ht&&fu(0);break}if(Ot||fu(2),di<256)Ie[Ye++]=di;else{if(di==256){Jn=Je,mt=null;break}var Cn=di-254;di>264&&(Cn=du(ve,Je,(1<<(Li=Dw[qn=di-257]))-1)+Nw[qn],Je+=Li);var Ln=zt[av(ve,Je)&Xn],Pi=Ln>>4;if(Ln||fu(3),Je+=15&Ln,pn=BA[Pi],Pi>3){var Li=Ow[Pi];pn+=av(ve,Je)&(1<<Li)-1,Je+=Li}if(Je>Vt){ht&&fu(0);break}ut&&ft(Ye+131072);var Di=Ye+Cn;if(Ye<pn){var Wi=0-pn,nr=Math.min(pn,Di);for(Wi+Ye<0&&fu(3);Ye<nr;++Ye)Ie[Ye]=(void 0)[Wi+Ye]}for(;Ye<Di;++Ye)Ie[Ye]=Ie[Ye-pn]}}Te.l=mt,Te.p=Jn,Te.b=Ye,Te.f=pt,mt&&(pt=1,Te.m=St,Te.d=zt,Te.n=hn)}while(!pt);return Ye!=Ie.length&&Qe?(gt=Ie,((vt=Ye)==null||vt>gt.length)&&(vt=gt.length),new cc(gt.subarray(0,vt))):Ie.subarray(0,Ye)})(Q.subarray(ne,-8),{i:2},new cc(((U=Q)[(Y=U.length)-4]|U[Y-3]<<8|U[Y-2]<<16|U[Y-1]<<24)>>>0))));var U,Y,Q,ne;const me=$A[G];if(!me)throw new Error(`Unhandled codec: ${G}`);const de=new globalThis.DecompressionStream(me);return new Response(new Blob([F]).stream().pipeThrough(de)).arrayBuffer().then((ve=>new Uint8Array(ve)))})(A,E).then((F=>((function(G,U){G.readFields(PA,U)})(new lv(F),P),new WA[p](P.buffer)))),k.then((F=>{for(let G=S.length-1;G>=0;G--)switch(S[G]){case"delta_filter":kA(F,y);break;case"zigzag_filter":zA(F);break;case"bitshuffle_filter":LA(F,p);break;default:throw new kc(`Unhandled filter "${S[G]}"`)}return{layerName:a,blockIndex:x,data:F}})).catch((F=>{throw F}))})))},qt($w,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qt(f_,"MapboxRasterTile"),qt(Gw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Hw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Ww{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ia(Pt,16,0),this.featureIndexArray=new gf,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,o,a,u,h=0,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,u,h);const x=this.grid;for(let S=0;S<n.length;S++){const E=n[S],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<E.length;P++){const k=E[P];A[0]=Math.min(A[0],k.x),A[1]=Math.min(A[1],k.y),A[2]=Math.max(A[2],k.x),A[3]=Math.max(A[3],k.y)}p!==0&&(A[0]-=p,A[1]-=p,A[2]+=p,A[3]+=p),A[0]<Pt&&A[1]<Pt&&A[2]>=0&&A[3]>=0&&x.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ne(new Gg(this.rawTileData)).layers,this.sourceLayerCoder=new Hw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:o,transform:a,tileTransform:u,pixelPosMatrix:h,availableImages:p,worldview:y}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const x=n.queryRadius?n.queryRadius:0,S=o.bufferedTilespaceBounds,E=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,((F,G,U,Y)=>Go(o.bufferedTilespaceGeometry,F-x,G-x,U+x,Y+x)));E.sort(qA);let A=null;a.elevation&&E.length>0&&(A=Jp.create(a.elevation,this.tileID));const P={};let k;for(let F=0;F<E.length;F++){const G=E[F];if(G===k)continue;k=G;const U=this.featureIndexArray.get(G);let Y=null;this.is3DTile?this.loadMatchingModelFeature(P,U,e,o,a,y):this.loadMatchingFeature(P,U,e,p,y,((Q,ne,me,de=0)=>(Y||(Y=xe(Q,this.tileID.canonical,u)),ne.queryIntersectsFeature(o,Q,me,Y,this.z,a,h,A,de))))}return P}loadMatchingFeature(e,n,o,a,u,h){const{featureIndex:p,bucketIndex:y,sourceLayerIndex:x,layoutVertexArrayOffset:S}=n,E=this.bucketLayerIDs[y],A=o.layers,P=Object.keys(A);if(P.length&&!Xt(P,E))return;const k=o.sourceCache,F=this.sourceLayerCoder.decode(x),G=this.vtLayers[F].feature(p),U=this.getId(G,F);for(let Y=0;Y<E.length;Y++){const Q=E[Y];if(!A[Q])continue;const{styleLayer:ne,targets:me}=A[Q];let de={};U!==void 0&&(de=k.getFeatureState(ne.sourceLayer,U));const ve=!h||h(G,ne,de,S);if(!ve)continue;const Te=new mp(G,this.z,this.x,this.y,U);Te.tile=this.tileID.canonical,Te.state=de;let Ie=this.serializedLayersCache.get(Q);Ie||(Ie=ne.serialize(),Ie.id=Q,this.serializedLayersCache.set(Q,Ie)),Te.source=Ie.source,Te.sourceLayer=Ie["source-layer"],Te.layer=Object.assign({},Ie),Te.layer.paint=qw(Ie.paint,ne.paint,G,de,a),Te.layer.layout=qw(Ie.layout,ne.layout,G,de,a);let qe=!1;for(const ke of me){this.updateFeatureProperties(Te,ke);const{filter:Qe}=ke;if(Qe){if(G.properties=Te.properties,Qe.needGeometry){const ut=Re(G,!0);if(!Qe.filter(new Xi(this.tileID.overscaledZ,{worldview:u}),ut,this.tileID.canonical))continue}else if(!Qe.filter(new Xi(this.tileID.overscaledZ,{worldview:u}),G))continue}qe=!0,ke.targetId&&this.addFeatureVariant(Te,ke)}qe&&this.appendToResult(e,Q,p,Te,ve)}}loadMatchingModelFeature(e,n,o,a,u,h){const{featureIndex:p,bucketIndex:y}=n,x=this.bucketLayerIDs[y],S=o.layers,E=Object.keys(S);if(!E.length||Xt(E,x))for(let A=0;A<x.length;A++){const P=x[A],{styleLayer:k,targets:F}=S[P];if(k.type!=="model")continue;const G=a.tile,U=G.getBucket(k);if(!(U&&U instanceof s_))continue;const Y=eA(U,p,a,u);if(!Y)continue;const{z:Q,x:ne,y:me}=G.tileID.canonical,{feature:de,intersectionZ:ve,position:Te}=Y;let Ie={};de.id!==void 0&&(Ie=o.sourceCache.getFeatureState(k.sourceLayer,de.id));const qe=new mp({},Q,ne,me,de.id);qe.tile=this.tileID.canonical,qe.state=Ie,qe.properties=de.properties,qe.geometry={type:"Point",coordinates:[Te.lng,Te.lat]};let ke=this.serializedLayersCache.get(P);ke||(ke=k.serialize(),ke.id=P,this.serializedLayersCache.set(P,ke)),qe.source=ke.source,qe.sourceLayer=ke["source-layer"],qe.layer=Object.assign({},ke);let Qe=!1;for(const ut of F){this.updateFeatureProperties(qe,ut);const{filter:ht}=ut;if(ht){if(de.properties=qe.properties,ht.needGeometry){if(!ht.filter(new Xi(this.tileID.overscaledZ,{worldview:h}),de,this.tileID.canonical))continue}else if(!ht.filter(new Xi(this.tileID.overscaledZ,{worldview:h}),de))continue}Qe=!0,ut.targetId&&this.addFeatureVariant(qe,ut)}Qe&&this.appendToResult(e,P,p,qe,ve)}}updateFeatureProperties(e,n,o){if(n.properties){const a={};for(const u in n.properties){const h=n.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);h!=null&&(a[u]=h)}e.properties=a}}addFeatureVariant(e,n,o){const a={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(a)}appendToResult(e,n,o,a,u){let h=e[n];h===void 0&&(h=e[n]=[]),h.push({featureIndex:o,feature:a,intersectionZ:u})}lookupSymbolFeatures(e,n,o,a,u,h){const p={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(p,{bucketIndex:n,sourceLayerIndex:o,featureIndex:y,layoutVertexArrayOffset:0},a,u,h);return p}loadFeature(e){const{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(o),u=this.vtFeatures[a];if(u[n])return u[n];const h=this.vtLayers[a].feature(n);return u[n]=h,h}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const u=wa(a);if(u.result!=="success"){const h=u.value.map((p=>`${p.key}: ${p.message}`)).join(", ");return void $t(`Failed to create expression for promoteId: ${h}`)}this.promoteIdExpression=u.value}o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[a];typeof o=="boolean"&&(o=Number(o))}return o}}function qw(i,e,n,o,a){return Ve(i,((u,h)=>{const p=e instanceof Jo?e.get(h):null;return p&&p.evaluate?p.evaluate(n,o,void 0,a):p}))}function qA(i,e){return e-i}qt(Ww,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Zw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const u=Zw[15&o];if(!u)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[p]=new Uint32Array(e,4,1);return new cv(p,h,u,e)}constructor(e,n=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=Zw.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,p=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-p%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+p+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return uv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:p}=this,y=[0,u.length-1,0],x=[];for(;y.length;){const S=y.pop()||0,E=y.pop()||0,A=y.pop()||0;if(E-A<=p){for(let G=A;G<=E;G++){const U=h[2*G],Y=h[2*G+1];U>=e&&U<=o&&Y>=n&&Y<=a&&x.push(u[G])}continue}const P=A+E>>1,k=h[2*P],F=h[2*P+1];k>=e&&k<=o&&F>=n&&F<=a&&x.push(u[P]),(S===0?e<=k:n<=F)&&(y.push(A),y.push(P-1),y.push(1-S)),(S===0?o>=k:a>=F)&&(y.push(P+1),y.push(E),y.push(1-S))}return x}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:u,nodeSize:h}=this,p=[0,a.length-1,0],y=[],x=o*o;for(;p.length;){const S=p.pop()||0,E=p.pop()||0,A=p.pop()||0;if(E-A<=h){for(let G=A;G<=E;G++)Yw(u[2*G],u[2*G+1],e,n)<=x&&y.push(a[G]);continue}const P=A+E>>1,k=u[2*P],F=u[2*P+1];Yw(k,F,e,n)<=x&&y.push(a[P]),(S===0?e-o<=k:n-o<=F)&&(p.push(A),p.push(P-1),p.push(1-S)),(S===0?e+o>=k:n+o>=F)&&(p.push(P+1),p.push(E),p.push(1-S))}return y}}function uv(i,e,n,o,a,u){if(a-o<=n)return;const h=o+a>>1;Xw(i,e,h,o,a,u),uv(i,e,n,o,h-1,1-u),uv(i,e,n,h+1,a,1-u)}function Xw(i,e,n,o,a,u){for(;a>o;){if(a-o>600){const x=a-o+1,S=n-o+1,E=Math.log(x),A=.5*Math.exp(2*E/3),P=.5*Math.sqrt(E*A*(x-A)/x)*(S-x/2<0?-1:1);Xw(i,e,n,Math.max(o,Math.floor(n-S*A/x+P)),Math.min(a,Math.floor(n+(x-S)*A/x+P)),u)}const h=e[2*n+u];let p=o,y=a;for(ag(i,e,o,n),e[2*a+u]>h&&ag(i,e,o,a);p<y;){for(ag(i,e,p,y),p++,y--;e[2*p+u]<h;)p++;for(;e[2*y+u]>h;)y--}e[2*o+u]===h?ag(i,e,o,y):(y++,ag(i,e,y,a)),y<=n&&(o=y+1),n<=y&&(a=y-1)}}function ag(i,e,n,o){hv(i,n,o),hv(e,2*n,2*o),hv(e,2*n+1,2*o+1)}function hv(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Yw(i,e,n,o){const a=i-n,u=e-o;return a*a+u*u}s.$=Ih,s.A=ql,s.B=Ta,s.C=2,s.D=Np,s.E=fc,s.F=Um,s.G=b1,s.H=Fd,s.I=kr,s.J=Xf,s.K=an,s.L=jc,s.M=Wh,s.N=$h,s.O=Hh,s.P=ct,s.Q=Qc,s.R=$l,s.S=Kh,s.T=vy,s.U=wa,s.V=o_,s.W=Zh,s.X=Nu,s.Y=qc,s.Z=Bh,s._=ys,s.a=function(i){return ri.API_CDN_URL_REGEX.test(i)},s.a$=O,s.a0=Pn,s.a1=ms,s.a2=rl,s.a3=class extends o_{},s.a4=qh,s.a5=Xu,s.a6=Le,s.a7=function(i){const e=i.value;return e?Pn(e)?Yy(e,!0)?[]:[new o_(i.key,e,`invalid url "${e}"`)]:[new o_(i.key,e,`string expected, "${an(e)}" found`)]:[]},s.a8=ls,s.a9=Tr,s.aA=H,s.aB=ot,s.aC=So,s.aD=gr,s.aE=Hi,s.aF=v,s.aG=te,s.aH=function(i,e){const n={};for(let o=0;o<e.length;o++){const a=e[o];a in i&&(n[a]=i[a])}return n},s.aI=c,s.aJ=b,s.aK=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,n,o){const a=this.entries[i]=this.entries[i]||{callbacks:[]};if(a.result){const[u,h]=a.result;return this.scheduler?this.scheduler.add((()=>{o(u,h)}),e):o(u,h),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=n(((u,h)=>{a.result=[u,h];for(const p of a.callbacks)this.scheduler?this.scheduler.add((()=>{p(u,h)}),e):p(u,h);setTimeout((()=>delete this.entries[i]),3e3)}))),()=>{a.result||(a.callbacks=a.callbacks.filter((u=>u!==o)),a.callbacks.length||(a.cancel(),delete this.entries[i]))}}},s.aL=function(i,e,n){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},(a=>{const u=xl(i.request,((h,p,y)=>{h?a(h):p&&a(null,{rawData:p,vectorTile:n?void 0:new Ne(new Gg(p)),responseHeaders:new Map(y.entries())})}));return()=>{u.cancel(),a()}}),e)},s.aM=function(i){return i?{cacheControl:i.get("Cache-Control"),expires:i.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=Ks,s.aO=function(i){Fo++,Fo>bu&&(i.getActor().send("enforceCacheSizeLimit",wh),Fo=0)},s.aP=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log2(i)))},s.aQ=M,s.aR=K1,s.aS=iw,s.aT=r,s.aU=Y1,s.aV=function(i,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const a=document.createElement("source");_m(i[o])||(n.crossOrigin="Anonymous"),a.src=i[o],n.appendChild(a)}return{cancel:()=>{}}},s.aW=Fm,s.aX=gp,s.aY=ze,s.aZ=Wm,s.a_=C,s.aa=Tt,s.ab=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return Fn(i.expression.evaluate(e))}interpolate(i,e,n){return{x:bn(i.x,e.x,n),y:bn(i.y,e.y,n),z:bn(i.z,e.z,n),azimuthal:bn(i.azimuthal,e.azimuthal,n),polar:bn(i.polar,e.polar,n)}}},s.ac=Xi,s.ad=ba,s.ae=ee,s.af=Gi,s.ag=Hn,s.ah=K,s.ai=Jo,s.aj=vf,s.ak=bn,s.al=Pt,s.am=kd,s.an=ti,s.ao=Vi,s.ap=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return(function([n,o]){const a=Fn([1,n,o]);return{x:a.x,y:a.y,z:a.z}})(i.expression.evaluate(e))}interpolate(i,e,n){return{x:bn(i.x,e.x,n),y:bn(i.y,e.y,n),z:bn(i.z,e.z,n)}}},s.aq=function(i,e,n=0,o=!0){const a=new ct(n,n),u=i.sub(a),h=e.add(a),p=[u,new ct(h.x,u.y),h,new ct(u.x,h.y)];return o&&p.push(u.clone()),p},s.ar=function(i,e){const n=[];for(let o=0;o<i.length;o++){const a=se(o-1,-1,i.length-1),u=se(o+1,-1,i.length-1),h=i[o],p=i[u],y=i[a].sub(h).unit(),x=p.sub(h).unit(),S=x.angleWithSep(y.x,y.y),E=y.add(x).unit().mult(-1*e/Math.sin(S/2));n.push(h.add(E))}return n},s.as=D1,s.at=Go,s.au=function(i,e,n=0){return Wt(((e.x-n)*i.scale-i.x)*Pt,(e.y*i.scale-i.y)*Pt,L(e.z,e.y))},s.av=Cr,s.aw=xn,s.ax=Yt,s.ay=Y0,s.az=function(i){let e=1/0,n=1/0,o=-1/0,a=-1/0;for(const u of i)e=Math.min(e,u.x),n=Math.min(n,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y);return{min:new ct(e,n),max:new ct(o,a)}},s.b=function(i){return ri.API_FONTS_REGEX.test(i)},s.b$=Yx,s.b0=Jr,s.b1=ws,s.b2=Pe,s.b3=tp,s.b4=t_,s.b5=function(){Ua.isLoading()||Ua.isLoaded()||mo()!=="deferred"||jo()},s.b6=Jh,s.b7=Re,s.b8=mp,s.b9=xr,s.bA=Be,s.bB=jt,s.bC=st,s.bD=function(i,e){const{x:n,y:o}=i.point,a=Tg(n,o,i.worldSize/i._pixelsPerMercatorPixel,0,0);return ot(a,a,ts(Nn(e)))},s.bE=Me,s.bF=vo,s.bG=jn,s.bH=gn,s.bI=_i,s.bJ=kn,s.bK=qp,s.bL=pl,s.bM=Fy,s.bN=function(i,e,n,o,a){const u=5*e+2;i.float32[u+0]=n,i.float32[u+1]=o,i.float32[u+2]=a},s.bO=Kp,s.bP=Zo,s.bQ=Ro,s.bR=Ra,s.bS=io,s.bT=se,s.bU=function(i,e,n,o){var a=new ae(4);return a[0]=i,a[1]=e,a[2]=n,a[3]=o,a},s.bV=class{isDataAvailableAtPoint(i){const e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;const n=e.getSource().maxzoom,o=1<<n,a=Math.floor(i.x),u=Math.floor((i.x-a)*o),h=Math.floor(i.y*o),p=this.findDEMTileFor(new M(n,a,n,u,h));return!(!p||!p.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const a=o.getSource().maxzoom,u=1<<a,h=Math.floor(i.x),p=i.x-h,y=new M(a,h,a,Math.floor(p*u),Math.floor(i.y*u)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;const S=x.dem,E=1<<x.tileID.canonical.z,A=(p*E-x.tileID.canonical.x)*S.dim,P=(i.y*E-x.tileID.canonical.y)*S.dim,k=Math.floor(A),F=Math.floor(P);return(n?this.exaggeration():1)*bn(bn(S.get(k,F),S.get(k,F+1),P-F),bn(S.get(k+1,F),S.get(k+1,F+1),P-F),A-k)}static getAtTileOffset(i,e,n,o){const a=1<<i.canonical.z;return o?o.pointElevation(e):n?n.getAtPointOrZero(new ee(i.wrap+(i.canonical.x+e.x/Pt)/a,(i.canonical.y+e.y/Pt)/a)):0}static getAtTileOffsetFunc(i,e,n,o){return(a,u,h)=>{const p=this.getAtTileOffset(i,a,u,h),y=o.upVector(i.canonical,a.x,a.y);return Gt(y,y,p*o.upVectorScale(i.canonical,e,n).metersToTile),y}}getForTilePoints(i,e,n,o){if(this.isUsingMockSource())return!1;const a=Jp.create(this,i,o);return!!a&&(e.forEach((u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],n)})),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,o=e.tileID,a=1<<i.canonical.z-o.canonical.z;let u=i.canonical.x/a-o.canonical.x,h=i.canonical.y/a-o.canonical.y,p=0;for(let y=0;y<i.canonical.z-o.canonical.z&&!n.leaves[p];y++){u*=2,h*=2;const x=2*Math.floor(h)+Math.floor(u);p=n.childOffsets[p]+x,u%=1,h%=1}return{min:this.exaggeration()*n.minimums[p],max:this.exaggeration()*n.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,n=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const a of i){const u=this.getMinMaxForTile(a.tileID);u&&(n=Math.min(n,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:n,max:o}:null}},s.bW=kg,s.bX=Ii,s.bY=Lo,s.bZ=Wx,s.b_=rw,s.ba=Cy,s.bb=ry,s.bc=xe,s.bd=Ac,s.be=Dl,s.bf=kt,s.bg=ki,s.bh=Fp,s.bi=Zy,s.bj=function(i,e){const n=vf(e.zoom);if(n===0)return Nn(i);const o=Et(i),a=vn(o),u=v(o.getWest())*e.worldSize,h=v(o.getEast())*e.worldSize,p=b(o.getNorth())*e.worldSize,y=b(o.getSouth())*e.worldSize,x=[u,p,0],S=[h,p,0],E=[u,y,0],A=[h,y,0],P=Xe([],e.globeMatrix);return Gi(x,x,P),Gi(S,S,P),Gi(E,E,P),Gi(A,A,P),a[0]=Lr(a[0],E,n),a[1]=Lr(a[1],A,n),a[2]=Lr(a[2],S,n),a[3]=Lr(a[3],x,n),Kt.fromPoints(a)},s.bk=Bi,s.bl=Xe,s.bm=ii,s.bn=Lr,s.bo=rh,s.bp=Ze,s.bq=Mt,s.br=Ke,s.bs=f_,s.bt=Gg,s.bu=xl,s.bv=function(i,e){const n=[];for(const o in i)o in e||n.push(o);return n},s.bw=Se,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=qr,s.bz=Ce,s.c=uo,s.c$=function(i,e,n){let o=0;for(let a=0;a<2;++a)i[a]>0&&(o+=(i[a]-0)*(i[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},s.c0=Kx,s.c1=Ly,s.c2=M1,s.c3=Uy,s.c4=cv,s.c5=Gt,s.c6=Ca,s.c7=Pa,s.c8=function(i,e,n){n*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(n),y=Math.cos(n);return i[0]=o*y+a*p,i[1]=a*y-o*p,i[2]=u*y+h*p,i[3]=h*y-u*p,i},s.c9=As,s.cA=dn,s.cB=Ri,s.cC=D0,s.cD=m,s.cE=at,s.cF=function(i,e,n,o,a,u,h,p,y){if(y.name==="globe")return at(i,e,new m(n,o,a),!1);const x=Wm({z:n,x:o,y:a},y);return new Kt([(u+x.x/x.scale)*e,e*(x.y/x.scale),h],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),p])},s.cG=function(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},s.cH=function(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},s.cI=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ws[e]},s.cJ=D,s.cK=to,s.cL=ac,s.cM=function(i){const e=Be(new Float64Array(16));ot(e,i.pixelMatrix,i.globeMatrix);const n=[0,Bs,0],o=[0,ua,0];return Gi(n,n,e),Gi(o,o,e),[n[0]>0&&n[0]<=i.width&&n[1]>0&&n[1]<=i.height&&!Y_(i,new r(i.center.lat,90)),o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!Y_(i,new r(i.center.lat,-90))]},s.cN=function(i,e){const{scale:n}=i.tileTransform,o=n*Pt/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return(function(a,u,h){var p=u[1],y=u[2],x=u[3],S=h[0],E=h[1];return a[0]=u[0]*S,a[1]=p*S,a[2]=y*E,a[3]=x*E,a})(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.cO=Fg,s.cP=pi,s.cQ=L0,s.cR=function(i){const e=L0(i,!0);return Me([],[e[0],e[1],e[4],e[5]])},s.cS=Ct,s.cT=Bt,s.cU=tt,s.cV=function(i){const{x:e,y:n}=i.point,{lng:o,lat:a}=i._center;return Tg(e,n,i.worldSize,o,a)},s.cW=sn,s.cX=ro,s.cY=B,s.cZ=Co,s.c_=so,s.ca=ir,s.cb=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.cc=Ti,s.cd=function(i,e,n,o,a){var u=1/Math.tan(e/2);if(i[0]=u/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0){var h=1/(o-a);i[10]=(a+o)*h,i[14]=2*a*o*h}else i[10]=-1,i[14]=-2*o;return i},s.ce=function(i,e,n,o,a,u,h){var p=1/(e-n),y=1/(o-a),x=1/(u-h);return i[0]=-2*p,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+n)*p,i[13]=(a+o)*y,i[14]=(h+u)*x,i[15]=1,i},s.cf=I,s.cg=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},s.ch=fd,s.ci=su,s.cj=Qr,s.ck=ul,s.cl=Ga,s.cm=j1,s.cn=function(){var i=new ae(4);return ae!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},s.co=function(i,e,n){var o=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(n),y=Math.cos(n);return i[0]=o*y+u*p,i[1]=a*y+h*p,i[2]=o*-p+u*y,i[3]=a*-p+h*y,i},s.cp=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.cq=Pr,s.cr=function(i){var e=i[0],n=i[1],o=i[2],a=i[3];return Math.sqrt(e*e+n*n+o*o+a*a)},s.cs=Hs,s.ct=Es,s.cu=w,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Ji,s.d=function(i){return ri.API_TILEJSON_REGEX.test(i)},s.d$=class{constructor(i,e,n,o){this.context=i,this.format=o,this.size=n,this.texture=i.gl.createTexture();const[a,u,h]=this.size,{gl:p}=i;p.bindTexture(p.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&p.texImage3D(p.TEXTURE_3D,0,this.format,a,u,h,0,_y(this.format),yy(this.format),e.data)}bind(i,e){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_3D,this.texture),i!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,i),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},s.d0=function(i){return i*i*i*i*i},s.d1=_,s.d2=45,s.d3=uh,s.d4=function(i,e,n){const o=Math.sqrt(i*i+e*e+n*n),a=o>0?Math.acos(n/o)*co:0;let u=i!==0||e!==0?Math.atan2(-e,-i)*co+90:0;return u<0&&(u+=360),[o,u,a]},s.d5=Wt,s.d6=Fn,s.d7=q,s.d8=nt,s.d9=Kt,s.dA=function(i){return i({pluginStatus:Ko,pluginURL:Va}),Xr.on("pluginStateChange",i),i},s.dB=Ao,s.dC=class extends cl{constructor(i){super(i),this.current=pd}set(i,e,n){if(this.fetchUniformLocation(i,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},s.dD=qa,s.dE=function(i,e,n){const o=vf(n.zoom),a=i.style.map._antialias,u=i.terrain&&i.terrain.exaggeration()>0;return o===0&&!a&&!u},s.dF=function(i){const e=i.pixelsPerMeter,n=e/I(1,i.center.lat),o=Be(new Float64Array(16));return Ke(o,o,[i.point.x,i.point.y,0]),Ct(o,o,[n,n,e]),Float32Array.from(o)},s.dG=Et,s.dH=function(i){const e=D-5;i=H(i,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(ti(i))),3);return Math.round(n*(lc.length-1))},s.dI=function(i,e,n,o){const a=e.getNorth(),u=e.getSouth(),h=e.getWest(),p=e.getEast(),y=1<<i.z,x=p-h,S=a-u,E=x/Nl,A=-S/lc[n],P=[0,E,0,A,0,0,a,h,0];if(i.z>0){const k=180/o;je(P,P,[k/x+1,0,0,0,k/S+1,0,-.5*k/E,.5*k/A,1])}return P[2]=y,P[5]=i.x,P[8]=i.y,P},s.dJ=Nn,s.dK=function(i,e,n){const o=Be(new Float64Array(16)),a=(e/(1<<i)-.5)*Math.PI*2;return Nt(o,n.globeMatrix,a),Float32Array.from(o)},s.dL=Cx,s.dM=en,s.dN=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},s.dO=oe,s.dP=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.dQ=yo,s.dR=lu,s.dS=Ei,s.dT=wr,s.dU=256,s.dV=function(i,e){const n=[0,0,0];return Gi(n,n,Bi(Nn(e.canonical))),Gi(n,n,i),n},s.dW=i=>({u_matrix:new Ga(i),u_texsize:new ul(i),u_pixels_to_tile_units:new aa(i),u_device_pixel_ratio:new Qr(i),u_width_scale:new Qr(i),u_floor_width_scale:new Qr(i),u_image:new fd(i),u_units_to_pixels:new ul(i),u_tile_units_to_pixels:new Qr(i),u_alpha_discard_threshold:new Qr(i),u_trim_offset:new ul(i),u_trim_fade_range:new ul(i),u_trim_color:new uh(i),u_zbias_factor:new Qr(i),u_tile_to_meter:new Qr(i),u_ground_shadow_factor:new su(i),u_pattern_transition:new Qr(i)}),s.dX=i=>({u_matrix:new Ga(i),u_pixels_to_tile_units:new aa(i),u_device_pixel_ratio:new Qr(i),u_width_scale:new Qr(i),u_floor_width_scale:new Qr(i),u_units_to_pixels:new ul(i),u_dash_image:new fd(i),u_gradient_image:new fd(i),u_image_height:new Qr(i),u_texsize:new ul(i),u_tile_units_to_pixels:new Qr(i),u_alpha_discard_threshold:new Qr(i),u_trim_offset:new ul(i),u_trim_fade_range:new ul(i),u_trim_color:new uh(i),u_zbias_factor:new Qr(i),u_tile_to_meter:new Qr(i),u_ground_shadow_factor:new su(i)}),s.dY=i=>({u_camera_to_center_distance:new Qr(i),u_extrude_scale:new aa(i),u_device_pixel_ratio:new Qr(i),u_matrix:new Ga(i),u_inv_rot_matrix:new Ga(i),u_merc_center:new ul(i),u_tile_id:new su(i),u_zoom_transition:new Qr(i),u_up_dir:new su(i),u_emissive_strength:new Qr(i)}),s.dZ=cs,s.d_=rI,s.da=mn,s.db=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},s.dc=z0,s.dd=Ey,s.de=B0,s.df=Yy,s.dg=function(i,e){return i.readFields(iA,{icons:[]},e)},s.dh=zg,s.di=Zp,s.dj=Ny,s.dk=bh,s.dl=tu,s.dm=mr,s.dn=Iu,s.dp=lt,s.dq=function(i){const e=i.indexOf(Ic);return e>=0?i.slice(0,e):i},s.dr=function(i){return i.indexOf(Ic)>=0},s.ds=function(i){const e=i.lastIndexOf(Ic);return e>=0?i.slice(e+1):""},s.dt=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.du=function(i,e,n,o){return i.type==="custom"?new YI(i,e):new tA[i.type](i,e,n,o)},s.dv=yt,s.dw=function(i){const e=i.indexOf(Ic);return e>=0?i.slice(e+1):""},s.dx=class extends mp{constructor(i,e){super(i._vectorTileFeature,i._z,i._x,i._y,i.id),i.state&&(this.state=Object.assign({},i.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=i.source,this.sourceLayer=i.sourceLayer,this.layer=i.layer)}toJSON(){const i=super.toJSON();return i.target=this.target,i.namespace=this.namespace,i}},s.dy=Xr,s.dz=vl,s.e=ri,s.e$=Jt,s.e0=yx,s.e1=(i,e,n,o,a,u)=>{const h=i.transform,p=h.projection.name==="globe";let y;if(u.paint.get("circle-pitch-alignment")==="map")if(p){const S=lu(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([S,0,0,S])}else y=h.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(h.projection),u_matrix:i.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:xo.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:x2,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(p){x.u_inv_rot_matrix=o,x.u_merc_center=a,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=vf(h.zoom);const S=a[0]*Pt,E=a[1]*Pt;x.u_up_dir=h.projection.upVector(new m(0,0,0),S,E)}return x},s.e2=e1,s.e3=_s,s.e4=(i,e,n,o,a,u,h,p,y,x)=>{const S=i.transform,E=S.pitch<15?K0(.07,.7,H((14-S.zoom)/5,0,1)):.07,A=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Q0(i,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:u,u_floor_width_scale:h,u_image:0,u_tile_units_to_pixels:J0(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:n.lut).toArray01(),u_zbias_factor:E,u_tile_to_meter:q(e.tileID.canonical,0),u_ground_shadow_factor:y,u_pattern_transition:x}},s.e5=(i,e,n,o,a,u,h,p,y,x)=>{const S=i.transform,E=S.calculatePixelsToTileUnitsMatrix(e),A=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=S.pitch<15?K0(.07,.7,H((14-S.zoom)/5,0,1)):.07;return{u_matrix:Q0(i,e,n,o),u_pixels_to_tile_units:E,u_device_pixel_ratio:u,u_width_scale:h,u_floor_width_scale:p,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:t1(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:J0(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:n.lut).toArray01(),u_zbias_factor:P,u_tile_to_meter:q(e.tileID.canonical,0),u_ground_shadow_factor:x}},s.e6=Ge,s.e7=bm,s.e8=L,s.e9=W,s.eA=function(i,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>he?(i[0]=e[0]/o,i[1]=e[1]/o,i[2]=e[2]/o):(i[0]=1,i[1]=0,i[2]=0),n},s.eB=Qy,s.eC=jg,s.eD=Ng,s.eE=[1,1,1],s.eF=Jp,s.eG=Gs,s.eH=function(i,e,n,o){var a=e[0],u=e[1],h=e[2],p=e[3];return i[0]=a+o*(n[0]-a),i[1]=u+o*(n[1]-u),i[2]=h+o*(n[2]-h),i[3]=p+o*(n[3]-p),i},s.eI=Gp,s.eJ=sa,s.eK=al,s.eL=function(i,e,n,o,a,u,h,p,y,x,S,E,A,P,k,F){var G=new ae(16);return G[0]=i,G[1]=e,G[2]=n,G[3]=o,G[4]=a,G[5]=u,G[6]=h,G[7]=p,G[8]=y,G[9]=x,G[10]=S,G[11]=E,G[12]=A,G[13]=P,G[14]=k,G[15]=F,G},s.eM=l,s.eN=Mc,s.eO=ff,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ct(1/0,1/0),max:new ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){const n=Zx(new ct(0,0),new ct(Pt,Pt),i),o=[];if(e&&!oy(n,this._globalClipBounds))return o;for(const a of this._activeRegions){if(a.hiddenByOverlap||!oy(n,a))continue;const u=X2(a.min,a.max,i);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return o}setSources(i){this._setSources(i.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const o of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(o).buckets[e.layer];a&&a.updateFootprints(o.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(i){const e=i.getFootprints();if(e.length===0)return;const n=i.getOrder(),o=i.getClipMask(),a=i.getClipScope();for(const u of e){if(!u.footprint)continue;const h=Zx(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:n,clipMask:o,clipScope:a})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,n)=>e.priority-n.priority||Cg(e.min,n.min)||Cg(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||(function(o,a){const u=(h,p)=>h+p;return o.length-a.length||o.reduce(u,"").localeCompare(a.reduce(u,""))})(e.clipScope,n.clipScope)));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){const n=this._activeRegions[e],o=this._prevRegions[e];i=n.priority!==o.priority||!qx(n,o)||n.order!==o.order||n.clipMask!==o.clipMask||!qr(n.clipScope,o.clipScope),this._activeRegions[e].hiddenByOverlap=o.hiddenByOverlap,++e}}if(i){++this._updateTime;for(const n of this._activeRegions)n.order!==Cm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const o=this._activeRegions;if(n>=o.length)return n;const a=o[n].priority;for(;n<o.length&&o[n].priority===a;)++n;return n};if(this._sourceIds.length>1){let n=0,o=e(n);for(;n!==o;){let a=n;const u=n;for(;a!==o;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let p=0;p<u;p++){const y=this._activeRegions[p];if(!y.hiddenByOverlap&&h.order===Cm&&oy(h,y)&&(h.hiddenByOverlap=Xx(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++a}n=o,o=e(n)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},s.eQ=Cm,s.eR=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){const n=new Ac,o=new Jr,a=[],u=i+1+2,h=e[0]+1,p=e[0]+1+(1+e.length),y=(x,S,E)=>{let A=x===u-1?x-2:x===0?x:x-1;return A+=E?24575:0,[A,S]};for(let x=0;x<u;++x)n.emplaceBack(...y(x,0,!0));for(let x=0;x<h;++x)for(let S=0;S<u;++S)n.emplaceBack(...y(S,x,(S===0||S===u-1)&&!0));for(let x=0;x<e.length;++x){const S=e[x];for(let E=0;E<u;++E)n.emplaceBack(...y(E,S,!0))}for(let x=0;x<e.length;++x){const S=o.length,E=e[x]+1+2,A=new Jr;for(let F=0;F<E-1;F++){const G=F===E-2,U=G?u*(p-e.length+x-F):u;for(let Y=0;Y<u-1;Y++){const Q=F*u+Y;F===0||G||Y===0||Y===u-2?(A.emplaceBack(Q+1,Q,Q+U),A.emplaceBack(Q+U,Q+U+1,Q+1)):(o.emplaceBack(Q+1,Q,Q+U),o.emplaceBack(Q+U,Q+U+1,Q+1))}}const P=ki.simpleSegment(0,S,n.length,o.length-S);for(let F=0;F<A.uint16.length;F+=3)o.emplaceBack(A.uint16[F],A.uint16[F+1],A.uint16[F+2]);const k=ki.simpleSegment(0,S,n.length,o.length-S);a.push({withoutSkirts:P,withSkirts:k})}return{vertices:n,indices:o,segments:a}}_createGrid(i){const e=this._fillGridMeshWithLods(Nl,lc);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,kt.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){const e=new Jr;for(let h=0;h<=Nl;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const n=new Cc,o=new Cc,a=new Cc,u=new Cc;this._poleSegments=[];for(let h=0,p=0;h<so;h++){const y=360/(1<<h);n.emplaceBack(0,-gr,0,.5,0),o.emplaceBack(0,-gr,0,.5,1),a.emplaceBack(0,-gr,0,.5,.5),u.emplaceBack(0,-gr,0,.5,.5);for(let x=0;x<=Nl;x++){let S=x/Nl,E=0;const A=bn(0,y,S),[P,k,F]=dl(y2,v2,A,gr);n.emplaceBack(P,k,F,S,E),o.emplaceBack(P,k,F,S,1-E);const G=ti(A);S=.5+.5*Math.sin(G),E=.5+.5*Math.cos(G),a.emplaceBack(P,k,F,S,E),u.emplaceBack(P,k,F,S,1-E)}this._poleSegments.push(ki.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,Fe,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,Fe,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(a,Fe,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(u,Fe,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},s.eS=Hx,s.eT=Lc,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=De,s.eW=Z,s.eX=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},s.eY=Is,s.eZ=Uo,s.e_=cn,s.ea=Rg,s.eb=h0,s.ec=_d,s.ed=t0,s.ee=e0,s.ef=j,s.eg=function(i,e){if(i===e){var n=e[1],o=e[2],a=e[3],u=e[6],h=e[7],p=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=n,i[6]=e[9],i[7]=e[13],i[8]=o,i[9]=u,i[11]=e[14],i[12]=a,i[13]=h,i[14]=p}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},s.eh=XI,s.ei=ni,s.ej=cd,s.ek=256,s.el=ts,s.em=Fs,s.en=Nt,s.eo=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.ep=Cc,s.eq=na,s.er=sd,s.es=function(i,e,n,o,a){return H((i-e)/(n-e)*(a-o)+o,o,a)},s.et=Cs,s.eu=function(i,e){var n=e[0],o=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],x=e[7],S=e[8],E=S*h-p*x,A=-S*u+p*y,P=x*u-h*y,k=n*E+o*A+a*P;return k?(i[0]=E*(k=1/k),i[1]=(-S*o+a*x)*k,i[2]=(p*o-a*h)*k,i[3]=A*k,i[4]=(S*n-a*y)*k,i[5]=(-p*n+a*u)*k,i[6]=P*k,i[7]=(-x*n+o*y)*k,i[8]=(h*n-o*u)*k,i):null},s.ev=2,s.ew=wn,s.ex=Ma,s.ey=Kn,s.ez=function(i,e){var n=new ae(3);Kn(n,e);var o=1/n[0],a=1/n[1],u=1/n[2],h=e[0]*o,p=e[1]*a,y=e[2]*u,x=e[4]*o,S=e[5]*a,E=e[6]*u,A=e[8]*o,P=e[9]*a,k=e[10]*u,F=h+S+k,G=0;return F>0?(G=2*Math.sqrt(F+1),i[3]=.25*G,i[0]=(E-P)/G,i[1]=(A-y)/G,i[2]=(p-x)/G):h>S&&h>k?(G=2*Math.sqrt(1+h-S-k),i[3]=(E-P)/G,i[0]=.25*G,i[1]=(p+x)/G,i[2]=(A+y)/G):S>k?(G=2*Math.sqrt(1+S-h-k),i[3]=(A-y)/G,i[0]=(p+x)/G,i[1]=.25*G,i[2]=(E+P)/G):(G=2*Math.sqrt(1+k-h-S),i[3]=(p-x)/G,i[0]=(A+y)/G,i[1]=(E+P)/G,i[2]=.25*G),i},s.f=function(i){return btoa(encodeURIComponent(i).replace(/%([0-9A-F]{2})/g,((e,n)=>String.fromCharCode(+("0x"+n)))))},s.f0=function([i,e,n]){const o=Math.hypot(i,e,n),a=Math.atan2(i,n),u=.5*Math.PI-Math.acos(-e/o);return new r(ro(a),ro(u))},s.f1=ds,s.f2=xy,s.f3=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!(function(n){if(Rr==null){const o=n.navigator?n.navigator.userAgent:null;Rr=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Rr})(i)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(i,e){wh=i,bu=e},s.f5=Y_,s.f6=gx,s.f7=function(i){const e=[0,0,0],n=Be(new Float64Array(16));return ot(n,i.pixelMatrix,i.globeMatrix),Gi(e,e,n),new ct(e[0],e[1])},s.f8=function(){const i=Lm;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(hy),Lm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){zg().acquire(hy)},s.fA=d_,s.fB=Ae,s.fC=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==C0){const n=new Uint32Array(i,0,7),[,,o,a,u,h]=n;e=n.byteLength+a+u+h+u,(o!==i.byteLength||e>=i.byteLength)&&$t("Invalid b3dm header information.")}return k0(i,e)},s.fD=function(i,e){const n=Ey(i);for(const o of n){for(const a of o.meshes)IE(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(AE(o.lights,e)))}return n},s.fE=s_,s.fF=xi,s.fG=T0,s.fH=Ua,s.fI=as,s.fJ=function(i){Xs(),Za?.then((e=>{e.keys().then((n=>{for(let o=0;o<n.length-i;o++)e.delete(n[o]).catch((a=>$t(a.message)))})).catch((n=>$t(n.message)))})).catch((e=>$t(e.message)))},s.fa=mo,s.fb=function(i,e,n=!1){if(Ko===as.deferred||Ko===as.loading||Ko===as.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Va=xo.resolveURL(i),Ko=as.deferred,Yh=e,zl(),n||jo()},s.fc=function(i){jp=xo.resolveURL(i),Vp||(Vp=new Np(zg(),new fc)),Vp.broadcast("setMeshoptUrl",jp)},s.fd=I0,s.fe=function(i){py=xo.resolveURL(i),Vp||(Vp=new Np(zg(),new fc)),Vp.broadcast("setDracoUrl",py)},s.ff=E0,s.fg=zm,s.fh=function(i){const e=da();if(!e)return;const n=e.delete(xh);i&&n.then((()=>i())).catch(i)},s.fi=up,s.fj=qt,s.fk=xf,s.fl=hu,s.fm=Hw,s.fn=Ww,s.fo=q0,s.fp=We,s.fq="hd_road_elevation",s.fr=Ai,s.fs=Ve,s.ft=gd,s.fu=By,s.fv=fp,s.fw=function(i,e,n,o,a,u,h,p=1,y,x,S){i.createArrays(),i.tilePixelRatio=Pt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const E=i.layers[0].layout,A=i.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=p,P.textSizeScaleRange=E.get("text-size-scale-range"),P.iconSizeScaleRange=E.get("icon-size-scale-range");const[k,F]=P.textSizeScaleRange,[G,U]=P.iconSizeScaleRange;P.textScaleFactor=H(P.scaleFactor,k,F),P.iconScaleFactor=H(P.scaleFactor,G,U);const Y=A["text-size"],Q=A["icon-size"];if(i.textSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:qe}=i.textSizeData;P.compositeTextSizes=[Y.possiblyEvaluate(new Xi(Ie,{worldview:S}),u),Y.possiblyEvaluate(new Xi(qe,{worldview:S}),u)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:qe}=i.iconSizeData;P.compositeIconSizes=[Q.possiblyEvaluate(new Xi(Ie,{worldview:S}),u),Q.possiblyEvaluate(new Xi(qe,{worldview:S}),u)]}P.layoutTextSize=Y.possiblyEvaluate(new Xi(h+1,{worldview:S}),u),P.layoutIconSize=Q.possiblyEvaluate(new Xi(h+1,{worldview:S}),u),P.textMaxSize=Y.possiblyEvaluate(new Xi(18,{worldview:S}),u);const ne=E.get("symbol-placement"),me=E.get("text-rotation-alignment")==="map"&&ne!=="point",de=E.get("text-size");let ve=!1;const Te=[];for(const Ie of i.features){const qe=E.get("text-font").evaluate(Ie,{},u).join(","),ke=de.evaluate(Ie,{},u)*P.textScaleFactor,Qe=P.layoutTextSize.evaluate(Ie,{},u)*P.textScaleFactor,ut=P.layoutIconSize.evaluate(Ie,{},u)*P.iconScaleFactor,ht={horizontal:{},vertical:void 0},gt=Ie.text;let vt,ft=[0,0];if(gt){const qn=gt.toString(),Yi=E.get("text-letter-spacing").evaluate(Ie,{},u)*Lo,fe=E.get("text-line-height").evaluate(Ie,{},u)*Lo,_e=eu(qn)?Yi:0,et=E.get("text-anchor").evaluate(Ie,{},u),_t=E.get("text-variable-anchor");if(!_t){const $n=E.get("text-radial-offset").evaluate(Ie,{},u);if($n)ft=M1(et,[$n*Lo,Vy]);else{const Xn=E.get("text-offset").evaluate(Ie,{},u);ft=[Xn[0]*Lo,Xn[1]*Lo]}}let Ot=me?"center":E.get("text-justify").evaluate(Ie,{},u);const Ft=ne==="point",fn=Ft?E.get("text-max-width").evaluate(Ie,{},u)*Lo:1/0,pn=$n=>{i.allowVerticalPlacement&&oa(qn)&&(ht.vertical=zy(gt,e,n,a,qe,fn,fe,et,$n,_e,ft,pl.vertical,!0,Qe,ke,y))};if(!me&&_t){const $n=Ot==="auto"?_t.map((Jn=>Uy(Jn))):[Ot];let Xn=!1;for(let Jn=0;Jn<$n.length;Jn++){const di=$n[Jn];if(!ht.horizontal[di])if(Xn)ht.horizontal[di]=ht.horizontal[0];else{const Cn=zy(gt,e,n,a,qe,fn,fe,"center",di,_e,ft,pl.horizontal,!1,Qe,ke,y);Cn&&(ht.horizontal[di]=Cn,Xn=Cn.positionedLines.length===1)}}pn("left")}else{if(Ot==="auto"&&(Ot=Uy(et)),Ft||E.get("text-writing-mode").indexOf("horizontal")>=0||!oa(qn)){const $n=zy(gt,e,n,a,qe,fn,fe,et,Ot,_e,ft,pl.horizontal,!1,Qe,ke,y);$n&&(ht.horizontal[Ot]=$n)}pn(Ft?"left":Ot)}}let pt,Je,Ye,mt,zt,St,hn=!1;const Vt=E.get("icon-text-fit").evaluate(Ie,{},u);if(Ie.icon&&Ie.icon.hasPrimary()){const qn=$m(Ie.icon,i.iconSizeData,A["icon-size"],u,i.zoom,Ie,y,P.iconScaleFactor,S);pt=qn.iconPrimary,Ye=qn.iconSecondary;const Yi=pt.toString();if(Je=o.get(Yi),Je&&(zt=E.get("icon-offset").evaluate(Ie,{},u),St=E.get("icon-anchor").evaluate(Ie,{},u),vt=Hg(a.get(Yi),Ye?a.get(Ye.toString()):void 0,zt,St),hn=Je.sdf,i.sdfIcons===void 0?i.sdfIcons=Je.sdf:i.sdfIcons!==Je.sdf&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==i.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0)),Ye){const fe=Ye.toString();mt=o.get(fe)}}ve=ve||!(!Ie.icon||!Ie.icon.hasSecondary());const Zt=Yg(ht.horizontal)||ht.vertical;i.iconsInText||(i.iconsInText=!!Zt&&Zt.iconsInText);const nn=Qe*P.textScaleFactor/Lo,{defaultShapedIcon:Qn,verticallyShapedIcon:It}=DI(i,vt,E,Ie,u,ht,nn,zt,Vt);Vt!=="none"&&vt&&(p1(vt)||m1(vt))&&(Xg(0,Je,pt,vt,Qn,Vt,x,o,a),Xg(0,mt,Ye,vt,Qn,Vt,x,o,a),It&&(Xg(0,Je,pt,vt,It,Vt,x,o,a),Xg(0,mt,Ye,vt,It,Vt,x,o,a))),vt=Qn;const{iconBBox:on,iconVerticalBBox:Dn,textBBox:gi,textVerticalBBox:bi}=PI(i,vt,It,E,Ie,u,ut,zt,P,a,St,ht,Qe,ft);Te.push({feature:Ie,shapedTextOrientations:ht,shapedText:Zt,shapedIcon:vt,iconPrimary:pt,iconSecondary:Ye,iconOffset:zt,iconAnchor:St,verticallyShapedIcon:It,layoutTextSize:Qe,layoutIconSize:ut,textOffset:ft,isSDFIcon:hn,iconTextFit:Vt,iconCollisionBounds:on,iconVerticalCollisionBounds:Dn,textCollisionBounds:gi,textVerticalCollisionBounds:bi})}return{featureData:Te,sizes:P,hasAnySecondaryIcon:ve,textAlongLine:me,symbolPlacement:ne}},s.fx=T1,s.fy=function(i,e,n,o,a,u,h,p,y,x){i.iconAtlasPositions=x.iconPositions;const{featureData:S,hasAnySecondaryIcon:E,sizes:A,textAlongLine:P,symbolPlacement:k}=e;for(const F of S){const{shapedIcon:G,verticallyShapedIcon:U,feature:Y,shapedTextOrientations:Q,shapedText:ne,layoutTextSize:me,textOffset:de,isSDFIcon:ve,iconPrimary:Te,iconSecondary:Ie,iconTextFit:qe,iconOffset:ke,iconCollisionBounds:Qe,iconVerticalCollisionBounds:ut,textCollisionBounds:ht}=F;R1(G,x.iconPositions,Te,Ie),R1(U,x.iconPositions,Te,Ie),LI(Q,x.iconPositions),zI(Te,Ie,x.iconPositions),(ne||G)&&OI(i,Y,Q,G,U,y,A,me,0,de,ve,o,a,h,p,E,qe,ke,P,k,Qe,ut,ht)}n&&i.generateCollisionDebugBuffers(u,i.collisionBoxArray,A.textScaleFactor)},s.fz=Ne,s.g=function(i,e){return vl(Object.assign(i,{method:"GET"}),e)},s.h=function(i){return i.indexOf("mapbox:")===0},s.i=function(i){return ri.API_STYLE_REGEX.test(i)&&!uo(i)},s.j=br,s.k=ns,s.l=function(i){return decodeURIComponent(atob(i).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},s.m=function(i,e){return vl(Object.assign(i,{type:"json"}),e)},s.n=Oc,s.o=xo,s.p=function(i,e){return vl(Object.assign(i,{method:"POST"}),e)},s.q=Ss,s.r=Zs,s.s=function(i){try{const e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return dy||(dy=new up("ImageRasterizer")),dy},s.u=function(){return(function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)})()},s.v=function(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)},s.w=$t,s.x=ov,s.y=Au,s.z=fa})),J(["./shared"],(function(s){function he(De){const H=De?De.url.toString():void 0;return H?performance.getEntriesByName(H):[]}function ae(De){if(typeof De=="number"||typeof De=="boolean"||typeof De=="string"||De==null)return JSON.stringify(De);if(Array.isArray(De)){let K="[";for(const se of De)K+=`${ae(se)},`;return`${K}]`}let H="{";for(const K of Object.keys(De).sort())H+=`${K}:${ae(De[K])},`;return`${H}}`}function Me(De){let H="";for(const K of s.bx)H+=`/${ae(De[K])}`;return H}class oe{constructor(H){this.keyCache={},this._layers={},this._layerConfigs={},H&&this.replace(H)}replace(H,K){this._layerConfigs={},this._layers={},this.update(H,[],K)}update(H,K,se){this._options=se;for(const we of H)this._layerConfigs[we.id]=we,(this._layers[we.id]=s.du(we,this.scope,null,this._options)).compileFilter(se),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of K)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const Se=(function(we,Pe){const Ge={};for(let Ve=0;Ve<we.length;Ve++){const yt=we[Ve];let lt=Pe&&Pe[yt.id];lt||(yt.type==="symbol"?lt=yt.id:(lt=Me(yt),yt.type==="line"&&yt.paint&&(function Qt($t){return typeof $t=="string"&&$t==="line-progress"||(Array.isArray($t)?$t.some(Qt):!(!$t||typeof $t!="object")&&Object.values($t).some(Qt))})(yt.paint["line-width"])&&(lt+=`/${ae(yt.paint["line-width"])}`))),Pe&&(Pe[yt.id]=lt);let Xt=Ge[lt];Xt||(Xt=Ge[lt]=[]),Xt.push(yt)}const ze=[];for(const Ve in Ge)ze.push(Ge[Ve]);return ze})(Object.values(this._layerConfigs),this.keyCache);for(const we of Se){const Pe=we.map((Xt=>this._layers[Xt.id])),Ge=Pe[0];if(Ge.visibility==="none")continue;const ze=Ge.source||"";let Ve=this.familiesBySource[ze];Ve||(Ve=this.familiesBySource[ze]={});const yt=Ge.sourceLayer||"_geojsonTileLayer";let lt=Ve[yt];lt||(lt=Ve[yt]=[]),lt.push(Pe)}}}const Oe=1*s.fl;class je{constructor(H){const K={},se=[];for(const Ge in H){const ze=H[Ge],Ve=K[Ge]={};for(const yt in ze.glyphs){const lt=ze.glyphs[+yt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Xt=lt.metrics.localGlyph?Oe:1,Qt={x:0,y:0,w:lt.bitmap.width+2*Xt,h:lt.bitmap.height+2*Xt};se.push(Qt),Ve[yt]=Qt}}const{w:Se,h:we}=s.G(se),Pe=new s.fk({width:Se||1,height:we||1});for(const Ge in H){const ze=H[Ge];for(const Ve in ze.glyphs){const yt=ze.glyphs[+Ve];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const lt=K[Ge][Ve],Xt=yt.metrics.localGlyph?Oe:1;s.fk.copy(yt.bitmap,Pe,{x:0,y:0},{x:lt.x+Xt,y:lt.y+Xt},yt.bitmap)}}this.image=Pe,this.positions=K}}function st(De,H,K){De[H]?K&&(De[H].center=K):De[H]={floorIds:new Set,center:K||[0,0],floors:{}}}function Ce(De,H,K,se){for(const Se of H)st(De,Se),De[Se].floors[K]=se,De[Se].floorIds.add(K)}function Be(De){return{id:De.properties.id.toString(),center:De.properties.center.toString().split(";").map(Number)}}function Xe(De){return{id:De.properties.id.toString(),isDefault:!!De.properties.is_default&&De.properties.is_default,connections:De.properties.connected_floor_ids?new Set(De.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:De.properties.conflicted_floor_ids?new Set(De.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:De.properties.building_ids?new Set(De.properties.building_ids.toString().split(";")):new Set,name:De.properties.name.toString(),zIndex:De.properties.z_index}}function ot(De,H){return H.every((K=>De.properties&&De.properties[K]!=null))}function Ke(De){return ot(De,["type","id","name"])&&De.properties.type==="building"}function Ct(De){return ot(De,["type","id","name","z_index"])&&De.properties.type==="floor"}s.fj(je,"GlyphAtlas");class tt{constructor(H){this.tileID=new s.aQ(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.lut=H.lut,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.scope=H.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.request&&H.request.collectResourceTiming,this.promoteId=H.promoteId,this.isSymbolTile=H.isSymbolTile,this.tileTransform=s.aZ(H.tileID.canonical,H.projection),this.projection=H.projection,this.worldview=H.worldview,this.localizableLayerIds=H.localizableLayerIds,this.brightness=H.brightness,this.extraShadowCaster=!!H.extraShadowCaster,this.tessellationStep=H.tessellationStep,this.scaleFactor=H.scaleFactor,this.worldview=H.worldview,this.indoor=H.indoor}parse(H,K,se,Se,we,Pe){this.status="parsing",this.data=H,this.collisionBoxArray=new s.b3;const Ge=new s.fm(Object.keys(H.layers).sort()),ze=new s.fn(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Ve={},yt=new s.fo(256,256),lt={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:yt,availableImages:se,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Vn=this.indoor.indoorState.activeFloorsVisible,Un=(function(Fn,xi,xr){const Rr=(function(Zi,Ei){if(!Zi)return s.w("No source layers defined in indoor specification"),Ei;if(Zi.size===0)return Ei;const wr=Zi.difference(Ei);for(const Qi of wr)s.w(`Missing source layer required in indoor specification: ${Qi}`);return Ei.intersection(Ei)})(xi.sourceLayers,new Set(Object.keys(Fn.layers))),ir=xi.indoorState,Kr=(function(Zi,Ei,wr,Qi){const ri=new Set,br=new Set,uo=new Set,Io=new Map,Rs={},Dc=ho=>{const qs=Io.get(ho)||new Set;for(const Oo of ri)if((Io.get(Oo)||new Set).has(ho)||qs.has(Oo))return!0;return!1};for(const ho of Ei){const qs=Zi.layers[ho];if(qs)for(let Oo=0;Oo<qs.length;Oo++){const Zs=qs.feature(Oo);if(Ke(Zs)){const{id:xo,center:Gl}=Be(Zs);st(Rs,xo,Gl),ri.add(xo)}else if(Ct(Zs)){const{id:xo,isDefault:Gl,connections:mr,conflicts:xh,buildings:wh,name:bu,zIndex:Tu}=Xe(Zs);Ce(Rs,wh,xo,{name:bu,zIndex:Tu}),Io.set(xo,xh),(xo===Qi||mr.has(Qi))&&ri.add(xo),br.add(xo),Gl&&uo.add(xo)}}else s.w(`indoor source layer not found: ${ho}`)}if(wr)for(const ho of wr)br.has(ho)&&(Dc(ho)||ri.add(ho));for(const ho of uo)ri.has(ho)||Dc(ho)||ri.add(ho);return{buildings:Rs,activeFloors:ri}})(Fn,Rr,ir.lastActiveFloors,ir.selectedFloorId);return xr.send("setIndoorData",Kr),Kr})(H,this.indoor,we);lt.activeFloors=Vn?Un.activeFloors:void 0}const Xt=[],Qt=K.familiesBySource[this.source];for(const Vn in Qt){const Un=H.layers[Vn];if(!Un)continue;let Fn=!1,xi=!1,xr=!1;for(const Ei of Qt[Vn])Ei[0].type==="symbol"?Fn=!0:xi=!0,Ei[0].is3D()&&Ei[0].type!=="model"&&(xr=!0);if(this.extraShadowCaster&&!xr||this.isSymbolTile===!0&&!Fn||this.isSymbolTile===!1&&!xi)continue;Un.version===1&&s.w(`Vector tile source "${this.source}" layer "${Vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Rr=Ge.encode(Vn),ir=[],Kr=this.localizableLayerIds&&this.localizableLayerIds.has(Vn);let Zi=!1;for(let Ei=0,wr=0;Ei<Un.length;Ei++){const Qi=Un.feature(Ei),ri=ze.getId(Qi,Vn),br=Qi.properties?Qi.properties.worldview:null;if(Kr&&this.worldview&&typeof br=="string")if(br==="all")Qi.properties.$localized=!0;else{if(!br.split(",").includes(this.worldview))continue;Qi.properties.$localized=!0,Qi.properties.worldview=this.worldview}!Zi&&Qi.properties&&Qi.properties.hasOwnProperty(s.fp)&&(Zi=!0),ir.push({feature:Qi,id:ri,index:wr,sourceLayerIndex:Rr}),wr++}Zi&&!lt.elevationFeatures&&H.layers.hasOwnProperty(s.fq)&&(lt.elevationFeatures=s.fr.parseFrom(H.layers[s.fq],this.canonical));for(const Ei of Qt[Vn]){const wr=Ei[0];if(this.extraShadowCaster&&(!wr.is3D()||wr.type==="model")||this.isSymbolTile!==void 0&&wr.type==="symbol"!==this.isSymbolTile||wr.minzoom&&this.zoom<Math.floor(wr.minzoom)||wr.maxzoom&&this.zoom>=wr.maxzoom||wr.visibility==="none")continue;Nt(Ei,this.zoom,lt.brightness,se,this.worldview);const Qi=Ve[wr.id]=wr.createBucket({index:ze.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Rr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Se,worldview:this.worldview,localizable:Kr});ze.bucketLayerIDs.push(Ei.map((br=>s.B(br.id,br.scope))));let ri=Qi.prepare?Qi.prepare():null;ri!=null?(ri=ri.then((()=>Qi.populate(ir,lt,this.tileID.canonical,this.tileTransform))),Xt.push(ri)):Qi.populate(ir,lt,this.tileID.canonical,this.tileTransform)}}const $t=()=>{let Vn,Un,Fn,xi,xr,Rr;yt.trim();const ir={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Kr=()=>{if(Vn)return this.status="done",Pe(Vn);if(this.extraShadowCaster)this.status="done",Pe(null,{buckets:Object.values(Ve).filter((Ei=>!Ei.isEmpty())),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Un&&Fn&&xi){const Ei=new je(Un),wr=new Map;for(const[br,uo]of Fn.entries()){const{imagePosition:Io}=s.fu(br,uo,s.fv);wr.set(br,Io)}const Qi={};for(const br in Ve){const uo=Ve[br];uo instanceof s.b4&&(Nt(uo.layers,this.zoom,lt.brightness,se,this.worldview),Qi[br]=s.fw(uo,Un,Ei.positions,Fn,wr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,xr,this.worldview))}const ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,Fn,xr,(()=>{ri.iconsPending=!1,Zi(Qi,Ei,ri)})),this.rasterizeIfNeeded(we,xi,Rr,(()=>{ri.patternsPending=!1,Zi(Qi,Ei,ri)}))}},Zi=(Ei,wr,Qi,ri)=>{if(Qi.iconsPending||Qi.patternsPending)return;const br=new s.fx(Fn,xi,this.lut);for(const uo in Ve){const Io=Ve[uo];if(uo in Ei)s.fy(Io,Ei[uo],this.showCollisionBoxes,se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Fn,br);else if(Io.hasPattern&&(Io instanceof s.ba||Io instanceof s.bb||Io instanceof s.ea)){Nt(Io.layers,this.zoom,lt.brightness,se,this.worldview);const Rs=Object.fromEntries(br.patternPositions);Io.addFeatures(lt,this.tileID.canonical,Rs,se,this.tileTransform,this.brightness)}}this.status="done",Pe(null,{buckets:Object.values(Ve).filter((uo=>!uo.isEmpty())),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wr.image,lineAtlas:yt,imageAtlas:br,brightness:lt.brightness})};if(!this.extraShadowCaster){const Ei=s.fs(lt.glyphDependencies,(ri=>Object.keys(ri).map(Number)));Object.keys(Ei).length?we.send("getGlyphs",{uid:this.uid,stacks:Ei},((ri,br)=>{Vn||(Vn=ri,Un=br,Kr())}),void 0,!1,ir):Un={};const wr=Array.from(lt.iconDependencies.keys()).map((ri=>s.I.parse(ri)));wr.length?we.send("getImages",{images:wr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((ri,br)=>{Vn||(Vn=ri,Fn=new Map,xr=this.updateImageMapAndGetImageTaskQueue(Fn,br,lt.iconDependencies),Kr())}),void 0,!1,ir):(Fn=new Map,xr=new Map);const Qi=Array.from(lt.patternDependencies.keys()).map((ri=>s.I.parse(ri)));Qi.length?we.send("getImages",{images:Qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((ri,br)=>{Vn||(Vn=ri,xi=new Map,Rr=this.updateImageMapAndGetImageTaskQueue(xi,br,lt.patternDependencies),Kr())}),void 0,!1,ir):(xi=new Map,Rr=new Map)}if(lt.elevationFeatures&&lt.elevationFeatures.length>0){const Ei=[];for(const Qi of Object.values(Ve))if(Qi instanceof s.bb){const ri=Qi.getUnevaluatedPortalGraph();ri&&Ei.push(ri)}const wr=s.ft.evaluate(Ei);for(const Qi of Object.values(Ve))if(Qi instanceof s.bb){const ri=H.layers[Ge.decode(Qi.sourceLayerIndex)];Qi.setEvaluatedPortalGraph(wr,ri,this.tileID.canonical,lt.availableImages,lt.brightness)}}Kr()};Xt.length>0?Promise.allSettled(Xt).then($t).catch(Pe):$t()}updateParameters(H){this.scaleFactor=H.scaleFactor,this.showCollisionBoxes=H.showCollisionBoxes,this.projection=H.projection,this.brightness=H.brightness,this.tileTransform=s.aZ(H.tileID.canonical,H.projection),this.extraShadowCaster=H.extraShadowCaster,this.lut=H.lut,this.worldview=H.worldview,this.indoor=H.indoor}rasterizeIfNeeded(H,K,se,Se){Array.from(K.values()).some((we=>we.usvg))?this.rasterize(H,K,se,Se):Se()}updateImageMapAndGetImageTaskQueue(H,K,se){const Se=new Map;for(const we of K.keys()){const Pe=se.get(we)||[];for(const Ge of Pe){const ze=Ge.toString(),Ve=K.get(Ge.id.toString());Ve.usvg?Se.has(ze)||(Se.set(ze,Ge),H.set(ze,Object.assign({},Ve))):H.set(ze,Ve)}}return Se}rasterize(H,K,se,Se){this.rasterizeTask=H.send("rasterizeImages",{scope:this.scope,tasks:se},((we,Pe)=>{if(!we)for(const[Ge,ze]of Pe.entries()){const Ve=Object.assign(K.get(Ge),{data:ze});K.set(Ge,Ve)}Se()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Nt(De,H,K,se,Se){const we=new s.ac(H,{brightness:K,worldview:Se});for(const Pe of De)Pe.recalculate(we,se)}class jt extends s.E{constructor(H,K,se,Se,we,Pe,Ge){super(),this.actor=H,this.layerIndex=K,this.availableImages=se,this.availableModels=Se,this.loadVectorData=Pe||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(H.scheduler),this.isSpriteLoaded=we,this.scheduler=H.scheduler,this.brightness=Ge}loadTile(H,K){const se=H.uid,Se=H&&H.request,we=Se&&Se.collectResourceTiming,Pe=this.loading[se]=new tt(H);Pe.abort=this.loadVectorData(H,((Ge,ze)=>{const Ve=!this.loading[se];if(delete this.loading[se],Pe.cancelRasterize(),Ve||Ge||!ze)return Pe.status="done",Ve||(this.loaded[se]=Pe),K(Ge);const yt=ze.rawData,lt={},Xt=s.aM(ze.responseHeaders);Xt&&Xt.expires&&(lt.expires=Xt.expires),Xt&&Xt.cacheControl&&(lt.cacheControl=Xt.cacheControl),Pe.vectorTile=ze.vectorTile||new s.fz(new s.bt(yt));const Qt=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(($t,Vn)=>{if($t||!Vn)return K($t);const Un={};if(we){const Fn=he(Se);Fn.length>0&&(Un.resourceTiming=JSON.parse(JSON.stringify(Fn)))}K(null,Object.assign({rawTileData:yt.slice(0),responseHeaders:ze.responseHeaders},Vn,lt,Un))}))};this.isSpriteLoaded?Qt():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Qt,{type:"parseTile",isSymbolTile:H.isSymbolTile,zoom:H.tileZoom}):Qt()})),this.loaded=this.loaded||{},this.loaded[se]=Pe}))}reloadTile(H,K){const se=this.loaded,Se=H.uid;if(se&&se[Se]){const we=se[Se];we.updateParameters(H);const Pe=(Ge,ze)=>{const Ve=we.reloadCallback;Ve&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve)),K(Ge,ze)};we.status==="parsing"?we.reloadCallback=Pe:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Pe):Pe())}else K(null,void 0)}abortTile(H,K){const se=H.uid,Se=this.loading[se];Se&&(Se.abort&&Se.abort(),delete this.loading[se]),K()}removeTile(H,K){const se=this.loaded,Se=H.uid;se&&se[Se]&&delete se[Se],K()}}class Mt{loadTile(H,K){const{uid:se,encoding:Se,rawImageData:we,padding:Pe}=H,Ge=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,Pe):we;K(null,new s.fA(se,Ge,Se,Pe<1))}reloadTile(H,K){K(null,null)}abortTile(H,K){K()}removeTile(H,K){K()}getImageData(H,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const se=this.offscreenCanvasContext.getImageData(-K,-K,H.width+2*K,H.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),se}}s.bs.setPbf(s.bt);class Rn{constructor(H){this._mrt=new s.bs(H.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=H.uid,this.tileID=H.tileID,this.source=H.source}parse(H,K){const se=this._mrt;this.status="parsing",this._entireBuffer=H;try{se.parseHeader(H),this._isHeaderLoaded=!0;const Se=[];for(const we in se.layers){const Pe=se.getLayer(we),Ge=Pe.getDataRange(Pe.getBandList()),ze=se.createDecodingTask(Ge),Ve=H.slice(Ge.firstByte,Ge.lastByte+1),yt=s.bs.performDecoding(Ve,ze).then((lt=>ze.complete(null,lt))).catch((lt=>ze.complete(lt,null)));Se.push(yt)}Promise.allSettled(Se).then((()=>K(null,se))).catch((we=>K(we)))}catch(Se){K(Se)}}}class Kn{constructor(H){this.actor=H,this.loading={},this.loaded={}}loadTile(H,K){const se=H.uid,Se=H.request,we=this.loading[se]=new Rn(H),{cancel:Pe}=s.bu(Se,((Ge,ze,Ve)=>{const yt=!this.loading[se];if(delete this.loading[se],yt||Ge||!ze)return we.status="done",yt||(this.loaded[se]=we),K(Ge);we.parse(ze,((lt,Xt)=>{if(lt||!Xt)return K(lt);K(null,Xt,Ve)})),this.loaded[se]=we}));we.abort=Pe}reloadTile(H,K){K(null,void 0)}abortTile(H,K){const se=H.uid,Se=this.loading[se];Se&&(Se.abort&&Se.abort(),delete this.loading[se]),K()}removeTile(H,K){const se=H.uid;this.loaded[se]&&delete this.loaded[se],K()}decodeRasterArray(H,K){s.bs.performDecoding(H.buffer,H.task).then((se=>K(null,se))).catch((se=>K(se)))}}const Ti=s.fB.prototype.toGeoJSON;class pi{constructor(H){this._feature=H,this.extent=s.al,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){const H=[];for(const K of this._feature.geometry)H.push([new s.P(K[0],K[1])]);return H}{const H=[];for(const K of this._feature.geometry){const se=[];for(const Se of K)se.push(new s.P(Se[0],Se[1]));H.push(se)}return H}}toGeoJSON(H,K,se){return Ti.call(this,H,K,se)}}class dn{constructor(H,K){this.name=H,this.extent=s.al,this.length=K.length,this._jsonFeatures=K}feature(H){return new pi(this._jsonFeatures[H])}}class mi{constructor(H){this.layers={},this.extent=s.al;for(const K of Object.keys(H))this.layers[K]=new dn(K,H[K])}}const Hn=64/4096,Wt=128;class Jt{constructor(){this.features=new Map}clear(){this.features.clear()}load(H=[],K){for(const se of H){const Se=se.id;if(Se==null)continue;let we=this.features.get(Se);we&&this.updateCache(we,K),se.geometry?(we=mn(se),this.updateCache(we,K),this.features.set(Se,we)):this.features.delete(Se),this.updateCache(we,K)}}updateCache(H,K){for(const{canonical:se,uid:Se}of Object.values(K)){const{z:we,x:Pe,y:Ge}=se;nt(H,Math.pow(2,we),Pe,Ge)&&delete K[Se]}}getTile(H,K,se){const Se=Math.pow(2,H),we=[];for(const Pe of this.features.values())nt(Pe,Se,K,se)&&we.push(Gt(Pe,Se,K,se));return{features:we}}getFeatures(){return[...this.features.values()]}}function nt({minX:De,minY:H,maxX:K,maxY:se},Se,we,Pe){return De<(we+1+Hn)/Se&&H<(Pe+1+Hn)/Se&&K>(we-Hn)/Se&&se>(Pe-Hn)/Se}function mn(De){const{id:H,geometry:K,properties:se}=De;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Se,coordinates:we}=K,Pe={id:H,type:1,geometry:[],tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Pe.geometry;if(Se==="Point")sn(we,Ge,Pe);else if(Se==="MultiPoint")for(const ze of we)sn(ze,Ge,Pe);else if(Se==="LineString")Pe.type=2,rt(we,Ge,Pe);else if(Se==="MultiLineString")Pe.type=2,Ut(we,Ge,Pe);else if(Se==="Polygon")Pe.type=3,Ut(we,Ge,Pe,!0);else{if(Se!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const ze of we)Ut(ze,Ge,Pe,!0)}return Pe}function sn([De,H],K,se){const Se=s.aF(De);let we=s.aJ(H);we=we<0?0:we>1?1:we,K.push(Se,we),se.minX=Math.min(se.minX,Se),se.minY=Math.min(se.minY,we),se.maxX=Math.max(se.maxX,Se),se.maxY=Math.max(se.maxY,we)}function rt(De,H,K,se=!1,Se=!1){const we=[];for(const Pe of De)sn(Pe,we,K);H.push(we),se&&(function(Pe,Ge){let ze=0;for(let Ve=0,yt=Pe.length,lt=yt-2;Ve<yt;lt=Ve,Ve+=2)ze+=(Pe[Ve]-Pe[lt])*(Pe[Ve+1]+Pe[lt+1]);if(ze>0===Ge)for(let Ve=0,yt=Pe.length;Ve<yt/2;Ve+=2){const lt=Pe[Ve],Xt=Pe[Ve+1];Pe[Ve]=Pe[yt-2-Ve],Pe[Ve+1]=Pe[yt-1-Ve],Pe[yt-2-Ve]=lt,Pe[yt-1-Ve]=Xt}})(we,Se)}function Ut(De,H,K,se=!1){for(let Se=0;Se<De.length;Se++)rt(De[Se],H,K,se,Se===0)}function Gt(De,H,K,se){const{id:Se,type:we,geometry:Pe,tags:Ge}=De,ze=[];if(we===1)(function(Ve,yt,lt,Xt,Qt){for(let $t=0;$t<Ve.length;$t+=2){const Vn=Math.round(s.al*(Ve[$t+0]*yt-lt)),Un=Math.round(s.al*(Ve[$t+1]*yt-Xt));Qt.push([Vn,Un])}})(Pe,H,K,se,ze);else if(we===2)for(const Ve of Pe)gn(Ve,H,K,se,ze);else if(we===3)for(const Ve of Pe)jn(Ve,H,K,se,ze);return{id:Se,type:we,geometry:ze,tags:Ge}}function gn(De,H,K,se,Se){const we=-Wt,Pe=s.al+Wt;let Ge;for(let ze=0;ze<De.length-2;ze+=2){let Ve=Math.round(s.al*(De[ze+0]*H-K)),yt=Math.round(s.al*(De[ze+1]*H-se)),lt=Math.round(s.al*(De[ze+2]*H-K)),Xt=Math.round(s.al*(De[ze+3]*H-se));const Qt=lt-Ve,$t=Xt-yt;Ve<we&&lt<we||(Ve<we?(yt+=Math.round($t*((we-Ve)/Qt)),Ve=we):lt<we&&(Xt=yt+Math.round($t*((we-Ve)/Qt)),lt=we),yt<we&&Xt<we||(yt<we?(Ve+=Math.round(Qt*((we-yt)/$t)),yt=we):Xt<we&&(lt=Ve+Math.round(Qt*((we-yt)/$t)),Xt=we),Ve>=Pe&&lt>=Pe||(Ve>=Pe?(yt+=Math.round($t*((Pe-Ve)/Qt)),Ve=Pe):lt>=Pe&&(Xt=yt+Math.round($t*((Pe-Ve)/Qt)),lt=Pe),yt>=Pe&&Xt>=Pe||(yt>=Pe?(Ve+=Math.round(Qt*((Pe-yt)/$t)),yt=Pe):Xt>=Pe&&(lt=Ve+Math.round(Qt*((Pe-yt)/$t)),Xt=Pe),Ge&&Ve===Ge[Ge.length-1][0]&&yt===Ge[Ge.length-1][1]||(Ge=[[Ve,yt]],Se.push(Ge)),Ge.push([lt,Xt])))))}}function jn(De,H,K,se,Se){const we=(K-Hn)/H,Pe=(se-Hn)/H,Ge=(K+1+Hn)/H,ze=(se+1+Hn)/H;function Ve(Xt,Qt){let $t=0;return Xt<we?$t|=1:Xt>Ge&&($t|=2),Qt<Pe?$t|=4:Qt>ze&&($t|=8),$t}let yt=[];for(let Xt=1;Xt<=8;Xt*=2){let Qt=De[De.length-2],$t=De[De.length-1],Vn=!(Ve(Qt,$t)&Xt);for(let Un=0;Un<De.length;Un+=2){const Fn=De[Un],xi=De[Un+1],xr=!(Ve(Fn,xi)&Xt);xr!==Vn&&(8&Xt?yt.push(Qt+(Fn-Qt)*(ze-$t)/(xi-$t),ze):4&Xt?yt.push(Qt+(Fn-Qt)*(Pe-$t)/(xi-$t),Pe):2&Xt?yt.push(Ge,$t+(xi-$t)*(Ge-Qt)/(Fn-Qt)):1&Xt&&yt.push(we,$t+(xi-$t)*(we-Qt)/(Fn-Qt))),xr&&yt.push(Fn,xi),Qt=Fn,$t=xi,Vn=xr}if(!(De=yt).length||Xt===8)break;yt=[]}const lt=[];for(let Xt=0;Xt<yt.length;Xt+=2)lt.push([Math.round(s.al*(yt[Xt]*H-K)),Math.round(s.al*(yt[Xt+1]*H-se))]);Se.push(lt)}function oi({name:De,features:H},K){K.writeStringField(1,De),K.writeVarintField(5,s.al);const se=new Map,Se=new Map,we={keys:se,values:Se,feature:null};for(const Pe of H)we.feature=Pe,K.writeMessage(2,cn,we);for(const Pe of se.keys())K.writeStringField(3,Pe);for(const Pe of Se.keys())K.writeMessage(4,Ji,Pe)}function cn(De,H){const K=De.feature;K.id!==void 0&&Number.isSafeInteger(+K.id)&&H.writeVarintField(1,+K.id),K.tags&&H.writeMessage(2,wn,De),H.writeVarintField(3,K.type),H.writeMessage(4,_i,K)}function wn({keys:De,values:H,feature:K},se){for(const Se of Object.keys(K.tags)){let we=K.tags[Se];if(we===null)continue;let Pe=De.get(Se);Pe===void 0&&(Pe=De.size,De.set(Se,Pe)),se.writeVarint(Pe);const Ge=typeof we;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(we=JSON.stringify(we));let ze=H.get(we);ze===void 0&&(ze=H.size,H.set(we,ze)),se.writeVarint(ze)}}function xn(De,H){return(H<<3)+(7&De)}function kn(De){return De<<1^De>>31}function _i(De,H){const{geometry:K,type:se}=De;let Se=0,we=0;if(se===1){H.writeVarint(xn(1,K.length));for(const Pe of K){const Ge=Pe[0]-Se,ze=Pe[1]-we;H.writeVarint(kn(Ge)),H.writeVarint(kn(ze)),Se+=Ge,we+=ze}}else for(const Pe of K){H.writeVarint(xn(1,1));const Ge=Pe.length-(se===3?1:0);for(let ze=0;ze<Ge;ze++){ze===1&&H.writeVarint(xn(2,Ge-1));const Ve=Pe[ze][0]-Se,yt=Pe[ze][1]-we;H.writeVarint(kn(Ve)),H.writeVarint(kn(yt)),Se+=Ve,we+=yt}se===3&&H.writeVarint(xn(7,1))}}function Ji(De,H){const K=typeof De;K==="string"?H.writeStringField(1,De):K==="boolean"?H.writeBooleanField(7,De):K==="number"&&(De%1!=0?H.writeDoubleField(3,De):De<0?H.writeSVarintField(6,De):H.writeVarintField(5,De))}const Gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},yo=Math.fround||(Es=new Float32Array(1),De=>(Es[0]=+De,Es[0]));var Es;const vo=3,Pr=5,Cr=6;class Is{constructor(H){this.options=Object.assign(Object.create(Gi),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:K,minZoom:se,maxZoom:Se}=this.options;K&&console.time("total time");const we=`prepare ${H.length} points`;K&&console.time(we),this.points=H;const Pe=[];for(let ze=0;ze<H.length;ze++){const Ve=H[ze];if(!Ve.geometry)continue;const[yt,lt]=Ve.geometry.coordinates,Xt=yo(to(yt)),Qt=yo(ds(lt));Pe.push(Xt,Qt,1/0,ze,-1,1),this.options.reduce&&Pe.push(0)}let Ge=this.trees[Se+1]=this._createTree(Pe);K&&console.timeEnd(we);for(let ze=Se;ze>=se;ze--){const Ve=+Date.now();Ge=this.trees[ze]=this._createTree(this._cluster(Ge,ze)),K&&console.log("z%d: %d clusters in %dms",ze,Ge.numItems,+Date.now()-Ve)}return K&&console.timeEnd("total time"),this}getClusters(H,K){let se=((H[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,H[1]));let we=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)se=-180,we=180;else if(se>we){const lt=this.getClusters([se,Se,180,Pe],K),Xt=this.getClusters([-180,Se,we,Pe],K);return lt.concat(Xt)}const Ge=this.trees[this._limitZoom(K)],ze=Ge.range(to(se),ds(Pe),to(we),ds(Se)),Ve=Ge.data,yt=[];for(const lt of ze){const Xt=this.stride*lt;yt.push(Ve[Xt+Pr]>1?Ca(Ve,Xt,this.clusterProps):this.points[Ve[Xt+vo]])}return yt}getChildren(H){const K=this._getOriginId(H),se=this._getOriginZoom(H),Se="No cluster with the specified id.",we=this.trees[se];if(!we)throw new Error(Se);const Pe=we.data;if(K*this.stride>=Pe.length)throw new Error(Se);const Ge=this.options.radius/(this.options.extent*Math.pow(2,se-1)),ze=we.within(Pe[K*this.stride],Pe[K*this.stride+1],Ge),Ve=[];for(const yt of ze){const lt=yt*this.stride;Pe[lt+4]===H&&Ve.push(Pe[lt+Pr]>1?Ca(Pe,lt,this.clusterProps):this.points[Pe[lt+vo]])}if(Ve.length===0)throw new Error(Se);return Ve}getLeaves(H,K,se){const Se=[];return this._appendLeaves(Se,H,K=K||10,se=se||0,0),Se}getTile(H,K,se){const Se=this.trees[this._limitZoom(H)],we=Math.pow(2,H),{extent:Pe,radius:Ge}=this.options,ze=Ge/Pe,Ve=(se-ze)/we,yt=(se+1+ze)/we,lt={features:[]};return this._addTileFeatures(Se.range((K-ze)/we,Ve,(K+1+ze)/we,yt),Se.data,K,se,we,lt),K===0&&this._addTileFeatures(Se.range(1-ze/we,Ve,1,yt),Se.data,we,se,we,lt),K===we-1&&this._addTileFeatures(Se.range(0,Ve,ze/we,yt),Se.data,-1,se,we,lt),lt.features.length?lt:null}getClusterExpansionZoom(H){let K=this._getOriginZoom(H)-1;for(;K<=this.options.maxZoom;){const se=this.getChildren(H);if(K++,se.length!==1)break;H=se[0].properties.cluster_id}return K}_appendLeaves(H,K,se,Se,we){const Pe=this.getChildren(K);for(const Ge of Pe){const ze=Ge.properties;if(ze&&ze.cluster?we+ze.point_count<=Se?we+=ze.point_count:we=this._appendLeaves(H,ze.cluster_id,se,Se,we):we<Se?we++:H.push(Ge),H.length===se)break}return we}_createTree(H){const K=new s.c4(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<H.length;se+=this.stride)K.add(H[se],H[se+1]);return K.finish(),K.data=H,K}_addTileFeatures(H,K,se,Se,we,Pe){for(const Ge of H){const ze=Ge*this.stride,Ve=K[ze+Pr]>1;let yt,lt,Xt;if(Ve)yt=Gs(K,ze,this.clusterProps),lt=K[ze],Xt=K[ze+1];else{const Vn=this.points[K[ze+vo]];yt=Vn.properties;const[Un,Fn]=Vn.geometry.coordinates;lt=to(Un),Xt=ds(Fn)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(lt*we-se)),Math.round(this.options.extent*(Xt*we-Se))]],tags:yt};let $t;$t=Ve||this.options.generateId?K[ze+vo]:this.points[K[ze+vo]].id,$t!==void 0&&(Qt.id=$t),Pe.features.push(Qt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,K){const{radius:se,extent:Se,reduce:we,minPoints:Pe}=this.options,Ge=se/(Se*Math.pow(2,K)),ze=H.data,Ve=[],yt=this.stride;for(let lt=0;lt<ze.length;lt+=yt){if(ze[lt+2]<=K)continue;ze[lt+2]=K;const Xt=ze[lt],Qt=ze[lt+1],$t=H.within(ze[lt],ze[lt+1],Ge),Vn=ze[lt+Pr];let Un=Vn;for(const Fn of $t){const xi=Fn*yt;ze[xi+2]>K&&(Un+=ze[xi+Pr])}if(Un>Vn&&Un>=Pe){let Fn,xi=Xt*Vn,xr=Qt*Vn,Rr=-1;const ir=(lt/yt<<5)+(K+1)+this.points.length;for(const Kr of $t){const Zi=Kr*yt;if(ze[Zi+2]<=K)continue;ze[Zi+2]=K;const Ei=ze[Zi+Pr];xi+=ze[Zi]*Ei,xr+=ze[Zi+1]*Ei,ze[Zi+4]=ir,we&&(Fn||(Fn=this._map(ze,lt,!0),Rr=this.clusterProps.length,this.clusterProps.push(Fn)),we(Fn,this._map(ze,Zi)))}ze[lt+4]=ir,Ve.push(xi/Un,xr/Un,1/0,ir,-1,Un),we&&Ve.push(Rr)}else{for(let Fn=0;Fn<yt;Fn++)Ve.push(ze[lt+Fn]);if(Un>1)for(const Fn of $t){const xi=Fn*yt;if(!(ze[xi+2]<=K)){ze[xi+2]=K;for(let xr=0;xr<yt;xr++)Ve.push(ze[xi+xr])}}}}return Ve}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,K,se){if(H[K+Pr]>1){const Pe=this.clusterProps[H[K+Cr]];return se?Object.assign({},Pe):Pe}const Se=this.points[H[K+vo]].properties,we=this.options.map(Se);return se&&we===Se?Object.assign({},we):we}}function Ca(De,H,K){return{type:"Feature",id:De[H+vo],properties:Gs(De,H,K),geometry:{type:"Point",coordinates:[(se=De[H],360*(se-.5)),So(De[H+1])]}};var se}function Gs(De,H,K){const se=De[H+Pr],Se=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,we=De[H+Cr],Pe=we===-1?{}:Object.assign({},K[we]);return Object.assign(Pe,{cluster:!0,cluster_id:De[H+vo],point_count:se,point_count_abbreviated:Se})}function to(De){return De/360+.5}function ds(De){const H=Math.sin(De*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function So(De){const H=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Ma(De,H,K,se){let Se=se;const we=H+(K-H>>1);let Pe,Ge=K-H;const ze=De[H],Ve=De[H+1],yt=De[K],lt=De[K+1];for(let Xt=H+3;Xt<K;Xt+=3){const Qt=Pa(De[Xt],De[Xt+1],ze,Ve,yt,lt);if(Qt>Se)Pe=Xt,Se=Qt;else if(Qt===Se){const $t=Math.abs(Xt-we);$t<Ge&&(Pe=Xt,Ge=$t)}}Se>se&&(Pe-H>3&&Ma(De,H,Pe,se),De[Pe+2]=Se,K-Pe>3&&Ma(De,Pe,K,se))}function Pa(De,H,K,se,Se,we){let Pe=Se-K,Ge=we-se;if(Pe!==0||Ge!==0){const ze=((De-K)*Pe+(H-se)*Ge)/(Pe*Pe+Ge*Ge);ze>1?(K=Se,se=we):ze>0&&(K+=Pe*ze,se+=Ge*ze)}return Pe=De-K,Ge=H-se,Pe*Pe+Ge*Ge}function As(De,H,K,se){const Se={id:De??null,type:H,geometry:K,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")Cs(Se,K);else if(H==="Polygon")Cs(Se,K[0]);else if(H==="MultiLineString")for(const we of K)Cs(Se,we);else if(H==="MultiPolygon")for(const we of K)Cs(Se,we[0]);return Se}function Cs(De,H){for(let K=0;K<H.length;K+=3)De.minX=Math.min(De.minX,H[K]),De.minY=Math.min(De.minY,H[K+1]),De.maxX=Math.max(De.maxX,H[K]),De.maxY=Math.max(De.maxY,H[K+1])}function Eo(De,H,K,se){if(!H.geometry)return;const Se=H.geometry.coordinates;if(Se&&Se.length===0)return;const we=H.geometry.type,Pe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ge=[],ze=H.id;if(K.promoteId?ze=H.properties[K.promoteId]:K.generateId&&(ze=se||0),we==="Point")qo(Se,Ge);else if(we==="MultiPoint")for(const Ve of Se)qo(Ve,Ge);else if(we==="LineString")$s(Se,Ge,Pe,!1);else if(we==="MultiLineString"){if(K.lineMetrics){for(const Ve of Se)Ge=[],$s(Ve,Ge,Pe,!1),De.push(As(ze,"LineString",Ge,H.properties));return}Hs(Se,Ge,Pe,!1)}else if(we==="Polygon")Hs(Se,Ge,Pe,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const Ve of H.geometry.geometries)Eo(De,{id:ze,geometry:Ve,properties:H.properties},K,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of Se){const yt=[];Hs(Ve,yt,Pe,!0),Ge.push(yt)}}De.push(As(ze,we,Ge,H.properties))}function qo(De,H){H.push(Ul(De[0]),no(De[1]),0)}function $s(De,H,K,se){let Se,we,Pe=0;for(let ze=0;ze<De.length;ze++){const Ve=Ul(De[ze][0]),yt=no(De[ze][1]);H.push(Ve,yt,0),ze>0&&(Pe+=se?(Se*yt-Ve*we)/2:Math.sqrt(Math.pow(Ve-Se,2)+Math.pow(yt-we,2))),Se=Ve,we=yt}const Ge=H.length-3;H[2]=1,Ma(H,0,Ge,K),H[Ge+2]=1,H.size=Math.abs(Pe),H.start=0,H.end=H.size}function Hs(De,H,K,se){for(let Se=0;Se<De.length;Se++){const we=[];$s(De[Se],we,K,se),H.push(we)}}function Ul(De){return De/360+.5}function no(De){const H=Math.sin(De*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function Zo(De,H,K,se,Se,we,Pe,Ge){if(se/=H,we>=(K/=H)&&Pe<se)return De;if(Pe<K||we>=se)return null;const ze=[];for(const Ve of De){const yt=Ve.geometry;let lt=Ve.type;const Xt=Se===0?Ve.minX:Ve.minY,Qt=Se===0?Ve.maxX:Ve.maxY;if(Xt>=K&&Qt<se){ze.push(Ve);continue}if(Qt<K||Xt>=se)continue;let $t=[];if(lt==="Point"||lt==="MultiPoint")_l(yt,$t,K,se,Se);else if(lt==="LineString")Ra(yt,$t,K,se,Se,!1,Ge.lineMetrics);else if(lt==="MultiLineString")Ro(yt,$t,K,se,Se,!1);else if(lt==="Polygon")Ro(yt,$t,K,se,Se,!0);else if(lt==="MultiPolygon")for(const Vn of yt){const Un=[];Ro(Vn,Un,K,se,Se,!0),Un.length&&$t.push(Un)}if($t.length){if(Ge.lineMetrics&&lt==="LineString"){for(const Vn of $t)ze.push(As(Ve.id,lt,Vn,Ve.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||($t.length===1?(lt="LineString",$t=$t[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=$t.length===3?"Point":"MultiPoint"),ze.push(As(Ve.id,lt,$t,Ve.tags))}}return ze.length?ze:null}function _l(De,H,K,se,Se){for(let we=0;we<De.length;we+=3){const Pe=De[we+Se];Pe>=K&&Pe<=se&&Ms(H,De[we],De[we+1],De[we+2])}}function Ra(De,H,K,se,Se,we,Pe){let Ge=fs(De);const ze=Se===0?ka:Ps;let Ve,yt,lt=De.start;for(let Un=0;Un<De.length-3;Un+=3){const Fn=De[Un],xi=De[Un+1],xr=De[Un+2],Rr=De[Un+3],ir=De[Un+4],Kr=Se===0?Fn:xi,Zi=Se===0?Rr:ir;let Ei=!1;Pe&&(Ve=Math.sqrt(Math.pow(Fn-Rr,2)+Math.pow(xi-ir,2))),Kr<K?Zi>K&&(yt=ze(Ge,Fn,xi,Rr,ir,K),Pe&&(Ge.start=lt+Ve*yt)):Kr>se?Zi<se&&(yt=ze(Ge,Fn,xi,Rr,ir,se),Pe&&(Ge.start=lt+Ve*yt)):Ms(Ge,Fn,xi,xr),Zi<K&&Kr>=K&&(yt=ze(Ge,Fn,xi,Rr,ir,K),Ei=!0),Zi>se&&Kr<=se&&(yt=ze(Ge,Fn,xi,Rr,ir,se),Ei=!0),!we&&Ei&&(Pe&&(Ge.end=lt+Ve*yt),H.push(Ge),Ge=fs(De)),Pe&&(lt+=Ve)}let Xt=De.length-3;const Qt=De[Xt],$t=De[Xt+1],Vn=Se===0?Qt:$t;Vn>=K&&Vn<=se&&Ms(Ge,Qt,$t,De[Xt+2]),Xt=Ge.length-3,we&&Xt>=3&&(Ge[Xt]!==Ge[0]||Ge[Xt+1]!==Ge[1])&&Ms(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&H.push(Ge)}function fs(De){const H=[];return H.size=De.size,H.start=De.start,H.end=De.end,H}function Ro(De,H,K,se,Se,we){for(const Pe of De)Ra(Pe,H,K,se,Se,we,!1)}function Ms(De,H,K,se){De.push(H,K,se)}function ka(De,H,K,se,Se,we){const Pe=(we-H)/(se-H);return Ms(De,we,K+(Se-K)*Pe,1),Pe}function Ps(De,H,K,se,Se,we){const Pe=(we-K)/(Se-K);return Ms(De,H+(se-H)*Pe,we,1),Pe}function lr(De,H){const K=[];for(let se=0;se<De.length;se++){const Se=De[se],we=Se.type;let Pe;if(we==="Point"||we==="MultiPoint"||we==="LineString")Pe=ei(Se.geometry,H);else if(we==="MultiLineString"||we==="Polygon"){Pe=[];for(const Ge of Se.geometry)Pe.push(ei(Ge,H))}else if(we==="MultiPolygon"){Pe=[];for(const Ge of Se.geometry){const ze=[];for(const Ve of Ge)ze.push(ei(Ve,H));Pe.push(ze)}}K.push(As(Se.id,we,Pe,Se.tags))}return K}function ei(De,H){const K=[];K.size=De.size,De.start!==void 0&&(K.start=De.start,K.end=De.end);for(let se=0;se<De.length;se+=3)K.push(De[se]+H,De[se+1],De[se+2]);return K}function io(De,H){if(De.transformed)return De;const K=1<<De.z,se=De.x,Se=De.y;for(const we of De.features){const Pe=we.geometry,Ge=we.type;if(we.geometry=[],Ge===1)for(let ze=0;ze<Pe.length;ze+=2)we.geometry.push(Yr(Pe[ze],Pe[ze+1],H,K,se,Se));else for(let ze=0;ze<Pe.length;ze++){const Ve=[];for(let yt=0;yt<Pe[ze].length;yt+=2)Ve.push(Yr(Pe[ze][yt],Pe[ze][yt+1],H,K,se,Se));we.geometry.push(Ve)}}return De.transformed=!0,De}function Yr(De,H,K,se,Se,we){return[Math.round(K*(De*se-Se)),Math.round(K*(H*se-we))]}function Wr(De,H,K,se,Se){const we=H===Se.maxZoom?0:Se.tolerance/((1<<H)*Se.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:K,y:se,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of De)Wa(Pe,Ge,we,Se);return Pe}function Wa(De,H,K,se){const Se=H.geometry,we=H.type,Pe=[];if(De.minX=Math.min(De.minX,H.minX),De.minY=Math.min(De.minY,H.minY),De.maxX=Math.max(De.maxX,H.maxX),De.maxY=Math.max(De.maxY,H.maxY),we==="Point"||we==="MultiPoint")for(let Ge=0;Ge<Se.length;Ge+=3)Pe.push(Se[Ge],Se[Ge+1]),De.numPoints++,De.numSimplified++;else if(we==="LineString")ct(Pe,Se,De,K,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Ge=0;Ge<Se.length;Ge++)ct(Pe,Se[Ge],De,K,we==="Polygon",Ge===0);else if(we==="MultiPolygon")for(let Ge=0;Ge<Se.length;Ge++){const ze=Se[Ge];for(let Ve=0;Ve<ze.length;Ve++)ct(Pe,ze[Ve],De,K,!0,Ve===0)}if(Pe.length){let Ge=H.tags||null;if(we==="LineString"&&se.lineMetrics){Ge={};for(const Ve in H.tags)Ge[Ve]=H.tags[Ve];Ge.mapbox_clip_start=Se.start/Se.size,Ge.mapbox_clip_end=Se.end/Se.size}const ze={geometry:Pe,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Ge};H.id!==null&&(ze.id=H.id),De.features.push(ze)}}function ct(De,H,K,se,Se,we){const Pe=se*se;if(se>0&&H.size<(Se?Pe:se))return void(K.numPoints+=H.length/3);const Ge=[];for(let ze=0;ze<H.length;ze+=3)(se===0||H[ze+2]>Pe)&&(K.numSimplified++,Ge.push(H[ze],H[ze+1])),K.numPoints++;Se&&(function(ze,Ve){let yt=0;for(let lt=0,Xt=ze.length,Qt=Xt-2;lt<Xt;Qt=lt,lt+=2)yt+=(ze[lt]-ze[Qt])*(ze[lt+1]+ze[Qt+1]);if(yt>0===Ve)for(let lt=0,Xt=ze.length;lt<Xt/2;lt+=2){const Qt=ze[lt],$t=ze[lt+1];ze[lt]=ze[Xt-2-lt],ze[lt+1]=ze[Xt-1-lt],ze[Xt-2-lt]=Qt,ze[Xt-1-lt]=$t}})(Ge,we),De.push(Ge)}const qr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class yl{constructor(H,K){const se=(K=this.options=(function(we,Pe){for(const Ge in Pe)we[Ge]=Pe[Ge];return we})(Object.create(qr),K)).debug;if(se&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(we,Pe){const Ge=[];if(we.type==="FeatureCollection")for(let ze=0;ze<we.features.length;ze++)Eo(Ge,we.features[ze],Pe,ze);else Eo(Ge,we.type==="Feature"?we:{geometry:we},Pe);return Ge})(H,K);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(we,Pe){const Ge=Pe.buffer/Pe.extent;let ze=we;const Ve=Zo(we,1,-1-Ge,Ge,0,-1,2,Pe),yt=Zo(we,1,1-Ge,2+Ge,0,-1,2,Pe);return(Ve||yt)&&(ze=Zo(we,1,-Ge,1+Ge,0,-1,2,Pe)||[],Ve&&(ze=lr(Ve,1).concat(ze)),yt&&(ze=ze.concat(lr(yt,-1)))),ze})(Se,K),Se.length&&this.splitTile(Se,0,0,0),se&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,K,se,Se,we,Pe,Ge){const ze=[H,K,se,Se],Ve=this.options,yt=Ve.debug;for(;ze.length;){Se=ze.pop(),se=ze.pop(),K=ze.pop(),H=ze.pop();const lt=1<<K,Xt=co(K,se,Se);let Qt=this.tiles[Xt];if(!Qt&&(yt>1&&console.time("creation"),Qt=this.tiles[Xt]=Wr(H,K,se,Se,Ve),this.tileCoords.push({z:K,x:se,y:Se}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,se,Se,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Ei=`z${K}`;this.stats[Ei]=(this.stats[Ei]||0)+1,this.total++}if(Qt.source=H,we==null){if(K===Ve.indexMaxZoom||Qt.numPoints<=Ve.indexMaxPoints)continue}else{if(K===Ve.maxZoom||K===we)continue;if(we!=null){const Ei=we-K;if(se!==Pe>>Ei||Se!==Ge>>Ei)continue}}if(Qt.source=null,H.length===0)continue;yt>1&&console.time("clipping");const $t=.5*Ve.buffer/Ve.extent,Vn=.5-$t,Un=.5+$t,Fn=1+$t;let xi=null,xr=null,Rr=null,ir=null,Kr=Zo(H,lt,se-$t,se+Un,0,Qt.minX,Qt.maxX,Ve),Zi=Zo(H,lt,se+Vn,se+Fn,0,Qt.minX,Qt.maxX,Ve);H=null,Kr&&(xi=Zo(Kr,lt,Se-$t,Se+Un,1,Qt.minY,Qt.maxY,Ve),xr=Zo(Kr,lt,Se+Vn,Se+Fn,1,Qt.minY,Qt.maxY,Ve),Kr=null),Zi&&(Rr=Zo(Zi,lt,Se-$t,Se+Un,1,Qt.minY,Qt.maxY,Ve),ir=Zo(Zi,lt,Se+Vn,Se+Fn,1,Qt.minY,Qt.maxY,Ve),Zi=null),yt>1&&console.timeEnd("clipping"),ze.push(xi||[],K+1,2*se,2*Se),ze.push(xr||[],K+1,2*se,2*Se+1),ze.push(Rr||[],K+1,2*se+1,2*Se),ze.push(ir||[],K+1,2*se+1,2*Se+1)}}getTile(H,K,se){H=+H,K=+K,se=+se;const Se=this.options,{extent:we,debug:Pe}=Se;if(H<0||H>24)return null;const Ge=1<<H,ze=co(H,K=K+Ge&Ge-1,se);if(this.tiles[ze])return io(this.tiles[ze],we);Pe>1&&console.log("drilling down to z%d-%d-%d",H,K,se);let Ve,yt=H,lt=K,Xt=se;for(;!Ve&&yt>0;)yt--,lt>>=1,Xt>>=1,Ve=this.tiles[co(yt,lt,Xt)];return Ve&&Ve.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",yt,lt,Xt),console.time("drilling down")),this.splitTile(Ve.source,yt,lt,Xt,H,K,se),Pe>1&&console.timeEnd("drilling down"),this.tiles[ze]?io(this.tiles[ze],we):null):null}}function co(De,H,K){return 32*((1<<De)*K+H)+De}function ti(De,H){const K=De.tileID.canonical;if(!this._geoJSONIndex)return void H(null,null);const se=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!se)return void H(null,null);const Se=Ve=>Ve.tags&&"3d_elevation_id"in Ve.tags&&"source"in Ve.tags&&Ve.tags.source==="elevation",we=se.features.filter((Ve=>Se(Ve)));let Pe={_geojsonTileLayer:se.features};we.length>0&&(Pe={_geojsonTileLayer:se.features.filter((Ve=>!Se(Ve))),hd_road_elevation:we});const Ge=new mi(Pe),ze=(function(Ve){const yt=new s.bt;for(const lt of Object.keys(Ve))yt.writeMessage(3,oi,{name:lt,features:Ve[lt]});return yt.finish()})(Pe).buffer;H(null,{vectorTile:Ge,rawData:ze})}class ro extends jt{constructor(H,K,se,Se,we,Pe,Ge){super(H,K,se,Se,we,ti,Ge),Pe&&(this.loadGeoJSON=Pe),this._dynamicIndex=new Jt}loadData(H,K){const se=H&&H.request,Se=se&&se.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(H,((we,Pe)=>{if(we||!Pe)return K(we);if(typeof Pe!="object")return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{try{if(H.filter){const ze=s.U(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map((Ve=>`${Ve.key}: ${Ve.message}`)).join(", "));Pe.features=Pe.features.filter((Ve=>ze.value.evaluate({zoom:0},Ve)))}H.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),H.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),H.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=H.cluster?new Is((function({superclusterOptions:ze,clusterProperties:Ve}){if(!Ve||!ze)return ze;const yt={},lt={},Xt={accumulated:null,zoom:0},Qt={properties:null},$t=Object.keys(Ve);for(const Vn of $t){const[Un,Fn]=Ve[Vn],xi=s.U(Fn),xr=s.U(typeof Un=="string"?[Un,["accumulated"],["get",Vn]]:Un);yt[Vn]=xi.value,lt[Vn]=xr.value}return ze.map=Vn=>{Qt.properties=Vn;const Un={};for(const Fn of $t)Un[Fn]=yt[Fn].evaluate(Xt,Qt);return Un},ze.reduce=(Vn,Un)=>{Qt.properties=Un;for(const Fn of $t)Xt.accumulated=Vn[Fn],Vn[Fn]=lt[Fn].evaluate(Xt,Qt)},ze})(H)).load(Pe.features):H.dynamic?this._dynamicIndex:(function(ze,Ve){return new yl(ze,Ve)})(Pe,H.geojsonVtOptions)}catch(ze){return K(ze)}const Ge={};if(Se){const ze=he(se);ze&&(Ge.resourceTiming={},Ge.resourceTiming[H.source]=JSON.parse(JSON.stringify(ze)))}K(null,Ge)}}))}reloadTile(H,K){const se=this.loaded;return se&&se[H.uid]?H.partial?K(null,void 0):super.reloadTile(H,K):this.loadTile(H,K)}loadGeoJSON(H,K){if(H.request)s.m(H.request,K);else{if(typeof H.data!="string")return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return K(null,JSON.parse(H.data))}catch{return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(H,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(se){K(se)}}getClusterChildren(H,K){try{K(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(se){K(se)}}getClusterLeaves(H,K){try{K(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(se){K(se)}}}class Ws{constructor(H,K,se){this.tileID=new s.aQ(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=H.projection,this.brightness=K,this.worldview=se}parse(H,K,se,Se){this.status="parsing";const we=new s.aQ(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),Pe=[],Ge=K.familiesBySource[se.source],ze=new s.fn(we,se.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,s.fC(H).then((Ve=>{if(!Ve)return Se(new Error("Could not parse tile"));const yt=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,lt=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),Xt=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qt in Ge)for(const $t of Ge[Qt]){const Vn=$t[0];ze.bucketLayerIDs.push($t.map((xi=>s.B(xi.id,xi.scope)))),Vn.recalculate(Xt,[]);const Un=s.fD(Ve,1/s.d7(se.tileID.canonical)),Fn=new s.fE($t,Un,we,yt,lt,this.brightness,ze,this.worldview);yt||(Fn.needsUpload=!0),Pe.push(Fn),Fn.evaluate(Vn)}this.status="done",Se(null,{buckets:Pe,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Ve=>Se(new Error(Ve.message))))}}class qa{constructor(H,K,se,Se,we,Pe,Ge,ze){this.actor=H,this.layerIndex=K,this.availableImages=se,this.availableModels=Se,this.brightness=Ge,this.loading={},this.loaded={},this.worldview=ze}loadTile(H,K){const se=H.uid,Se=this.loading[se]=new Ws(H,this.brightness,this.worldview);s.bu(H.request,((we,Pe)=>{const Ge=!this.loading[se];return delete this.loading[se],Ge||we?(Se.status="done",Ge||(this.loaded[se]=Se),K(we)):Pe&&Pe.byteLength!==0?void Se.parse(Pe,this.layerIndex,H,((ze,Ve)=>{Se.status="done",this.loaded=this.loaded||{},this.loaded[se]=Se,ze||!Ve?K(ze):K(null,Ve)})):(Se.status="done",this.loaded[se]=Se,K())}))}reloadTile(H,K){const se=this.loaded,Se=H.uid;if(se&&se[Se]){const we=se[Se];we.projection=H.projection,we.brightness=H.brightness;const Pe=(Ge,ze)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(H,K)),K(Ge,ze)};we.status==="parsing"?we.reloadCallback=Pe:we.status==="done"&&this.loadTile(H,K)}}abortTile(H,K){const se=H.uid;this.loading[se]&&delete this.loading[se],K()}removeTile(H,K){const se=this.loaded,Se=H.uid;se&&se[Se]&&delete se[Se],K()}}class Lc{constructor(H){this.self=H,this.actor=new s.fG(H,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:jt,geojson:ro,"raster-dem":Mt,"raster-array":Kn,"batched-model":qa},this.workerSources={},this.self.registerWorkerSource=(K,se)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=se},this.self.registerRTLTextPlugin=K=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=K.applyArabicShaping,s.fH.processBidirectionalText=K.processBidirectionalText,s.fH.processStyledBidirectionalText=K.processStyledBidirectionalText;for(const se of this.rtlPluginParsingListeners)se(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(H,K,se){delete this.layerIndexes[H],delete this.availableImages[H],delete this.availableModels[H],delete this.workerSources[H],se()}checkIfReady(H,K,se){se()}setReferrer(H,K){this.referrer=K}spriteLoaded(H,K){this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={});const{scope:se,isLoaded:Se}=K;if(this.isSpriteLoaded[H][se]=Se,this.workerSources[H]&&this.workerSources[H][se])for(const we in this.workerSources[H][se]){const Pe=this.workerSources[H][se][we];for(const Ge in Pe){const ze=Pe[Ge];ze instanceof jt&&(ze.isSpriteLoaded=Se,ze.fire(new s.z("isSpriteLoaded")))}}}setImages(H,K,se){this.availableImages[H]||(this.availableImages[H]={});const{scope:Se,images:we}=K;if(this.availableImages[H][Se]=we,this.workerSources[H]&&this.workerSources[H][Se]){for(const Pe in this.workerSources[H][Se]){const Ge=this.workerSources[H][Se][Pe];for(const ze in Ge)Ge[ze].availableImages=we}se()}else se()}setModels(H,{scope:K,models:se},Se){if(this.availableModels[H]||(this.availableModels[H]={}),this.availableModels[H][K]=se,this.workerSources[H]&&this.workerSources[H][K]){for(const we in this.workerSources[H][K]){const Pe=this.workerSources[H][K][we];for(const Ge in Pe)Pe[Ge].availableModels=se}Se()}else Se()}setProjection(H,K){this.projections[H]=s.cm(K)}setBrightness(H,K,se){this.brightness=K,se()}setWorldview(H,K,se){this.worldview=K,se()}setLayers(H,K,se){this.getLayerIndex(H,K.scope).replace(K.layers,K.options),se()}updateLayers(H,K,se){this.getLayerIndex(H,K.scope).update(K.layers,K.removedIds,K.options),se()}loadTile(H,K,se){K.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source,K.scope).loadTile(K,se)}decodeRasterArray(H,K,se){this.getWorkerSource(H,K.type,K.source,K.scope).decodeRasterArray(K,se)}reloadTile(H,K,se){K.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source,K.scope).reloadTile(K,se)}abortTile(H,K,se){this.getWorkerSource(H,K.type,K.source,K.scope).abortTile(K,se)}removeTile(H,K,se){this.getWorkerSource(H,K.type,K.source,K.scope).removeTile(K,se)}removeSource(H,K,se){if(!(this.workerSources[H]&&this.workerSources[H][K.scope]&&this.workerSources[H][K.scope][K.type]&&this.workerSources[H][K.scope][K.type][K.source]))return;const Se=this.workerSources[H][K.scope][K.type][K.source];delete this.workerSources[H][K.scope][K.type][K.source],Se.removeSource!==void 0?Se.removeSource(K,se):se()}loadWorkerSource(H,K,se){try{this.self.importScripts(K.url),se()}catch(Se){se(Se)}}syncRTLPluginState(H,K,se){if(s.fH.isParsed())se(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(se);else try{s.fH.setState(K);const Se=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||Se==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(Se),s.fH.isParsed()?se(null,!0):this.rtlPluginParsingListeners.push(se))}catch(Se){se(Se)}}setDracoUrl(H,K){this.dracoUrl=K}getAvailableImages(H,K){this.availableImages[H]||(this.availableImages[H]={});let se=this.availableImages[H][K];return se||(se=[]),se}getAvailableModels(H,K){this.availableModels[H]||(this.availableModels[H]={});let se=this.availableModels[H][K];return se||(se={}),se}getLayerIndex(H,K){this.layerIndexes[H]||(this.layerIndexes[H]={});let se=this.layerIndexes[H][K];return se||(se=this.layerIndexes[H][K]=new oe,se.scope=K),se}getWorkerSource(H,K,se,Se){const we=this.workerSources;return we[H]||(we[H]={}),we[H][Se]||(we[H][Se]={}),we[H][Se][K]||(we[H][Se][K]={}),this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),we[H][Se][K][se]||(we[H][Se][K][se]=new this.workerSourceTypes[K]({send:(Pe,Ge,ze,Ve,yt,lt)=>this.actor.send(Pe,Ge,ze,H,yt,lt),scheduler:this.actor.scheduler},this.getLayerIndex(H,Se),this.getAvailableImages(H,Se),this.getAvailableModels(H,Se),this.isSpriteLoaded[H][Se],void 0,this.brightness,this.worldview)),we[H][Se][K][se]}rasterizeImagesWorker(H,K,se){const Se=new Map;for(const[we,{image:Pe,imageVariant:Ge}]of K.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ge,Pe,K.scope,H);Se.set(we,ze)}se(void 0,Se)}removeRasterizedImages(H,K,se){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,H),se()}enforceCacheSizeLimit(H,K){s.fJ(K)}getWorkerPerformanceMetrics(H,K,se){se(void 0,void 0)}}return s.fF(self)&&(self.worker=new Lc(self)),Lc})),J(["./shared"],(function(s){var he="3.17.0";const ae={create:"create",load:"load",fullLoad:"fullLoad"},Me={mark(l){performance.mark(l)},measure(l,t,r){performance.measure(l,t,r)}};function oe(l){const t=l.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var Oe,je={},st=(function(){if(Oe)return je;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,_,v=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(v);try{_=new Worker(b),g=!0}catch{g=!1}return _&&_.terminate(),URL.revokeObjectURL(b),g})()?(function(){var g=document.createElement("canvas");g.width=g.height=1;var _=g.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===g.width})()?(r[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(r[f]=(function(g){var _,v=(function(b){var I=document.createElement("canvas"),C=Object.create(l.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=b,I.getContext("webgl2",C)})(g);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)})(f)),r[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}Oe=1,je.supported=l,je.notSupportedReason=t;var r={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},je})();function Ce(l,t,r){const c=document.createElement(l);return t!=null&&(c.className=t),r&&r.appendChild(c),c}function Be(l,t,r){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const f of Object.keys(t))c.setAttributeNS(null,f,String(t[f]));return r&&r.appendChild(c),c}const Xe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ot=Xe&&Xe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ke;function Ct(){Xe&&ot&&(Ke=Xe[ot],Xe[ot]="none")}function tt(){Xe&&ot&&(Xe[ot]=Ke)}function Nt(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Nt,!0)}function jt(){window.addEventListener("click",Nt,!0),window.setTimeout((()=>{window.removeEventListener("click",Nt,!0)}),0)}function Mt(l,t){const r=l.getBoundingClientRect();return Ti(l,r,t)}function Rn(l,t){const r=l.getBoundingClientRect(),c=[];for(let f=0;f<t.length;f++)c.push(Ti(l,r,t[f]));return c}function Kn(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function Ti(l,t,r){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.P((r.clientX-t.left)*c,(r.clientY-t.top)*c)}const pi="01",dn="NO_ACCESS_TOKEN";class mi{constructor(t,r,c){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=(function(){let r="";for(let c=0;c<10;c++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pi,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.params.push(`sdk=js-${he}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeModelURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeSourceURL(t,r,c,f){if(!s.h(t))return t;const g=Wt(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),c&&g.params.push(`language=${c}`),f&&g.params.push(`worldview=${f}`),this._makeAPIURL(g,this._customAccessToken||r)}normalizeIconsetURL(t,r){const c=Wt(t);return s.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||r)):Jt(c)}normalizeSpriteURL(t,r,c,f){const g=Wt(t);return s.h(t)?(g.path=`/styles/v1${g.path}/sprite${r}${c}`,this._makeAPIURL(g,this._customAccessToken||f)):(g.path+=`${r}${c}`,Jt(g))}normalizeTileURL(t,r,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const f=Wt(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||c&&f.authority!=="raster"&&c===512?"@2x":""}${s.k.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${s.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${s.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${s.e.TILE_URL_VERSION}${f.path}`);const g=this._customAccessToken||(function(_){for(const v of _){const b=v.match(/^access_token=(.*)$/);if(b)return b[1]}return null})(f.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,g)}canonicalizeTileURL(t,r){const c=Wt(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let f="mapbox://";c.path.match(/^\/raster\/v1\//)?f+=`raster/${c.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${c.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${c.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let g=c.params;return r&&(g=g.filter((_=>!_.match(/^access_token=/)))),g.length&&(f+=`?${g.join("&")}`),f}canonicalizeTileset(t,r){const c=!!r&&s.h(r),f=[];for(const g of t.tiles||[])s.j(g)?f.push(this.canonicalizeTileURL(g,c)):f.push(g);return f}_makeAPIURL(t,r){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Wt(s.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Jt(t);if(r=r||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter((g=>g.indexOf("access_token")===-1)),t.params.push(`access_token=${r||""}`),Jt(t)}}const Hn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(l){const t=l.match(Hn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Jt(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const nt="mapbox.eventData";function mn(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class sn{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=mn(s.e.ACCESS_TOKEN);let c="";return c=r&&r.u?s.f(r.u):s.e.ACCESS_TOKEN||"",t?`${nt}.${t}:${c}`:`${nt}:${c}`}fetchEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.getStorageKey("uuidTimestamp");if(t)try{const g=localStorage.getItem(r);g&&(this.eventData=JSON.parse(g));const _=localStorage.getItem(c);_&&(this.anonId=_);const v=localStorage.getItem(f);v&&(this.anonIdTimestamp=Number(v));const b=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<b)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.getStorageKey("uuidTimestamp"),g=this.anonId,_=this.anonIdTimestamp;if(t&&g)try{localStorage.setItem(c,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData)),_&&localStorage.setItem(f,_.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,c,f){if(!s.e.EVENTS_URL)return;const g=Wt(s.e.EVENTS_URL);g.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString()},v=r?Object.assign(_,r):_,b={url:Jt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=s.p(b,(I=>{this.pendingRequest=null,c(I),this.saveEventData(),this.processRequests(f)}))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}class rt extends sn{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!s.e.EVENTS_URL||!t&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const r=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:r},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,(()=>{}),t)}}const Ut=new class extends sn{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some((r=>s.h(r)||s.j(r)))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=mn(s.e.ACCESS_TOKEN),r=t?t.u:s.e.ACCESS_TOKEN;let c=r!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),_=new Date(f),v=(f-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||g.getDate()!==_.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:he,skuId:pi,"enabled.telemetry":!1,userId:this.anonId},(g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=r)}),l):this.processRequests()}},Gt=Ut.postTurnstileEvent.bind(Ut),gn=new class extends sn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,r,c){this.skuToken=t,this.errorCb=c,s.e.EVENTS_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(dn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:he,skuId:pi,skuToken:this.skuToken,userId:this.anonId},(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l))}remove(){this.errorCb=null}},jn=gn.postMapLoadEvent.bind(gn),oi=new class extends sn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=s.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:r,style:c,importedStyles:f}=t;if(!s.e.EVENTS_URL||!l&&!s.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(r),_={mapInstanceId:g,eventId:this.getEventId(g),style:c};f.length&&(_.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:_},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),l)}},cn=oi.postStyleLoadEvent.bind(oi),wn=new rt({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),xn=wn.postMetricsEvent.bind(wn),kn=new rt({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),_i=kn.postMetricsEvent.bind(kn),Ji=new class extends sn{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),c=(function(f){const g=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),v=(function(D){const V={};if(D){for(const j in D)if(j!=="other")for(const Z of D[j]){const q=`${j}ResolveRangeMin`,ee=`${j}ResolveRangeMax`,ie=`${j}RequestCount`,te=`${j}RequestCachedCount`;V[q]=Math.min(V[q]||1/0,Z.startTime),V[ee]=Math.max(V[ee]||-1/0,Z.responseEnd);const ye=pe=>{V[pe]===void 0&&(V[pe]=0),++V[pe]};Z.transferSize!==void 0&&Z.transferSize===0&&ye(te),ye(ie)}}return V})((function(D,V){const j={};if(D)for(const Z of D){const q=V(Z);j[q]===void 0&&(j[q]=[]),j[q].push(Z)}return j})(g,oe)),b=window.devicePixelRatio,I=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=I?I.effectiveType:void 0,O={counters:[],metadata:[],attributes:[]},L=(D,V,j)=>{j!=null&&D.push({name:V,value:j.toString()})};for(const D in v)L(O.counters,D,v[D]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(L(O.counters,"interactionRangeMin",f.interactionRange[0]),L(O.counters,"interactionRangeMax",f.interactionRange[1])),_)for(const D of Object.values(ae)){const V=_.find((j=>j.name===D));V&&L(O.counters,D,V.startTime)}return L(O.counters,"visibilityHidden",f.visibilityHidden),L(O.attributes,"style",(function(D){if(D)for(const V of D){const j=V.name.split("?")[0];if(s.i(j)){const Z=j.split("/").slice(-2);if(Z.length===2)return`mapbox://styles/${Z[0]}/${Z[1]}`}}})(g)),L(O.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),L(O.attributes,"fogEnabled",f.fogEnabled?"true":"false"),L(O.attributes,"projection",f.projection),L(O.attributes,"zoom",f.zoom),L(O.metadata,"devicePixelRatio",b),L(O.metadata,"connectionEffectiveType",C),L(O.metadata,"navigatorUserAgent",navigator.userAgent),L(O.metadata,"screenWidth",window.screen.width),L(O.metadata,"screenHeight",window.screen.height),L(O.metadata,"windowWidth",window.innerWidth),L(O.metadata,"windowHeight",window.innerHeight),L(O.metadata,"mapWidth",f.width/b),L(O.metadata,"mapHeight",f.height/b),L(O.metadata,"webglRenderer",f.renderer),L(O.metadata,"webglVendor",f.vendor),L(O.metadata,"sdkVersion",he),L(O.metadata,"sdkIdentifier","mapbox-gl-js"),O})(r);for(const f of c.metadata);for(const f of c.counters);for(const f of c.attributes);this.postEvent(t,c,(()=>{}),l)}},Gi=Ji.postPerformanceEvent.bind(Ji),yo=new class extends sn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,r,c){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const f=Wt(s.e.API_URL+s.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||s.e.ACCESS_TOKEN||""}`);const g={url:Jt(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(g,(_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(c)}))}getSessionAPI(l,t,r,c){this.skuToken=t,this.errorCb=c,s.e.SESSION_PATH&&s.e.API_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(dn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l)}remove(){this.errorCb=null}},Es=yo.getSessionAPI.bind(yo),vo=new Set;function Pr(l,t){t?vo.add(l):vo.delete(l)}class Cr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Is(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ca extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const c of r.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,r,f);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,c){this._validate(t,c)&&this.images.get(r).set(t.toString(),c)}_validate(t,r){let c=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||r<f[1])return!1;c=f[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,c){const f=this.images.get(r).get(t.toString());c.version=f.version+1,this.images.get(r).set(t.toString(),c),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const c=this.images.get(r),f=c.get(t.toString());c.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((r=>s.I.from(r)))}getImages(t,r,c){const f=[],g=[],_=this.imageProviders.get(r);for(const C of t){if(!C.iconsetId){f.push(C);continue}const O=_.get(C.iconsetId);O&&(this.getImage(C,r)?g.push(C):O.addPendingRequest(C))}if(f.length===0)return void this._notify(g,r,c);let v=!0;const b=!!this.loaded.get(r),I=this.images.get(r);if(!b)for(const C of f)I.has(C.toString())||(v=!1);b||v?this._notify(f,r,c):this.requestors.push({ids:f,scope:r,callback:c})}rasterizeImages(t,r){const c=new Map,{tasks:f,scope:g}=t;for(const[_,v]of f.entries()){const b=this.getImage(v.id,g);b&&c.set(_,{image:b,imageVariant:v})}this._rasterizeImages(g,c,r)}_rasterizeImages(t,r,c){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},c);else{const f=new Map;for(const[g,{image:_,imageVariant:v}]of r.entries())f.set(g,this.imageRasterizer.rasterize(v,_,t,0));c(void 0,f)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,c){const f=this.images.get(r),g=new Map;for(const _ of t){if(!f.get(_.toString())){if(_.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:_.name}))}const v=f.get(_.toString());if(!v){s.w(`Image "${_.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const b={data:v.usvg?null:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,usvg:v.usvg,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)};v.usvg&&Object.assign(b,{width:v.icon.usvg_tree.width,height:v.icon.usvg_tree.height}),g.set(s.I.toString(_),b)}c(null,g)}getPixelSize(t){const{width:r,height:c}=this.atlasImage.get(t);return{width:r,height:c}}getPattern(t,r,c){const f=t.toString(),g=this.patterns.get(r),_=g.get(f),v=this.getImage(t,r);if(!v)return null;if(_){if(_.position.version===v.version)return _.position;_.position.version=v.version}else{if(v.usvg&&!v.data){const b=this.getPatternInFlightId(f,r);if(this.patternsInFlight.has(b))return null;this.patternsInFlight.add(b);const I=new s.A(t).scaleSelf(s.o.devicePixelRatio),C=new Map([[I.toString(),{image:v,imageVariant:I}]]);return this._rasterizeImages(r,C,((O,L)=>this.storePatternImage(I,r,v,c,L))),null}this.storePattern(t,r,v)}return this._updatePatternAtlas(r,c),g.get(f).position}getPatternInFlightId(t,r){return s.B(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,c,f,g){const _=t.toString(),v=g?g.get(_):void 0;v&&(c.data=v,this.storePattern(t.id,r,c),this._updatePatternAtlas(r,f),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,c){const f={w:c.data.width+2*s.C,h:c.data.height+2*s.C,x:0,y:0},g=new s.F(f,c,s.C);this.patterns.get(r).set(t.toString(),{bin:f,position:g})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,r){const c=t.gl;let f=this.atlasTexture.get(r);f?this.dirty&&(f.update(this.atlasImage.get(r)),this.dirty=!1):(f=new s.T(t,this.atlasImage.get(r),c.RGBA8),this.atlasTexture.set(r,f)),f.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const c=this.patterns.get(t),f=Array.from(c.values()).map((({bin:I})=>I)),{w:g,h:_}=s.G(f),v=this.atlasImage.get(t);v.resize({width:g||1,height:_||1});const b=this.images.get(t);for(const[I,{bin:C,position:O}]of c.entries()){let L=O.padding;const D=C.x+L,V=C.y+L,j=b.get(I).data,Z=j.width,q=j.height;L=L>1?L-1:L,s.q.copy(j,v,{x:0,y:0},{x:D,y:V},{width:Z,height:q},r),s.q.copy(j,v,{x:0,y:q-L},{x:D,y:V-L},{width:Z,height:L},r),s.q.copy(j,v,{x:0,y:0},{x:D,y:V+q},{width:Z,height:L},r),s.q.copy(j,v,{x:Z-L,y:0},{x:D-L,y:V},{width:L,height:q},r),s.q.copy(j,v,{x:0,y:0},{x:D+Z,y:V},{width:L,height:q},r),s.q.copy(j,v,{x:Z-L,y:q-L},{x:D-L,y:V-L},{width:L,height:L},r),s.q.copy(j,v,{x:0,y:q-L},{x:D+Z,y:V-L},{width:L,height:L},r),s.q.copy(j,v,{x:0,y:0},{x:D+Z,y:V+q},{width:L,height:L},r),s.q.copy(j,v,{x:Z-L,y:0},{x:D-L,y:V+q},{width:L,height:L},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const c=this.images.get(r);for(const f of t){if(this.callbackDispatchedThisFrame.get(r).has(f.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(f.toString());const g=c.get(f.toString());Is(g)&&this.updateImage(f,r,g)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Gs(l){const t=l.value,r=l.valueSpec,c=l.style,f=l.styleSpec,g=l.key,_=l.arrayElementValidator||lr;if(!Array.isArray(t))return[new s.V(g,t,`array expected, ${s.K(t)} found`)];if(r.length&&t.length!==r.length)return[new s.V(g,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new s.V(g,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let v={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};f.$version<7&&(v.function=r.function),s.H(r.value)&&(v=r.value);let b=[];for(let I=0;I<t.length;I++)b=b.concat(_({array:t,arrayIndex:I,value:t[I],valueSpec:v,style:c,styleSpec:f,key:`${g}[${I}]`},!0));return b}function to(l){const t=l.key,r=l.value,c=l.valueSpec;if(!s.L(r))return[new s.V(t,r,`number expected, ${s.K(r)} found`)];if(r!=r)return[new s.V(t,r,"number expected, NaN found")];if("minimum"in c){let f=c.minimum;if(Array.isArray(c.minimum)&&(f=c.minimum[l.arrayIndex]),r<f)return[new s.V(t,r,`${r} is less than the minimum value ${f}`)]}if("maximum"in c){let f=c.maximum;if(Array.isArray(c.maximum)&&(f=c.maximum[l.arrayIndex]),r>f)return[new s.V(t,r,`${r} is greater than the maximum value ${f}`)]}return[]}function ds(l){const t=l.key,r=l.value;if(!s.H(r))return[new s.V(t,r,`object expected, ${s.K(r)} found`)];const c=l.valueSpec,f=s.J(r.type);let g,_,v,b={};const I=f!=="categorical"&&r.property===void 0,C=!I,O=(function(j){const Z=j.stops;return Array.isArray(Z)&&Array.isArray(Z[0])&&s.H(Z[0][0])})(r),L=ei({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(j){if(f==="identity")return[new s.V(j.key,j.value,'identity function may not have a "stops" property')];let Z=[];const q=j.value;return Z=Z.concat(Gs({key:j.key,value:q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:D})),Array.isArray(q)&&q.length===0&&Z.push(new s.V(j.key,q,"array must have at least one stop")),Z},default:function(j){return lr({key:j.key,value:j.value,valueSpec:c,style:j.style,styleSpec:j.styleSpec})}}});return f==="identity"&&I&&L.push(new s.V(l.key,l.value,'missing required property "property"')),f==="identity"||r.stops||L.push(new s.V(l.key,l.value,'missing required property "stops"')),f==="exponential"&&c.expression&&!s.M(c)&&L.push(new s.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(C&&!s.N(c)?L.push(new s.V(l.key,l.value,"property functions not supported")):I&&!s.O(c)&&L.push(new s.V(l.key,l.value,"zoom functions not supported"))),f!=="categorical"&&!O||r.property!==void 0||L.push(new s.V(l.key,l.value,'"property" property is required')),L;function D(j){let Z=[];const q=j.value,ee=j.key;if(!Array.isArray(q))return[new s.V(ee,q,`array expected, ${s.K(q)} found`)];if(q.length!==2)return[new s.V(ee,q,`array length 2 expected, length ${q.length} found`)];if(O){if(!s.H(q[0]))return[new s.V(ee,q,`object expected, ${s.K(q[0])} found`)];const ie=q[0];if(ie.zoom===void 0)return[new s.V(ee,q,"object stop key must have zoom")];if(ie.value===void 0)return[new s.V(ee,q,"object stop key must have value")];const te=s.J(ie.zoom);if(typeof te!="number")return[new s.V(ee,ie.zoom,"stop zoom values must be numbers")];if(v&&v>te)return[new s.V(ee,ie.zoom,"stop zoom values must appear in ascending order")];te!==v&&(v=te,_=void 0,b={}),Z=Z.concat(ei({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:to,value:V}}))}else Z=Z.concat(V({key:`${ee}[0]`,value:q[0],style:j.style,styleSpec:j.styleSpec},q));return s.Q(s.S(q[1]))?Z.concat([new s.V(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):Z.concat(lr({key:`${ee}[1]`,value:q[1],valueSpec:c,style:j.style,styleSpec:j.styleSpec}))}function V(j,Z){const q=s.K(j.value),ee=s.J(j.value),ie=j.value!==null?j.value:Z;if(g){if(q!==g)return[new s.V(j.key,ie,`${q} stop domain type must match previous stop domain type ${g}`)]}else g=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new s.V(j.key,ie,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&f!=="categorical"){let te=`number expected, ${q} found`;return s.N(c)&&f===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(j.key,ie,te)]}return f!=="categorical"||q!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?f!=="categorical"&&q==="number"&&typeof ee=="number"&&typeof _=="number"&&_!==void 0&&ee<_?[new s.V(j.key,ie,"stop domain values must appear in ascending order")]:(_=ee,f==="categorical"&&ee in b?[new s.V(j.key,ie,"stop domain values must be unique")]:(b[ee]=!0,[])):[new s.V(j.key,ie,`integer expected, found ${String(ee)}`)]}}function So(l){const t=(l.expressionContext==="property"?s.W:s.U)(s.S(l.value),l.valueSpec);if(t.result==="error")return t.value.map((c=>new s.V(`${l.key}${c.key}`,l.value,c.message)));const r=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!r.outputDefined())return[new s.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!s.Z(r))return[new s.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Ma(r,l);if(l.expressionContext==="appearance")return Pa(r,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!s.X(r,["zoom","feature-state"]))return[new s.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!s.Y(r))return[new s.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ma(l,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)r.delete(f);if(r.size===0)return[];const c=[];return l instanceof s._&&r.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild((f=>{c.push(...Ma(f,t))})),c)}function Pa(l,t){const r=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)r.add(f);if(r.size===0)return[];const c=[];return l instanceof s._&&!r.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] is not an allowed parameter`)]:(l.eachChild((f=>{c.push(...Pa(f,t))})),c)}function As(l){const t=l.key,r=l.value,c=l.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(s.J(r))===-1&&f.push(new s.V(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(s.J(r))===-1&&f.push(new s.V(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),f}function Cs(l){return s.a2(s.S(l.value))?So(Object.assign({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):Eo(l)}function Eo(l){const t=l.value,r=l.key;if(!Array.isArray(t))return[new s.V(r,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(r,t,"filter array must have at least 1 element")];const c=l.styleSpec;let f=As({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator});const g=()=>{t.length>=2&&(s.a0(t[1])||f.push(new s.V(`${r}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let _=2;_<t.length;_++)s.J(t[1])==="$type"?f=f.concat(As({key:`${r}[${_}]`,value:t[_],valueSpec:c.geometry_type})):s.a0(t[_])||s.L(t[_])||s.$(t[_])||f.push(new s.V(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${s.K(t[_])} found.`))};switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&f.push(new s.V(r,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&f.push(new s.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`)),g();break;case"==":case"!=":t.length!==3&&f.push(new s.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`)),g();break;case"in":case"!in":g();break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)f=f.concat(Eo({key:`${r}[${_}]`,value:t[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":t.length!==2?f.push(new s.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||f.push(new s.V(`${r}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return f}function qo(l,t){const r=l.key,c=l.style,f=l.layer,g=l.styleSpec,_=l.value,v=l.objectKey,b=g[`${t}_${l.layerType}`];if(!b)return[];const I=v.match(/^(.*)-use-theme$/);if(I&&b[I[1]])return s.Q(s.S(_))?[].concat(lr({key:r,value:_,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v})):lr({key:r,value:_,valueSpec:{type:"string"},style:c,styleSpec:g});const C=v.match(/^(.*)-transition$/);if(t==="paint"&&C&&b[C[1]]&&b[C[1]].transition)return lr({key:r,value:_,valueSpec:g.transition,style:c,styleSpec:g});const O=l.valueSpec||b[v];if(!O)return[new s.a3(r,_,`unknown property "${v}"`)];let L;if(s.a0(_)&&s.N(O)&&!O.tokens&&(L=/^{([^}]+)}$/.exec(_))){const V=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new s.V(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const D=[];if(l.layerType==="symbol")v!=="text-field"||!c||c.glyphs||c.imports||D.push(new s.V(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&s.a4(s.S(_))&&s.J(_.type)==="identity"&&D.push(new s.V(r,_,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&s.N(O)&&(s.a5(O)||s.O(O))){const V=s.W(s.S(_),O).value,j="expression"in V&&V.expression||"_styleExpression"in V&&V._styleExpression&&V._styleExpression.expression;j&&!s.X(j,["measure-light"])&&(v==="model-emissive-strength"&&s.Y(j)&&s.Z(j)||D.push(new s.V(r,_,`${v} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return D.concat(lr({key:l.key,value:_,valueSpec:O,style:c,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function $s(l){return qo(l,"paint")}function Hs(l){return qo(l,"layout")}function Ul(l){let t=[];const r=l.value,c=l.key,f=l.style,g=l.styleSpec;if(!s.H(r))return[new s.V(c,r,"object expected")];r.type||r.ref||t.push(new s.V(c,r,'either "type" or "ref" is required'));let _=s.J(r.type);const v=s.J(r.ref);if(r.id){const b=s.J(r.id);for(let I=0;I<l.arrayIndex;I++){const C=f.layers[I];s.J(C.id)===b&&t.push(new s.V(c,r.id,`duplicate layer id "${b}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach((I=>{I in r&&t.push(new s.V(c,r[I],`"${I}" is prohibited for ref layers`))})),f.layers.forEach((I=>{s.J(I.id)===v&&(b=I)})),b?b.ref?t.push(new s.V(c,r.ref,"ref cannot reference another ref layer")):_=s.J(b.type):typeof v=="string"&&t.push(new s.V(c,r.ref,`ref layer "${v}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(r.source)if(s.a0(r.source)){const b=f.sources&&f.sources[r.source],I=b&&s.J(b.type);b?I==="vector"&&_==="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a raster source`)):I==="raster"&&_!=="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"?t.push(new s.V(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="raster-array"||["raster","raster-particle"].includes(_)?_==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&I==="geojson"&&!b.lineMetrics?t.push(new s.V(c,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):_==="raster-particle"&&I!=="raster-array"&&t.push(new s.V(c,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new s.V(c,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new s.V(c,r.source,`source "${r.source}" not found`))}else t.push(new s.V(`${c}.source`,r.source,'"source" must be a string'));else t.push(new s.V(c,r,'missing required property "source"'));return t=t.concat(ei({key:c,value:r,valueSpec:g.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lr({key:`${c}.type`,value:r.type,valueSpec:g.layer.type,style:l.style,styleSpec:l.styleSpec,object:r,objectKey:"type"}),filter:b=>Cs(Object.assign({layerType:_},b)),layout:b=>ei({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":I=>Hs(Object.assign({layerType:_},I))}}),paint:b=>ei({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":I=>$s(Object.assign({layerType:_,layer:r},I))}}),appearances(b){const I=Gs({key:b.key,value:b.value,valueSpec:b.valueSpec,style:b.style,styleSpec:b.styleSpec,arrayElementValidator:L=>(function(D){const{key:V,layer:j,layerType:Z}=D,q=s.J(D.value),ee=s.J(q.name),ie=s.J(q.condition),te=ei({key:V,value:q,valueSpec:D.styleSpec.appearance,style:D.style,styleSpec:D.styleSpec,objectElementValidators:{condition:ye=>(function(pe){const ge=[];return ge.push(...So({key:pe.key,value:pe.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),ge})(Object.assign({layer:j,layerType:Z},ye)),properties:ye=>(function(pe){const ge=[],{styleSpec:ue,layer:le,layerType:xe}=pe,Re=ue[`paint_${xe}`],Ae=ue[`layout_${xe}`],$e=pe.object[pe.objectKey];for(const He in $e){const it=He in Re?"paint":He in Ae?"layout":void 0;if(!it){ge.push(new s.V(pe.key,He,`unknown property "${He}" for layer type "${xe}"`));continue}const xt=Object.assign({},pe,{key:`${pe.key}.${He}`,object:$e,objectKey:He,layer:le,layerType:xe,value:$e[He],valueSpec:it==="paint"?Re[He]:Ae[He]});ge.push(...qo(xt,it))}return ge})(Object.assign({layer:j,layerType:Z},ye))}});return ee!=="hidden"&&ie===void 0&&te.push(new s.V(D.key,"name",'Appearance with name different than "hidden" must have a condition')),te})(Object.assign({layerType:_,layer:r},L))}),C=Array.isArray(b.value)?b.value:[],O=new Set;return C.forEach(((L,D)=>{const V=s.J(L.name);if(V)if(O.has(V)){const j=s.J(r.id);I.push(new s.V(b.key,V,`Duplicated appearance name "${V}" for layer "${j}"`))}else O.add(V)})),I}}})),t}function no({key:l,value:t}){return s.a0(t)?[]:[new s.V(l,t,`string expected, ${s.K(t)} found`)]}const Zo={promoteId:function l({key:t,value:r}){if(s.a0(r))return no({key:t,value:r});if(Array.isArray(r)){const f=[],g=s.S(r),_=s.U(g);return _.result==="error"&&_.value.forEach((v=>{f.push(new s.V(`${t}${v.key}`,null,`${v.message}`))})),s.X(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),f}if(!s.H(r))return[new s.V(t,r,`string, expression or object expected, "${s.K(r)}" found`)];const c=[];for(const f in r)c.push(...l({key:`${t}.${f}`,value:r[f]}));return c}};function _l(l){const t=l.value,r=l.key,c=l.styleSpec,f=l.style;if(!s.H(t))return[new s.V(r,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(r,t,'"type" is required')];const g=s.J(t.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&("url"in t||"tiles"in t||_.push(new s.a3(r,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat(ei({key:r,value:t,valueSpec:c[`source_${g.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:Zo})),_;case"geojson":if(_=ei({key:r,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Zo}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${r}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const v in t.clusterProperties){const b=t.clusterProperties[v];if(!Array.isArray(b))return[new s.V(`${r}.clusterProperties.${v}`,b,"array expected")];const[I,C]=b,O=typeof I=="string"?[I,["accumulated"],["get",v]]:I;_.push(...So({key:`${r}.${v}.map`,value:C,expressionContext:"cluster-map"})),_.push(...So({key:`${r}.${v}.reduce`,value:O,expressionContext:"cluster-reduce"}))}}return _;case"video":return ei({key:r,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return ei({key:r,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new s.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return As({key:`${r}.type`,value:t.type,valueSpec:{values:Ra(c)}})}}function Ra(l){return l.source.reduce(((t,r)=>{const c=l[r];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values||{}))),t}),[])}function fs(l){const t=l.value,r=l.styleSpec,c=r.light,f=l.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let g=[];for(const _ in t){const v=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);g=g.concat(b&&c[b[1]]?lr({key:_,value:t[_],valueSpec:{type:"string"},style:f,styleSpec:r}):v&&c[v[1]]&&c[v[1]].transition?lr({key:_,value:t[_],valueSpec:r.transition,style:f,styleSpec:r}):c[_]?lr({key:_,value:t[_],valueSpec:c[_],style:f,styleSpec:r}):[new s.V(_,t[_],`unknown property "${_}"`)])}return g}function Ro(l){const t=l.value;if(!t)return[];const r=l.key;if(!s.H(t))return[new s.V(r,t,`object expected, ${s.K(t)} found`)];let c=[];const f=l.styleSpec,g=f["light-3d"],_=l.style,v=l.style.lights;for(const C of["type","id"])if(!(C in t))return c=c.concat([new s.V(r,t,`missing property "${C}"`)]),c;if(!s.a0(t.type))return c=c.concat([new s.V(`${r}.type`,t.type,"string expected")]),c;if(v)for(let C=0;C<l.arrayIndex;C++){const O=s.J(t.type),L=v[C];s.J(L.type)===O&&c.push(new s.V(r,t.id,`duplicate light type "${t.type}", previously defined at line ${L.id.__line__}`))}const b=`properties_light_${t.type}`;if(!(b in f))return c=c.concat([new s.V(`${r}.type`,t,`Invalid light type ${t.type}`)]),c;const I=f[b];for(const C in t)if(C==="properties"){const O=t[C];if(!s.H(O))return c=c.concat([new s.V("properties",O,`object expected, ${s.K(O)} found`)]),c;for(const L in O){const D=L.match(/^(.*)-transition$/),V=L.match(/^(.*)-use-theme$/);c=c.concat(V&&I[V[1]]?lr({key:C,value:O[L],valueSpec:{type:"string"},style:_,styleSpec:f}):D&&I[D[1]]&&I[D[1]].transition?lr({key:C,value:t[C],valueSpec:f.transition,style:_,styleSpec:f}):I[L]?lr({key:L,value:O[L],valueSpec:I[L],style:_,styleSpec:f}):[new s.a3(l.key,O[L],`unknown property "${L}"`)])}}else c=c.concat(g[C]?lr({key:C,value:t[C],valueSpec:g[C],style:_,styleSpec:f}):[new s.a3(C,t[C],`unknown property "${C}"`)]);return c}function Ms(l){const t=l.value,r=l.key,c=l.style,f=l.styleSpec,g=f.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let _=[];for(const v in t){const b=v.match(/^(.*)-transition$/),I=v.match(/^(.*)-use-theme$/);_=_.concat(I&&g[I[1]]?lr({key:v,value:t[v],valueSpec:{type:"string"},style:c,styleSpec:f}):b&&g[b[1]]&&g[b[1]].transition?lr({key:v,value:t[v],valueSpec:f.transition,style:c,styleSpec:f}):g[v]?lr({key:v,value:t[v],valueSpec:g[v],style:c,styleSpec:f}):[new s.a3(v,t[v],`unknown property "${v}"`)])}if(t.source)if(s.a0(t.source)){const v=c.sources&&c.sources[t.source],b=v&&s.J(v.type);v?b!=="raster-dem"&&_.push(new s.V(`${r}.source`,t.source,`terrain cannot be used with a source of type ${b}, it only be used with a "raster-dem" source type`)):_.push(new s.V(`${r}.source`,t.source,`source "${t.source}" not found`))}else _.push(new s.V(`${r}.source`,t.source,"source must be a string"));else _.push(new s.V(r,t,'terrain is missing required property "source"'));return _}function ka(l){const t=l.value,r=l.style,c=l.styleSpec,f=c.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let g=[];for(const _ in t){const v=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);g=g.concat(b&&f[b[1]]?lr({key:_,value:t[_],valueSpec:{type:"string"},style:r,styleSpec:c}):v&&f[v[1]]&&f[v[1]].transition?lr({key:_,value:t[_],valueSpec:c.transition,style:r,styleSpec:c}):f[_]?lr({key:_,value:t[_],valueSpec:f[_],style:r,styleSpec:c}):[new s.a3(_,t[_],`unknown property "${_}"`)])}return g}const Ps={"*":()=>[],array:Gs,boolean:function(l){const t=l.value,r=l.key;return s.$(t)?[]:[new s.V(r,t,`boolean expected, ${s.K(t)} found`)]},number:to,color:function({key:l,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(l,t,`color expected, "${t}" found`)]:[]:[new s.V(l,t,`color expected, ${s.K(t)} found`)]},enum:As,filter:Cs,function:ds,layer:Ul,object:ei,source:_l,model:s.a7,light:fs,"light-3d":Ro,terrain:Ms,fog:ka,string:no,formatted:function(l){return no(l).length===0?[]:So(l)},resolvedImage:function(l){return no(l).length===0?[]:So(l)},projection:function(l){const t=l.value,r=l.styleSpec,c=r.projection,f=l.style;if(s.H(t)){let g=[];for(const _ in t)g=g.concat(lr({key:_,value:t[_],valueSpec:c[_],style:f,styleSpec:r}));return g}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(l){const t=l.key,{value:r,styleSpec:c}=l;if(!s.H(r))return[new s.V(t,r,"import must be an object")];const{data:f,...g}=r;Object.defineProperty(g,"__line__",{value:r.__line__,enumerable:!1});let _=ei(Object.assign({},l,{value:g,valueSpec:c.import}));return s.J(g.id)===""&&_.push(new s.V(`${l.key}.id`,g,"import id can't be an empty string")),f&&(_=_.concat(Yr(f,c,{key:`${l.key}.data`}))),_},iconset:function(l){const t=l.value,r=l.key,c=l.styleSpec,f=l.style;if(!s.H(t))return[new s.V(r,t,"object expected")];if(!t.type)return[new s.V(r,t,'"type" is required')];const g=s.J(t.type);let _=[];if(_=_.concat(ei({key:r,value:t,valueSpec:c[`iconset_${g}`],style:f,styleSpec:c})),(function(v,b){return!(v!=="source"||!b.source)})(g,t)){const v=f.sources&&f.sources[t.source],b=v&&s.J(v.type);v?b!=="raster-array"&&_.push(new s.V(r,t.source,`iconset cannot be used with a source of type ${String(b)}, it only be used with a "raster-array" source type`)):_.push(new s.V(r,t.source,`source "${t.source}" not found`))}return _}};function lr(l,t=!1){const r=l.value,c=l.valueSpec,f=l.styleSpec;if(c.expression){if(s.a4(s.J(r)))return ds(l);if(s.Q(s.S(r)))return So(l)}if(c.type&&Ps[c.type]){const g=Ps[c.type](l);return t===!0&&g.length>0&&Array.isArray(l.value)?So(l):g}return ei(Object.assign({},l,{valueSpec:c.type?f[c.type]:c}))}function ei(l){const t=l.key,r=l.value,c=l.valueSpec||{},f=l.objectElementValidators||{},g=l.style,_=l.styleSpec;if(!s.H(r))return[new s.V(t,r,`object expected, ${s.K(r)} found`)];let v=[];for(const b in r){const I=b.split(".")[0];let C;f[I]?C=f[I]:c[I]?C=lr:f["*"]?C=f["*"]:c["*"]&&(C=lr),C?v=v.concat(C({key:(t&&`${t}.`)+b,value:r[b],valueSpec:c[I]||c["*"],style:g,styleSpec:_,object:r,objectKey:b},r)):v.push(new s.a3(t,r[b],`unknown property "${b}"`))}for(const b in c){if(f[b])continue;const I=c[b];I.required&&I.default===void 0&&r[b]===void 0&&v.push(new s.V(t,r,`missing required property "${b}"`))}return v}function io({key:l,value:t}){const r=no({key:l,value:t});if(r.length)return r;const c=t;return c.indexOf("{fontstack}")===-1&&r.push(new s.V(l,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&r.push(new s.V(l,t,'"glyphs" url must include a "{range}" token')),r}function Yr(l,t=s.a6,r={}){return ei({key:r.key||"",value:l,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:l,objectElementValidators:{glyphs:io}})}function Wr(l,t=s.a6){return K(Yr(l,t))}const Wa=l=>K(_l(l)),ct=l=>K(fs(l)),qr=l=>K(Ro(l)),yl=l=>K(Ms(l)),co=l=>K(ka(l)),ti=l=>K((function(t){const r=t.value,c=t.style,f=t.styleSpec,g=f.snow;if(r===void 0)return[];if(!s.H(r))return[new s.V("snow",r,`object expected, ${s.K(r)} found`)];let _=[];for(const v in r){const b=v.match(/^(.*)-transition$/);_=_.concat(b&&g[b[1]]&&g[b[1]].transition?lr({key:v,value:r[v],valueSpec:f.transition,style:c,styleSpec:f}):g[v]?lr({key:v,value:r[v],valueSpec:g[v],style:c,styleSpec:f}):[new s.a3(v,r[v],`unknown property "${v}"`)])}return _})(l)),ro=l=>K((function(t){const r=t.value,c=t.style,f=t.styleSpec,g=f.rain;if(r===void 0)return[];if(!s.H(r))return[new s.V("rain",r,`object expected, ${s.K(r)} found`)];let _=[];for(const v in r){const b=v.match(/^(.*)-transition$/);_=_.concat(b&&g[b[1]]&&g[b[1]].transition?lr({key:v,value:r[v],valueSpec:f.transition,style:c,styleSpec:f}):g[v]?lr({key:v,value:r[v],valueSpec:g[v],style:c,styleSpec:f}):[new s.a3(v,r[v],`unknown property "${v}"`)])}return _})(l)),Ws=l=>K(Ul(l)),qa=l=>K(Cs(l)),Lc=l=>K($s(l)),De=l=>K(Hs(l)),H=l=>K(s.a7(l));function K(l){return l.slice().sort(((t,r)=>t.line&&r.line?t.line-r.line:0))}function se(l,t){let r=!1;if(t&&t.length)for(const c of t)c instanceof s.a3?s.w(c.message):(l.fire(new s.y(new Error(c.message))),r=!0);return r}const Se=s.a6.light;let we;class Pe extends s.E{constructor(t,r="flat"){super(),this._transitionable=new s.a8(we||(we=new s.a9({anchor:new s.aa(Se.anchor),position:new s.ab(Se.position),color:new s.aa(Se.color),intensity:new s.aa(Se.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,c={}){this._validate(ct,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&se(this,t.call(Wr,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Ge=s.a6.terrain;let ze=class extends s.E{constructor(l,t,r,c,f){super(),this.scope=r,this._transitionable=new s.a8(new s.a9({source:new s.aa(Ge.source),exaggeration:new s.aa(Ge.exaggeration)}),r,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=f}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new s.ac(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let r=-1,c=-1,f=1;for(const g of t.zoomStops)f=t.evaluate(new s.ac(g,{worldview:this.worldview})),f>.01?(r=g,c=-1):c=g;return f<.01&&r>0&&c>r?[r,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof s.ad}};const Ve=45,yt=65,lt=.05;function Xt(l,t,r,c){const f=s.ah(Ve,yt,r),[g,_]=Qt(l,c);let v=1-Math.min(1,Math.exp((t-g)/(_-g)*-6));return v*=v*v,v=Math.min(1,1.00747*v),v*f*l.alpha}function Qt(l,t){const r=.5/Math.tan(.5*t);return[l.range[0]+r,l.range[1]+r]}function $t(l,t,r,c,f){const g=s.af([],[t,r,c],f.mercatorFogMatrix);return Xt(l,s.ag(g),f.pitch,f._fov)}function Vn(l,t,r,c,f,g,_){const v=[[r,c,0],[f,c,0],[f,g,0],[r,g,0]];let b=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(const C of v){const O=s.af([],C,t),L=s.ag(O);b=Math.min(b,L),I=Math.max(I,L)}return[Xt(l,b,_.pitch,_._fov),Xt(l,I,_.pitch,_._fov)]}const Un=s.a6.fog;class Fn extends s.E{constructor(t,r,c,f){super();const g=new s.a9({range:new s.aa(Un.range),color:new s.aa(Un.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Un["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Un["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Un["horizon-blend"]),"star-intensity":new s.aa(Un["star-intensity"]),"vertical-range":new s.aa(Un["vertical-range"])});this._transitionable=new s.a8(g,c,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new s.ai(g),this.scope=c}get state(){const t=this._transform,r=t.projection.name==="globe",c=s.aj(t.zoom),f=this.properties.get("range"),g=[.5,3];return{range:r?[s.ak(g[0],f[0],c),s.ak(g[1],f[1],c)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,c={}){if(this._validate(co,t,c))return;const f=Object.assign({},t);for(const g of Object.keys(Un))f[g]===void 0&&(f[g]=Un[g].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(Ve,yt,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?(function(c,f,g){const _=s.ae.fromLngLat(f),v=g.elevation?g.elevation.getAtPointOrZero(_):0;return $t(c,_.x,_.y,v,g)})(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Vn(this.state,r,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,r,c,f,g){return this._transform.projection.supportsFog?Vn(this.state,t,r,c,f,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Qt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const c of r){const f=t.points[c];let g;if(f[2]>=0)g=f;else{const _=t.points[c-4];g=s.am(_,f,_[2]/(_[2]-f[2]))}if($t(this.state,g[0],g[1],0,this._transform)>=lt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&se(this,t.call(Wr,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let xi,xr,Rr,ir,Kr=class extends s.E{constructor(l,t,r,c){super();const f=xi||(xi=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(f,r,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(f),this.scope=r}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=s.an(r[0]),f=-Math.max(s.an(r[1]),.01),g=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],_=this.properties.get("vignette"),v=this.properties.get("vignette-color");return v.a=_,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*l),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(l,t,r={}){if(this._validate(ti,l,r))return;const c=Object.assign({},l),f=s.a6.snow;for(const g of Object.keys(f))c[g]===void 0&&(c[g]=f[g].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,r){return(!r||r.validate!==!1)&&se(this,l.call(Wr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Zi=class extends s.E{constructor(l,t,r,c){super();const f=xr||(xr=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(f,r,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(f),this.scope=r}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=s.an(r[0]),f=-Math.max(s.an(r[1]),.01),g=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],_=this.properties.get("vignette-color");return _.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*l),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:_}}get(){return this._transitionable.serialize()}set(l,t,r={}){if(this._validate(ro,l,r))return;const c=Object.assign({},l),f=s.a6.rain;for(const g of Object.keys(f))c[g]===void 0&&(c[g]=f[g].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,r){return(!r||r.validate!==!1)&&se(this,l.call(Wr,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class Ei extends s.E{constructor(t,r,c,f){super(),this.scope=c,this._options=t,this.properties=new s.ai(r),this._transitionable=new s.a8(r,c,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class wr{constructor(t,r,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,r){let c,f;if(t instanceof s.P||typeof t[0]=="number"){const g=s.P.convert(t);c=[g],f=r.isPointAboveHorizon(g)}else{const g=s.P.convert(t[0]),_=s.P.convert(t[1]),v=g.add(_)._div(2);c=[g,_],f=s.aq(g,_).every((b=>r.isPointAboveHorizon(b)))&&r.isPointAboveHorizon(v)}return new wr(c,f,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.aq(r,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<c.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?f[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(f[3]=this.cameraPoint)),s.ar(f,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.aq(r,c,t),g=this.cameraPoint.clone();switch(3*((g.y>r.y)+(g.y>c.y))+((g.x>r.x)+(g.x>c.x))){case 0:f[0]=g,f[4]=g.clone();break;case 1:f.splice(1,0,g);break;case 2:f[1]=g;break;case 3:f.splice(4,0,g);break;case 5:f.splice(2,0,g);break;case 6:f[3]=g;break;case 7:f.splice(3,0,g);break;case 8:f[2]=g}return f}containsTile(t,r,c,f=0){const g=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/r._pixelsPerMercatorPixel+1,_=c?this._bufferedCameraMercator(g,r):this._bufferedScreenMercator(g,r);let v=t.tileID.wrap+(_.unwrapped?f:0);const b=_.polygon.map((Z=>s.as(t.tileTransform,Z,v)));if(!s.at(b,0,0,s.al,s.al))return;v=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const I=this.screenGeometryMercator.polygon.map((Z=>s.au(t.tileTransform,Z,v))),C=I.map((Z=>new s.P(Z[0],Z[1]))),O=r.getFreeCameraOptions().position||new s.ae(0,0,0),L=s.au(t.tileTransform,O,v),D=I.map((Z=>{const q=s.av(Z,Z,L);return s.aw(q,q),new s.ax(L,q)})),V=s.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:D,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(j=s.az(b),j.min.x=s.aA(j.min.x,0,s.al),j.min.y=s.aA(j.min.y,0,s.al),j.max.x=s.aA(j.max.x,0,s.al),j.max.y=s.aA(j.max.y,0,s.al),j),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:V};var j}_bufferedScreenMercator(t,r){const c=br(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let f;return f=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map((g=>r.pointCoordinate3D(g))),unwrapped:!0},this._screenRaycastCache[c]=f,f}}_bufferedCameraMercator(t,r){const c=br(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let f;return f=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map((g=>r.pointCoordinate3D(g))),unwrapped:!0},this._cameraRaycastCache[c]=f,f}}_projectAndResample(t,r){const c=(function(g,_){const v=s.aB([],_.pixelMatrix,_.globeMatrix),b=[0,-s.aD,0,1],I=[0,s.aD,0,1],C=[0,0,0,1];s.aC(b,b,v),s.aC(I,I,v),s.aC(C,C,v);const O=new s.P(b[0]/b[3],b[1]/b[3]),L=new s.P(I[0]/I[3],I[1]/I[3]),D=s.aE(g,O)&&b[3]<C[3],V=s.aE(g,L)&&I[3]<C[3];if(!D&&!V)return null;const j=(function(ge,ue,le){for(let xe=1;xe<ge.length;xe++){const Re=ri(ue.pointCoordinate3D(ge[xe-1]).x),Ae=ri(ue.pointCoordinate3D(ge[xe]).x);if(le<0){if(Re<Ae)return{idx:xe,t:-Re/(Ae-1-Re)}}else if(Ae<Re)return{idx:xe,t:(1-Re)/(Ae+1-Re)}}return null})(g,_,D?-1:1);if(!j)return null;const{idx:Z,t:q}=j;let ee=Z>1?Qi(g.slice(0,Z),_):[],ie=Z<g.length?Qi(g.slice(Z),_):[];ee=ee.map((ge=>new s.P(ri(ge.x),ge.y))),ie=ie.map((ge=>new s.P(ri(ge.x),ge.y)));const te=[...ee];te.length===0&&te.push(ie[ie.length-1]);const ye=s.ak(te[te.length-1].y,(ie.length===0?ee[0]:ie[0]).y,q);let pe;return pe=D?[new s.P(0,ye),new s.P(0,0),new s.P(1,0),new s.P(1,ye)]:[new s.P(1,ye),new s.P(1,1),new s.P(0,1),new s.P(0,ye)],te.push(...pe),ie.length===0?te.push(ee[0]):te.push(...ie),{polygon:te.map((ge=>new s.ae(ge.x,ge.y))),unwrapped:!1}})(t,r);if(c)return c;const f=(function(g,_){let v=!1,b=-1/0,I=0;for(let O=0;O<g.length-1;O++)g[O].x>b&&(b=g[O].x,I=O);for(let O=0;O<g.length-1;O++){const L=(I+O)%(g.length-1),D=g[L],V=g[L+1];Math.abs(D.x-V.x)>.5&&(D.x<V.x?(D.x+=1,L===0&&(g[g.length-1].x+=1)):(V.x+=1,L+1===g.length-1&&(g[0].x+=1)),v=!0)}const C=s.aF(_.center.lng);return v&&C<Math.abs(C-1)&&g.forEach((O=>{O.x-=1})),{polygon:g,unwrapped:v}})(Qi(t,r).map((g=>new s.P(ri(g.x),g.y))),r);return{polygon:f.polygon.map((g=>new s.ae(g.x,g.y))),unwrapped:f.unwrapped}}}function Qi(l,t){return s.aG(l,(r=>{const c=t.pointCoordinate3D(r);r.x=c.x,r.y=c.y}),1/256)}function ri(l){return l<0?1+l%1:l%1}function br(l){return 100*l|0}function uo(l,t,r,c,f){const g=function(v,b){if(v)return f(v);if(b){if(l.url&&b.tiles&&l.tiles&&delete l.tiles,b.variants){if(!Array.isArray(b.variants))return f(new Error("variants must be an array"));for(const C of b.variants){if(C==null||typeof C!="object"||C.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(C.capabilities))return f(new Error("capabilities must be an array"));if(C.capabilities.length===1&&C.capabilities[0]==="meshopt"){b=Object.assign(b,C);break}}}const I=s.aH(Object.assign({},b,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);I.tiles=t.canonicalizeTileset(I,l.url),f(null,I)}},_=(function(v,b,I){if(!v)return null;if(!b&&!I)return v;I=I||v.worldview_default;const C=Object.values(v.language||{});if(C.length===0)return null;const O=Object.values(v.worldview||{});if(O.length===0)return null;const L=C.every((V=>V===b)),D=O.every((V=>V===I));return L&&D?v:b in(v.language_options||{})||I in(v.worldview_options||{})?null:v.language_options&&v.worldview_options?v:null})(l.data,r,c);return _?s.o.frame((()=>g(null,_))):l.url?s.m(t.transformRequest(t.normalizeSourceURL(l.url,null,r,c),s.R.Source),g):s.o.frame((()=>{const{data:v,...b}=l;g(null,b)}))}function Io(l,t){const r=Math.pow(2,t.z),c=Math.floor(s.aF(l.getWest())*r),f=Math.floor(s.aJ(l.getNorth())*r),g=Math.ceil(s.aF(l.getEast())*r),_=Math.ceil(s.aJ(l.getSouth())*r);return t.x>=c&&t.x<g&&t.y>=f&&t.y<_}class Rs{constructor(t,r,c){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(s.aI.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Io(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(Io(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new Rs(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Dc extends s.E{constructor(t,r,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=uo(this._options,this.map._requestManager,r,c,((f,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,f)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(f));else if(g){if(Object.assign(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const _ of g.vector_layers)this.vectorLayerIds.push(_.id),g.worldview&&g.worldview[_.source]&&this.localizableLayerIds.add(_.id)}this.tileBounds=Rs.fromTileJSON(g),Gt(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(f)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const c=t.tileID.canonical.url(this.tiles,this.scheme),f=this.map._requestManager.normalizeTileURL(c),g=this.map._requestManager.transformRequest(f,s.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,v=_?{image:_.image.clone()}:null,b={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:v,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&s.h(c)&&(b.localizableLayerIds=this.localizableLayerIds),b.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",b,I.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",b,I.bind(this),void 0,!0);else{const C=s.aL.call({deduped:this._deduped},b,((O,L)=>{if(O||!L)I.call(this,O);else{const D=s.aM(L.responseHeaders);b.data={rawData:L.rawData.slice(0),expires:D.expires,cacheControl:D.cacheControl},t.actor&&t.actor.send("loadTile",b,I.bind(this),void 0,!0)}}),!0);t.request={cancel:C}}function I(C,O){return delete t.request,t.aborted?r(null):C&&C instanceof s.aN&&C.status!==404?r(C):(O&&O.resourceTiming&&(t.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&t.setExpiryData(O),t.loadVectorData(O,this.map.painter),s.aO(this.dispatcher),r(null,O),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ho extends s.E{constructor(t,r,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,s.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=uo(this._options,this.map._requestManager,null,r,((c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.y(c)):f&&(Object.assign(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map((g=>g.id))),this.tileBounds=Rs.fromTileJSON(f),Gt(f.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const c=s.o.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(f,s.R.Tile),((g,_,v)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(g)return t.state="errored",r(g);if(!_)return r(null);const b=s.aM(v);this.map._refreshExpiredTiles&&t.setExpiryData(b),t.setTexture(_,this.map.painter),t.state="loaded",s.aO(this.dispatcher),r(null)}))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof s.T?(t.destroy(!1),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function qs([l,t],r,c,{scaled:f=!0}={}){const{tileSize:g,buffer:_}=c,{x:v,y:b,z:I}=r;if(!isFinite(v)||!isFinite(b)||!isFinite(I))throw new Error("Invalid MRT header");const C=2**I,O=C*s.aF(l),L=C*s.aJ(t);return(function([D,V],j,{scaled:Z=!0}={}){if(!j)throw new Error("bandView is undefined");const{data:q,tileSize:ee,buffer:ie,offset:te,scale:ye,dimension:pe}=j;if(D<-ie||D>ee+ie||V<-ie||V>ee+ie)throw new Error(`Point (${D}, ${V}) out of bounds for tileSize=${ee}, buffer=${ie}`);const ge=(V+ie)*(ee+2*ie)+(D+ie);if(new Uint32Array(q.buffer)[ge]===4294967295)return null;let ue=[];ue=Z?[]:new j.data.constructor(pe);for(let le=0;le<pe;le++)ue[le]=Math.round(1e12*(q[pe*ge+le]*ye+te))/1e12;return ue})([Math.min(Math.max(-_,Math.floor((O-v)*g)),g-1+_),Math.min(Math.max(-_,Math.floor((L-b)*g)),g-1+_)],c,{scaled:f})}class Oo extends ho{constructor(t,r,c,f){super(t,r,c,f),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);r&&r.enabled&&c&&r._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,s.R.Tile),g={request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor());const _=(v,b,I)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(v)return v.name==="AbortError"?void 0:(t.state="errored",r(v));if(this.map._refreshExpiredTiles&&b){const C=s.aM(I);t.setExpiryData(C)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!b)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=b}r(null)};t.request=this.partial?t.fetchHeader(void 0,_.bind(this)):t.actor.send("loadTile",g,_.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!1);for(const f of c.values())this.map.painter.saveTileTexture(f)}else t.destroy()}prepareTile(t,r,c,f){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(r,c,f,((g,_)=>{if(g)return t.state="errored",this.fire(new s.y(g)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,_,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find((({id:g})=>g===t)),c=r&&r.fields,f=c&&c.bands&&c.bands;return f?f[0]:0}getTextureDescriptor(t,r,c){if(!t)return;const f=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let g=null;r instanceof s.aR?g=r.paint.get("raster-array-band"):r instanceof s.aS&&(g=r.paint.get("raster-particle-array-band"));const _=g||this.getInitialBand(f);if(_==null)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,f,r.id,_);if(t.updateNeeded(r.id,_)&&!c)return;const v=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},v,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const c=new Map;for(const f of t)for(const g of r){const[_,v]=g.split("/"),b=f.getLayer(_);if(!b||!b.hasBand(v)||!b.hasDataForBand(v))continue;const{bytes:I,tileSize:C,buffer:O}=b.getBandView(v),L=C+2*O,D={data:new s.q({width:L,height:L},I),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(g,D)}return c}queryRasterArrayValueByBandId(t,r,c){const f=r._mrt;return new Promise((g=>{const _={},v=new Set;for(const[b,I]of Object.entries(f.layers)){if(c.layerName&&b!==c.layerName)continue;const C={};_[b]=C;for(const{bands:O}of I.dataIndex)for(const L of O)c.bands&&!c.bands.includes(L)||(v.add(s.B(b,L)),r.fetchBand(b,null,L,(D=>{s.o.frame((()=>{C[L]=D?null:qs([t.lng,t.lat],f,I.getBandView(L)),v.delete(s.B(b,L)),v.size===0&&g(_)}))}),!1))}v.size===0&&g(_)}))}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,s.R.Tile);t.actor.send("loadTile",{request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((g,_,v)=>{if(g)return this._loadTilePending[t.uid].forEach((b=>b(g,null))),void delete this._loadTilePending[t.uid];if(!_)return this._loadTilePending[t.uid].forEach((b=>b(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&_){const b=s.aM(v);t.setExpiryData(b)}t._mrt=_,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((b=>b(null,_))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,r,c){return new Promise(((f,g)=>{this._loadTileForQuery(r,((_,v)=>{_?g(_):f(v?this.queryRasterArrayValueByBandId(t,r,c):null)}))}))}queryRasterArrayValue(t,r){const c=s.aT.convert(t),f=this.findLoadedParent(c);return f&&f._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(c,f,r):this.queryRasterArrayValueByAllBands(c,f,r):Promise.resolve(null)}findLoadedParent(t){const r=s.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,f=1<<c,g=Math.floor(r.x),_=Math.floor((r.x-g)*f),v=Math.floor(r.y*f),b=this.map.style.getSourceCache(this.id),I=new s.aQ(c,g,c,_,v);return b.findLoadedParent(I,this.minzoom)}}const Zs={vector:Dc,raster:ho,"raster-dem":class extends ho{constructor(l,t,r,c){super(l,t,r,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(f,g){f&&(l.state="errored",t(f)),g&&(l.dem=g,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.n(this.map._requestManager.transformRequest(r,s.R.Tile),function(f,g,_){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(g){const v=s.aM(_);this.map._refreshExpiredTiles&&l.setExpiryData(v);const b=ImageBitmap&&g instanceof ImageBitmap&&s.r(),I=1-(g.width-s.aP(g.width))/2;I<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const C=b?g:s.o.getImageData(g,I),O={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:C,encoding:this.encoding,padding:I};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",O,c.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const t=l.canonical,r=Math.pow(2,t.z),c=(t.x-1+r)%r,f=t.x===0?l.wrap-1:l.wrap,g=(t.x+1+r)%r,_=t.x+1===r?l.wrap+1:l.wrap,v={};return v[new s.aQ(l.overscaledZ,f,t.z,c,t.y).key]={backfilled:!1},v[new s.aQ(l.overscaledZ,_,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(v[new s.aQ(l.overscaledZ,f,t.z,c,t.y-1).key]={backfilled:!1},v[new s.aQ(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},v[new s.aQ(l.overscaledZ,_,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<r&&(v[new s.aQ(l.overscaledZ,f,t.z,c,t.y+1).key]={backfilled:!1},v[new s.aQ(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},v[new s.aQ(l.overscaledZ,_,t.z,g,t.y+1).key]={backfilled:!1}),v}},"raster-array":Oo,geojson:class extends s.E{constructor(l,t,r,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const f=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of l.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,r,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:r},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:l},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(r),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.y(c));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(g.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new s.z("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const l=s.B(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const r=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,f=c?{image:c.image.clone()}:null,g=this._partialReload,_={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:g,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};l.request=this.actor.send(r,_,((v,b)=>g&&!b?(l.state="loaded",t(null)):(delete l.request,l.destroy(!1),l.aborted?t(null):v?t(v):(l.loadVectorData(b,this.map.painter,r==="reloadTile"),t(null)))),void 0,r==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(l,t,r,c){super(l,t,r,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aV(this.urls,((t,r)=>{this._loaded=!0,t?this.fire(new s.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(l,t,r,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(l)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=uo(this._options,this.map._requestManager,t,r,((c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new s.y(c))):f&&(Object.assign(this,f),f.bounds&&(this.tileBounds=new Rs(f.bounds,this.minzoom,this.maxzoom)),Gt(f.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)}))}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(r,s.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const g=Object.values(l.buckets);for(const _ of g)_.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,f.bind(this),void 0,!0);function f(g,_){return l.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadModelData(_,this.map.painter),l.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(l,t,r,c){super(l,t,r,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((f=>!Array.isArray(f)||f.length!==2||f.some((g=>typeof g!="number"))))||this.fire(new s.y(new s.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.E{constructor(l,t,r,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:r,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:r,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:r,y:c,z:f}=l.tileID.canonical,g=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:r,y:c,z:f},{signal:g.signal})).then(function(_){return delete l.request,l.aborted?(l.state="unloaded",t(null)):_===void 0?(l.state="errored",t(null)):_===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):(function(v){return v instanceof ImageData||v instanceof HTMLCanvasElement||v instanceof ImageBitmap||v instanceof HTMLImageElement})(_)?(this.loadTileData(l,_),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((_=>{_.name!=="AbortError"&&(l.state="errored",t(_))})),l.request.cancel=()=>g.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof s.T?(l.destroy(!1),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:r,y:c,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:r,y:c,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z})))}_clearTiles(){const l=s.B(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},xo=function(l,t,r,c){const f=new Zs[t.type](l,t,r,c);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return s.aY(["load","abort","unload","serialize","prepare"],f),f};function Gl(l,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${(function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:f,importId:g}=c;return`featureset:${f}${g?`:import:${g}`:""}`}})(l.target)}`}function mr(l,t,r,c=""){if(l.uniqueFeatureID){const f=Gl(l,t,c);if(r.has(f))return!0;r.add(f)}return!1}function xh(l,t,r,c,f=!1){const g=t.sourceCache.transform,_=t.sourceCache.tilesIn(l,t.has3DLayers,f);_.sort(Tu);const v=[];for(const b of _){const I=b.tile.queryRenderedFeatures(t,b,r,c,g,f);Object.keys(I).length&&v.push({wrappedTileID:b.tile.tileID.wrapped().key,queryResults:I})}for(const b in t.layers){const I=t.layers[b];if(I.styleLayer){const C=I.styleLayer.queryRenderedFeatures(l,t.sourceCache,c);Object.keys(C).length&&v.push({wrappedTileID:0,queryResults:C})}}return v.length===0?{}:(function(b){const I={},C={};for(const O of b){const L=O.queryResults,D=O.wrappedTileID,V=C[D]=C[D]||{};for(const j in L){const Z=L[j],q=V[j]=V[j]||{},ee=I[j]=I[j]||[];for(const ie of Z)q[ie.featureIndex]||(q[ie.featureIndex]=!0,ee.push(ie))}}return I})(v)}function wh(l,t,r,c,f,g){const _={},v=c.queryRenderedSymbols(l),b=[];for(const I of Object.keys(v).map(Number))b.push(f[I]);b.sort(Tu);for(const I of b){const C=I.featureIndex.lookupSymbolFeatures(v[I.bucketInstanceId],I.bucketIndex,I.sourceLayerIndex,t,r,g);for(const O in C){const L=_[O]=_[O]||[],D=C[O];D.sort(((V,j)=>{const Z=I.featureSortOrder;if(Z){const q=Z.indexOf(V.featureIndex);return Z.indexOf(j.featureIndex)-q}return j.featureIndex-V.featureIndex}));for(const V of D)L.push(V)}}return _}function bu(l,t){const r=l.getRenderableIds().map((g=>l.getTileByID(g))),c=[],f={};for(let g=0;g<r.length;g++){const _=r[g],v=_.tileID.canonical.key;f[v]||(f[v]=!0,_.querySourceFeatures(c,t))}return c}function Tu(l,t){const r=l.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function Za(l,t){const r={};if(!t)return r;for(const c of l){const f=c.layerIds.map((g=>t.getLayer(g))).filter(Boolean);if(f.length!==0){c.layers=f,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map((g=>f.filter((_=>_.id===g))[0])));for(const g of f)r[g.fqid]=c}}return r}const ps=32,da=33,Xs=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,r=0,c=0,f=0,g=0,_=0,v=0;for(1&t?f=g=_=ps:r=c=v=ps;(t>>=1)>1;){const I=r+f>>1,C=c+g>>1;1&t?(f=r,g=c,r=_,c=v):(r=f,c=g,f=_,g=v),_=I,v=C}const b=4*l;Xs[b+0]=r,Xs[b+1]=c,Xs[b+2]=f,Xs[b+3]=g}const Fo=new Uint16Array(2178),ns=new Uint8Array(1089),ks=new Uint16Array(1089);function Xa(l){return l===0?-.03125:l===32?.03125:0}const dc={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Ys{constructor(t,r,c,f,g,_){this.tileID=t,this.uid=s.b2(),this.uses=0,this.tileSize=r,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection),this.worldview=_,this._hasAppearances=null}registerFadeDuration(t){const r=t+this.timeAdded;r<s.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Za(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof s.b4){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof s.b4&&g.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f],_=r.style.getOwnLayer(f);if(!_)continue;const v=_.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,v)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Za(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,r){for(const g in this.buckets){const _=this.buckets[g];if(_.uploadPending()){let v={},b=[],I={zoom:0,pitch:0,brightness:0,worldview:""};if(r){if(r.style){b=r.style.listImages();const C=_.layers[0],O=C.sourceLayer||"_geojsonTileLayer",L=r.style.getLayerSourceCache(C);L&&(v=L._state.getState(O,void 0))}I={zoom:r.transform.zoom||0,pitch:r.transform.pitch||0,brightness:r.style.getBrightness()||0,worldview:r.worldview||""}}_.upload(t,this.tileID.canonical,v,b,I)}}const c=t.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new s.T(t,f.image,c.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=r.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(r)),(this._lastUpdatedBrightness||f||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==f),this._lastUpdatedBrightness=f))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const r in this.buckets){const c=this.buckets[r];c.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,c.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,r,c,f,g,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const v=this.evaluateQueryRenderedFeaturePadding(),b=(function(I,C){const O=s.bq([],[.5*I.width,.5*-I.height,1]);return s.br(O,O,[1,-1,0]),s.aB(O,O,I.calculateProjMatrix(C.toUnwrapped())),Float32Array.from(O)})(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:b,transform:f,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:v})}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=r?r.sourceLayer:"",_=f._geojsonTileLayer||f[g];if(!_)return;const v=s.b6(r&&r.filter),{z:b,x:I,y:C}=this.tileID.canonical,O={z:b,x:I,y:C};for(let L=0;L<_.length;L++){const D=_.feature(L);if(v.needGeometry){const Z=s.b7(D,!0);if(!v.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Z,this.tileID.canonical))continue}else if(!v.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),D))continue;const V=c.getId(D,g),j=new s.b8(D,b,I,C,V);j.tile=O,t.push(j)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=s.b9(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(r)if(this.expirationTime<r)f=!0;else{const g=this.expirationTime-r;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const r in this.buckets)if(t.style.hasLayer(r)&&this.buckets[r].layers.some((c=>c.appearances&&c.appearances.length>0)))return!0;return!1}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const c=t.style.listImages(),f=t.style.getBrightness();for(const g in this.buckets){if(!t.style.hasLayer(g))continue;const _=this.buckets[g],v=_.layers[0],b=v.sourceLayer||"_geojsonTileLayer",I=t.style.getLayerSourceCache(v);let C={};I&&(C=I._state.getState(b,void 0));const O=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},L=Object.keys(C).length>0&&!r;_.hasAppearances=_.layers.some((j=>j.appearances&&j.appearances.length>0));const D=L?_.stateDependentLayers:_.layers;if(L&&_.stateDependentLayers.length!==0||r){const j=this.latestFeatureIndex.loadVTLayers();_.update(C,j[b],c,O,D,r,f)}if(L&&_.stateDependentLayers.length!==0||r||_.hasAppearances){const j={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};_.updateAppearances(this.tileID.canonical,C,c,j)}(_ instanceof s.ba||_ instanceof s.bb)&&t._terrain&&t._terrain.enabled&&I&&_.uploadPending()&&t._terrain._clearRenderCacheForTile(I.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(g);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,r){const c=r.context,f=c.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(c,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,r){const c={};for(const f of r)c[f]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const f=this.dependencies[c];if(f){for(const g of r)if(f[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const c=s.bc(dc,this.tileID.canonical,this.tileTransform)[0],f=new s.bd,g=new s.be;for(let _=0;_<c.length;_++){const{x:v,y:b}=c[_];f.emplaceBack(v,b),g.emplaceBack(_)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(f,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const c=s.bc(dc,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const _=(function(v,b){const I=s.aZ(v,b),C=Math.pow(2,v.z);for(let Z=0;Z<da;Z++)for(let q=0;q<da;q++){const ee=s.a_((v.x+(q+Xa(q))/ps)/C),ie=s.a$((v.y+(Z+Xa(Z))/ps)/C),te=b.project(ee,ie),ye=Z*da+q;Fo[2*ye+0]=Math.round((te.x*I.scale-I.x)*s.al),Fo[2*ye+1]=Math.round((te.y*I.scale-I.y)*s.al)}ns.fill(0),ks.fill(0);for(let Z=2045;Z>=0;Z--){const q=4*Z,ee=Xs[q+0],ie=Xs[q+1],te=Xs[q+2],ye=Xs[q+3],pe=ee+te>>1,ge=ie+ye>>1,ue=pe+ge-ie,le=ge+ee-pe,xe=ie*da+ee,Re=ye*da+te,Ae=ge*da+pe,$e=Math.hypot((Fo[2*xe+0]+Fo[2*Re+0])/2-Fo[2*Ae+0],(Fo[2*xe+1]+Fo[2*Re+1])/2-Fo[2*Ae+1])>=16;ns[Ae]=ns[Ae]||($e?1:0),Z<1022&&(ns[Ae]=ns[Ae]||ns[(ie+le>>1)*da+(ee+ue>>1)]||ns[(ye+le>>1)*da+(te+ue>>1)])}const O=new s.b1,L=new s.b0;let D=0;function V(Z,q){const ee=q*da+Z;return ks[ee]===0&&(O.emplaceBack(Fo[2*ee+0],Fo[2*ee+1],Z*s.al/ps,q*s.al/ps),ks[ee]=++D),ks[ee]-1}function j(Z,q,ee,ie,te,ye){const pe=Z+ee>>1,ge=q+ie>>1;if(Math.abs(Z-te)+Math.abs(q-ye)>1&&ns[ge*da+pe])j(te,ye,Z,q,pe,ge),j(ee,ie,te,ye,pe,ge);else{const ue=V(Z,q),le=V(ee,ie),xe=V(te,ye);L.emplaceBack(ue,le,xe)}}return j(0,0,ps,ps,ps,0),j(ps,ps,0,0,0,ps),{vertices:O,indices:L}})(this.tileID.canonical,r);f=_.vertices,g=_.indices}else{f=new s.b1,g=new s.b0;for(const{x:v,y:b}of c)f.emplaceBack(v,b,0,0);const _=s.bh(f.int16.subarray(0,4*f.length),void 0,4);for(let v=0;v<_.length;v+=3)g.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,s.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=s.bg.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(t,r){const c=r.projection;if(!c||c.name!=="globe"||r.freezeTileCoverage)return;const f=this.tileID.canonical,g=s.bj(f,r),_=s.bk(g),v=s.aj(r.zoom);let b;v>0&&(b=s.bl(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,r,_,b,v),this._makeGlobeTileDebugTextBuffer(t,f,r,_,b,v)}_globePoint(t,r,c,f,g,_,v){let b=s.bm(t,r,c);if(_){const I=1<<c.z,C=s.aF(f.center.lng),O=s.aJ(f.center.lat),L=(c.x+.5)/I-C;let D=0;L>.5?D=-1:L<-.5&&(D=1);let V=(t/s.al+c.x)/I+D,j=(r/s.al+c.y)/I;V=(V-C)*f._pixelsPerMercatorPixel+C,j=(j-O)*f._pixelsPerMercatorPixel+O;const Z=[V*f.worldSize,j*f.worldSize,0];s.af(Z,Z,_),b=s.bn(b,Z,v)}return s.af(b,b,g)}_makeGlobeTileDebugBorderBuffer(t,r,c,f,g,_){const v=new s.bd,b=new s.be,I=new s.bo,C=(L,D,V,j,Z)=>{const q=(V-L)/(Z-1),ee=(j-D)/(Z-1),ie=v.length;for(let te=0;te<Z;te++){const ye=L+te*q,pe=D+te*ee;v.emplaceBack(ye,pe);const ge=this._globePoint(ye,pe,r,c,f,g,_);I.emplaceBack(ge[0],ge[1],ge[2]),b.emplaceBack(ie+te)}},O=s.al;C(0,0,O,0,16),C(O,0,O,O,16),C(O,O,0,O,16),C(0,O,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(v,s.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(I,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,v.length,b.length)}_makeGlobeTileDebugTextBuffer(t,r,c,f,g,_){const v=s.al/4,b=new s.bd,I=new s.b0,C=new s.bo,O=25;I.reserve(32),b.reserve(O),C.reserve(O);const L=(D,V)=>O*D+V;for(let D=0;D<O;D++){const V=D*v;for(let j=0;j<O;j++){const Z=j*v;b.emplaceBack(Z,V);const q=this._globePoint(Z,V,r,c,f,g,_);C.emplaceBack(q[0],q[1],q[2])}}for(let D=0;D<4;D++)for(let V=0;V<4;V++){const j=L(D,V),Z=L(D,V+1),q=L(D+1,V),ee=L(D+1,V+1);I.emplaceBack(j,Z,q),I.emplaceBack(q,Z,ee)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(I),this._tileDebugTextBuffer=t.createVertexBuffer(b,s.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(C,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,O,32)}destroy(t=!0){for(const r in this.buckets)this.buckets[r].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class Cd extends Ys{constructor(t,r,c,f,g){super(t,r,c,f,g),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,r,c){const f=c.context,g=f.gl;let _=this.texturePerLayer.get(t)||c.getTileTexture(r.width);_&&_ instanceof s.T?_.update(r,{premultiply:!1}):_=new s.T(f,r,g.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,_)}flushQueues(t){const r=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const r=this._workQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const r=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}}fetchHeader(t=16384,r){const c=this._mrt=new s.bs(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bu(f,((g,_,v)=>{if(g)r(g);else try{const b=c.getHeaderLength(_);if(b>t)return void(this.request=this.fetchHeader(b,r));c.parseHeader(_),this._isHeaderLoaded=!0;let I=0;for(const C of Object.values(c.layers))I=Math.max(I,C.dataIndex[C.dataIndex.length-1].lastByte);_.byteLength>=I&&(this.entireBuffer=_),r(null,this.entireBuffer||_,v)}catch(b){r(b)}})),this.request}fetchBandForRender(t,r,c,f){this.fetchBand(t,r,c,(g=>{if(g)return void f(g);this.updateTextureDescriptor(t,r,c);const _=this.textureDescriptorPerLayer.get(r);f(null,_?_.img:null)}))}fetchBand(t,r,c,f,g=!0){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let b;const I=s.B(String(c),s.B(this.tileID.key,t));let C=this._taskQueue.get(I);C?C.add(f):(C=new Set,C.add(f),this._taskQueue.set(I,C));const O=(j,Z)=>{b.complete(j,Z),j?f(j):(C.forEach((q=>q(null,Z))),this._taskQueue.delete(I))},L=(j,Z)=>{if(j)return f(j);const q=v.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Z,task:b},O,void 0,!0);if(r!==null){const ee=this._workQueuePerLayer.get(r)||[];ee.push((()=>{q&&q.cancel(),b.cancel()})),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,ee)}};let D;try{D=_.getLayer(t)}catch(j){if(this.state==="reloading")return;throw j}if(!D)return void f(new Error(`Unknown sourceLayer "${t}"`));if(D.hasDataForBand(c))return C.forEach((j=>j(null,null))),void this._taskQueue.delete(I);const V=D.getDataRange([c]);if(b=_.createDecodingTask(V),!b||b.tasks.length)if(r!==null&&this.flushQueues(r),this.entireBuffer)L(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{const j=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),Z=s.bu(j,L);if(r!==null){const q=this._fetchQueuePerLayer.get(r)||[];q.push((()=>{Z.cancel(),b.cancel()})),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,q)}}}updateNeeded(t,r){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==r||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,r,c){if(!this._mrt)return;const f=this._mrt.getLayer(t);if(!f||!f.hasBand(c)||!f.hasDataForBand(c))return;const{bytes:g,tileSize:_,buffer:v,offset:b,scale:I}=f.getBandView(c),C=_+2*v,O=new s.q({width:C,height:C},g),L=this.texturePerLayer.get(r);L&&L instanceof s.T&&L.update(O,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:c,img:O,buffer:v,offset:b,tileSize:_,format:f.pixelFormat,mix:[I,256*I,65536*I,16777216*I]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof s.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class kf{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:r,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout((()=>{this.remove(t,g)}),c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,f=r===void 0?0:this.data[c].indexOf(r),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||r.push(f);for(const c of r)this.remove(c.value.tileID,c)}}class $l{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const f=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},Object.assign(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==f&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const g in this.state[t][f])c[g]||(this.deletedStates[t][f][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][g]===null&&delete this.deletedStates[t][f][g]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const f=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,r){const c=this.state[t]||{},f=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(r!==void 0){const v=String(r),b=Object.assign({},c[v],f[v]);if(g){const I=g[r];if(I===null)return{};for(const C in I)delete b[C]}return b}const _=Object.assign({},c,f);if(g)for(const v in g)delete _[v];return _}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const _ in this.stateChanges[f])this.state[f][_]||(this.state[f][_]={}),Object.assign(this.state[f][_],this.stateChanges[f][_]),g[_]=this.state[f][_];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const _ in this.state[f])g[_]={},this.state[f][_]={};else for(const _ in this.deletedStates[f]){if(this.deletedStates[f][_]===null)this.state[f][_]={};else if(this.state[f][_])for(const v of Object.keys(this.deletedStates[f][_]))delete this.state[f][_][v];g[_]=this.state[f][_]}c[f]=c[f]||{},Object.assign(c[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].refreshFeatureState(r)}}class Ks extends s.E{constructor(t,r,c){super(),this.id=t,this._onlySymbols=c,r.on("data",(f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),r.on("error",(()=>{this._sourceErrored=!0})),this._source=r,this._tiles={},this._cache=new kf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $l,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t,this.map?this.map.painter:void 0),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(bh).map((t=>t.key))}getRenderableIds(t,r){const c=[];for(const f in this._tiles)this._isIdRenderable(+f,t,r)&&c.push(this._tiles[f]);return t?c.sort(((f,g)=>{const _=f.tileID,v=g.tileID,b=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),I=new s.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||I.y-b.y||I.x-b.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(bh).map((f=>f.key))}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),this._loadTile(c,this._tileLoaded.bind(this,c,t,r)))}_tileLoaded(t,r,c,f,g){if(f){if(t.state="errored",f.status!==404)this._source.fire(new s.y(f,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=s.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let _=new Map;g&&g.responseHeaders&&(_=g.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:_}))}_backfillDEM(t){const r=this.getRenderableIds();for(let f=0;f<r.length;f++){const g=r[f];if(t.neighboringTiles&&t.neighboringTiles[g]){const _=this.getTileByID(g);c(t,_),c(_,t)}}function c(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let _=g.tileID.canonical.x-f.tileID.canonical.x;const v=g.tileID.canonical.y-f.tileID.canonical.y,b=Math.pow(2,f.tileID.canonical.z),I=g.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,_,v),f.neighboringTiles&&f.neighboringTiles[I]&&(f.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,f){for(const g in this._tiles){let _=this._tiles[g];if(f[g]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>c)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const I=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[I.key],_&&_.hasData()&&(v=I)}let b=v;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){f[v.key]=v;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const f=t.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const c=Math.ceil(t.width/r)+1,f=Math.ceil(t.height/r)+1,g=Math.floor(c*f*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),c[g.tileID.key]=g}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,r,c,f,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let v,b=this._source.maxzoom;const I=this.map&&this.map.painter?this.map.painter._terrain:null;if(I&&I.sourceCache===this&&I.attenuationRange()){const L=I.attenuationRange()[0],D=Math.floor(L)-Math.log2(I.getDemUpscale());b>D&&(b=D)}if(this.used||this.usedForTerrain){if(this._source.tileID)v=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((L=>new s.aQ(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y)));else if(this.tileCoverLift!==0){const L=t.clone();L.tileCoverLift=this.tileCoverLift,v=L.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(v.push(new s.aQ(1,0,1,0,0)),v.push(new s.aQ(1,0,1,1,0)),v.push(new s.aQ(1,0,1,0,1)),v.push(new s.aQ(1,0,1,1,1)))}else if(v=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const L=this._source.hasTile.bind(this._source);v=v.filter((D=>L(D)))}}else v=[];if(v.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!vl(this._source.type)){const L=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),D=Math.min(L,this._source.maxzoom);if(_){const V=t.extendTileCover(v,D);for(const j of V)v.push(j)}else if(g){const V=t.extendTileCoverToNearPlane(v,this.transform.getFrustum(D),D);for(const j of V)v.push(j)}else if(this.castsShadows&&f){const V=t.extendTileCover(v,D,f,16);for(const j of V)this._shadowCasterTiles[j.key]=!0,v.push(j)}}const C=this._updateRetainedTiles(v);if(vl(this._source.type)&&v.length!==0){const L={},D={},V=Object.keys(C);for(const Z of V){const q=C[Z],ee=this._tiles[Z];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=s.o.now())continue;const ie=this.findLoadedParent(q,Math.max(q.overscaledZ-Ks.maxOverzooming,this._source.minzoom));ie&&(this._addTile(ie.tileID),L[ie.tileID.key]=ie.tileID),D[Z]=q}const j=v[v.length-1].overscaledZ;for(const Z in this._tiles){const q=this._tiles[Z];if(C[Z]||!q.hasData())continue;let ee=q.tileID;for(;ee.overscaledZ>j;){ee=ee.scaledTo(ee.overscaledZ-1);const ie=this._tiles[ee.key];if(ie&&ie.hasData()&&D[ee.key]){C[Z]=q.tileID;break}}}for(const Z in L)C[Z]||(this._coveredTiles[Z]=!0,C[Z]=L[Z])}for(const L in C)this._tiles[L].clearFadeHold();const O=s.bv(this._tiles,C);for(const L of O){const D=this._tiles[L];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+L)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const c={},f=t.reduce(((I,C)=>Math.min(I,C.overscaledZ)),1/0),g=t[0].overscaledZ,_=Math.max(g-Ks.maxOverzooming,this._source.minzoom),v=Math.max(g+Ks.maxUnderzooming,this._source.minzoom),b={};for(const I of t){const C=this._addTile(I);r[I.key]=I,C.hasData()||f<this._source.maxzoom&&(b[I.key]=I)}this._retainLoadedChildren(b,f,v,r);for(const I of t){let C=this._tiles[I.key];if(C.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const L=I.children(this._source.maxzoom)[0],D=this.getTile(L);if(D&&D.hasData()){r[L.key]=L;continue}}else{const L=I.children(this._source.maxzoom);if(r[L[0].key]&&r[L[1].key]&&r[L[2].key]&&r[L[3].key])continue}let O=C.wasRequested();for(let L=I.overscaledZ-1;L>=_;--L){const D=I.scaledTo(L);if(c[D.key]||(c[D.key]=!0,C=this.getTile(D),!C&&O&&(C=this._addTile(D)),C&&(r[D.key]=D,O=C.wasRequested(),C.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}r.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(const g of r)this._loadedParentTiles[g]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=!!r;if(!c){const f=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new Cd(t,g,this.transform.tileZoom,f,this._isRaster):new Ys(t,g,this.transform.tileZoom,f,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,c||this._source.fire(new s.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,c){const f=[],g=this.transform;if(!g)return f;const _=g.projection.name==="globe",v=s.aF(g.center.lng);for(const b in this._tiles){const I=this._tiles[b];if(c&&I.clearQueryDebugViz(),I.holdingForFade())continue;let C;if(_){const O=I.tileID.canonical;if(O.z===0){const L=[Math.abs(s.aA(v,...xl(O,-1))-v),Math.abs(s.aA(v,...xl(O,1))-v)];C=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(s.aA(v,...xl(O,-1))-v),Math.abs(s.aA(v,...xl(O,0))-v),Math.abs(s.aA(v,...xl(O,1))-v)];C=[L.indexOf(Math.min(...L))-1]}}else C=[0];for(const O of C){const L=t.containsTile(I,g,r,O);L&&f.push(L)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const c=this.getRenderableIds(t,r).map((g=>this._tiles[g].tileID)),f=this.transform.projection.name==="globe";for(const g of c)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=f?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return c}sortCoordinatesByDistance(t){const r=t.slice(),c=this.transform._camera.position,f=this.transform._camera.forward(),g={};for(const _ of r){const v=1/(1<<_.canonical.z);g[_.key]=((_.canonical.x+.5)*v+_.wrap-c[0])*f[0]+((_.canonical.y+.5)*v-c[1])*f[1]-c[2]*f[2]}return r.sort(((_,v)=>g[_.key]-g[v.key])),r}hasTransition(){if(this._source.hasTransition())return!0;if(vl(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const f=this._tiles[t];f&&f.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(+c,"reloading");this._cache.filter((c=>!c.hasDependency(t,r)))}_preloadTiles(t,r){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(t,r))};return void this._source.on("data",b)}const c=new Map,f=Array.isArray(t)?t:[t],g=this.map.painter.terrain,_=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const b of f){const I=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of I)c.set(C.key,C);this.usedForTerrain&&b.updateElevation(!1)}const v=Array.from(c.values());s.bw(v,((b,I)=>{const C=new Ys(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(C,(O=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),I(O,C)}))}),r)}}function bh(l,t){const r=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-r||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function vl(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function xl(l,t){const r=1<<l.z;return[l.x/r+t,(l.x+1)/r+t]}Ks.maxOverzooming=10,Ks.maxUnderzooming=3;class _m{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const c in this.style._mergedLayers){const f=this.style._mergedLayers[c];if(f.type==="fill-extrusion"||f.type==="building")this.layers.push({layer:f,visible:t,visibilityChanged:r});else if(f.type==="model"){const g=this.style.getLayerSource(f);g&&g.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const c=r.layer;let f=!1;c.type==="fill-extrusion"?f=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?f=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(f=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!f&&r.visible,r.visible=f}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const f of this.layers){const g=f.layer,_=this.style.getLayerSourceCache(g);let v=1;g.type==="fill-extrusion"?v=f.visible?g.paint.get("fill-extrusion-vertical-scale"):0:g.type==="building"&&(v=f.visible?g.paint.get("building-vertical-scale"):0);let b=_?_.getTile(r):null;if(!b&&_)for(const I in _._tiles){const C=_._tiles[I];if(r.canonical.isChildOf(C.tileID.canonical)){b=C;break}}this.currentBuildingBuckets.push({bucket:b?b.getBucket(g):null,tileID:b?b.tileID:r,verticalScale:v})}t.hasAnyZOffset=!1;let c=!1;for(let f=0;f<t.symbolInstances.length;f++){const g=t.symbolInstances.get(f),_=g.zOffset,v=this._getHeightAtTileOffset(r,g.tileAnchorX,g.tileAnchorY);g.zOffset=v!==Number.NEGATIVE_INFINITY?v:_,c||_===g.zOffset||(c=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,c,f){let g=r,_=c;if(t.canonical.z!==f.canonical.z){const v=f.canonical,b=1/(1<<t.canonical.z-v.z);g=(r+t.canonical.x*s.al)*b-v.x*s.al|0,_=(c+t.canonical.y*s.al)*b-v.y*s.al|0}return{tileX:g,tileY:_}}_getHeightAtTileOffset(t,r,c){let f,g;for(let _=0;_<this.layers.length;++_){const v=this.layers[_].layer;if(v.type!=="fill-extrusion"&&v.type!=="building")continue;const{bucket:b,tileID:I,verticalScale:C}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:O,tileY:L}=this._mapCoordToOverlappingTile(t,r,c,I),D=b.getHeightAtTileCoord(O,L);D&&D.height!==void 0&&(D.hidden?f=D.height:g=Math.max(D.height*C,g||0))}if(g!==void 0)return g;for(let _=0;_<this.layers.length;++_){const v=this.layers[_];if(v.layer.type!=="model"||!v.visible)continue;const{bucket:b,tileID:I}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:C,tileY:O}=this._mapCoordToOverlappingTile(t,r,c,I),L=b.getHeightAtTileCoord(C,O);if(L&&!L.hidden)return L.height===void 0&&f!==void 0?Math.min(L.maxHeight,f)*L.verticalScale:L.height?L.height*L.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Su(l,t){const r={};for(const c in l)c!=="ref"&&(r[c]=l[c]);return s.bx.forEach((c=>{c in t&&(r[c]=t[c])})),r}function Hl(l){l=l.slice();const t=Object.create(null);for(let r=0;r<l.length;r++)t[l[r].id]=l[r];for(let r=0;r<l.length;r++)"ref"in l[r]&&(l[r]=Su(l[r],t[l[r].ref]));return l}const ci={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Oc(l,t,r){r.push({command:ci.addSource,args:[l,t[l]]})}function zf(l,t,r){t.push({command:ci.removeSource,args:[l]}),r[l]=!0}function Tp(l,t,r,c){zf(l,r,c),Oc(l,t,r)}function Md(l,t,r){let c;for(c in l[r])if(l[r].hasOwnProperty(c)&&c!=="data"&&!s.by(l[r][c],t[r][c]))return!1;for(c in t[r])if(t[r].hasOwnProperty(c)&&c!=="data"&&!s.by(l[r][c],t[r][c]))return!1;return!0}function Ya(l,t,r,c,f,g){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(s.by(l[_],t[_])||r.push({command:g,args:[c,_,t[_],f]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(s.by(l[_],t[_])||r.push({command:g,args:[c,_,t[_],f]}))}function Fc(l){return l.id}function Eu(l,t){return l[t.id]=t,l}function wl(l,t,r){const c=t.createTileMatrix(l,l.worldSize,r.toUnwrapped());return s.aB(new Float32Array(16),l.projMatrix,c)}function Iu(l,t,r){if(t.projection.name===r.projection.name)return l.projMatrix;const c=r.clone();return c.setProjection(t.projection),wl(c,t.getProjection(),l)}function fa(l,t,r){return t.name===r.projection.name?l.projMatrix:wl(r,t,l)}class Au{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let r=1,c=this._distances[r];const f=t*this.paddedLength+this.padding;for(;c<f&&r<this._distances.length;)c=this._distances[++r];const g=r-1,_=this._distances[g],v=c-_,b=v>0?(f-_)/v:0;return this.points[g].mult(1-b).add(this.points[r].mult(b))}}class Cu{constructor(t,r,c){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let _=0;_<this.xCellCount*this.yCellCount;_++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,f,g){this._forEachCell(r,c,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(t,r,c,f){this._forEachCell(r-f,c-f,r+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,r,c,f,g,_){this.boxCells[g].push(_)}_insertCircleCell(t,r,c,f,g,_){this.circleCells[g].push(_)}_query(t,r,c,f,g,_){if(c<0||t>this.width||f<0||r>this.height)return!g&&[];const v=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=f){if(g)return!0;for(let b=0;b<this.boxKeys.length;b++)v.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const I=this.circles[3*b],C=this.circles[3*b+1],O=this.circles[3*b+2];v.push({key:this.circleKeys[b],x1:I-O,y1:C-O,x2:I+O,y2:C+O})}return _?v.filter(_):v}return this._forEachCell(t,r,c,f,this._queryCell,v,{hitTest:g,seenUids:{box:{},circle:{}}},_),g?v.length>0:v}_queryCircle(t,r,c,f,g){const _=t-c,v=t+c,b=r-c,I=r+c;if(v<0||_>this.width||I<0||b>this.height)return!f&&[];const C=[];return this._forEachCell(_,b,v,I,this._queryCellCircle,C,{hitTest:f,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},g),f?C.length>0:C}query(t,r,c,f,g){return this._query(t,r,c,f,!1,g)}hitTest(t,r,c,f,g){return this._query(t,r,c,f,!0,g)}hitTestCircle(t,r,c,f){return this._queryCircle(t,r,c,!0,f)}_queryCell(t,r,c,f,g,_,v,b){const I=v.seenUids,C=this.boxCells[g];if(C!==null){const L=this.bboxes;for(const D of C)if(!I.box[D]){I.box[D]=!0;const V=4*D;if(t<=L[V+2]&&r<=L[V+3]&&c>=L[V+0]&&f>=L[V+1]&&(!b||b(this.boxKeys[D]))){if(v.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[D],x1:L[V],y1:L[V+1],x2:L[V+2],y2:L[V+3]})}}}const O=this.circleCells[g];if(O!==null){const L=this.circles;for(const D of O)if(!I.circle[D]){I.circle[D]=!0;const V=3*D;if(this._circleAndRectCollide(L[V],L[V+1],L[V+2],t,r,c,f)&&(!b||b(this.circleKeys[D]))){if(v.hitTest)return _.push(!0),!0;{const j=L[V],Z=L[V+1],q=L[V+2];_.push({key:this.circleKeys[D],x1:j-q,y1:Z-q,x2:j+q,y2:Z+q})}}}}}_queryCellCircle(t,r,c,f,g,_,v,b){const I=v.circle,C=v.seenUids,O=this.boxCells[g];if(O!==null){const D=this.bboxes;for(const V of O)if(!C.box[V]){C.box[V]=!0;const j=4*V;if(this._circleAndRectCollide(I.x,I.y,I.radius,D[j+0],D[j+1],D[j+2],D[j+3])&&(!b||b(this.boxKeys[V])))return _.push(!0),!0}}const L=this.circleCells[g];if(L!==null){const D=this.circles;for(const V of L)if(!C.circle[V]){C.circle[V]=!0;const j=3*V;if(this._circlesCollide(D[j],D[j+1],D[j+2],I.x,I.y,I.radius)&&(!b||b(this.circleKeys[V])))return _.push(!0),!0}}}_forEachCell(t,r,c,f,g,_,v,b){const I=this._convertToXCellCoord(t),C=this._convertToYCellCoord(r),O=this._convertToXCellCoord(c),L=this._convertToYCellCoord(f);for(let D=I;D<=O;D++)for(let V=C;V<=L;V++)if(g.call(this,t,r,c,f,this.xCellCount*V+D,_,v,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,f,g,_){const v=f-t,b=g-r,I=c+_;return I*I>v*v+b*b}_circleAndRectCollide(t,r,c,f,g,_,v){const b=(_-f)/2,I=Math.abs(t-(f+b));if(I>b+c)return!1;const C=(v-g)/2,O=Math.abs(r-(g+C));if(O>C+c)return!1;if(I<=b||O<=C)return!0;const L=I-b,D=O-C;return L*L+D*D<=c*c}}const Ka={unknown:0,flipRequired:1,flipNotRequired:2},fc=Math.tan(85*Math.PI/180);function kr(l,t,r,c,f,g,_){const v=s.bC();if(r)if(g.name==="globe"){const b=s.bD(f,t);s.aB(v,v,b)}else{const b=s.bE([],_);v[0]=b[0],v[1]=b[1],v[4]=b[2],v[5]=b[3],c||s.bB(v,v,f.angle)}else s.aB(v,f.labelPlaneMatrix,l);return v}function Wl(l,t,r,c,f,g,_){const v=kr(l,t,r,c,f,g,_);return g.name==="globe"&&r||(v[2]=v[6]=v[10]=v[14]=0),v}function Bc(l,t,r,c,f,g,_){if(r){if(g.name==="globe"){const v=kr(l,t,r,c,f,g,_);return s.bl(v,v),s.aB(v,l,v),v}{const v=s.bz(l),b=s.bA([]);return b[0]=_[0],b[1]=_[1],b[4]=_[2],b[5]=_[3],s.aB(v,v,b),c||s.bB(v,v,-f.angle),v}}return f.glCoordMatrix}function ms(l,t,r,c){const f=[l,t,r,1];r?s.aC(f,f,c):un(f,f,c);const g=f[3];return f[0]/=g,f[1]/=g,f[2]/=g,f}function Vi(l,t){return Math.min(.5+l/t*.5,1.5)}function Pd(l,t){const r=l[0]/l[3],c=l[1]/l[3];return r>=-t[0]&&r<=t[0]&&c>=-t[1]&&c<=t[1]}function Rd(l,t,r,c,f,g,_,v,b,I,C=1){const O=r.transform,L=c?l.textSizeData:l.iconSizeData,D=s.bK(L,r.transform.zoom,C),V=O.projection.name==="globe",j=[256/r.width*2+1,256/r.height*2+1],Z=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();let q=null;V&&(q=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const ee=l.lineVertexArray,ie=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,te=r.transform.width/r.transform.height;let ye,pe=!1;for(let ge=0;ge<ie.length;ge++){const ue=ie.get(ge),{numGlyphs:le,writingMode:xe}=ue;if(xe!==s.bL.vertical||pe||ye===s.bL.horizontal||(pe=!0),ye=xe,(ue.hidden||xe===s.bL.vertical)&&!pe){pa(le,Z);continue}pe=!1;const Re=new s.P(ue.tileAnchorX,ue.tileAnchorY),Ae=l.elevationType==="road",$e=!!O.elevation||Ae;let{x:He,y:it,z:xt}=O.projection.projectTilePoint(Re.x,Re.y,I.canonical),Ne=null;if($e){const Ht=Ae?l.getElevationFeatureForText(ge):null;Ne={getElevation:b,elevation:O.elevation,elevationFeature:Ht};const[_n,An,si]=b(Re,O.elevation,Ht);He+=_n,it+=An,xt+=si}const Ee=[He,it,xt,1];if(s.aC(Ee,Ee,t),!Pd(Ee,j)){pa(le,Z);continue}const We=Ee[3],Ue=Vi(r.transform.getCameraToCenterDistance(O.projection),We),dt=s.bM(L,D,ue),Rt=_?dt/Ue:dt*Ue,Lt=ms(He,it,xt,f);if(Lt[3]<=0){pa(le,Z);continue}let At={};const wt=s.an(l.layers[0].layout.get("text-max-angle")),tn=Math.cos(wt),Yt=_?null:Ne,Bt=kd(ue,Rt,!1,v,t,f,g,l.glyphOffsetArray,ee,Z,q,Lt,Re,At,te,Yt,O.projection,I,_,tn);pe=Bt.useVertical,Yt&&Bt.needsFlipping&&(At={}),(Bt.notEnoughRoom||pe||Bt.needsFlipping&&kd(ue,Rt,!0,v,t,f,g,l.glyphOffsetArray,ee,Z,q,Lt,Re,At,te,Yt,O.projection,I,_,tn).notEnoughRoom)&&pa(le,Z)}c?(l.text.dynamicLayoutVertexBuffer.updateData(Z),q&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(q)):(l.icon.dynamicLayoutVertexBuffer.updateData(Z),q&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(q))}function Mu(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z){const{lineStartIndex:q,glyphStartIndex:ee,segment:ie}=v,te=ee+v.numGlyphs,ye=q+v.lineLength,pe=t.getoffsetX(ee),ge=t.getoffsetX(te-1),ue=Pu(l*pe,r,c,f,g,_,ie,q,ye,b,I,C,O,L,!0,D,V,j,Z);if(!ue)return null;const le=Pu(l*ge,r,c,f,g,_,ie,q,ye,b,I,C,O,L,!0,D,V,j,Z);return le?{first:ue,last:le}:null}function bn(l,t,r,c){return l===s.bL.horizontal&&Math.abs(c)>Math.abs(r)?{useVertical:!0}:l===s.bL.vertical?c>0?{needsFlipping:!0}:null:t!==Ka.unknown&&(function(f,g){return f===0||Math.abs(g/f)>fc})(r,c)?t===Ka.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function kd(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee,ie){const te=t/24,ye=l.lineOffsetX*te,pe=l.lineOffsetY*te,{lineStartIndex:ge,glyphStartIndex:ue,numGlyphs:le,segment:xe,writingMode:Re,flipState:Ae}=l,$e=ge+l.lineLength,He=it=>{if(C){const[We,Ue,dt]=it.up,Rt=I.length;s.bN(C,Rt+0,We,Ue,dt),s.bN(C,Rt+1,We,Ue,dt),s.bN(C,Rt+2,We,Ue,dt),s.bN(C,Rt+3,We,Ue,dt)}const[xt,Ne,Ee]=it.point;s.bO(I,xt,Ne,Ee,it.angle)};if(le>1){const it=Mu(te,v,ye,pe,r,O,L,l,b,g,D,j,!1,Z,q,ee,ie);if(!it)return{notEnoughRoom:!0};if(c&&!r){let[xt,Ne,Ee]=it.first.point,[We,Ue,dt]=it.last.point;[xt,Ne]=ms(xt,Ne,Ee,_),[We,Ue]=ms(We,Ue,dt,_);const Rt=bn(Re,Ae,(We-xt)*V,Ue-Ne);if(l.flipState=Rt&&Rt.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,Rt)return Rt}He(it.first);for(let xt=ue+1;xt<ue+le-1;xt++){const Ne=Pu(te*v.getoffsetX(xt),ye,pe,r,O,L,xe,ge,$e,b,g,D,j,!1,!1,Z,q,ee,ie);if(!Ne)return I.length-=4*(xt-ue),{notEnoughRoom:!0};He(Ne)}He(it.last)}else{if(c&&!r){const xt=ms(L.x,L.y,0,f),Ne=ge+xe+1,Ee=new s.P(b.getx(Ne),b.gety(Ne)),We=ms(Ee.x,Ee.y,0,f),Ue=We[3]>0?We:za(L,Ee,xt,1,f,void 0,Z,q.canonical),dt=bn(Re,Ae,(Ue[0]-xt[0])*V,Ue[1]-xt[1]);if(l.flipState=dt&&dt.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,dt)return dt}const it=Pu(te*v.getoffsetX(ue),ye,pe,r,O,L,xe,ge,$e,b,g,D,j,!1,!1,Z,q,ee,ie);if(!it)return{notEnoughRoom:!0};He(it)}return{}}function Th(l,t,r,c,f){const{x:g,y:_,z:v}=c.projectTilePoint(l.x,l.y,t);if(!f)return ms(g,_,v,r);const[b,I,C]=f.getElevation(l,f.elevation,f.elevationFeature);return ms(g+b,_+I,v+C,r)}function za(l,t,r,c,f,g,_,v){const b=Th(l.sub(t)._unit()._add(l),v,f,_,g);return s.av(b,r,b),s.aw(b,b),s.bH(b,r,b,c)}function Pu(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee){const ie=c?l-t:l+t;let te=ie>0?1:-1,ye=0;c&&(te*=-1,ye=Math.PI),te<0&&(ye+=Math.PI);let pe=v+_+(te>0?0:1)|0,ge=f,ue=f,le=0,xe=0;const Re=Math.abs(ie),Ae=[],$e=[];let He=g,it=He,xt=s.bF([]);const Ne=()=>za(it,He,ue,Re-le+1,C,L,j,Z.canonical);for(;le+xe<=Re;){if(pe+=te,pe<v||pe>=b)return null;if(ue=ge,it=He,Ae.push(ue),D&&$e.push(it),He=new s.P(I.getx(pe),I.gety(pe)),ge=O[pe],!ge){const Yt=Th(He,Z.canonical,C,j,L);ge=Yt[3]>0?O[pe]=Yt:Ne()}le+=xe;const wt=s.av([],ge,ue),tn=s.bG(ue,ge);if(r&&tn>0&&xe>0&&s.bJ(xt,wt)/(xe*tn)<ee)return null;xe=tn,xt=wt}V&&L&&(O[pe]&&(ge=Ne(),xe=s.bG(ue,ge),xt=s.av([],ge,ue)),O[pe]=ge);const Ee=(Re-le)/xe,We=He.sub(it)._mult(Ee)._add(it),Ue=s.bH([],ue,xt,Ee);let dt=[0,0,1],Rt=xt[0],Lt=xt[1];if(q&&(dt=j.upVector(Z.canonical,We.x,We.y),dt[0]!==0||dt[1]!==0||dt[2]!==1)){const wt=[dt[2],0,-dt[0]],tn=s.bI([],dt,wt);s.aw(wt,wt),s.aw(tn,tn),Rt=s.bJ(xt,wt),Lt=s.bJ(xt,tn)}if(r){const wt=s.bI([],dt,xt);s.aw(wt,wt),s.bH(Ue,Ue,wt,r*te)}const At=ye+Math.atan2(Lt,Rt);return Ae.push(Ue),D&&$e.push(We),{point:Ue,angle:At,path:Ae,tilePath:$e,up:dt}}function pa(l,t){const r=t.length,c=r+4*l;t.resize(c),t.float32.fill(-1/0,4*r,4*c)}function un(l,t,r){const c=t[0],f=t[1];return l[0]=r[0]*c+r[4]*f+r[12],l[1]=r[1]*c+r[5]*f+r[13],l[3]=r[3]*c+r[7]*f+r[15],l}const yi=100;class $i{constructor(t,r,c=new Cu(t.width+200,t.height+200,25),f=new Cu(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+yi,this.screenBottomBoundary=t.height+yi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,c,f,g,_,v,b,I,C,O){let L=c.projectedAnchorX,D=c.projectedAnchorY,V=c.projectedAnchorZ;const j=c.tileAnchorX,Z=c.tileAnchorY,q=c.elevation,ee=c.tileID,ie=t.getProjection();if(q&&ee){const[$e,He,it]=ie.upVector(ee.canonical,c.tileAnchorX,c.tileAnchorY),xt=ie.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=$e*q*xt,D+=He*q*xt,V+=it*q*xt}const te=t.projection.name==="globe",ye=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(ee&&te&&ye<1&&!_){const $e=1<<ee.canonical.z,He=s.bP(j,Z);s.bQ(He,He,1/s.al),s.bR(He,He,s.bP(ee.canonical.x,ee.canonical.y)),s.bQ(He,He,1/$e),s.bS(He,He,s.bP(f[0],f[1])),He[0]=s.bT(He[0],-.5,.5),s.bQ(He,He,s.al);const it=s.bU(He[0],He[1],s.al/(2*Math.PI),1);s.aC(it,it,g),L=s.ak(L,it[0],ye),D=s.ak(D,it[1],ye),V=s.ak(V,it[2],ye)}const pe=this.projectAndGetPerspectiveRatio(C,L,D,V,c.tileID,ie.name==="globe"||!!q||this.transform.pitch>0,ie),ge=I*pe.perspectiveRatio,ue=(c.x1*r+v.x-c.padding)*ge+pe.point.x,le=(c.y1*r+v.y-c.padding)*ge+pe.point.y,xe=(c.x2*r+v.x+c.padding)*ge+pe.point.x,Re=(c.y2*r+v.y+c.padding)*ge+pe.point.y,Ae=pe.perspectiveRatio<=.55||pe.occluded;return!this.isInsideGrid(ue,le,xe,Re)||!b&&this.grid.hitTest(ue,le,xe,Re,O)||Ae?{box:[],offscreen:!1,occluded:pe.occluded}:{box:[ue,le,xe,Re],offscreen:this.isOffscreen(ue,le,xe,Re),occluded:!1}}placeCollisionCircles(t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z){const q=[],ee=this.transform.elevation,ie=t.getProjection(),te=t.elevationType==="road",ye=!!ee||te,pe=s.bV.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ie),ge=new s.P(c.tileAnchorX,c.tileAnchorY),ue=new s.P(c.tileAnchorX,c.tileAnchorY);let{x:le,y:xe,z:Re}=ie.projectTilePoint(ue.x,ue.y,Z.canonical),Ae=null;if(ye){const tn=te?t.getElevationFeatureForText(f):null;Ae={getElevation:pe,elevation:ee,elevationFeature:tn};const[Yt,Bt,Ht]=pe(ge,ee,tn);le+=Yt,xe+=Bt,Re+=Ht}const $e=ie.name==="globe",He=this.projectAndGetPerspectiveRatio(b,le,xe,Re,Z,$e||!!ee||this.transform.pitch>0,ie),{perspectiveRatio:it}=He,xt=(L?v/it:v*it)/s.bY,Ne=ms(le,xe,Re,I),Ee=c.lineOffsetX*xt,We=c.lineOffsetY*xt,Ue=s.an(t.layers[0].layout.get("text-max-angle")),dt=Math.cos(Ue),Rt=He.signedDistanceFromCamera>0?Mu(xt,_,Ee,We,te&&c.flipState===1,Ne,ue,c,g,I,{},ye&&!L?Ae:null,L&&ye,ie,Z,L,dt):null;let Lt=!1,At=!1,wt=!0;if(Rt&&!He.occluded){const tn=.5*V*it+j,Yt=new s.P(-100,-100),Bt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new Au,{first:_n,last:An}=Rt,si=_n.path.length;let Ri=[];for(let Mn=si-1;Mn>=1;Mn--)Ri.push(_n.path[Mn]);for(let Mn=1;Mn<An.path.length;Mn++)Ri.push(An.path[Mn]);const Kt=2.5*tn;C&&(Ri=Ri.map((([Mn,Ai,ji],Fi)=>(ye&&!$e&&(ji=pe(Fi<si-1?_n.tilePath[si-1-Fi]:An.tilePath[Fi-si+2],ee,Ae.elevationFeature)[2]),ms(Mn,Ai,ji,C)))),Ri.some((Mn=>Mn[3]<=0))&&(Ri=[]));let wi=[];if(Ri.length>0){let Mn=1/0,Ai=-1/0,ji=1/0,Fi=-1/0;for(const Ii of Ri)Mn=Math.min(Mn,Ii[0]),ji=Math.min(ji,Ii[1]),Ai=Math.max(Ai,Ii[0]),Fi=Math.max(Fi,Ii[1]);Ai>=Yt.x&&Mn<=Bt.x&&Fi>=Yt.y&&ji<=Bt.y&&(wi=[Ri.map((Ii=>new s.P(Ii[0],Ii[1])))],(Mn<Yt.x||Ai>Bt.x||ji<Yt.y||Fi>Bt.y)&&(wi=s.bW(wi,Yt.x,Yt.y,Bt.x,Bt.y)))}for(const Mn of wi){Ht.reset(Mn,.25*tn);let Ai=0;Ai=Ht.length<=.5*tn?1:Math.ceil(Ht.paddedLength/Kt)+1;for(let ji=0;ji<Ai;ji++){const Fi=ji/Math.max(Ai-1,1),Ii=Ht.lerp(Fi),Gn=Ii.x+yi,zi=Ii.y+yi;q.push(Gn,zi,tn,0);const _r=Gn-tn,ur=zi-tn,Ci=Gn+tn,hi=zi+tn;if(wt=wt&&this.isOffscreen(_r,ur,Ci,hi),At=At||this.isInsideGrid(_r,ur,Ci,hi),!r&&this.grid.hitTestCircle(Gn,zi,tn,D)&&(Lt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Lt,occluded:!1}}}}return{circles:!O&&Lt||!At?[]:q,offscreen:wt,collisionDetected:Lt,occluded:He.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,f=1/0,g=-1/0,_=-1/0;for(const C of t){const O=new s.P(C.x+yi,C.y+yi);c=Math.min(c,O.x),f=Math.min(f,O.y),g=Math.max(g,O.x),_=Math.max(_,O.y),r.push(O)}const v=this.grid.query(c,f,g,_).concat(this.ignoredGrid.query(c,f,g,_)),b={},I={};for(const C of v){const O=C.key;if(b[O.bucketInstanceId]===void 0&&(b[O.bucketInstanceId]={}),b[O.bucketInstanceId][O.featureIndex])continue;const L=[new s.P(C.x1,C.y1),new s.P(C.x2,C.y1),new s.P(C.x2,C.y2),new s.P(C.x1,C.y2)];s.bX(r,L)&&(b[O.bucketInstanceId][O.featureIndex]=!0,I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]=[]),I[O.bucketInstanceId].push(O.featureIndex))}return I}insertCollisionBox(t,r,c,f,g){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,f,g){const _=r?this.ignoredGrid:this.grid,v={bucketInstanceId:c,featureIndex:f,collisionGroupID:g};for(let b=0;b<t.length;b+=4)_.insertCircle(v,t[b],t[b+1],t[b+2])}projectAndGetPerspectiveRatio(t,r,c,f,g,_,v){const b=[r,c,f,1];let I=!1;f||this.transform.pitch>0?(s.aC(b,b,t),this.fogState&&g&&v.name!=="globe"&&(I=(function(L,D,V,j,Z,q){const ee=q.calculateFogTileMatrix(Z),ie=[D,V,j];return s.af(ie,ie,ee),Xt(L,s.ag(ie),q.pitch,q._fov)})(this.fogState,r,c,f,g.toUnwrapped(),this.transform)>.9)):un(b,b,t);const C=b[3];return{point:new s.P((b[0]/C+1)/2*this.transform.width+yi,(-b[1]/C+1)/2*this.transform.height+yi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/C*.5,1.5),signedDistanceFromCamera:C,occluded:_&&b[2]>C||I}}isOffscreen(t,r,c,f){return c<yi||t>=this.screenRightBoundary||f<yi||r>this.screenBottomBoundary}isInsideGrid(t,r,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.bA([]);return s.br(t,t,[-100,-100,0]),t}}class zs{constructor(t,r,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class bl{constructor(t,r,c,f,g,_=!1){this.text=new zs(t?t.text:null,r,c,g),this.icon=new zs(t?t.icon:null,r,f,g),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Oi{constructor(t,r,c,f=!1){this.text=t,this.icon=r,this.skipFade=c,this.clipped=f}}class zd{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Sh{constructor(t,r,c,f,g){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=g}}class Eh{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function Xo(l,t,r,c,f){const{horizontalAlign:g,verticalAlign:_}=s.c1(l),v=-(g-.5)*t,b=-(_-.5)*r,I=s.c2(l,c);return new s.P(v+I[0]*f,b+I[1]*f)}function Dr(l,t,r,c,f){const g=new s.P(l,t);return r&&g._rotate(c?f:-f),g}class ym{constructor(t,r,c,f,g,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new $i(this.transform,g),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Eh(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,r,c,f,g=1){const _=c.getBucket(r),v=c.latestFeatureIndex;if(!_||!v||r.fqid!==_.layerIds[0])return;const b=_.layers[0].layout,I=_.layers[0].paint,C=c.collisionBoxArray,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),L=c.tileSize/s.al,D=c.tileID.toUnwrapped();this.transform.setProjection(_.projection);const V=(j=c.tileID,Z=_.getProjection(),q=this.transform,Z.name===this.projection?q.calculateProjMatrix(j.toUnwrapped()):wl(q,Z,j));var j,Z,q;const ee=b.get("text-pitch-alignment")==="map",ie=b.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const te=r.dynamicFilter(),ye=r.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(c),ge=Wl(V,c.tileID.canonical,ee,ie,this.transform,_.getProjection(),pe);let ue=null;const le=_.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(ee){const Ee=Bc(V,c.tileID.canonical,ee,ie,this.transform,_.getProjection(),pe);ue=s.aB([],this.transform.labelPlaneMatrix,Ee)}let xe=null;te&&c.latestFeatureIndex&&(xe={unwrappedTileID:D,dynamicFilter:te,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[_.bucketInstanceId]=new Sh(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,c.tileID);const[Re,Ae]=_.layers[0].layout.get("text-size-scale-range"),$e=s.aA(g,Re,Ae),[He,it]=b.get("icon-size-scale-range"),xt=s.aA(g,He,it),Ne={bucket:_,layout:b,paint:I,posMatrix:V,invMatrix:le,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ge,labelToScreenMatrix:ue,clippingData:xe,scale:O,textPixelRatio:L,holdingForFade:c.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:s.bK(_.textSizeData,this.transform.zoom,$e),partiallyEvaluatedIconSize:s.bK(_.iconSizeData,this.transform.zoom,xt),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(f)for(const Ee of _.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Ue,symbolInstanceEnd:dt}=Ee;t.push({sortKey:We,symbolInstanceStart:Ue,symbolInstanceEnd:dt,parameters:Ne})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee,ie,te,ye){const{textOffset0:pe,textOffset1:ge,crossTileID:ue}=j,le=[pe,ge],xe=Xo(t,_,v,le,b),Re=this.collisionIndex.placeCollisionBox(q,b,r,c,f,g,Dr(xe.x,xe.y,I,C,this.transform.angle),V,O,L,D.predicate);if(ie){const Ae=q.getSymbolInstanceIconSize(ye,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ae,ie,c,f,g,Dr(xe.x,xe.y,I,C,this.transform.angle),V,O,L,D.predicate).box.length===0)return}if(Re.box.length>0){let Ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(Ae=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:le,width:_,height:v,anchor:t,textScale:b,prevAnchor:Ae},this.markUsedJustification(q,t,j,ee),q.allowVerticalPlacement&&(this.markUsedOrientation(q,ee,j),this.placedOrientations[ue]=ee),{shift:xe,placedGlyphBoxes:Re}}}placeLayerBucketPart(t,r,c,f,g=1){const{bucket:_,layout:v,paint:b,posMatrix:I,textLabelPlaneMatrix:C,labelToScreenMatrix:O,clippingData:L,textPixelRatio:D,mercatorCenter:V,invMatrix:j,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:ie,collisionGroup:te,latestFeatureIndex:ye}=t.parameters,pe=v.get("text-optional"),ge=v.get("icon-optional"),ue=v.get("text-allow-overlap"),le=v.get("icon-allow-overlap"),xe=v.get("text-rotation-alignment")==="map",Re=v.get("icon-rotation-alignment")==="map",Ae=v.get("text-pitch-alignment")==="map",$e=b.get("symbol-z-offset"),He=v.get("symbol-elevation-reference")==="sea",it=v.get("symbol-placement"),[xt,Ne]=v.get("text-size-scale-range"),[Ee,We]=v.get("icon-size-scale-range"),Ue=s.aA(g,xt,Ne),dt=s.aA(g,Ee,We),Rt=v.get("text-variable-anchor"),Lt=xe&&it!=="point",At=Re&&it!=="point",wt=Rt&&_.hasTextData(),tn=_.hasIconTextFit()&&wt&&_.hasIconData();this.transform.setProjection(_.projection);const Yt=wt||Lt,Bt=At||tn;let Ht=ue&&(le||!_.hasIconData()||ge),_n=le&&(ue||!_.hasTextData()||pe);const An=!$e.isConstant();!_.collisionArrays&&q&&_.deserializeCollisionBoxes(q),c&&f&&_.updateCollisionDebugBuffers(this.transform.zoom,q,Ue,dt);const si=(Kt,wi,Mn)=>{const{crossTileID:Ai,numVerticalGlyphVertices:ji}=Kt;let Fi=null;if(L&&L.dynamicFilterNeedsFeature||An){const fr=this.retainedQueryData[_.bucketInstanceId];Fi=ye.loadFeature({featureIndex:Kt.featureIndex,bucketIndex:fr.bucketIndex,sourceLayerIndex:fr.sourceLayerIndex,layoutVertexArrayOffset:0});const d=Fi.properties?Fi.properties.worldview:null;if(_.localizable&&_.worldview&&typeof d=="string")if(d==="all")Fi.properties.$localized=!0;else{if(!d.split(",").includes(_.worldview))return;Fi.properties.$localized=!0,Fi.properties.worldview=_.worldview}}if(L&&!(0,L.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:_.worldview},Fi,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new s.P(Kt.tileAnchorX,Kt.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Ai]=new Oi(!1,!1,!1,!0),void r.add(Ai);const Ii=$e.evaluate(Fi,{});if(r.has(Ai))return;if(Z)return void(this.placements[Ai]=new Oi(!1,!1,!1));let Gn=!1,zi=!1,_r=!0,ur=!1,Ci=!1,hi=null,Wn={box:null,offscreen:null,occluded:null},tr={box:null},Mr=null,dr=null,Hi=null,Go=0,Co=0,Ur=0;Mn.textFeatureIndex?Go=Mn.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(Go=Kt.featureIndex),Mn.verticalTextFeatureIndex&&(Co=Mn.verticalTextFeatureIndex);const $o=_.elevationFeatures?_.elevationFeatures[Kt.elevationFeatureIndex]:void 0,es=fr=>{fr.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const d=this.transform.elevation;fr.elevation=He?Ii:Ii+s.bV.getAtTileOffset(fr.tileID,new s.P(fr.tileAnchorX,fr.tileAnchorY),d,$o),fr.elevation+=Kt.zOffset},go=Mn.textBox;if(go){es(go);const fr=m=>{let w=s.bL.horizontal;if(_.allowVerticalPlacement&&!m&&this.prevPlacement){const M=this.prevPlacement.placedOrientations[Ai];M&&(this.placedOrientations[Ai]=M,w=M,this.markUsedOrientation(_,w,Kt))}return w},d=(m,w)=>{if(_.allowVerticalPlacement&&ji>0&&Mn.verticalTextBox){for(const M of _.writingModes)if(M===s.bL.vertical?(Wn=w(),tr=Wn):Wn=m(),Wn&&Wn.box&&Wn.box.length)break}else Wn=m()};if(Rt){let m=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ai]){const B=this.prevPlacement.variableOffsets[Ai];m.indexOf(B.anchor)>0&&(m=m.filter((W=>W!==B.anchor)),m.unshift(B.anchor))}const w=(B,W,ce)=>{const Fe=_.getSymbolInstanceTextSize(ee,Kt,this.transform.zoom,wi),Ze=(B.x2-B.x1)*Fe+2*B.padding,kt=(B.y2-B.y1)*Fe+2*B.padding,en=Kt.hasIconTextFit&&!le?W:null;en&&es(en);let ln={box:[],offscreen:!1,occluded:!1};const rn=ue?2*m.length:m.length;for(let zn=0;zn<rn;++zn){const Bn=this.attemptAnchorPlacement(m[zn%m.length],B,V,j,Yt,Ze,kt,Fe,xe,Ae,D,I,te,zn>=m.length,Kt,wi,_,ce,en,ee,ie);if(Bn&&(ln=Bn.placedGlyphBoxes,ln&&ln.box&&ln.box.length)){Gn=!0,hi=Bn.shift;break}}return ln};d((()=>w(go,Mn.iconBox,s.bL.horizontal)),(()=>{const B=Mn.verticalTextBox;return B&&es(B),_.allowVerticalPlacement&&!(Wn&&Wn.box&&Wn.box.length)&&ji>0&&B?w(B,Mn.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}})),Wn&&(Gn=Wn.box,_r=Wn.offscreen,ur=Wn.occluded);const M=fr(!(!Wn||!Wn.box));if(!Gn&&this.prevPlacement){const B=this.prevPlacement.variableOffsets[Ai];B&&(this.variableOffsets[Ai]=B,this.markUsedJustification(_,B.anchor,Kt,M))}}else{const m=(w,M)=>{const B=_.getSymbolInstanceTextSize(ee,Kt,this.transform.zoom,wi),W=this.collisionIndex.placeCollisionBox(_,B,w,V,j,Yt,new s.P(0,0),ue,D,I,te.predicate);return W&&W.box&&W.box.length&&(this.markUsedOrientation(_,M,Kt),this.placedOrientations[Ai]=M),W};d((()=>m(go,s.bL.horizontal)),(()=>{const w=Mn.verticalTextBox;return _.allowVerticalPlacement&&ji>0&&w?(es(w),m(w,s.bL.vertical)):{box:null,offscreen:null,occluded:null}})),fr(!!(Wn&&Wn.box&&Wn.box.length))}}if(Mr=Wn,Gn=Mr&&Mr.box&&Mr.box.length>0,_r=Mr&&Mr.offscreen,ur=Mr&&Mr.occluded,Kt.useRuntimeCollisionCircles){const fr=Kt.centerJustifiedTextSymbolIndex>=0?Kt.centerJustifiedTextSymbolIndex:Kt.verticalPlacedTextSymbolIndex,d=_.text.placedSymbolArray.get(fr),m=s.bM(_.textSizeData,ee,d),w=v.get("text-padding");dr=this.collisionIndex.placeCollisionCircles(_,ue,d,fr,_.lineVertexArray,_.glyphOffsetArray,m,I,C,O,c,Ae,te.predicate,Kt.collisionCircleDiameter*m/s.bY,w,this.retainedQueryData[_.bucketInstanceId].tileID),Gn=ue||dr.circles.length>0&&!dr.collisionDetected,_r=_r&&dr.offscreen,ur=dr.occluded}if(Mn.iconFeatureIndex&&(Ur=Mn.iconFeatureIndex),Mn.iconBox){const fr=d=>{es(d);const m=Kt.hasIconTextFit&&hi?Dr(hi.x,hi.y,xe,Ae,this.transform.angle):new s.P(0,0),w=_.getSymbolInstanceIconSize(ie,this.transform.zoom,Kt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,w,d,V,j,Bt,m,le,D,I,te.predicate)};tr&&tr.box&&tr.box.length&&Mn.verticalIconBox?(Hi=fr(Mn.verticalIconBox),zi=Hi.box.length>0):(Hi=fr(Mn.iconBox),zi=Hi.box.length>0),_r=_r&&Hi.offscreen,Ci=Hi.occluded}const Sa=pe||Kt.numHorizontalGlyphVertices===0&&ji===0,Ts=ge||Kt.numIconVertices===0;if(Sa||Ts?Ts?Sa||(zi=zi&&Gn):Gn=zi&&Gn:zi=Gn=zi&&Gn,Gn&&Mr&&Mr.box&&this.collisionIndex.insertCollisionBox(Mr.box,v.get("text-ignore-placement"),_.bucketInstanceId,tr&&tr.box&&Co?Co:Go,te.ID),zi&&Hi&&this.collisionIndex.insertCollisionBox(Hi.box,v.get("icon-ignore-placement"),_.bucketInstanceId,Ur,te.ID),dr&&(Gn&&this.collisionIndex.insertCollisionCircles(dr.circles,v.get("text-ignore-placement"),_.bucketInstanceId,Go,te.ID),c)){const fr=_.bucketInstanceId;let d=this.collisionCircleArrays[fr];d===void 0&&(d=this.collisionCircleArrays[fr]=new zd);for(let m=0;m<dr.circles.length;m+=4)d.circles.push(dr.circles[m+0]),d.circles.push(dr.circles[m+1]),d.circles.push(dr.circles[m+2]),d.circles.push(dr.collisionDetected?1:0)}const Ns=_.projection.name!=="globe";Ht=Ht&&(Ns||!ur),_n=_n&&(Ns||!Ci),this.placements[Ai]=new Oi(Gn||Ht,zi||_n,_r||_.justReloaded),r.add(Ai)},Ri=this.retainedQueryData[_.bucketInstanceId].tileID;if(_.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(_,Ri),_.elevationType==="road"&&_.updateRoadElevation(Ri.canonical),_.updateZOffset(),_.sortFeaturesByY){const Kt=_.getSortedSymbolIndexes(this.transform.angle);for(let wi=Kt.length-1;wi>=0;--wi){const Mn=Kt[wi];si(_.symbolInstances.get(Mn),Mn,_.collisionArrays[Mn])}_.hasAnyZOffset&&s.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const Kt=_.getSortedIndexesByZOffset();for(let wi=0;wi<Kt.length;++wi){const Mn=Kt[wi];si(_.symbolInstances.get(Mn),Mn,_.collisionArrays[Mn])}}else for(let Kt=t.symbolInstanceStart;Kt<t.symbolInstanceEnd;Kt++)si(_.symbolInstances.get(Kt),Kt,_.collisionArrays[Kt]);if(c&&_.bucketInstanceId in this.collisionCircleArrays){const Kt=this.collisionCircleArrays[_.bucketInstanceId];s.bl(Kt.invProjMatrix,I),Kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,r,c,f){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:b,crossTileID:I}=c,C=s.c3(r),O=f===s.bL.vertical?b:C==="left"?g:C==="center"?_:C==="right"?v:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=O>=0&&g!==O?0:I),_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:I),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=O>=0&&v!==O?0:I),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=O>=0&&b!==O?0:I)}markUsedOrientation(t,r,c){const f=r===s.bL.horizontal||r===s.bL.horizontalOnly?r:0,g=r===s.bL.vertical?r:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:I}=c,C=t.text.placedSymbolArray;_>=0&&(C.get(_).placedOrientation=f),v>=0&&(C.get(v).placedOrientation=f),b>=0&&(C.get(b).placedOrientation=f),I>=0&&(C.get(I).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const f=r?r.symbolFadeChange(t):1,g=r?r.opacities:{},_=r?r.variableOffsets:{},v=r?r.placedOrientations:{};for(const b in this.placements){const I=this.placements[b],C=g[b];C?(this.opacities[b]=new bl(C,f,I.text,I.icon,null,I.clipped),c=c||I.text!==C.text.placed||I.icon!==C.icon.placed):(this.opacities[b]=new bl(null,f,I.text,I.icon,I.skipFade,I.clipped),c=c||I.text||I.icon)}for(const b in g){const I=g[b];if(!this.opacities[b]){const C=new bl(I,f,!1,!1);C.isHidden()||(this.opacities[b]=C,c=c||I.text.placed||I.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in v)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=v[b]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,c,f){f&&(this.lastReplacementSourceUpdateTime=f.updateTime);const g=new Set;for(const _ of r){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,g,_,_.collisionBoxArray,c,f,_.tileID,t.scope),v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,_.tileID),v.elevationType==="road"&&v.updateRoadElevation(_.tileID.canonical),v.updateZOffset())}}updateBucketOpacities(t,r,c,f,g,_,v,b){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const I=t.layers[0].layout,C=t.layers[0].paint,O=!!t.layers[0].dynamicFilter(),L=new bl(null,0,!1,!1,!0),D=I.get("text-allow-overlap"),V=I.get("icon-allow-overlap"),j=I.get("text-variable-anchor"),Z=I.get("text-rotation-alignment")==="map",q=I.get("text-pitch-alignment")==="map",ee=C.get("symbol-z-offset"),ie=I.get("symbol-elevation-reference")==="sea",te=!ee.isConstant(),ye=new bl(null,0,D&&(V||!t.hasIconData()||I.get("icon-optional")),V&&(D||!t.hasTextData()||I.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const pe=(ue,le,xe)=>{for(let Re=0;Re<le/4;Re++)ue.opacityVertexArray.emplaceBack(xe)};let ge=0;_&&t.updateReplacement(v,_);for(let ue=0;ue<t.symbolInstances.length;ue++){const le=t.symbolInstances.get(ue),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Re,crossTileID:Ae,numIconVertices:$e,tileAnchorX:He,tileAnchorY:it}=le;let xt=null;const Ne=this.retainedQueryData[t.bucketInstanceId];te&&le&&Ne&&(xt=c.latestFeatureIndex.loadFeature({featureIndex:le.featureIndex,bucketIndex:Ne.bucketIndex,sourceLayerIndex:Ne.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ee=ee.evaluate(xt,{}),We=r.has(Ae);let Ue=this.opacities[Ae];We?Ue=L:Ue||(Ue=ye,this.opacities[Ae]=Ue),r.add(Ae);const dt=xe>0||Re>0,Rt=$e>0,Lt=this.placedOrientations[Ae],At=Lt===s.bL.vertical,wt=Lt===s.bL.horizontal||Lt===s.bL.horizontalOnly;!dt&&!Rt||Ue.isHidden()||ge++;let tn=!1;if((dt||Rt)&&_)for(const Yt of t.activeReplacements){if(s.bZ(Yt,g,s.b_.Symbol,b)||Yt.min.x>He||He>Yt.max.x||Yt.min.y>it||it>Yt.max.y)continue;const Bt=s.b$(He,it,v.canonical,Yt.footprintTileId.canonical);if(tn=s.c0(Bt,Yt.footprint),tn)break}if(dt){const Yt=tn?Nc:_s(Ue.text);pe(t.text,xe,At?Nc:Yt),pe(t.text,Re,wt?Nc:Yt);const Bt=Ue.text.isHidden(),{leftJustifiedTextSymbolIndex:Ht,centerJustifiedTextSymbolIndex:_n,rightJustifiedTextSymbolIndex:An,verticalPlacedTextSymbolIndex:si}=le,Ri=t.text.placedSymbolArray,Kt=Bt||At?1:0;Ht>=0&&(Ri.get(Ht).hidden=Kt),_n>=0&&(Ri.get(_n).hidden=Kt),An>=0&&(Ri.get(An).hidden=Kt),si>=0&&(Ri.get(si).hidden=Bt||wt?1:0);const wi=this.variableOffsets[Ae];wi&&this.markUsedJustification(t,wi.anchor,le,Lt);const Mn=this.placedOrientations[Ae];Mn&&(this.markUsedJustification(t,"left",le,Mn),this.markUsedOrientation(t,Mn,le))}if(Rt){const Yt=tn?Nc:_s(Ue.icon),{placedIconSymbolIndex:Bt,verticalPlacedIconSymbolIndex:Ht}=le,_n=t.icon.placedSymbolArray,An=Ue.icon.isHidden()?1:0;Bt>=0&&(pe(t.icon,$e,At?Nc:Yt),_n.get(Bt).hidden=An),Ht>=0&&(pe(t.icon,le.numVerticalIconVertices,wt?Nc:Yt),_n.get(Ht).hidden=An)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Yt=t.collisionArrays[ue];if(Yt){let Bt=new s.P(0,0),Ht=!0;if(Yt.textBox||Yt.verticalTextBox){if(j){const An=this.variableOffsets[Ae];An?(Bt=Xo(An.anchor,An.width,An.height,An.textOffset,An.textScale),Z&&Bt._rotate(q?this.transform.angle:-this.transform.angle)):Ht=!1}O&&(Ht=!Ue.clipped),Yt.textBox&&pc(t.textCollisionBox.collisionVertexArray,Ue.text.placed,!Ht||At,Ee,ie,Bt.x,Bt.y),Yt.verticalTextBox&&pc(t.textCollisionBox.collisionVertexArray,Ue.text.placed,!Ht||wt,Ee,ie,Bt.x,Bt.y)}const _n=Ht&&!!(!wt&&Yt.verticalIconBox);Yt.iconBox&&pc(t.iconCollisionBox.collisionVertexArray,Ue.icon.placed,_n,Ee,ie,le.hasIconTextFit?Bt.x:0,le.hasIconTextFit?Bt.y:0),Yt.verticalIconBox&&pc(t.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!_n,Ee,ie,le.hasIconTextFit?Bt.x:0,le.hasIconTextFit?Bt.y:0)}}}if(t.fullyClipped=ge===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ue.invProjMatrix,t.placementViewportMatrix=ue.viewportMatrix,t.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}isStale(){return this.stale}setStale(){this.stale=!0}}function pc(l,t,r,c,f,g,_){l.emplaceBack(t?1:0,r?1:0,g||0,_||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,g||0,_||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,g||0,_||0,c,f?1:0),l.emplaceBack(t?1:0,r?1:0,g||0,_||0,c,f?1:0)}const Lf=Math.pow(2,25),Ru=Math.pow(2,24),Ld=Math.pow(2,17),Df=Math.pow(2,16),Dd=Math.pow(2,9),gs=Math.pow(2,8),ql=Math.pow(2,1);function _s(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,r=Math.floor(127*l.opacity);return r*Lf+t*Ru+r*Ld+t*Df+r*Dd+t*gs+r*ql+t}const Nc=0;class mc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,c,f,g,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,f,t[this._currentTileIndex],this._sortAcrossTiles,_),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((b,I)=>b.sortKey-I.sortKey)));this._currentPartIndex<v.length;){const b=v[this._currentPartIndex];if(r.placeLayerBucketPart(b,this._seenCrossTileIDs,c,b.symbolInstanceStart===0,_),this._currentPartIndex++,g())return!0}return!1}}class Zr{constructor(t,r,c,f,g,_,v,b,I){this.placement=new ym(t,g,_,v,b,I),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c,f,g){const _=s.o.now(),v=()=>{const b=s.o.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=r[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&b.visibility!=="none"&&(!b.minzoom||b.minzoom<=I)&&(!b.maxzoom||b.maxzoom>I)){const C=b,O=C.layout.get("symbol-z-elevate"),L=C.layout.get("symbol-sort-key").constantOr(1)!==void 0,D=C.layout.get("symbol-z-order"),V=D==="viewport-y"||D==="auto"&&!(D!=="viewport-y"&&L),j=C.layout.get("text-allow-overlap")||C.layout.get("icon-allow-overlap")||C.layout.get("text-ignore-placement")||C.layout.get("icon-ignore-placement"),Z=V&&j,q=this._inProgressLayer=this._inProgressLayer||new mc(C),ee=s.B(b.source,b.scope);if(q.continuePlacement(O||Z?f[ee]:c[ee],this.placement,this._showCollisionBoxes,b,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const La=512/s.al/2;class Tl{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this.index=new s.c4(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=t.canonical.x*s.al,g=t.canonical.y*s.al;for(let _=0;_<r.length;_++){const{key:v,crossTileID:b,tileAnchorX:I,tileAnchorY:C}=r.get(_),O=Math.floor((f+I)*La),L=Math.floor((g+C)*La);this.index.add(O,L),this.keys.push(v),this.crossTileIDs.push(b)}this.index.finish()}findMatches(t,r,c){const f=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),g=La/Math.pow(2,r.canonical.z-this.tileID.canonical.z),_=r.canonical.x*s.al,v=r.canonical.y*s.al;for(let b=0;b<t.length;b++){const I=t.get(b);if(I.crossTileID)continue;const{key:C,tileAnchorX:O,tileAnchorY:L}=I,D=Math.floor((_+O)*g),V=Math.floor((v+L)*g),j=this.index.range(D-f,V-f,D+f,V+f).sort(((Z,q)=>Z-q));for(const Z of j){const q=this.crossTileIDs[Z];if(this.keys[Z]===C&&!c.has(q)){c.add(q),I.crossTileID=q;break}}}}}class oo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Od{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const f=this.indexes[c],g={};for(const _ in f){const v=f[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+r),g[v.tileID.key]=v}this.indexes[c]=g}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<r.symbolInstances.length;g++)r.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const f=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const _=this.indexes[g];if(Number(g)>t.overscaledZ)for(const v in _){const b=_[v];b.tileID.isChildOf(t)&&b.findMatches(r.symbolInstances,t,f)}else{const v=_[t.scaledTo(Number(g)).key];v&&v.findMatches(r.symbolInstances,t,f)}}for(let g=0;g<r.symbolInstances.length;g++){const _=r.symbolInstances.get(g);_.crossTileID||(_.crossTileID=c.generate(),f.add(_.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Tl(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const f=this.indexes[c];for(const g in f)t[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[g]),delete f[g],r=!0)}return r}}class Da{constructor(){this.layerIndexes={},this.crossTileIDs=new oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c,f){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new Od);let _=!1;const v={};f.name!=="globe"&&g.handleWrapJump(c);for(const b of r){const I=b.getBucket(t);I&&t.fqid===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(b.tileID,I,this.crossTileIDs)&&(_=!0),v[I.bucketInstanceId]=!0)}return g.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach((c=>{r[c]=!0}));for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}const Ja=771;class On{constructor(t,r,c,f){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=f}}On.Replace=[1,0,1,0],On.disabled=new On(On.Replace,s.ao.transparent,[!1,!1,!1,!1]),On.unblended=new On(On.Replace,s.ao.transparent,[!0,!0,!0,!0]),On.alphaBlended=new On([1,Ja,1,Ja],s.ao.transparent,[!0,!0,!0,!0]),On.alphaBlendedNonPremultiplied=new On([770,Ja,770,Ja],s.ao.transparent,[!0,!0,!0,!0]),On.multiply=new On([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),On.additive=new On([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class an{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);const Fd=7680;class Pn{constructor(t,r,c,f,g,_){this.test=t,this.ref=r,this.mask=c,this.fail=f,this.depthFail=g,this.pass=_}}Pn.disabled=new Pn({func:519,mask:0},0,0,Fd,Fd,Fd);const jc=1029,Ih=2305;class In{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}function Js(l,t){const r=s.ca(l,3);s.cc(l,t),s.cg(l,3,r)}function Of(l,t){const r=s.c7([]);return s.c8(r,r,-t),s.c9(r,r,-l),r}function Vc(l,t){const r=[l[0],l[1],0],c=[t[0],t[1],0];if(s.ag(r)>=1e-15){const _=s.aw([],r);s.c5(c,_,s.bJ(c,_)),t[0]=c[0],t[1]=c[1]}const f=s.bI([],t,l);if(s.c6(f)<1e-15)return null;const g=Math.atan2(-f[1],f[0]);return Of(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),g)}In.disabled=new In(!1,jc,Ih),In.backCCW=new In(!0,jc,Ih),In.backCW=new In(!0,jc,2304),In.frontCW=new In(!0,1028,2304),In.frontCCW=new In(!0,1028,Ih);class ys{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=s.bT(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r,c){if(this.orientation=null,!this.position)return;const f=this.position,g=c||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0),_=s.ae.fromLngLat(t,g),v=[_.x-f.x,_.y-f.y,_.z-f.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Vc(v,r)}setPitchBearing(t,r){this.orientation=Of(s.an(t),s.an(-r))}}class Ah{constructor(t,r){this._transform=s.bA([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&s.cg(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c7([]),t&&Js(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Of(t,r),Js(this._transform,this._orientation)}forward(){const t=s.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const c=new Float64Array(16);return s.bl(c,this.getWorldToCamera(t,r)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,c){const f=this.position;s.c5(f,f,-t);const g=new Float64Array(16);return s.bq(g,[c,c,c]),s.br(g,g,f),g[10]*=r,g}getWorldToCamera(t,r){const c=new Float64Array(16),f=new Float64Array(4),g=this.position;return s.cb(f,this._orientation),s.c5(g,g,-t),s.cc(c,f),s.br(c,c,g),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=r,c[9]*=r,c[10]*=r,c[11]*=r,c}getCameraToClipPerspective(t,r,c,f){const g=new Float64Array(16);return s.cd(g,t,r,c,f),g}getCameraToClipOrthographic(t,r,c,f,g,_){const v=new Float64Array(16);return s.ce(v,t,r,c,f,g,_),v}getDistanceToElevation(t,r=!1){const c=t===0?0:s.cf(t,r?s.a$(this.position[1]):this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new Ah([...this.position],[...this.orientation])}}const fo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ku{constructor(t=0,r=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=f}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=s.ak(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=s.ak(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=s.ak(t.right,r.right,c)),this}getCenter(t,r){const c=s.aA((this.left+t-this.right)/2,0,t),f=s.aA((this.top+r-this.bottom)/2,0,r);return new s.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ku(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Oa=15;class Bd{constructor(t,r,c,f,g,_,v){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=c??0,this._maxPitch=f??60,this.setProjection(_),this.setMaxBounds(v),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ku,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ah,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Bd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Oa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const c=this.getProjection(),f=!s.by(r,c);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let f=0,g=0;for(let _=0;_<r.length;_++){const v=new s.P(r[_][0]*this.width,c+r[_][1]*(this.height-c)),b=t.pointCoordinate(v);if(!b)continue;const I=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);f+=b[3]*I,g+=I}return g===0?NaN:f/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*r,f=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),_=Math.max(f-c,g);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const r=this.elevation,c=t.elevation,f=r!=null!=(c!=null)||r&&c&&r.exaggeration()!==c.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!f}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const f=s.ag(s.av([],this._camera.position,c));return s.aA(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!s.cp(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.cq(c,this._camera.position)||(this._setCameraPosition(c),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new ys;return r.position=new s.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!s.cr(t))return!1;s.cs(t,t);const r=s.ct([],[0,0,-1],t),c=s.ct([],[0,-1,0],t);if(c[2]<0)return!1;const f=Vc(r,c);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=s.aA(t[2],f/c,f/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.cu(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new s.P(0,0)),f=this.pointCoordinate(new s.P(this.width,0)),g=this.pointCoordinate(new s.P(this.width,this.height)),_=this.pointCoordinate(new s.P(0,this.height)),v=Math.floor(Math.min(c.x,f.x,g.x,_.x)),b=Math.floor(Math.max(c.x,f.x,g.x,_.x)),I=1;for(let C=v-I;C<=b+I;C++)C!==0&&r.push(new s.cu(C,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,c,f){let g=[];const _=c!=null,v=!_;if(v&&this.zoom<r||_&&c[0]===0&&c[1]===0)return g;const b=new Set,I=(O,L,D,V,j)=>{const Z=s.cY(L,O,D,V,j);b.has(Z)||(g.push(new s.aQ(O,L,D,V,j)),b.add(Z))};for(let O=0;O<t.length;O++){const L=t[O];if(v&&L.canonical.z!==r||_&&f!==void 0&&f>L.canonical.z)continue;const D=L.canonical,V=L.overscaledZ,j=L.wrap,Z=1<<D.z,q=D.x+1<Z,ee=D.x>0,ie=D.y+1<Z,te=D.y>0,ye=L.wrap-(ee?0:1),pe=L.wrap+(q?0:1),ge=ee?D.x-1:Z-1,ue=q?D.x+1:0;if(_)c[0]<0?(I(V,pe,D.z,ue,D.y),c[1]<0&&ie&&(I(V,j,D.z,D.x,D.y+1),I(V,pe,D.z,ue,D.y+1)),c[1]>0&&te&&(I(V,j,D.z,D.x,D.y-1),I(V,pe,D.z,ue,D.y-1))):c[0]>0?(I(V,ye,D.z,ge,D.y),c[1]<0&&ie&&(I(V,j,D.z,D.x,D.y+1),I(V,ye,D.z,ge,D.y+1)),c[1]>0&&te&&(I(V,j,D.z,D.x,D.y-1),I(V,ye,D.z,ge,D.y-1))):c[1]<0&&ie?I(V,j,D.z,D.x,D.y+1):te&&I(V,j,D.z,D.x,D.y-1);else{const le=L.visibleQuadrants;1&le&&(I(V,ye,D.z,ge,D.y),te&&(I(V,j,D.z,D.x,D.y-1),I(V,ye,D.z,ge,D.y-1))),2&le&&(I(V,pe,D.z,ue,D.y),te&&(I(V,j,D.z,D.x,D.y-1),I(V,pe,D.z,ue,D.y-1))),4&le&&(I(V,ye,D.z,ge,D.y),ie&&(I(V,j,D.z,D.x,D.y+1),I(V,ye,D.z,ge,D.y+1))),8&le&&(I(V,pe,D.z,ue,D.y),ie&&(I(V,j,D.z,D.x,D.y+1),I(V,pe,D.z,ue,D.y+1)))}}const C=[];for(const O of g)g.some((L=>O.isChildOf(L)))||C.push(O);if(g=C.filter((O=>!t.some((L=>!!(O.overscaledZ<r&&L.isChildOf(O))||O.equals(L)||O.isChildOf(L))))),v){const O=1<<r,L=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),D=[O*L.x,O*L.y],V=4,j=V*V;g=g.filter((Z=>{const q=Z.canonical.x+.5-D[0],ee=Z.canonical.y+.5-D[1];return q*q+ee*ee<j}))}return g}extendTileCoverToNearPlane(t,r,c){const f=[],g=new Set;for(const ee of t)g.add(ee.key);const _=(ee,ie,te,ye,pe)=>{const ge=s.cY(ie,ee,te,ye,pe);g.has(ge)||(f.push(new s.aQ(ee,ie,te,ye,pe)),g.add(ge))},v=t.reduce(((ee,ie)=>Math.max(ee,ie.overscaledZ)),c),b=1<<c,I=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],C=new s.P(0,0),O=new s.P(0,0),L=(ee,ie)=>{const te=Math.floor(ee[0]),ye=Math.floor(ee[1]),pe=(ee[0]-te)*s.al,ge=(ee[1]-ye)*s.al,ue=Math.floor(ie[0]),le=Math.floor(ie[1]),xe=(ie[0]-ue)*s.al,Re=(ie[1]-le)*s.al;for(let Ae=-1;Ae<=1;Ae++){const $e=te+Ae;if(!($e<0||$e>=b)){C.x=pe-Ae*s.al,O.x=xe-($e-ue)*s.al;for(let He=-1;He<=1;He++){const it=ye+He;C.y=ge-He*s.al,O.y=Re-(it-le)*s.al,s.cZ(C,O,I)&&_(v,0,c,$e,it)}}}},D=r.points,V=D[s.cv],j=D[s.cw],Z=this._projectToGround(V,D[s.cx]),q=this._projectToGround(j,D[s.cy]);return L(V,Z),L(j,q),f}_projectToGround(t,r){return s.cz(s.cA(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const c=r,f=this.elevation&&this.elevation.exaggeration(),g=f&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const v=this.locationCoordinate(this.center),b=this.center.lat,I=1<<r,C=[I*v.x,I*v.y,0],O=this.projection.name==="globe",L=!O,D=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,L),V=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=I*s.cf(1,this.center.lat),Z=this._camera.position[2]/s.cf(1,this.center.lat),q=[I*V.x,I*V.y,Z*(L?1:j)],ee=O||f,ie=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),te=this.isLODDisabled(!0)?r:0;let ye;if(this._elevation&&t.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ee=this._elevation.getMinMaxForVisibleTiles();ye=Ee?Ee.max:this._centerAltitude}else ye=this._centerAltitude;const pe=t.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?s.cC(this):1,ue=Ee=>{const Ue=new s.ae(Ee.x+25e-6,Ee.y,Ee.z),dt=new s.ae(Ee.x,Ee.y+25e-6,Ee.z),Rt=Ee.toLngLat(),Lt=Ue.toLngLat(),At=dt.toLngLat(),wt=this.locationCoordinate(Rt),tn=this.locationCoordinate(Lt),Yt=this.locationCoordinate(At),Bt=Math.hypot(tn.x-wt.x,tn.y-wt.y),Ht=Math.hypot(Yt.x-wt.x,Yt.y-wt.y);return Math.sqrt(Bt*Ht)*ge/25e-6},le=Ee=>{const We=ye,Ue=pe;return{aabb:s.cF(this,I,0,0,0,Ee,Ue,We,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:We,wrap:Ee,fullyVisible:!1}},xe=[];let Re=[];const Ae=r,$e=t.reparseOverscaled?c:r,He=(Z-this._centerAltitude)*j,it=Ee=>{if(!this._elevation||!Ee.tileID||!_)return;const We=this._elevation.getMinMaxForTile(Ee.tileID),Ue=Ee.aabb;We?(Ue.min[2]=We.min,Ue.max[2]=We.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Ee.shouldSplit=Ne(Ee),Ee.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},xt=(Ee,We)=>{if(.707*We<Ee)return 1;const Ue=We/Ee;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},Ne=Ee=>{if(Ee.zoom<te)return!0;if(Ee.zoom===Ae)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const We=Ee.aabb.distanceX(q),Ue=Ee.aabb.distanceY(q);let dt=He,Rt=1;if(O){dt=Ee.aabb.distanceZ(q);const Ht=Math.pow(2,Ee.zoom),_n=s.a$((Ee.y+1)/Ht),An=s.a$(Ee.y/Ht),si=Math.min(Math.max(b,_n),An),Ri=s.d1(si)/s.d1(b);if(Rt=si===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ri/this._mercatorScaleRatio),this.zoom<=s.c_&&Ee.zoom===Ae-1&&Ri>=.9)return!0}else if(g&&(dt=Ee.aabb.distanceZ(q)*j),this.projection.isReprojectedInTileSpace&&c<=5){const Ht=Math.pow(2,Ee.zoom),_n=ue(new s.ae((Ee.x+.5)/Ht,(Ee.y+.5)/Ht));Rt=_n>.85?1:_n}if(!_&&!O){const Ht=Math.sqrt(We*We+Ue*Ue+dt*dt);let _n=(1<<Ae-Ee.zoom)*ie*Rt;return _n*=xt(Math.max(dt,He),Ht),Ht<_n}let Lt=Number.MAX_VALUE,At=0;const wt=Ee.aabb.getCorners(),tn=[];for(const Ht of wt){s.av(tn,Ht,q),O||(g?tn[2]*=j:tn[2]=He);const _n=s.bJ(tn,this._camera.forward());_n<Lt&&(Lt=_n,At=Math.abs(tn[2]))}let Yt=(1<<Ae-Ee.zoom)*ie*Rt;if(Yt*=xt(Math.max(At,He),Lt),Lt<Yt)return!0;const Bt=Ee.aabb.closestPoint(C);return Bt[0]===C[0]&&Bt[1]===C[1]};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)xe.push(le(-Ee)),xe.push(le(Ee));for(xe.push(le(0));xe.length>0;){const Ee=xe.pop(),We=Ee.x,Ue=Ee.y;let dt=Ee.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(Ee.y===0||Ee.y===(1<<Ee.zoom)-1);if(!dt){let Lt=ee?Ee.aabb.intersects(D):Ee.aabb.intersectsFlat(D);if(Lt===0&&Rt()){const At=new s.cD(Ee.zoom,We,Ue);Lt=s.cE(this,I,At,!0).intersects(D)}if(Lt===0)continue;dt=Lt===2}if(Ee.zoom!==Ae&&Ne(Ee))for(let Lt=0;Lt<4;Lt++){const At=(We<<1)+Lt%2,wt=(Ue<<1)+(Lt>>1),tn={aabb:_?Ee.aabb.quadrant(Lt):s.cF(this,I,Ee.zoom+1,At,wt,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:At,y:wt,wrap:Ee.wrap,fullyVisible:dt,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};g&&!O&&(tn.tileID=new s.aQ(Ee.zoom+1===Ae?$e:Ee.zoom+1,Ee.wrap,Ee.zoom+1,At,wt),it(tn)),xe.push(tn)}else{const Lt=Ee.zoom===Ae?$e:Ee.zoom;if(t.minzoom&&t.minzoom>Lt)continue;let At=0;if(!dt){let Bt=ee?Ee.aabb.intersectsPrecise(D):Ee.aabb.intersectsPreciseFlat(D);if(Bt===0&&Rt()){const Ht=new s.cD(Ee.zoom,We,Ue);Bt=s.cE(this,I,Ht,!0).intersectsPrecise(D)}if(Bt===0)continue;if(t.calculateQuadrantVisibility)if(D.containsPoint(Ee.aabb.center))At=15;else for(let Ht=0;Ht<4;Ht++)Ee.aabb.quadrant(Ht).intersects(D)!==0&&(At|=1<<Ht)}const wt=C[0]-(.5+We+(Ee.wrap<<Ee.zoom))*(1<<r-Ee.zoom),tn=C[1]-.5-Ue,Yt=Ee.tileID?Ee.tileID:new s.aQ(Lt,Ee.wrap,Ee.zoom,We,Ue);t.calculateQuadrantVisibility&&(Yt.visibleQuadrants=At),Re.push({tileID:Yt,distanceSq:wt*wt+tn*tn})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,We=this.horizonLineFromTop();Re=Re.filter((Ue=>{const dt=[0,0,0,1],Rt=[s.al,s.al,0,1],Lt=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());s.aC(dt,dt,Lt),s.aC(Rt,Rt,Lt);const At=s.cG([],dt,Rt),wt=s.cH([],dt,Rt),tn=s.c$(At,wt);if(tn===0)return!0;let Yt=!1;const Bt=this._elevation;if(Bt&&tn>Ee&&We!==0){const Ht=this.calculateProjMatrix(Ue.tileID.toUnwrapped());let _n;t.isTerrainDEM||(_n=Bt.getMinMaxForTile(Ue.tileID)),_n||(_n={min:pe,max:ye});const An=s.cI(this.rotation),si=[An[0]*s.al,An[1]*s.al,_n.max];s.af(si,si,Ht),Yt=(1-si[1])*this.height*.5<We}return tn<Ee||Yt}))}return Re.sort(((Ee,We)=>Ee.distanceSq-We.distanceSq)).map((Ee=>Ee.tileID))}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const r=s.aA(t.lat,-s.cJ,s.cJ),c=this.projection.project(t.lng,r);return new s.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let c,f;const g=this.centerPoint;if(this.projection.name==="globe"){const v=this.worldSize;c=(r.x-g.x)/v,f=(r.y-g.y)/v}else{const v=this.pointCoordinate(r),b=this.pointCoordinate(g);c=v.x-b.x,f=v.y-b.y}const _=this.locationCoordinate(t);this.setLocation(new s.ae(_.x-c,_.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const c=r?s.cf(r,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new s.ae(f.x,f.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const c=r??this._centerAltitude,f=[t.x,t.y,0,1],g=[t.x,t.y,1,1];s.aC(f,f,this.pixelMatrixInverse),s.aC(g,g,this.pixelMatrixInverse);const _=g[3];s.cK(f,f,1/f[3]),s.cK(g,g,1/_);const v=f[2],b=g[2];return{p0:f,p1:g,t:v===b?0:(c-v)/(b-v)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.aC(r,r,this.pixelMatrixInverse),s.aC(c,c,this.pixelMatrixInverse),s.cK(r,r,1/r[3]),s.cK(c,c,1/c[3]),r[2]=s.cf(r[2],this._center.lat)*this.worldSize,c[2]=s.cf(c[2],this._center.lat)*this.worldSize,s.cK(r,r,1/this.worldSize),s.cK(c,c,1/this.worldSize),new s.ax([r[0],r[1],r[2]],s.aw([],s.av([],c,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:c,t:f}=t,g=s.cf(r[2],this._center.lat),_=s.cf(c[2],this._center.lat);return new s.ae(s.ak(r[0],c[0],f)/this.worldSize,s.ak(r[1],c[1],f)/this.worldSize,s.ak(g,_,f))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new s.ae(c[0],c[1],c[2]);let f=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,r);const _=.02*g,v=t.clone();for(let b=0;b<10&&g-f>_;b++){v.y=s.ak(f,g,.66);const I=this.projection.pointCoordinate3D(this,v.x,v.y);I?(g=v.y,c=I):f=v.y}return c?new s.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const c=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.aC(f,f,this.pixelMatrix),f[3]>0?new s.P(f[0]/f[3],f[1]/f[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,g=this.pointLocation3D(new s.P(r,t)),_=this.pointLocation3D(new s.P(f,t)),v=this.pointLocation3D(new s.P(f,c)),b=this.pointLocation3D(new s.P(r,c));let I=Math.min(g.lng,_.lng,v.lng,b.lng),C=Math.max(g.lng,_.lng,v.lng,b.lng),O=Math.min(g.lat,_.lat,v.lat,b.lat),L=Math.max(g.lat,_.lat,v.lat,b.lat);const D=Math.pow(2,-this.zoom)/16*270,V=this.projection.name==="globe"?1:4,j=(Z,q,ee,ie,te)=>{const ye=(Z+ee)/2,pe=(q+ie)/2,ge=new s.P(ye,pe),{lng:ue,lat:le}=this.pointLocation3D(ge),xe=Math.max(0,I-ue,O-le,ue-C,le-L);I=Math.min(I,ue),C=Math.max(C,ue),O=Math.min(O,le),L=Math.max(L,le),(te<V||xe>D)&&(j(Z,q,ye,pe,te+1),j(ye,pe,ee,ie,te+1))};if(j(r,t,f,t,1),j(f,t,f,c,1),j(f,c,r,c,1),j(r,c,r,t,1),this.projection.name==="globe"){const[Z,q]=s.cM(this);Z?(L=90,C=180,I=-180):q&&(O=-90,C=180,I=-180)}return new s.aI(new s.aT(I,O),new s.aT(C,L))}_getBoundsRectangular(t,r){const{top:c,left:f}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=new s.P(f,c),b=new s.P(_,c),I=new s.P(_,g),C=new s.P(f,g);let O=this.pointCoordinate(v,t),L=this.pointCoordinate(b,t);const D=this.pointCoordinate(I,r),V=this.pointCoordinate(C,r),j=(Z,q)=>(q.y-Z.y)/(q.x-Z.x);return O.y>1&&L.y>=0?O=new s.ae((1-V.y)/j(V,O)+V.x,1):O.y<0&&L.y<=1&&(O=new s.ae(-V.y/j(V,O)+V.x,0)),L.y>1&&O.y>=0?L=new s.ae((1-D.y)/j(D,L)+D.x,1):L.y<0&&O.y<=1&&(L=new s.ae(-D.y/j(D,L)+D.x,0)),new s.aI().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(D))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce(((c,f)=>{if(f.dem){const g=f.dem.tree;c.min=Math.min(c.min,g.minimums[0]),c.max=Math.max(c.max,g.maximums[0])}return c}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,c=this._distanceTileDataCache;if(c[r])return c[r];const f=t.canonical,g=1/this.height,_=this.cameraWorldSize,v=_/this.zoomScale(f.z),b=(f.x+Math.pow(2,f.z)*t.wrap)*v,I=f.y*v,C=this.point;C.x*=_/this.worldSize,C.y*=_/this.worldSize;const O=this.angle,L=Math.sin(-O),D=-Math.cos(-O);return c[r]={bearing:[L,D],center:[(C.x-b)*g,(C.y-I)*g],scale:v/s.al*g},c[r]}calculateFogTileMatrix(t){const r=t.key,c=this._fogTileMatrixCache;if(c[r])return c[r];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(f,this.worldToFogMatrix,f),c[r]=new Float32Array(f),c[r]}calculateProjMatrix(t,r=!1,c=!1){const f=t.key;let g;if(g=c?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,g[f])return g[f];const _=this.calculatePosMatrix(t,this.worldSize);let v;return v=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,s.aB(_,v,_),g[f]=new Float32Array(_),g[f]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[r])return c[r];const f=s.cN(t,this);return c[r]=f,c[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=s.bq([],[t,t,t]);return s.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=s.cf(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(r),f=this._camera.forward(),g=s.cf(1,this._center.lat);c[2]/=g,f[2]/=g,s.aw(f,f);const _=t.raycast(c,f,t.exaggeration());if(_){const v=s.bH([],c,f,_),b=new s.ae(v[0],v[1],s.cf(v[2],s.a$(v[1]))),I=(b.z+s.ag([b.x-c[0],b.y-c[1],b.z-c[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,c=s.cf(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),g=r.getAtPointOrZero(new s.ae(...f)),_=this.pixelsPerMeter/this.worldSize*g,v=this._minimumHeightOverTerrain(),b=f[2]-_;if(b<=v)if(b<0||t){const I=this.locationCoordinate(this._center,this._centerAltitude),C=[f[0],f[1],I.z-f[2]],O=s.ag(C);C[2]-=(v-b)/this._pixelsPerMercatorPixel;const L=s.ag(C);if(L===0)return;s.c5(C,C,O/L*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],I.z*this._pixelsPerMercatorPixel-C[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const L=this.center;return L.lat=s.aA(L.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(L.lng=s.aA(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}const r=this._unmodified,{x:c,y:f}=this.point;let g=0,_=c,v=f;const b=this.width/2,I=this.height/2,C=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(f-I<C&&(v=C+I),f+I>O&&(v=O-I),O-C<this.height&&(g=Math.max(g,this.height/(O-C)),v=(O+C)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const L=this.worldMinX*this.scale,D=this.worldMaxX*this.scale,V=this.worldSize/2-(L+D)/2;_=(c+V+this.worldSize)%this.worldSize-V,_-b<L&&(_=L+b),_+b>D&&(_=D-b),D-L<this.width&&(g=Math.max(g,this.width/(D-L)),_=(D+L)/2)}_===c&&v===f||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(_,v))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const f=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?c:1,_=this._camera.getWorldToCamera(this.worldSize,g);let v;const b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(b[8]=2*-t.x/this.width,b[9]=2*t.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=le*this.aspect,Re=-xe,Ae=-le;xe-=t.x,Re-=t.x,le+=t.y,Ae+=t.y,v=this._camera.getCameraToClipOrthographic(Re,xe,Ae,le,this._nearZ,this._farZ),(($e,He,it,xt)=>{for(let Ne=0;Ne<16;Ne++)$e[Ne]=s.ak(He[Ne],it[Ne],xt)})(v,v,b,s.d0(this.pitch>=Oa?1:this.pitch/Oa))}else v=b;const I=s.cP([],b,_);let C=s.cP([],v,_);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),xe=s.bA([]);s.br(xe,xe,[le.x*this.worldSize,le.y*this.worldSize,0]),s.aB(xe,xe,s.cQ(this)),s.br(xe,xe,[-le.x*this.worldSize,-le.y*this.worldSize,0]),s.aB(C,C,xe),s.aB(I,I,xe),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],C,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=C,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),r){const le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-t.x/this.width,le[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cP([],le,_)}else this.expandedFarZProjMatrix=this.projMatrix;const O=s.bl([],v);this.frustumCorners=s.cT.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const L=new Float32Array(16);s.bA(L),s.cS(L,L,[1,-1,1]),s.cU(L,L,this._pitch),s.bB(L,L,this.angle);const D=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(D);const V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-t.x/this.width,D[9]=2*(t.y+V)/this.height,this.skyboxMatrix=s.aB(L,D,L);const j=this.point,Z=j.x,q=j.y,ee=this.width%2/2,ie=this.height%2/2,te=Math.cos(this.angle),ye=Math.sin(this.angle),pe=Z-Math.round(Z)+te*ee+ye*ie,ge=q-Math.round(q)+te*ie+ye*ee,ue=new Float64Array(C);if(s.br(ue,ue,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=ue,C=s.bC(),s.cS(C,C,[this.width/2,-this.height/2,1]),s.br(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=s.bC(),s.cS(C,C,[1,-1,1]),s.br(C,C,[-1,-1,0]),s.cS(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,I),this._calcFogMatrices(),this._distanceTileDataCache={},C=s.bl(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(le,le,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,c=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,r];s.c5(g,g,f),s.c5(c,c,-1),s.cW(c,c,g);const _=s.bC();s.br(_,_,c),s.cS(_,_,g),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,f)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),f=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-c[0]*g,f.y/this.worldSize-c[1]*g,t/this.worldSize*this._centerAltitude-c[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],f=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(g=Math.min((r-c)/f,1)),this._camera.position=s.bH([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:c,bearing:f}=this._camera.getPitchBearing(),g=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),v=Math.max((t[2]-g)/Math.cos(c),_),b=this._zoomFromMercatorZ(v);s.bH(t,t,r,v),this._pitch=s.aA(c,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(f,-Math.PI,Math.PI),this._setZoom(s.aA(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,c=s.cL,f=0,g=1/0;for(;c-r>1e-6&&c>r;){const _=r+.5*(c-r),v=this.tileSize*Math.pow(2,_),b=this.getCameraToCenterDistance(this.projection,_,v),I=this.scaleZoom(b/(Math.max(0,t)*this.tileSize)),C=Math.abs(_-I);C<g&&(g=C,f=_),_<I?r=_:c=_}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const c=Math.min(t.x,r.x),f=Math.max(t.x,r.x),g=Math.min(t.y,r.y),_=Math.max(t.y,r.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const v=[new s.P(c,g),new s.P(f,_),new s.P(c,_),new s.P(f,g)],b=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const C of v){const O=this.pointRayIntersection(C);if(O.t<0)return!0;const L=this.rayIntersectionCoordinate(O);if(L.x<b||L.y<0||L.x>I||L.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,r){const c=s.ag(s.av([],this._camera.position,t)),f=this._zoomFromMercatorZ(c)+r;return c-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([r,c,f],g){const _=[r,c,f,1];s.aC(_,_,g);const v=_[3]=Math.max(_[3],1e-6);return _[0]/=v,_[1]/=v,_[2]/=v,_})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,c=this.worldSize){const f=s.cO(t,r,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,c,f);let _=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(_=s.ak(1,_,s.d0(this.pitch>=Oa?1:this.pitch/Oa))),_}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Zl=(l,t)=>{if(t>0&&l.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=l.transform,c=Math.max(Math.abs(r._zoom-(l.minCutoffZoom-1)),1),f=r.isLODDisabled(!1)?s.ah(60,45,r.pitch):s.ah(30,15,r.pitch),g=r._farZ-r._nearZ,_=t*r.height,v=((1-(b=f))*r.cameraToCenterDistance+b*(r._farZ+_))*c;var b;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(v-r._nearZ)/g,(v-_-r._nearZ)/g]}}},Fa=2048;class Ch{constructor(t,r){this.aabb=t,this.lastCascade=r}}class vm{add(t,r){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],r.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],r.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],r.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],r.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],r.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],r.max[2])):this.receivers[t.key]=new Ch(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,c){const f=s.d9.fromPoints(t.points);let g=0;for(const _ in this.receivers){const v=this.receivers[_];if(!v||!f.intersectsAabb(v.aabb))continue;v.aabb.min=f.closestPoint(v.aabb.min),v.aabb.max=f.closestPoint(v.aabb.max);const b=v.aabb.getCorners();for(let I=0;I<c.length;I++){let C=!0;for(const O of b){const L=[O[0]*r,O[1]*r,O[2]];if(s.af(L,L,c[I].matrix),L[0]<-1||L[0]>1||L[1]<-1||L[1]>1){C=!1;break}}if(v.lastCascade=I,g=Math.max(g,I),C)break}}return g+1}}class zu{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vm,this._depthMode=new an(t.context.gl.LEQUAL,an.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const f=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||f<=0||(this._shadowLayerCount=c.style.order.reduce(((V,j)=>{const Z=c.style._mergedLayers[j];return V+(Z.hasShadowPass()&&!Z.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=c.context,_=Fa,v=Fa;if(this._cascades.length===0||Fa!==this._cascades[0].texture.size[0]){this._cascades=[];for(let V=0;V<2;++V){const j=c._shadowMapDebug,Z=g.gl,q=g.createFramebuffer(_,v,j?1:0,"texture"),ee=new s.T(g,{width:_,height:v,data:null},Z.DEPTH_COMPONENT16);if(q.depthAttachment.set(ee.texture),j){const ie=new s.T(g,{width:_,height:v,data:null},Z.RGBA8);q.colorAttachment0.set(ie.texture)}this._cascades.push({framebuffer:q,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=Ls(r);let b=0;if(t.elevation){const V=t.elevation,j=[1e4,-1e4];V.visibleDemTiles.filter((Z=>Z.dem)).forEach((Z=>{const q=Z.dem.tree;j[0]=Math.min(j[0],q.minimums[0]),j[1]=Math.max(j[1],q.maximums[0])})),j[0]!==1e4&&(b=(j[1]-j[0])*V.exaggeration())}const I=1.5*t.cameraToCenterDistance,C=3*I,O=new Float64Array(16);for(let V=0;V<this._cascades.length;++V){const j=this._cascades[V];let Z=t.height/50,q=1;V===0?q=I:(Z=I,q=C);const[ee,ie]=Xl(t,this.shadowDirection,Z,q,Fa,b);j.scale=t.scale,j.matrix=ee,j.boundingSphereRadius=ie,s.bl(O,j.matrix),j.frustum=s.cB.fromInvProjectionMatrix(O,1,0,!0),j.far=q}const L=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[L].far,this._cascades[L].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Fa,this._uniformValues.u_shadowmap_0=fo.ShadowMap0,this._uniformValues.u_shadowmap_1=fo.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const D=c.transform.elevation;for(const V of this._groundShadowTiles){let j={min:0,max:0};if(D){const Z=D.getMinMaxForTile(V);Z&&(j=Z)}this.addShadowReceiver(V.toUnwrapped(),j.min,j.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const c=this.painter,f=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),f.viewport.set([0,0,Fa,Fa]);for(let g=0;g<this._numCascadesToRender;++g){c.currentShadowCascade=g,f.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),f.clear({color:s.ao.white,depth:1});for(const _ of t.order){const v=t._mergedLayers[_];if(!v.hasShadowPass()||v.isHidden(c.transform.zoom))continue;const b=t.getLayerSourceCache(v),I=b?r[b.id]:void 0;(v.type==="model"||I&&I.length)&&c.renderLayer(c,b,v,I)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,c=t.context,f=c.gl,g=r.directionalLight,_=r.ambientLight;if(!g||!_)return;const v=[],b=Zl(t,t.longestCutoffRange);b.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&v.push("NORMAL_OFFSET");const I=ma(r,g,_),C=new an(f.LEQUAL,an.ReadOnly,t.depthRangeFor3D),O=new Pn({func:f.EQUAL,mask:255},0,255,f.KEEP,f.KEEP,f.KEEP);for(const L of this._groundShadowTiles){const D=L.toUnwrapped(),V=t.isTileAffectedByFog(L),j=t.getOrCreateProgram("groundShadow",{defines:v,overrideFog:V});this.setupShadows(D,j),t.uploadCommonUniforms(c,j,D,null,b);const Z={u_matrix:t.transform.calculateProjMatrix(D),u_ground_shadow_factor:I};j.draw(t,f.TRIANGLES,C,O,On.multiply,In.disabled,Z,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?On.unblended:On.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,c=r.calculatePosMatrix(t,r.worldSize);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){const r=s.bz(t);return s.aB(r,this._cascades[this.painter.currentShadowCascade].matrix,t),r}setupShadows(t,r,c){if(!this.enabled)return;const f=this.painter.transform,g=this.painter.context,_=g.gl,v=this._uniformValues,b=new Float64Array(16),I=f.calculatePosMatrix(t,f.worldSize);for(let C=0;C<this._cascades.length;C++)s.aB(b,this._cascades[C].matrix,I),v[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),g.activeTexture.set(_.TEXTURE0+fo.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const C=s.d7(t.canonical),O=2/f.tileSize*s.al/Fa,L=O*this._cascades[0].boundingSphereRadius,D=O*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(c==="vector-tile"?1:3)*(function(j,Z,q,ee,ie){const te=s.aA((j-22)/-22,0,1);return .125*(1-te)+4*te})(f.zoom);v.u_shadow_normal_offset=[C,L*V,D*V],v.u_shadow_bias=[1e-4,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(g,v)}setupShadowsFromMatrix(t,r,c=!1){if(!this.enabled)return;const f=this.painter.context,g=f.gl,_=this._uniformValues,v=new Float64Array(16);for(let b=0;b<2;b++)s.aB(v,this._cascades[b].matrix,t),_[b===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(v),f.activeTexture.set(g.TEXTURE0+fo.ShadowMap0+b),this._cascades[b].texture.bindExtraParam(g.LINEAR,g.LINEAR,g.CLAMP_TO_EDGE,g.CLAMP_TO_EDGE,g.GREATER);this.useNormalOffset=c,c?(_.u_shadow_normal_offset=[1,3,3],_.u_shadow_bias=[6e-5,.0012,.012]):_.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(f,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,c,f){if(f[2]>=0)return{};const g=(function(b,I,C){const O=C/(1<<b.canonical.z);return new s.d9([b.canonical.x*O+b.wrap*C,b.canonical.y*O+b.wrap*C,0],[(b.canonical.x+1)*O+b.wrap*C,(b.canonical.y+1)*O+b.wrap*C,I])})(t,r,c).getCorners(),_=r/-f[2];f[0]<0?(s.d8(g[0],g[0],[f[0]*_,0,0]),s.d8(g[3],g[3],[f[0]*_,0,0])):f[0]>0&&(s.d8(g[1],g[1],[f[0]*_,0,0]),s.d8(g[2],g[2],[f[0]*_,0,0])),f[1]<0?(s.d8(g[0],g[0],[0,f[1]*_,0]),s.d8(g[1],g[1],[0,f[1]*_,0])):f[1]>0&&(s.d8(g[2],g[2],[0,f[1]*_,0]),s.d8(g[3],g[3],[0,f[1]*_,0]));const v={};return v.vertices=g,v.planes=[Mh(g[1],g[0],g[4]),Mh(g[2],g[1],g[5]),Mh(g[3],g[2],g[6]),Mh(g[0],g[3],g[7])],v}addShadowReceiver(t,r,c){this._receivers.add(t,s.d9.fromTileIdAndHeight(t,r,c))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Mh(l,t,r){const c=s.av([],r,t),f=s.av([],l,t),g=s.bI([],c,f),_=s.ag(g);return _===0?[0,0,1,0]:(s.c5(g,g,1/_),[g[0],g[1],g[2],-s.bJ(g,t)])}function Ls(l){const t=l.properties.get("direction"),r=s.d4(t.x,t.y,t.z);r[2]=s.aA(r[2],0,75);const c=s.d6([r[0],r[1],r[2]]);return s.d5(c.x,c.y,c.z)}function ma(l,t,r){const c=t.properties.get("color-use-theme")==="none",f=t.properties.get("color"),g=t.properties.get("intensity"),_=t.properties.get("direction"),v=[_.x,_.y,_.z],b=r.properties.get("color-use-theme")==="none",I=r.properties.get("color"),C=r.properties.get("intensity"),O=Math.max(s.bJ([0,0,1],v),0),L=[0,0,0];s.c5(L,I.toPremultipliedRenderColor(b?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),C);const D=[0,0,0];return s.c5(D,f.toPremultipliedRenderColor(c?null:l.getLut(r.scope)).toArray01Linear().slice(0,3),O*g),s.db([L[0]>0?L[0]/(L[0]+D[0]):0,L[1]>0?L[1]/(L[1]+D[1]):0,L[2]>0?L[2]/(L[2]+D[2]):0])}function Xl(l,t,r,c,f,g){const _=l.zoom,v=l.scale,b=l.worldSize,I=1/b,C=l.aspect,O=Math.sqrt(1+C*C)*Math.tan(.5*l.fovX),L=O*O,D=c-r,V=c+r;let j,Z;L>D/V?(j=c,Z=c*O):(j=.5*V*(1+L),Z=.5*Math.sqrt(D*D+2*(c*c+r*r)*L+V*V*L*L));const q=l.projection.pixelsPerMeter(l.center.lat,b),ee=l._camera.getCameraToWorldMercator(),ie=[0,0,-j*I];s.af(ie,ie,ee);let te=Z*I;const ye=l._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const dt=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?q:1),Rt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,r,c);Rt[8]=2*-l.centerOffset.x/l.width,Rt[9]=2*l.centerOffset.y/l.height;const Lt=new Float64Array(16);s.cP(Lt,Rt,dt);const At=new Float64Array(16);s.bl(At,Lt);const wt=s.cB.fromInvProjectionMatrix(At,b,_,!0);for(const tn of wt.points){const Yt=((pe=tn)[0]/=v,pe[1]/=v,pe[2]=s.cf(pe[2],l._center.lat),pe);te=Math.max(te,s.c6(s.da([],ie,Yt)))}}var pe;te*=f/(f-1);const ge=Math.acos(t[2]),ue=Math.atan2(-t[0],-t[1]),le=new Ah;le.position=ie,le.setPitchBearing(ge,ue);const xe=le.getWorldToCamera(b,q),Re=te*b,Ae=Math.min(l._mercatorZfromZoom(17)*b*-2,-2*Re),$e=le.getCameraToClipOrthographic(-Re,Re,-Re,Re,Ae,(Re+g*q)/t[2]),He=new Float64Array(16);s.aB(He,$e,xe);const it=s.d5(Math.floor(1e6*ie[0])/1e6*b,Math.floor(1e6*ie[1])/1e6*b,0),xt=.5*f,Ne=[0,0,0];s.af(Ne,it,He),s.c5(Ne,Ne,xt);const Ee=[Math.floor(Ne[0]),Math.floor(Ne[1]),Math.floor(Ne[2])],We=[0,0,0];s.av(We,Ne,Ee),s.c5(We,We,-1/xt);const Ue=new Float64Array(16);return s.bA(Ue),s.br(Ue,Ue,We),s.aB(He,Ue,He),[He,Re]}class Sp extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return s.dc(this.requestManager.transformRequest(r,s.R.Model).url).then((c=>{if(!c)return;const f=s.dd(c),g=new s.de(t,r,void 0,void 0,f);return g.computeBoundsAndApplyParent(),g})).catch((c=>{if(c&&c.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${r}: ${c.message}`)))}))}load(t,r,c={forceReload:!1}){this.models[r]||(this.models[r]={});const f=Object.keys(t),g=[],_=[];for(const v of f){const b=t[v];this.hasURLBeenRequested(b)&&!c.forceReload||(this.modelByURL[b]={modelId:v,scope:r},g.push(this.loadModel(v,b)),_.push(v)),this.models[r][v]||(this.models[r][v]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+_.length,Promise.allSettled(g).then((v=>{for(let b=0;b<v.length;b++){const{status:I}=v[b];if(I==="rejected")continue;const{value:C}=v[b];this.models[r][_[b]]||(this.models[r][_[b]]={model:null,numReferences:1}),this.models[r][_[b]].model=C}this.numModelsLoading[r]-=_.length,this.fire(new s.z("data",{dataType:"style"}))})).catch((v=>{this.fire(new s.y(new Error(`Could not load models: ${v.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===f)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(f)){const{scope:g,modelId:_}=this.modelByURL[f];this.models[g][_].numReferences++}else this.modelUris[c][t]=f,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c=this.modelUris[r];for(const f in t)c[f]=this.requestManager.normalizeModelURL(t[f])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c={};for(const f of t)this.hasModel(f,r,{exactIdMatch:!0})||this.hasURLBeenRequested(f)?this.models[r][f].numReferences++:this.modelUris[r][f]&&!this.hasURLBeenRequested(f)?c[f]=this.modelUris[r][f]:!this.hasURLBeenRequested(f)&&s.df(f,!1)&&(this.modelUris[r][f]=this.requestManager.normalizeModelURL(f),c[f]=this.modelUris[r][f]);this.load(c,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,c=!1,f=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0||f)){const g=this.modelUris[r][t];c||delete this.modelUris[r][t],delete this.modelByURL[g];const _=this.models[r][t].model;if(!_)return;delete this.models[r][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const c=this.models[t][r].model;delete this.models[t][r],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const c in this.models[r])this.models[r][c].model&&this.models[r][c].model.upload(t.context)}}const Nd=s.a6.colorTheme,Ep=new s.a9({data:new s.aa(Nd.data)});function jd(l){if(!l.metadata||!l.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:r,top:c,width:f,height:g}=l.metadata.content_area,_=r*t,v=c*t;return[_,v,_+f*t,v+g*t]}function Ip(l){if(l)return l.map((([t,r])=>[t*s.o.devicePixelRatio,r*s.o.devicePixelRatio]))}class Ff{constructor(t,r,c){this.id=t,this.scope=r,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof Oo))return t;const f=r.map((_=>this.sourceCache.getTile(_))),g=c.getImages(f,Array.from(this.pendingRequests));for(const[_,v]of g)t.set(s.I.from({name:_,iconsetId:this.id}),v),this.pendingRequests.delete(_);for(const _ of this.pendingRequests)this.missingRequests.add(_);return this.pendingRequests.clear(),t}}const ga=(l,t)=>se(l,t&&t.filter((r=>r.identifier!=="source.canvas"))),Vd=s.aH(ci,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Lu=s.aH(ci,["setCenter","setZoom","setBearing","setPitch"]),Du=new Set(["background","sky","slot","custom"]),Yl={version:8,layers:[],sources:{}},gc={duration:300,delay:0};class is extends s.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},gc),this._buildingIndex=new _m(this),this.crossTileSymbolIndex=new Da,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=r.styleChanges||new Cr,this._hasDataDrivenEmissive=!1,this.dispatcher=r.dispatcher?r.dispatcher:new s.D(s.dh(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new Ca(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new s.di(t._requestManager,r.localFontFamily?s.dj.all:r.localIdeographFontFamily?s.dj.ideographs:s.dj.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Sp(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._indoorDependentLayers=r.indoorDependentLayers?r.indoorDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const c=this;this._rtlTextPluginCallback=is.registerForPluginStateChange((f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},((g,_)=>{if(s.dl(g),_&&_.every((v=>v)))for(const v in c._sourceCaches){const b=c._sourceCaches[v],I=b.getSource().type;I!=="vector"&&I!=="geojson"||b.reload()}}))})),this.on("data",(f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.getOwnSource(f.sourceId);if(g&&g.vectorLayerIds)for(const _ in this._layers){const v=this._layers[_];v.source===g.id&&this._validateLayer(v)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const r=s.dm(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${s.dn(JSON.stringify(t))}`}_diffStyle(t,r,c){this.globalId=this._getGlobalId(t);const f=(g,_)=>{try{_(null,this.setState(g,c))}catch(v){_(v,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),_=this.map._requestManager.transformRequest(g,s.R.Style);s.m(_,((v,b)=>{v?this.fire(new s.y(v)):b&&f(b,r)}))}else typeof t=="object"&&f(t,r)}loadURL(t,r={}){this.fire(new s.z("dataloading",{dataType:"style"}));const c=typeof r.validate=="boolean"?r.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const f=this.importsCache.get(t);if(f)return this._load(f,c);const g=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(g,((_,v)=>{if(this._request=null,_)this.fire(new s.y(_));else if(v)return this.importsCache.set(t,v),this._load(v,c)}))}loadJSON(t,r={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame((()=>{this._request=null,this._load(t,r.validate!==!1)}))}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Yl,!1)}_loadImports(t,r,c){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const g of t){const _=this._createFragmentStyle(g),v=new Promise((C=>{_.once("style.import.load",C),_.once("error",C)})).then((()=>this.mergeAll()));if(f.push(v),this.resolvedImports.has(g.url)){_.loadEmpty();continue}const b=g.data||this.importsCache.get(g.url);b?(_.loadJSON(b,{validate:r}),this._isInternalStyle(b)&&(_.globalId=null)):g.url?_.loadURL(g.url,{validate:r}):_.loadEmpty();const I={style:_,id:g.id,config:g.config};if(c){const C=this.fragments.findIndex((({id:O})=>O===c));this.fragments=this.fragments.slice(0,C).concat(I).concat(this.fragments.slice(C))}else this.fragments.push(I)}return Promise.allSettled(f)}getImportGlobalIds(t=this,r=new Set){for(const c of t.fragments)c.style.globalId&&r.add(c.style.globalId),this.getImportGlobalIds(c.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?s.B(t.id,this.scope):t.id;let c;const f=this._initialConfig&&this._initialConfig[r];(t.config||f)&&(c=Object.assign({},t.config,f));const g=new is(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){if(this._isInternalStyle(t)){const g=Object.assign({},Yl,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(g,r)}if(this.updateConfig(this._config,t.schema),r&&ga(this,Wr(t)))return;this._loaded=!0,this.stylesheet=s.dp(t);const c=()=>{for(const b in t.sources)this.addSource(b,t.sources[b],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const b in t.iconsets)this.addIconset(b,t.iconsets[b]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const g=Hl(this.stylesheet.layers);if(this._order=g.map((b=>b.id)),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const b=this.stylesheet.lights[0];this.light=new Pe(b.properties,b.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Pe(this.stylesheet.light)),this._layers={};for(const b of g){const I=s.du(b,this.scope,this._styleColorTheme.lut,this.options);I.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(I.fqid),I.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(I.fqid),this._hasAppearances=this._hasAppearances||I.getAppearances().length!==0,I.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=I;const C=this.getOwnLayerSourceCache(I),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&I.canCastShadows()&&O&&(C.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const _=this.stylesheet.terrain;_&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const v=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then((()=>{this._reloadImports(),this.fire(new s.z(v?"style.load":"style.import.load"))})).catch((b=>{this.fire(new s.y(new Error("Failed to load imports",b))),this.fire(new s.z(v?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new s.z(v?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(f){const g=this._evaluateColorThemeData(f);this._loadColorTheme(g).then((()=>{c()})).catch((_=>{s.w(`Couldn't load color theme from the stylesheet: ${_}`),c()}))}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((t=>t.style.hasAppearances()))}mergeAll(){let t,r,c,f,g,_,v,b,I,C;const O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((L=>{if(L.stylesheet){if(L.light!=null&&(t=L.light),L.stylesheet.lights)for(const D of L.stylesheet.lights)D.type==="ambient"&&L.ambientLight!=null&&(r=L.ambientLight),D.type==="directional"&&L.directionalLight!=null&&(c=L.directionalLight);f=this._prioritizeTerrain(f,L.terrain,L.stylesheet.terrain),L.stylesheet.fog&&L.fog!=null&&(g=L.fog),L.stylesheet.snow&&L.snow!=null&&(_=L.snow),L.stylesheet.rain&&L.rain!=null&&(v=L.rain),L.stylesheet.camera!=null&&(C=L.stylesheet.camera),L.stylesheet.projection!=null&&(b=L.stylesheet.projection),L.stylesheet.transition!=null&&(I=L.stylesheet.transition),O[L.scope]=L._styleColorTheme}})),this.light=t,this.ambientLight=r,this.directionalLight=c,this.fog=g,this.snow=_,this.rain=v,this._styleColorThemeForScope=O,f===null?delete this.terrain:this.terrain=f,this.camera=C||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=Object.assign({},gc,I),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const r=c=>{for(const f of c.fragments)r(f.style);t(c)};r(this)}_prioritizeTerrain(t,r,c){const f=t&&t.drapeRenderMode===0;return c===null?r&&r.drapeRenderMode===0?r:f?t:null:r!=null&&(!t||f||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},c={};this.forEachFragmentStyle((f=>{for(const g in f._sourceCaches){const _=s.B(g,f.scope);t[_]=f._sourceCaches[g]}for(const g in f._otherSourceCaches){const _=s.B(g,f.scope);r[_]=f._otherSourceCaches[g]}for(const g in f._symbolSourceCaches){const _=s.B(g,f.scope);c[_]=f._symbolSourceCaches[g]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=c}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const r of Object.values(t.stylesheet.indoor)){const c=r,f=s.B(c.sourceId,t.scope);this._mergedIndoor[f]=new Set(c.sourceLayers||[])}}))}mergeLayers(){const t={},r=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((_=>{for(const v of _._order){const b=_._layers[v];if(b.type==="slot"){const I=s.dq(v);if(t[I])continue;t[I]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):r.push(b)}})),this._mergedOrder=[];let f=-1;const g=(_=[])=>{for(const v of _)if(v.type==="slot"){const b=s.dq(v.id);t[b]&&g(t[b]),this._mergedSlots.push(b)}else{const b=s.B(v.id,v.scope);this._mergedOrder.push(b),c[b]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0,f=this._mergedOrder.length-1),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};if(g(r),this._has3DLayers){const _={};for(let v=0;v<this._mergedOrder.length;++v){const b=this._mergedOrder[v];_[b]=v===f?1:v<f?c[b].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((v,b)=>_[v]-_[b]))}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(r,c,f,g){const _=Object.assign({},c);for(const b of Object.keys(Nd))_[b]===void 0&&(_[b]=Nd[b].default);const v=new s.a8(Ep,r,new Map(f));return v.setTransitionOrValue(_,f),v.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((c,f)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let _=t;_.startsWith(g)||(_=g+_);const v=s.I.from("mapbox-reserved-lut"),b=new Image;b.src=_,b.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},b.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void c();this._styleColorTheme.lutLoading=!1;const{width:I,height:C,data:O}=s.o.getImageData(b);if(C>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(I!==C*C)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(v)&&this.removeImage(v),this.addImage(v,{data:new s.q({width:I,height:C},O),pixelRatio:1,sdf:!1,usvg:!1,version:0});const L=this.imageManager.getImage(v,this.scope);L?(this._styleColorTheme.lut={image:L.data,data:t},c()):f(new Error("Missing LUT image."))}}))}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(r,c,f){let g,_,v;const b=s.o.devicePixelRatio>1?"@2x":"";let I=s.m(c.transformRequest(c.normalizeSpriteURL(r,b,".json"),s.R.SpriteJSON),((L,D)=>{I=null,v||(v=L,g=D,O())})),C=s.n(c.transformRequest(c.normalizeSpriteURL(r,b,".png"),s.R.SpriteImage),((L,D)=>{C=null,v||(v=L,_=D,O())}));function O(){if(v)f(v);else if(g&&_){const L=s.o.getImageData(_),D={};for(const V in g){const{width:j,height:Z,x:q,y:ee,sdf:ie,pixelRatio:te,stretchX:ye,stretchY:pe,content:ge}=g[V],ue=new s.q({width:j,height:Z});s.q.copy(L,ue,{x:q,y:ee},{x:0,y:0},{width:j,height:Z},null),D[V]={data:ue,pixelRatio:te!==void 0?te:1,sdf:ie!==void 0&&ie,stretchX:ye,stretchY:pe,content:ge,usvg:!1,version:0}}f(null,D)}}return{cancel(){I&&(I.cancel(),I=null),C&&(C.cancel(),C=null)}}})(t,this.map._requestManager,((r,c)=>{if(this._spriteRequest=null,r)this.fire(new s.y(r));else if(c){const f=new Map;for(const g in c)f.set(s.I.from(g),c[g]);this.addImages(f)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))}))}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const c=this.getOwnSourceCache(r.source);if(!c)return void this.fire(new s.y(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const f=c.getSource();if(f.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));f.partial=!1;const g=new Ff(t,this.scope,c);this.imageManager.addImageProvider(g,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var c,f;this._spriteRequest=(f=(g,_)=>{if(this._spriteRequest=null,g)r?this._loadSprite(t):this.fire(new s.y(g));else if(_){const v=new Map;for(const b in _)v.set(s.I.from(b),_[b]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),s.R.Iconset),((g,_)=>{if(g)return void f(g);const v={},b=s.dg(new s.bt(_));for(const I of b.icons){const C={version:1,pixelRatio:s.o.devicePixelRatio,content:jd(I),stretchX:I.metadata?Ip(I.metadata.stretch_x_areas):void 0,stretchY:I.metadata?Ip(I.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:I};v[I.name]=C}f(null,v)})))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const c=t.sourceLayer;c&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.y(new Error(`Source layer "${c}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,r)=>{const c=this.fragments[r];return c&&c.style&&(t.data=c.style.serialize()),t}))}_serializeSources(){const t={};for(const r in this._sourceCaches){const c=this._sourceCaches[r].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const r=[];for(const c of t){const f=this._layers[c];f&&f.type!=="custom"&&r.push(f.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const r=this._mergedLayers[t];if(r._transitionablePaint&&r._transitionablePaint._values){const c=r._transitionablePaint._values["line-emissive-strength"];if(c&&c.value&&c.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const c=this.map.painter;if(c)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){const g=t.getProgramIds();if(g)for(const _ of g){const v=t.getDefaultProgramParams(_,r.zoom,this._styleColorTheme.lut);v&&(c.style=this,this.fog&&(c._fogVisible=!0,v.overrideFog=!0,c.getOrCreateProgram(_,v)),c._fogVisible=!1,v.overrideFog=!1,c.getOrCreateProgram(_,v),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(v.overrideRtt=!0,c.getOrCreateProgram(_,v)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let f=!1;if(this._changes.isDirty()){const v=this._changes.getLayerUpdatesByScope();for(const b in v){const{updatedIds:I,removedIds:C}=v[b];(I||C)&&(this._updateWorkerLayers(b,I,C),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const v in this._mergedSourceCaches){const b=this._mergedSourceCaches[v];g[v]=b.used,b.used=!1,b.tileCoverLift=0}for(const v of this._mergedOrder){const b=this._mergedLayers[v];if(b.visibility!=="none"&&b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)){const I=this.getLayerSourceCache(b);I&&(I.used=!0,I.tileCoverLift=Math.max(I.tileCoverLift,b.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(b,t)})):this.precompilePrograms(b,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();const _=this.imageManager.getPendingImageProviders();for(const v of _)v.sourceCache.used=!0;for(const v in g){const b=this._mergedSourceCaches[v];g[v]!==b.used&&b.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const c=r.resolvePendingRequests(),f=this.getFragmentStyle(r.scope);f&&f.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const c=this._mergedSourceCaches[r].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,c){const f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:r?f._serializeLayers(r):[],scope:t,removedIds:c||[],options:f.options})}setState(t,r){if(this._checkLoaded(),ga(this,Wr(t)))return!1;(t=s.dp(t)).layers=Hl(t.layers);const c=(function(_,v){if(!_)return[{command:ci.setStyle,args:[v]}];let b=[];try{if(!s.by(_.version,v.version))return[{command:ci.setStyle,args:[v]}];if(s.by(_.center,v.center)||b.push({command:ci.setCenter,args:[v.center]}),s.by(_.zoom,v.zoom)||b.push({command:ci.setZoom,args:[v.zoom]}),s.by(_.bearing,v.bearing)||b.push({command:ci.setBearing,args:[v.bearing]}),s.by(_.pitch,v.pitch)||b.push({command:ci.setPitch,args:[v.pitch]}),s.by(_.sprite,v.sprite)||b.push({command:ci.setSprite,args:[v.sprite]}),s.by(_.glyphs,v.glyphs)||b.push({command:ci.setGlyphs,args:[v.glyphs]}),s.by(_.imports,v.imports)||(function(D=[],V=[],j){V=V||[];const Z=(D=D||[]).map(Fc),q=V.map(Fc),ee=D.reduce(Eu,{}),ie=V.reduce(Eu,{}),te=Z.slice();let ye,pe,ge,ue;for(ye=0,pe=0;ye<Z.length;ye++)ge=Z[ye],ie.hasOwnProperty(ge)?pe++:(j.push({command:ci.removeImport,args:[ge]}),te.splice(te.indexOf(ge,pe),1));for(ye=0,pe=0;ye<q.length;ye++)ge=q[q.length-1-ye],te[te.length-1-ye]!==ge&&(ee.hasOwnProperty(ge)?(j.push({command:ci.removeImport,args:[ge]}),te.splice(te.lastIndexOf(ge,te.length-pe),1)):pe++,ue=te[te.length-ye],j.push({command:ci.addImport,args:[ie[ge],ue]}),te.splice(te.length-ye,0,ge));for(const le of V){const xe=ee[le.id];xe&&(delete xe.data,s.by(xe,le)||j.push({command:ci.updateImport,args:[le.id,le]}))}})(_.imports,v.imports,b),s.by(_.transition,v.transition)||b.push({command:ci.setTransition,args:[v.transition]}),s.by(_.light,v.light)||b.push({command:ci.setLight,args:[v.light]}),s.by(_.fog,v.fog)||b.push({command:ci.setFog,args:[v.fog]}),s.by(_.snow,v.snow)||b.push({command:ci.setSnow,args:[v.snow]}),s.by(_.rain,v.rain)||b.push({command:ci.setRain,args:[v.rain]}),s.by(_.projection,v.projection)||b.push({command:ci.setProjection,args:[v.projection]}),s.by(_.lights,v.lights)||b.push({command:ci.setLights,args:[v.lights]}),s.by(_.camera,v.camera)||b.push({command:ci.setCamera,args:[v.camera]}),s.by(_.iconsets,v.iconsets)||(function(D,V,j){let Z;for(Z in V=V||{},D=D||{})D.hasOwnProperty(Z)&&(V.hasOwnProperty(Z)||j.push({command:ci.removeIconset,args:[Z]}));for(Z in V){if(!V.hasOwnProperty(Z))continue;const q=V[Z];D.hasOwnProperty(Z)?s.by(D[Z],q)||(j.push({command:ci.removeIconset,args:[Z]}),j.push({command:ci.addIconset,args:[Z,q]})):j.push({command:ci.addIconset,args:[Z,q]})}})(_.iconsets,v.iconsets,b),!s.by(_["color-theme"],v["color-theme"]))return[{command:ci.setStyle,args:[v]}];const I={},C=[];(function(D,V,j,Z){let q;for(q in V=V||{},D=D||{})D.hasOwnProperty(q)&&(V.hasOwnProperty(q)||zf(q,j,Z));for(q in V){if(!V.hasOwnProperty(q))continue;const ee=V[q];D.hasOwnProperty(q)?s.by(D[q],ee)||(D[q].type==="geojson"&&ee.type==="geojson"&&Md(D,V,q)?j.push({command:ci.setGeoJSONSourceData,args:[q,ee.data]}):Tp(q,V,j,Z)):Oc(q,V,j)}})(_.sources,v.sources,C,I);const O=[];_.layers&&_.layers.forEach((D=>{D.source&&I[D.source]?b.push({command:ci.removeLayer,args:[D.id]}):O.push(D)}));let L=_.terrain;L&&I[L.source]&&(b.push({command:ci.setTerrain,args:[void 0]}),L=void 0),b=b.concat(C),s.by(L,v.terrain)||b.push({command:ci.setTerrain,args:[v.terrain]}),(function(D,V,j){V=V||[];const Z=(D=D||[]).map(Fc),q=V.map(Fc),ee=D.reduce(Eu,{}),ie=V.reduce(Eu,{}),te=Z.slice(),ye=Object.create(null);let pe,ge,ue,le,xe,Re,Ae;for(pe=0,ge=0;pe<Z.length;pe++)ue=Z[pe],ie.hasOwnProperty(ue)?ge++:(j.push({command:ci.removeLayer,args:[ue]}),te.splice(te.indexOf(ue,ge),1));for(pe=0,ge=0;pe<q.length;pe++)ue=q[q.length-1-pe],te[te.length-1-pe]!==ue&&(ee.hasOwnProperty(ue)?(j.push({command:ci.removeLayer,args:[ue]}),te.splice(te.lastIndexOf(ue,te.length-ge),1)):ge++,Re=te[te.length-pe],j.push({command:ci.addLayer,args:[ie[ue],Re]}),te.splice(te.length-pe,0,ue),ye[ue]=!0);for(pe=0;pe<q.length;pe++)if(ue=q[pe],le=ee[ue],xe=ie[ue],!ye[ue]&&!s.by(le,xe))if(s.by(le.source,xe.source)&&s.by(le["source-layer"],xe["source-layer"])&&s.by(le.type,xe.type)){for(Ae in Ya(le.layout,xe.layout,j,ue,null,ci.setLayoutProperty),Ya(le.paint,xe.paint,j,ue,null,ci.setPaintProperty),s.by(le.slot,xe.slot)||j.push({command:ci.setSlot,args:[ue,xe.slot]}),s.by(le.filter,xe.filter)||j.push({command:ci.setFilter,args:[ue,xe.filter]}),s.by(le.minzoom,xe.minzoom)&&s.by(le.maxzoom,xe.maxzoom)||j.push({command:ci.setLayerZoomRange,args:[ue,xe.minzoom,xe.maxzoom]}),le)le.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&Ae!=="slot"&&(Ae.indexOf("paint.")===0?Ya(le[Ae],xe[Ae],j,ue,Ae.slice(6),ci.setPaintProperty):s.by(le[Ae],xe[Ae])||j.push({command:ci.setLayerProperty,args:[ue,Ae,xe[Ae]]}));for(Ae in xe)xe.hasOwnProperty(Ae)&&!le.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&Ae!=="slot"&&(Ae.indexOf("paint.")===0?Ya(le[Ae],xe[Ae],j,ue,Ae.slice(6),ci.setPaintProperty):s.by(le[Ae],xe[Ae])||j.push({command:ci.setLayerProperty,args:[ue,Ae,xe[Ae]]}))}else j.push({command:ci.removeLayer,args:[ue]}),Re=te[te.lastIndexOf(ue)+1],j.push({command:ci.addLayer,args:[xe,Re]})})(O,v.layers,b)}catch(I){console.warn("Unable to compute style diff:",I),b=[{command:ci.setStyle,args:[v]}]}return b})(this.serialize(),t).filter((_=>!(_.command in Lu)));if(c.length===0)return!1;const f=c.filter((_=>!(_.command in Vd)));if(f.length>0)throw new Error(`Unimplemented: ${f.map((_=>_.command)).join(", ")}.`);const g=[];return c.forEach((_=>{g.push(this[_.command](..._.args))})),r&&Promise.all(g).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[r,c]of t.entries()){if(this.getImage(r))return this.fire(new s.y(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,r,c=!1){this.imageManager.updateImage(t,this.scope,r),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,r,c={}){return this._checkLoaded(),this._validate(H,`models.${t}`,r,null,c)||(this.modelManager.addModel(t,r,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,r,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Wa,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const f=xo(t,r,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id})));const g=_=>{const v=(_?"symbol:":"other:")+f.id,b=s.B(v,this.scope),I=this._sourceCaches[v]=new Ks(b,f,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=I,I.onAdd(this.map)};g(!1),r.type!=="vector"&&r.type!=="geojson"||g(!0),f.onAdd&&f.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const f=Object.entries(this.stylesheet.iconsets).find((([g,_])=>_.type==="source"&&_.source===t));if(f)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${f[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const f of c){const g=s.dq(f.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(f.id),f.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const c=this.getOwnSourceCache(r);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const c=t[r]._tiles;for(const f in c){const g=c[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const g of t){if(this._validate(qr,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(g),_.updateTransitions(r)}else this.ambientLight=new Ei(g,Rr||(Rr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(g),_.updateTransitions(r)}else this.directionalLight=new Ei(g,ir||(ir=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(r,{worldview:this.map.getWorldview()}),f=new s.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const c=L=>.2126*(L[0]<=.03928?L[0]/12.92:Math.pow((L[0]+.055)/1.055,2.4))+.7152*(L[1]<=.03928?L[1]/12.92:Math.pow((L[1]+.055)/1.055,2.4))+.0722*(L[2]<=.03928?L[2]/12.92:Math.pow((L[2]+.055)/1.055,2.4)),f=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),g=t.properties.get("intensity"),_=t.properties.get("direction"),v=1-s.d4(_.x,_.y,_.z)[2]/90,b=c(f)*g*v,I=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),C=r.properties.get("intensity"),O=c(I)*C;return Number(((b+O)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dr(t)){const r=s.ds(t),c=this.fragments.find((({id:g})=>g===r));if(!c)return;const f=s.dq(t);return c.style.getFragmentStyle(f)}{const r=this.fragments.find((({id:c})=>c===t));return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},c=(f,g="")=>`${f}::${g}`;this._featuresetSelectors={};for(const f in t){const g=this._featuresetSelectors[f]=[];for(const _ of t[f].selectors){if(_.featureNamespace){const b=this.getOwnLayer(_.layer);if(!b){s.w(`Layer is undefined for selector: ${_.layer}`);continue}const I=c(b.source,b.sourceLayer);if(I in r&&r[I]!==_.featureNamespace){s.w(`"featureNamespace ${_.featureNamespace} of featureset ${f}'s selector is not associated to the same source, skip this selector`);continue}r[I]=_.featureNamespace}let v;if(_.properties)for(const b in _.properties){const I=s.U(_.properties[b]);I.result==="success"&&(v=v||{},v[b]=I.value)}g.push({layerId:_.layer,namespace:_.featureNamespace,properties:v,uniqueFeatureID:_._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const c=[];for(const f in r.stylesheet.featuresets)c.push({featuresetId:f,importId:r.scope?r.scope:void 0});return c}getFeaturesetLayers(t,r){const c=this.getFragmentStyle(r),f=c.stylesheet.featuresets;if(!f||!f[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const _ of f[t].selectors){const v=c.getOwnLayer(_.layer);v&&g.push(v)}return g}getConfigProperty(t,r){const c=this.getFragmentStyle(t);if(!c)return null;const f=s.B(r,c.scope),g=c.options.get(f),_=g?g.value||g.default:null;return _?_.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,r){const c=s.B(t,r);return this._mergedIndoor[c]}setIndoorData(t,r){this.map.indoor.setIndoorData(r)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,r,c){const f=this.getFragmentStyle(t);if(!f)return;const g=f.stylesheet.schema;if(!g||!g[r])return;const _=s.U(c);if(_.result!=="success")return void ga(this,_.value);const v=_.value.expression,b=s.B(r,f.scope),I=f.options.get(b);if(!I)return;let C;const{minValue:O,maxValue:L,stepValue:D,type:V,values:j}=g[r],Z=s.U(g[r].default);Z.result==="success"&&(C=Z.value.expression),C?(this.options.set(b,Object.assign({},I,{value:v,default:C,minValue:O,maxValue:L,stepValue:D,type:V,values:j})),this.updateConfigDependencies(r)):this.fire(new s.y(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const c=r.stylesheet.schema;if(!c)return null;const f={};for(const g in c){const _=s.B(g,r.scope),v=r.options.get(_),b=v?v.value||v.default:null;f[g]=b?b.serialize():null}return f}setConfig(t,r){const c=this.getFragmentStyle(t);c&&(c.updateConfig(r,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=r,c.updateConfig(c._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const c in r){let f,g;const _=s.U(r[c].default);if(_.result==="success"&&(f=_.value.expression),t&&t[c]!==void 0){const L=s.U(t[c]);L.result==="success"&&(g=L.value.expression)}const{minValue:v,maxValue:b,stepValue:I,type:C,values:O}=r[c];if(f){const L=s.B(c,this.scope);this.options.set(L,{default:f,value:g,minValue:v,maxValue:b,stepValue:I,type:C,values:O})}else this.fire(new s.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,r=(()=>!0)){for(const c of t){const f=this.getLayer(c);f&&r(f)&&(f.possiblyEvaluateVisibility(),this._updateLayer(f),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(r=>!t||r.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((r=>{const c=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(c){const f=r._evaluateColorThemeData(c);(!r._styleColorTheme.lut&&f!==""||r._styleColorTheme.lut&&f!==r._styleColorTheme.lut.data)&&r.setColorTheme(c)}})),this._changes.setDirty()}addLayer(t,r,c={}){this._checkLoaded();const f=t.id;if(this._layers[f])return void this.fire(new s.y(new Error(`Layer with id "${f}" already exists on this map`)));let g;if(t.type==="custom"){if(ga(this,s.dt(t)))return;g=s.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=s.dp(t),t=Object.assign(t,{source:f})),this._validate(Ws,`layers.${f}`,t,{arrayIndex:-1},c))return;g=s.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}const _=s.B(g.source,g.scope);g.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_),g.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_);let v=this._order.length;if(r){const O=this._order.indexOf(r);if(O===-1)return void this.fire(new s.y(new Error(`Layer with id "${r}" does not exist on this map.`)));g.slot===this._layers[r].slot?v=O:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=g;const b=this.getOwnLayerSourceCache(g),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&g.canCastShadows()&&I&&(b.castsShadows=!0);const C=this._changes.getRemovedLayer(g);if(C&&g.source&&b&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const O=s.B(g.source,g.scope);C.type!==g.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),b.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===r)return;const f=this._order.indexOf(t);this._order.splice(f,1);let g=this._order.length;if(r){const _=this._order.indexOf(r);if(_===-1)return void this.fire(new s.y(new Error(`Layer with id "${r}" does not exist on this map.`)));c.slot===this._layers[r].slot?g=_:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._indoorDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const f=this.getOwnLayerSourceCache(r);if(f&&f.castsShadows){let g=!1;for(const _ in this._layers)if(this._layers[_].source===r.source&&this._layers[_].canCastShadows()){g=!0;break}f.castsShadows=g}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,c){this._checkLoaded();const f=this._checkLayer(t);f&&(f.minzoom===r&&f.maxzoom===c||(r!=null&&(f.minzoom=r),c!=null&&(f.maxzoom=c),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==r&&(c.slot=r,this._updateLayer(c))}setFilter(t,r,c={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!s.by(f.filter,r))return r==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(qa,`layers.${f.id}.filter`,r,{layerType:f.type},c)||(f.filter=s.dp(r),this._updateLayer(f)))}getFilter(t){const r=this._checkLayer(t);if(r)return s.dp(r.filter)}setLayoutProperty(t,r,c,f={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!s.by(g.getLayoutProperty(r),c)){if(c!=null&&(!f||f.validate!==!1)&&ga(g,De.call(Wr,{key:`layers.${t}.layout.${r}`,layerType:g.type,objectKey:r,value:c,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(r,c),g.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),g.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(g.fqid),this._updateLayer(g)}}setLayerProperty(t,r,c,f={}){this._checkLoaded();const g=this._checkLayer(t);g&&(r==="appearances"?(g.setAppearances(c),this._changes.setDirty()):g.isPaintProperty(r)?this.setPaintProperty(t,r,c,f):this.setLayoutProperty(t,r,c,f))}getLayoutProperty(t,r){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(r)}setPaintProperty(t,r,c,f={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||s.by(g.getPaintProperty(r),c)||c!=null&&(!f||f.validate!==!1)&&ga(g,Lc.call(Wr,{key:`layers.${t}.paint.${r}`,layerType:g.type,objectKey:r,value:c,styleSpec:s.a6})))return;const _=g.setPaintProperty(r,c);g.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),g.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(g.fqid),_&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,r){const c=this._checkLayer(t);if(c)return c.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:I}=t.target,C=this.getFragmentStyle(I),O=C.getFeaturesetLayers(b);for(const{source:L,sourceLayer:D}of O)C.setFeatureState({id:t.id,source:L,sourceLayer:D},r)}else if("layerId"in t.target){const{layerId:b}=t.target,I=this.getLayer(b);this.setFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer},r)}return}const c=t.source,f=t.sourceLayer,g=this._checkSource(c);if(!g)return;const _=g.type;if(_==="geojson"&&f)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!f)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const v=this.getOwnSourceCaches(c);for(const b of v)b.setFeatureState(f,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:I}=t.target,C=this.getFragmentStyle(I),O=C.getFeaturesetLayers(b);for(const{source:L,sourceLayer:D}of O)C.removeFeatureState({id:t.id,source:L,sourceLayer:D},r)}else if("layerId"in t.target){const{layerId:b}=t.target,I=this.getLayer(b);this.removeFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer},r)}return}const c=t.source,f=this._checkSource(c);if(!f)return;const g=f.type,_=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!_)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const v=this.getOwnSourceCaches(c);for(const b of v)b.removeFeatureState(_,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:_,importId:v}=t.target,b=this.getFragmentStyle(v),I=b.getFeaturesetLayers(_);for(const{source:C,sourceLayer:O}of I){const L=b.getFeatureState({id:t.id,source:C,sourceLayer:O});if(L&&!g)g=L;else if(!s.by(g,L))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:_}=t.target,v=this.getLayer(_);g=this.getFeatureState({id:t.id,source:v.source,sourceLayer:v.sourceLayer})}return g}const r=t.source,c=t.sourceLayer,f=this._checkSource(r);if(f){if(f.type!=="vector"||c)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(c,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(c=>c!==void 0))}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),c=s.B(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[c]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=v=>this._mergedLayers[v].is3D(!!this.terrain),c=this.order,f={},g=[];for(let v=c.length-1;v>=0;v--){const b=c[v];if(r(b)){f[b]=v;for(const I of t){const C=I[b];if(C)for(const O of C)g.push(O)}}}g.sort(((v,b)=>b.intersectionZ-v.intersectionZ));const _=[];for(let v=c.length-1;v>=0;v--){const b=c[v];if(r(b))for(let I=g.length-1;I>=0;I--){const C=g[I].feature;if(C.layer&&f[C.layer.id]<v)break;_.push(C),g.pop()}else for(const I of t){const C=I[b];if(C)for(const O of C)_.push(O.feature)}}return _}queryRasterValue(t,r,c){const f=this.getOwnSource(t);return f?f.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):f.queryRasterArrayValue(r,c):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,r,c){let f;r&&!Array.isArray(r)&&r.filter&&(this._validate(qa,"queryRenderedFeatures.filter",r.filter,null,r),f=s.b6(r.filter));const g={},_=C=>{if(Du.has(C.type))return;const O=this.getOwnLayerSourceCache(C),L=g[O.id]=g[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};C.is3D(!!this.terrain)&&(L.has3DLayers=!0),L.layers[C.fqid]=L.layers[C.fqid]||{styleLayer:C,targets:[]},L.layers[C.fqid].targets.push({filter:f})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const C of r.layers){const O=this._layers[C];if(!O)return this.fire(new s.y(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_(O)}}else for(const C in this._layers)_(this._layers[C]);const v=this._queryRenderedFeatures(t,g,c),b=this._flattenAndSortRenderedFeatures(v),I=[];for(const C of b)s.dw(C.layer.id)===this.scope&&I.push(C);return I}queryRenderedFeatureset(t,r,c){let f;r&&!Array.isArray(r)&&r.filter&&(this._validate(qa,"queryRenderedFeatures.filter",r.filter,null,r),f=s.b6(r.filter));const g="mock",_=[];if(r&&r.target)_.push(Object.assign({},r,{targetId:g,filter:f}));else{const C=this.getFeaturesetDescriptors();for(const O of C)_.push({targetId:g,filter:f,target:O});for(const{style:O}of this.fragments){const L=O.getFeaturesetDescriptors();for(const D of L)_.push({targetId:g,filter:f,target:D})}}const v=this.queryRenderedTargets(t,_,c),b=[],I=new Set;for(const C of v)for(const O of C.variants[g])mr(O,C,I)||b.push(new s.dx(C,O));return b}queryRenderedTargets(t,r,c){const f={},g=(v,b,I,C)=>{const O=f[b.id]=f[b.id]||{sourceCache:b,layers:{},has3DLayers:!1};if(O.layers[v.fqid]=O.layers[v.fqid]||{styleLayer:v,targets:[]},v.is3D(!!this.terrain)&&(O.has3DLayers=!0),!C)return I.uniqueFeatureID=!1,void O.layers[v.fqid].targets.push(I);O.layers[v.fqid].targets.push(Object.assign({},I,{namespace:C.namespace,properties:C.properties,uniqueFeatureID:C.uniqueFeatureID}))};for(const v of r)if("featuresetId"in v.target){const{featuresetId:b,importId:I}=v.target,C=this.getFragmentStyle(I);if(!C||!C._featuresetSelectors)continue;const O=C._featuresetSelectors[b];if(!O){this.fire(new s.y(new Error(`The featureset '${b}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const L of O){const D=C.getOwnLayer(L.layerId);D&&!Du.has(D.type)&&g(D,C.getOwnLayerSourceCache(D),v,L)}}else if("layerId"in v.target){const{layerId:b}=v.target,I=this.getLayer(b);if(!I||Du.has(I.type))continue;g(I,this.getLayerSourceCache(I),v)}const _=this._queryRenderedFeatures(t,f,c);return this._flattenAndSortRenderedFeatures(_)}_queryRenderedFeatures(t,r,c){const f=[],g=!!this.map._showQueryGeometry,_=wr.createFromScreenPoints(t,c);for(const v in r){const b=xh(_,r[v],this._availableImages,c,g);Object.keys(b).length&&f.push(b)}if(this.placement)for(const v in r){if(!r[v].sourceCache._onlySymbols)continue;const b=wh(_.screenGeometry,r[v],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(b).length&&f.push(b)}return f}querySourceFeatures(t,r){const c=r&&r.filter;c&&this._validate(qa,"querySourceFeatures.filter",c,null,r);let f=[];const g=this.getOwnSourceCaches(t);for(const _ of g)f=f.concat(bu(_,r));return f}addSourceType(t,r,c){return is.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(is.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,c={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const v in t)if(!s.by(t[v],f[v])){g=!0;break}if(!g)return;const _=this._getTransitionParameters();this.light.setLight(t,r,c),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const f=!("source"in t)||t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if("source"in c&&typeof c.source=="object"){const v="terrain-dem-src";this.addSource(v,c.source),c=s.dp(c),c=Object.assign(c,{source:v})}const g=Object.assign({},c),_={};if(this.terrain&&f){g.source=this.terrain.get().source;const v=this.terrain?this.getFragmentStyle(this.terrain.scope):null;v&&(_.style=v.serialize())}if(this._validate(yl,"terrain",g,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&r!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,r),this.fire(new s.z("data",{dataType:"style"}))}else{const g=this.terrain,_=g.get();for(const v of Object.keys(s.a6.terrain))!c.hasOwnProperty(v)&&s.a6.terrain[v].default&&(c[v]=s.a6.terrain[v].default);for(const v in t)if(!s.by(t[v],_[v])){g.set(t,this.options),this.stylesheet.terrain=t;const b=this._getTransitionParameters({duration:0});g.updateTransitions(b),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new Fn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createSnow(t){const r=this.snow=new Kr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createRain(t){const r=this.rain=new Zi(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(r);this._loadColorTheme(c).then((()=>{this.fire(new s.z("colorthemeset")),t()})).catch((f=>{s.w(`Couldn't set color theme: ${f}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=r,c._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):r.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const c=this.terrain=new ze(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,c,f,g={}){if(g&&g.validate===!1)return!1;const _=Object.assign({},this.serialize());return ga(this,t.call(Wr,Object.assign({key:r,style:_,value:c,styleSpec:s.a6},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const c of r)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const r=this._mergedLayers[t];r._clear&&r._clear()}}reloadSource(t){const r=this.getSourceCaches(t);for(const c of r)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let r;this.directionalLight&&(r=Ls(this.directionalLight));const c=new Set,f=new Set;for(const g in this._mergedLayers){const _=this._mergedLayers[g];_.type==="building"&&c.add(_.source),_.hasElevation()&&!f.has(_.source)&&f.add(_.source)}for(const g in this._mergedSourceCaches){const _=this._mergedSourceCaches[g],v=f.has(_._source.id);c.has(_._source.id)&&(_._source.reparseOverscaled=!1),_.update(t,void 0,void 0,r,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,c,f,g,_,v=!1){let b=!1,I=!1;const C={},O={};for(const j of this._mergedOrder){const Z=this._mergedLayers[j];if(Z.type!=="symbol")continue;const q=s.B(Z.source,Z.scope);let ee=C[q];if(!ee){const te=this.getLayerSourceCache(Z);if(!te)continue;const ye=te.getRenderableIds(!0).map((pe=>te.getTileByID(pe)));O[q]=ye.slice(),ee=C[q]=ye.sort(((pe,ge)=>ge.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ge.tileID)?-1:1)))}const ie=this.crossTileSymbolIndex.addLayer(Z,ee,r.center.lng,r.projection);b=b||ie}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new s.z("neworder"));const L=!!(this.placement&&!r.equals(this.placement.transform)),D=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!_||this.placement.lastReplacementSourceUpdateTime!==_.updateTime)),V=(L||D||b||this.placement&&this.placement.isStale())&&f===0;if((v||!this.pauseablePlacement||V||f!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),r.zoom))&&(this.pauseablePlacement=new Zr(r,this._mergedOrder,v||f===0,c,f,g,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,O,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),b&&this.pauseablePlacement.placement.setStale()),I||b){this._buildingIndex.onNewFrame(r.zoom);for(let j=0;j<this._mergedOrder.length;j++){const Z=this._mergedLayers[this._mergedOrder[j]];if(Z.type!=="symbol"||Z.visibility==="none")continue;const q=this.isLayerClipped(Z);this.placement.updateLayerOpacities(Z,C[s.B(Z.source,Z.scope)],j,q?_:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex((({id:g})=>g===t.id))!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return c.push(t),this._loadImports([t],!0);const f=c.findIndex((({id:g})=>g===r));return f===-1&&this.fire(new s.y(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,f).concat(t).concat(c.slice(f)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==c[f].url&&this.setImportUrl(t,r.url),s.by(r.config,c[f].config)||this.setImportConfig(t,r.config,r.data.schema),s.by(r.data,c[f].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let c=this.stylesheet.imports||[];const f=this.getImportIndex(t);if(f===-1)return this;const g=this.getImportIndex(r);if(g===-1)return this;const _=c[f],v=this.fragments[f];return c=c.filter((({id:b})=>b!==t)),this.fragments=this.fragments.filter((({id:b})=>b!==t)),this.stylesheet.imports=c.slice(0,g).concat(_).concat(c.slice(g)),this.fragments=this.fragments.slice(0,g).concat(v).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;c[f].url=r;const g=this.fragments[f];return g.style=this._createFragmentStyle(c[f]),g.style.on("style.import.load",(()=>this.mergeAll())),g.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];return c===-1?this:r?(this.fragments[c].style.setState(r),this._reloadImports(),this):(delete f[c].data,this.setImportUrl(t,f[c].url))}setImportConfig(t,r,c){this._checkLoaded();const f=this.getImportIndex(t),g=this.stylesheet.imports||[];if(f===-1)return this;r?g[f].config=r:delete g[f].config;const _=this.fragments[f];c&&_.style.stylesheet&&(_.style.stylesheet.schema=c);const v=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=r,_.style.updateConfig(r,v),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(r.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex((c=>c.id===t));return r===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[r];c&&t.push(c.getSource())}return t}getSource(t,r){const c=this.getSourceCache(t,r);return c&&c.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const c=s.B(t,r);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const r=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const c=t[r];c==="reload"?this.reloadSource(r):c==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const c of r){const f=this.getLayer(c);f&&f.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,r,c){this.imageManager.getImages(r.images,r.scope,c),this._updateTilesForChangedImages();const f=_=>{if(_){const v=r.images.map((b=>s.I.toString(b)));_.setDependencies(r.tileID.key,r.type,v)}},g=s.B(r.source,r.scope);f(this._mergedOtherSourceCaches[g]),f(this._mergedSymbolSourceCaches[g]),r.images.some((_=>_.iconsetId))&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,r,c){this.imageManager.rasterizeImages(r,c)}getGlyphs(t,r,c){this.glyphManager.getGlyphs(r.stacks,c)}getResource(t,r,c){return s.dz(r,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):r.every((c=>c.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),f=t.type==="building";if(t.is3D(!!this.terrain)){if(c||f||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}is.getSourceType=function(l){return Zs[l]},is.setSourceType=function(l,t){Zs[l]=t},is.registerForPluginStateChange=s.dA;class Ud extends s.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[r,c]of Object.entries(t.buildings))if(this._buildings[r])for(const f of c.floorIds)this._buildings[r].floors[f]||(this._buildings[r].floors[f]=c.floors[f]);else this._buildings[r]=c;for(const r of t.activeFloors)this._activeFloors.add(r);this._updateIndoorSelector()}getIndoorTileOptions(t,r){const c=this._style.getIndoorSourceLayers(t,r);return c&&this._indoorState?{sourceLayers:c,indoorState:this._indoorState}:null}_updateUI(t,r,c){const f=(function(g,_,v,b){let I=null,C=Number.MAX_SAFE_INTEGER;if(b<16)return null;for(const[O,L]of Object.entries(g)){const D=L.center;if(D){const V=_.distanceTo(s.aT.convert(D));V<C&&v.contains(D)&&(C=V,I=O)}}return I})(this._buildings,r,c,t);f!==this._closestBuildingId&&(this._closestBuildingId=f,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,r=this._closestBuildingId,c=r&&t?t[r]:void 0;if(!c)return void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let f=null;for(const _ of c.floorIds)if(this._activeFloors&&this._activeFloors.has(_)){f=_;break}const g=Array.from(c.floorIds).map((_=>({id:_,name:c.floors[_].name,zIndex:c.floors[_].zIndex}))).sort(((_,v)=>v.zIndex-_.zIndex));this.fire(new s.z("selector-update",{selectedFloorId:f,activeFloorsVisible:this._activeFloorsVisible,floors:g}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Uc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Kl=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Gd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ph="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Rh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,$d=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Qa=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ou=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,kh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const zh=/#include\s+"([^"]+)"/g,Sl=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Gc=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,$c=new Set(["ifdef","ifndef","elif","if","defined"]),_c=new Set;Ba(Uc,_c),Ba(Gd,_c),Ba(Kl,_c);const Jl={"_prelude_fog.vertex.glsl":Rh,"_prelude_terrain.vertex.glsl":Qs,"_prelude_shadow.vertex.glsl":Ou,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Pt,"_prelude_shadow.fragment.glsl":kh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":$d,"_prelude_raster_particle.glsl":Qa},Or={};ui("",Qs),ui(Pt,Rh),ui(kh,Ou),ui($d,""),ui(Qa,"");const Hd=ui(Kl,Gd),Hc=Uc,Lh=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Hc,Hd.fragmentSource].join(`
`),Bf=["precision highp float;",Hc,Hd.vertexSource].join(`
`);var Dh={background:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:ui(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ui("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ui(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ui("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ui("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:ui(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ui(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ui(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ui(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ui(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ui("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ui("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ui(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ui(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ui("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ui(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ph),skyboxGradient:ui(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ph),skyboxCapture:ui(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ui(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ui(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ui("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ui("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ui("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ui("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ba(l,t){const r=l.split(`
`);for(let c of r){if(c=c.trimStart(),c[0]!=="#"||!c.includes("if")||c.startsWith("#endif"))continue;const f=c.match(Gc);if(f)for(const g of f)$c.has(g)||t.add(g)}}function ui(l,t){const r=new Set,c=[],f=[];l=l.replace(zh,((_,v)=>(f.push(v),""))),t=t.replace(zh,((_,v)=>(c.push(v),"")));let g=new Set(_c);Ba(l,g),Ba(t,g);for(const _ of[...c,...f])Or[_]||(Or[_]=new Set,Ba(Jl[_],Or[_])),g=new Set([...g,...Or[_]]);return{fragmentSource:l=l.replace(Sl,((_,v,b,I,C)=>(r.add(C),v==="define"?`
#ifndef HAS_UNIFORM_u_${C}
in ${b} ${I} ${C};
#else
uniform ${b} ${I} u_${C};
#endif
`:v==="initialize"?`
#ifdef HAS_UNIFORM_u_${C}
    ${b} ${I} ${C} = u_${C};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    in ${b} ${I} ${C};
#endif
`:v==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(Sl,((_,v,b,I,C)=>{const O=`MATERIAL_ATTRIBUTE_OFFSET_${C}`,L=I==="float"?"vec2":I,D=`GET_ATTRIBUTE_${L}(a_${C}, materialInfo, ${O})`,V=C.match(/color/)?"color":L;return v==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${C}
in ${b} ${I} a_${C};
#endif
`:r.has(C)?v==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
    #if !defined(${O})
        in ${b} ${L} a_${C};
    #endif
out ${b} ${I} ${C};
#else
uniform ${b} ${I} u_${C};
#endif
`:v==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    ${C} = a_${C};
#else
    ${b} ${I} ${C} = u_${C};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${C})
    #ifdef ${O}
        ${C} = unpack_mix_${V}(${D}, u_${C}_t);
    #else
        ${C} = unpack_mix_${V}(a_${C}, u_${C}_t);
    #endif
#else
    ${b} ${I} ${C} = u_${C};
#endif
`:v==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    in ${b} ${I} a_${C};
    out ${b} ${I} ${C};
#endif
`:v==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    ${C} = a_${C};
#endif
`:void 0:v==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
    #if !defined(${O})
        in ${b} ${L} a_${C};
    #endif
#else
uniform ${b} ${I} u_${C};
#endif
`:v==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${C}0;
in vec4 a_${C}1;
in vec4 a_${C}2;
in vec4 a_${C}3;
#else
uniform ${b} ${I} u_${C};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${b} ${L} a_${C};
#else
uniform ${b} ${I} u_${C};
#endif
`:v==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    ${b} ${I} ${C} = a_${C};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    #ifdef ${O}
        ${b} ${I} ${C} = ${D};
    #else
        ${b} ${I} ${C} = a_${C};
    #endif
#else
    ${b} ${I} ${C} = u_${C};
#endif
`:`
#ifndef HAS_UNIFORM_u_${C}
    #ifdef ${O}
        ${b} ${I} ${C} = unpack_mix_${V}(${D}, u_${C}_t);
    #else
        ${b} ${I} ${C} = unpack_mix_${V}(a_${C}, u_${C}_t);
    #endif
#else
    ${b} ${I} ${C} = u_${C};
#endif
`})),usedDefines:g,vertexIncludes:c,fragmentIncludes:f}}class Fu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,c,f,g,_,v,b){this.context=t;let I=this.boundPaintVertexBuffers.length!==f.length;for(let O=0;!I&&O<f.length;O++)this.boundPaintVertexBuffers[O]!==f[O]&&(I=!0);let C=this.boundDynamicVertexBuffers.length!==v.length;for(let O=0;!C&&O<v.length;O++)this.boundDynamicVertexBuffers[O]!==v[O]&&(C=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||I||C||this.boundIndexBuffer!==g||this.boundVertexOffset!==_)this.freshBind(r,c,f,g,_,v,b);else{t.bindVertexArrayOES.set(this.vao);for(const O of v)O&&(O.bind(),b&&O.instanceCount&&O.setVertexAttribDivisor(t.gl,r,b));g&&g.dynamicDraw&&g.bind()}}freshBind(t,r,c,f,g,_,v){const b=this.context,I=b.gl;this.vao&&this.destroy(),this.vao=b.gl.createVertexArray(),b.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=_,r.enableAttributes(I,t),r.bind(),r.setVertexAttribPointers(I,t,g);for(const C of c)C.enableAttributes(I,t),C.bind(),C.setVertexAttribPointers(I,t,g);for(const C of _)C&&(C.enableAttributes(I,t),C.bind(),C.setVertexAttribPointers(I,t,g),v&&C.instanceCount&&C.setVertexAttribDivisor(I,t,v));f&&f.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ap(l,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.ae(0,c/r).toLngLat().lat,new s.ae(0,(c+1)/r).toLngLat().lat]}function xm(l,t,r,c,f,g,_){const v=l.context,b=v.gl,I=r.hillshadeFBO;if(!I)return;l.prepareDrawTile();const C=l.isTileAffectedByFog(t),O=[];l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&O.push("USE_MRT1");const L=l.getOrCreateProgram("hillshade",{overrideFog:C,defines:O});v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,I.colorAttachment0.get());const D=((q,ee,ie,te)=>{const ye=ie.paint.get("hillshade-shadow-color"),pe=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ge=ie.paint.get("hillshade-highlight-color"),ue=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",le=ie.paint.get("hillshade-accent-color"),xe=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=ie.paint.get("hillshade-emissive-strength");let Ae=s.an(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")Ae-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const He=q.style.directionalLight.properties.get("direction"),it=s.d4(He.x,He.y,He.z);Ae=s.an(it[1])}const $e=!q.options.moving;return{u_matrix:te||q.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),$e),u_image:0,u_latrange:Ap(0,ee.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Ae],u_shadow:ye.toPremultipliedRenderColor(pe?null:ie.lut),u_highlight:ge.toPremultipliedRenderColor(ue?null:ie.lut),u_emissive_strength:Re,u_accent:le.toPremultipliedRenderColor(xe?null:ie.lut)}})(l,r,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(v,L,t.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:j,tileBoundsSegments:Z}=l.getTileBoundsBuffers(r);L.draw(l,b.TRIANGLES,f,g,_,In.disabled,D,c.id,V,j,Z)}function Nf(l,t,r){if(!t.needsDEMTextureUpload)return;const c=l.context,f=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(r.stride);const g=r.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new s.T(c,g,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Cp(l,t,r){const c=l.context,f=c.gl;if(!t.dem)return;const g=t.dem;if(c.activeTexture.set(f.TEXTURE1),Nf(l,t,g),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const _=g.dim;c.activeTexture.set(f.TEXTURE0);let v=t.hillshadeFBO;if(!v){const L=new s.T(c,{width:_,height:_,data:null},f.RGBA8);L.bind(f.LINEAR,f.CLAMP_TO_EDGE),v=t.hillshadeFBO=c.createFramebuffer(_,_,1,"renderbuffer"),v.colorAttachment0.set(L.texture)}c.bindFramebuffer.set(v.framebuffer),c.viewport.set([0,0,_,_]);const{tileBoundsBuffer:b,tileBoundsIndexBuffer:I,tileBoundsSegments:C}=l.getMercatorTileBoundsBuffers(),O=[];l.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&O.push("USE_MRT1"),l.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(l,f.TRIANGLES,an.disabled,Pn.disabled,On.unblended,In.disabled,((L,D)=>{const V=D.stride,j=s.bC();return s.ce(j,0,s.al,-s.al,0,0,1),s.br(j,j,[0,-s.al,0]),{u_matrix:j,u_image:1,u_dimension:[V,V],u_zoom:L.overscaledZ}})(t.tileID,g),r.id,b,I,C),t.needsHillshadePrepare=!1}class or{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wd extends or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qd extends or{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Oh extends or{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bu extends or{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Fh extends or{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Wc extends or{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class qc extends or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Bh extends or{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Nu extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zd extends or{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class El extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class jf extends or{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class el extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class _a extends or{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yc extends or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class tl extends or{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ju extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Nh extends or{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Mp extends or{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let vc=class extends or{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Vu extends or{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class nl extends or{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class jh extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Vf extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Uu extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class xc extends or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Vr extends or{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Fr extends or{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Il extends or{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Yo extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ds extends or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Al extends or{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ql extends Al{constructor(t,r,c=0){super(t,r),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+c}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachmentPoint,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Bo extends Al{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wc extends Al{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Uf extends Bo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ea=(l,t,r,c)=>({u_matrix:l,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:r,u_emissive_texture_available:c}),Zc=(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:r,u_zoom_transition:f,u_merc_center:g,u_image0:0,u_image1:1,u_frustum_tl:_,u_frustum_tr:v,u_frustum_br:b,u_frustum_bl:I,u_globe_pos:C,u_globe_radius:O,u_viewport:L,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:D,u_far_z_cutoff:V,u_emissive_texture_available:j});function Gu(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const rs=new class{constructor(){this.operations={}}newMorphing(l,t,r,c,f){if(l in this.operations){const g=this.operations[l];g.to.tileID.key!==r.tileID.key&&(g.queued=r)}else this.operations[l]={startTime:c,phase:0,duration:f,from:t,to:r,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const r=this.operations[t];for(r.phase=(l-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Xc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function $u(l,t,r){if(t===0)return 0;const c=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function Xd(l,t){const r=1<<l.z;return!t&&(l.x===0||l.x===r-1)||l.y===0||l.y===r-1}function Hu(l,t){if(!l.style||!l.style.enable3dLights())return;const r=l.context,c=r.gl;r.activeTexture.set(c.TEXTURE1),t?t.bind(c.LINEAR,c.CLAMP_TO_EDGE):l.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}const Na=l=>({u_matrix:l});function Cl(l,t,r,c,f){if(f>0){const g=s.o.now(),_=(g-l.timeAdded)/f,v=t?(g-t.timeAdded)/f:-1,b=r.getSource(),I=c.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),C=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(l.tileID.overscaledZ-I),O=C&&l.refreshedUponExpiration?1:s.aA(C?_:1-v,0,1);return t?{opacity:1,mix:1-O,isFading:_<1}:{opacity:O,mix:0,isFading:_<1}}return{opacity:1,mix:0,isFading:!1}}class ec extends Ks{constructor(t){const r=xo("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class Wu extends Ks{constructor(t){const r=xo("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,c){if(t.freezeTileCoverage)return;this.transform=t;const f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((g,_)=>{if(g[_.key]="",!this._tiles[_.key]){const v=new Ys(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);v.state="loaded",this._tiles[_.key]=v}return g}),{});for(const g in this._tiles)g in f||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const c=Object.values(r);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qu extends s.aQ{constructor(t,r,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=c}}class ta extends s.bV{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,f,g]=(function(b){const I=new s.bd,C=new s.b0,O=131;I.reserve(17161),C.reserve(33800);const L=s.al/128,D=s.al+L/2,V=D+L;for(let Z=-L;Z<V;Z+=L)for(let q=-L;q<V;q+=L){const ee=q<0||q>D||Z<0||Z>D?24575:0,ie=s.aA(Math.round(q),0,s.al),te=s.aA(Math.round(Z),0,s.al);I.emplaceBack(ie+ee,te)}const j=(Z,q)=>{const ee=q*O+Z;C.emplaceBack(ee+1,ee,ee+O),C.emplaceBack(ee+O,ee+O+1,ee+1)};for(let Z=1;Z<129;Z++)for(let q=1;q<129;q++)j(q,Z);return[0,129].forEach((Z=>{for(let q=0;q<130;q++)j(q,Z),j(Z,q)})),[I,C,32768]})(),_=t.context;this.gridBuffer=_.createVertexBuffer(c,s.bf.members),this.gridIndexBuffer=_.createIndexBuffer(f),this.gridSegments=s.bg.simpleSegment(0,0,c.length,f.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,c.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Wu(r.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const v=_.gl;this._overlapStencilMode=new Pn({func:v.GEQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ec(r.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,r,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const f=t.terrain.properties,g=t.terrain.drapeRenderMode===0,_=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const v=t.terrain&&t.terrain.scope,b=f.get("source"),I=g?this._mockSourceCache:t.getSourceCache(b,v);if(!I)return void s.w(`Couldn't find terrain source "${b}".`);if(this.sourceCache=I,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=_?this.calculateExaggeration(r):f.get("exaggeration"),!r.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const C=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(r,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),r.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const f=r!=null?c-r:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const g=t.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(g);let v=g-this._previousZoom;const b=this._previousUpdateTimestamp;let I=g;this._evaluationZoom!=null&&(I=this._evaluationZoom,Math.abs(g-I)>.5&&(v=.5*(g-I+v)),v*f<0&&(I+=v)),this._evaluationZoom=I;const C=_.getExaggeration(I),O=C===_.getExaggeration(Math.max(0,I-.1));if(O&&Math.abs(C-this._exaggeration)<.01)return C;let L=Math.min(.1,.00375*(this._updateTimestamp-b));return(O||C<.1||Math.abs(v)<1e-4)&&(L=Math.min(.2,4*L)),s.ak(this._exaggeration,C,L)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=r.getIds().map((b=>{const I=r.getTileByID(b).tileID;return I.projMatrix=c.calculateProjMatrix(I.toUnwrapped()),I}));(function(b,I){const C=I.transform.pointCoordinate(I.transform.getCameraPoint()),O=new s.P(C.x,C.y);b.sort(((L,D)=>{if(D.overscaledZ-L.overscaledZ)return D.overscaledZ-L.overscaledZ;const V=new s.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),j=new s.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),Z=O.mult(1<<L.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(V)-Z.distSqr(j)}))})(f,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},f.forEach((b=>{this.proxyToSource[b.key]={}})),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const b in _){const I=_[b];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,t[b],g),I.usedForTerrain))continue;const C=t[b];I.getSource().reparseOverscaled&&this._assignTerrainTiles(C)}this.proxiedCoords[r.id]=f.map((b=>new qu(b,b.key,this.orthoMatrix))),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const v={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const I=this.terrainTileForTile[b.key];if(!I)continue;const C=I.tileID.key;C in v||(this._visibleDemTiles.push(I),v[C]=C)}}_assignTerrainTiles(t){this._initializing||t.forEach((r=>{if(this.terrainTileForTile[r.key])return;const c=this._findTileCoveringTileID(r,this.sourceCache);c&&(this.terrainTileForTile[r.key]=c)}))}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const c in this.terrainTileForTile){const f=this.terrainTileForTile[c],g=f.dem;!g||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Nf(this.painter,f,g))}}_prepareDemTileUniforms(t,r,c,f){if(!r||r.demTexture==null)return!1;const g=t.tileID.canonical,_=Math.pow(2,r.tileID.canonical.z-g.z),v=f||"";return c[`u_dem_tl${v}`]=[g.x*_%1,g.y*_%1],c[`u_dem_scale${v}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce(((c,f)=>{if(!f.dem)return c;const g=f.dem.tree.minimums[0];return g>0&&t++,c+g}),0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const c=this._getLoadedAreaMinimum(),f=new s.dL({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(f,{premultiply:!1}):g=this._emptyDEMTexture=new s.T(t,f,r.R32F,{premultiply:!1}),g}setupElevationDraw(t,r,c){const f=this.painter.context,g=f.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};_.u_exaggeration=this.exaggeration();let v=null,b=null,I=1;if(c&&c.morphing&&this._useVertexMorphing){const D=c.morphing.srcDemTile,V=c.morphing.dstDemTile;I=c.morphing.phase,D&&V&&(this._prepareDemTileUniforms(t,D,_,"_prev")&&(b=D),this._prepareDemTileUniforms(t,V,_)&&(v=V))}const C=D=>D&&D.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let O=null;var L;if(this.enabled?b&&v?(O=v.demTexture,f.activeTexture.set(g.TEXTURE4),b.demTexture.bind(C(b),g.CLAMP_TO_EDGE),_.u_dem_lerp=I):(v=this.terrainTileForTile[t.tileID.key],O=this._prepareDemTileUniforms(t,v,_)?v.demTexture:this.emptyDEMTexture):O=this.emptyDEMTexture,f.activeTexture.set(g.TEXTURE2),O&&(_.u_dem_size=(L=O).size[0]===1?1:L.size[0]-2,O.bind(C(v),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,r,_),c&&c.useMeterToDem&&v){const D=(1<<v.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=D}if(c&&c.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),r.setTerrainUniformValues(f,_),this.painter.transform.projection.name==="globe"){const D=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);r.setGlobeUniformValues(f,D)}}globeUniformValues(t,r,c){const f=t.projection;return{u_tile_tl_up:f.upVector(r,0,0),u_tile_tr_up:f.upVector(r,s.al,0),u_tile_br_up:f.upVector(r,s.al,s.al),u_tile_bl_up:f.upVector(r,0,s.al),u_tile_up_scale:c?s.dM(1):f.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(f,g,_,v,b){if(f.transform.projection.name==="globe")(function(I,C,O,L,D){const V=I.context,j=V.gl;let Z,q;const ee=I.transform,ie=s.dE(I,V,ee),te=($e,He)=>{if(q===He)return;const it=[Xc[He],"PROJECTION_GLOBE_VIEW"];ie&&it.push("CUSTOM_ANTIALIASING");const xt=I.isTileAffectedByFog($e);Z=I.getOrCreateProgram("globeRaster",{defines:it,overrideFog:xt}),q=He},ye=I.colorModeForRenderPass(),pe=new an(j.LEQUAL,an.ReadWrite,I.depthRangeFor3D);rs.update(D);const ge=s.dF(ee),ue=[s.aF(ee.center.lng),s.aJ(ee.center.lat)],le=I.globeSharedBuffers,xe=[ee.width*s.o.devicePixelRatio,ee.height*s.o.devicePixelRatio],Re=Float32Array.from(ee.globeMatrix),Ae={useDenormalizedUpVectorScale:!0};{const $e=I.transform,He=$u($e.zoom,C.exaggeration(),C.sourceCache._source.tileSize);q=-1;const it=j.TRIANGLES;for(const xt of L){const Ne=O.getTile(xt),Ee=Pn.disabled,We=C.prevTerrainTileForTile[xt.key],Ue=C.terrainTileForTile[xt.key];Gu(We,Ue)&&rs.newMorphing(xt.key,We,Ue,D,250),Hu(I,Ne.emissiveTexture),V.activeTexture.set(j.TEXTURE0),Ne.texture&&Ne.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const dt=rs.getMorphValuesForProxy(xt.key),Rt=dt?1:0;dt&&Object.assign(Ae,{morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:s.dD(dt.phase)}});const Lt=s.dG(xt.canonical),At=s.dH(Lt.getCenter().lat),wt=s.dI(xt.canonical,Lt,At,$e.worldSize/$e._pixelsPerMercatorPixel),tn=s.bk(s.dJ(xt.canonical)),Yt=I.emissiveMode==="mrt-fallback"?1:0,Bt=Zc($e.expandedFarZProjMatrix,Re,ge,tn,s.aj($e.zoom),ue,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,xe,He,$e._farZ,Yt,wt);if(te(xt,Rt),Z&&(C.setupElevationDraw(Ne,Z,Ae),I.uploadCommonUniforms(V,Z,xt.toUnwrapped()),le)){const[Ht,_n,An]=le.getGridBuffers(At,He!==0);Z.draw(I,it,pe,Ee,ye,In.backCCW,Bt,"globe_raster",Ht,_n,An)}}}if(le&&(I.renderDefaultNorthPole||I.renderDefaultSouthPole)){const $e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&$e.push("CUSTOM_ANTIALIASING"),Z=I.getOrCreateProgram("globeRaster",{defines:$e});for(const He of L){const{x:it,y:xt,z:Ne}=He.canonical,Ee=xt===0,We=xt===(1<<Ne)-1,[Ue,dt,Rt,Lt]=le.getPoleBuffers(Ne,!1);if(Lt&&(Ee||We)){const At=O.getTile(He);Hu(I,At.emissiveTexture),V.activeTexture.set(j.TEXTURE0),At.texture&&At.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let wt=s.dK(Ne,it,ee);const tn=s.bk(s.dJ(He.canonical)),Yt=I.emissiveMode==="mrt-fallback"?1:0,Bt=(Ht,_n)=>Ht.draw(I,j.TRIANGLES,pe,Pn.disabled,ye,In.disabled,Zc(ee.expandedFarZProjMatrix,wt,wt,tn,0,ue,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,xe,0,ee._farZ,Yt),"globe_pole_raster",_n,Rt,Lt);C.setupElevationDraw(At,Z,Ae),I.uploadCommonUniforms(V,Z,He.toUnwrapped()),Ee&&I.renderDefaultNorthPole&&Bt(Z,Ue),We&&I.renderDefaultSouthPole&&(wt=s.cS(s.bC(),wt,[1,-1,1]),Bt(Z,dt))}}}})(f,g,_,v,b);else{const I=f.context,C=I.gl;let O,L;const D=f.shadowRenderer,V=Zl(f,f.longestCutoffRange),j=ye=>{if(L===ye)return;const pe=[];pe.push(Xc[ye]),V.shouldRenderCutoff&&pe.push("RENDER_CUTOFF"),D&&(pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),D.useNormalOffset&&pe.push("NORMAL_OFFSET")),O=f.getOrCreateProgram("terrainRaster",{defines:pe}),L=ye},Z=f.colorModeForRenderPass(),q=new an(C.LEQUAL,an.ReadWrite,f.depthRangeFor3D);rs.update(b);const ee=f.transform,ie=$u(ee.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let te=[0,0,0];if(D){const ye=f.style.directionalLight,pe=f.style.ambientLight;ye&&pe&&(te=ma(f.style,ye,pe))}{L=-1;const ye=C.TRIANGLES,[pe,ge]=[g.gridIndexBuffer,g.gridSegments];for(const ue of v){const le=_.getTile(ue),xe=Pn.disabled,Re=g.prevTerrainTileForTile[ue.key],Ae=g.terrainTileForTile[ue.key];Gu(Re,Ae)&&rs.newMorphing(ue.key,Re,Ae,b,250),Hu(f,le.emissiveTexture),I.activeTexture.set(C.TEXTURE0),le.texture&&le.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const $e=rs.getMorphValuesForProxy(ue.key),He=$e?1:0;let it;$e&&(it={morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:s.dD($e.phase)}});const xt=f.emissiveMode==="mrt-fallback"?1:0,Ne=ea(ue.projMatrix,Xd(ue.canonical,ee.renderWorldCopies)?ie/10:ie,te,xt);if(j(He),!O)continue;g.setupElevationDraw(le,O,it);const Ee=ue.toUnwrapped();D&&D.setupShadows(Ee,O),f.uploadCommonUniforms(I,O,Ee,null,V),O.draw(f,ye,q,xe,Z,In.backCCW,Ne,"terrain_raster",g.gridBuffer,pe,ge)}}}})(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,c=this.painter.context,f=this.proxySourceCache,g=this.proxiedCoords[f.id],_=this._drapedRenderBatches.shift(),v=r.style.order,b=[];this._updateFBOs(r.emissiveMode==="mrt-fallback");let I=0;for(const C of g){const O=f.getTileByID(C.proxyTileKey),L=f.proxyCachedFBO[C.key]?f.proxyCachedFBO[C.key][t]:void 0,D=L!==void 0?f.renderCache[L]:this.pool[I++],V=L!==void 0;if(O.texture=D.tex,O.emissiveTexture=D.emissiveTex,V&&!D.dirty){b.push(O.tileID);continue}c.bindFramebuffer.set(D.fb.framebuffer);const j=c.gl;let Z;j.drawBuffers(r.emissiveMode==="mrt-fallback"?[j.COLOR_ATTACHMENT0,j.COLOR_ATTACHMENT1]:[j.COLOR_ATTACHMENT0]),this.renderedToTile=!1,D.dirty&&(c.clear({color:s.ao.transparent,stencil:0}),D.dirty=!1);for(let q=_.start;q<=_.end;++q){const ee=r.style._mergedLayers[v[q]];if(ee.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(ee),te=ie?this.proxyToSource[C.key][ie.id]:[C];if(!te)continue;const ye=te;c.viewport.set([0,0,D.fb.width,D.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(D,te,ee,ie),Z=ie?ie.id:null),r.renderLayer(r,ie,ee,ye)}if(j.drawBuffers([j.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const ee=r.style._mergedLayers[v[q]];if(ee.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(ee),te=ie?this.proxyToSource[C.key][ie.id]:[C];if(!te)continue;const ye=te;c.viewport.set([0,0,D.fb.width,D.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(D,te,ee,ie),Z=ie?ie.id:null),r.renderLayer(r,ie,ee,ye)}this.renderedToTile?(D.dirty=!0,b.push(O.tileID)):V||--I,I===5&&(I=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),_.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let c=-1,f=r;for(let g=0;g<r;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?c=Math.max(c,g):f=Math.min(f,g);return f>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((r=>r.dem)).forEach((r=>{t=Math.min(t,r.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,r,c){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter((g=>g.dem)).map((g=>{const _=g.tileID,v=1<<_.overscaledZ,{x:b,y:I}=_.canonical,C=b/v,O=(b+1)/v,L=I/v,D=(I+1)/v;return{minx:C,miny:L,maxx:O,maxy:D,t:g.dem.tree.raycastRoot(C,L,O,D,t,r,c),tile:g}}));f.sort(((g,_)=>(g.t!==null?g.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE)));for(const g of f){if(g.t==null)return null;const _=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,r,c);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,r=t.gl,c=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const f=new s.T(t,{width:c[0],height:c[1],data:null},r.RGBA8);f.bind(r.LINEAR,r.CLAMP_TO_EDGE);const g=t.createFramebuffer(c[0],c[1],1,null);let _;return g.colorAttachment0.set(f.texture),this._emissiveTexture&&(_=new s.T(t,{width:c[0],height:c[1],data:null},r.R8),_.bind(r.LINEAR,r.CLAMP_TO_EDGE),g.createColorAttachment(t,1),g.colorAttachment1.set(_.texture)),g.depthAttachment=new Uf(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:f,emissiveTex:_,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const r of this.pool)this._updateFBO(r,t);for(const r of this.proxySourceCache.renderCache)this._updateFBO(r,t);this._emissiveTexture=t}}_updateFBO(t,r){const c=t.fb,f=this.painter.context,g=f.gl,_=this.drapeBufferSize;if(r){const v=new s.T(f,{width:_[0],height:_[1],data:null},g.R8);v.bind(g.LINEAR,g.CLAMP_TO_EDGE),t.emissiveTex=v,c.createColorAttachment(f,1),c.colorAttachment1.set(v.texture)}else t.emissiveTex=void 0,c.removeColorAttachment(f,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const r=this._style._mergedLayers[t],c=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!c&&r.shouldRedrape():!c&&r.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof Dc){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],g=this._style.getLayerSourceCache(f);if(!g||r[g.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="line")continue;const _=f.widthExpression(),v=f.emissiveStrengthExpression();if(_ instanceof s.ad||v instanceof s.ad){r[g.id]=!0;for(const b of this.proxyCoords){const I=this.proxyToSource[b.key][g.id];if(I)for(const C of I)this._clearRenderCacheForTile(g.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof ho){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],g=this._style.getLayerSourceCache(f);if(!g||r[g.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const _=f.paint.get("raster-fade-duration");for(const v of this.proxyCoords){const b=this.proxyToSource[v.key][g.id];if(b)for(const I of b){const C=Cl(g.getTile(I),g.findLoadedParent(I,0),g,this.painter.transform,_);(C.opacity!==1||C.mix!==0)&&this._clearRenderCacheForTile(g.id,I)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const c=[];this._pendingGroundEffectLayers=[];let f,g=0,_=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++g<r;)_=this._style._mergedLayers[t[g]];for(;g<r;++g){const v=this._style._mergedLayers[t[g]];v.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(v)?f===void 0&&(f=g):(v.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),f!==void 0&&(c.push({start:f,end:g-1}),f=void 0)))}if(f!==void 0&&c.push({start:f,end:g-1}),c.length!==0){const v=c[c.length-1];this._pendingGroundEffectLayers.every((b=>b>v.end))||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const _=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let v=0;v<_.length;++v){const b=Object.values(_[v]);r.renderCachePool.push(...b)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,f=this._tilesDirty;for(let _=c.length-1;_>=0;_--){const v=c[_];if(r.getTileByID(v.key),r.proxyCachedFBO[v.key]!==void 0){const b=t[v.key],I=this.proxyToSource[v.key];let C=0;for(const O in I){const L=I[O],D=b[O];if(!D||D.length!==L.length||L.some(((V,j)=>V!==D[j]||f[O]&&f[O].hasOwnProperty(V.key)))){C=-1;break}++C}for(const O in r.proxyCachedFBO[v.key])r.renderCache[r.proxyCachedFBO[v.key][O]].dirty=C<0||C!==Object.values(b).length}}const g=[...this._drapedRenderBatches];g.sort(((_,v)=>v.end-v.start-(_.end-_.start)));for(const _ of g)for(const v of c){if(r.proxyCachedFBO[v.key])continue;let b=r.renderCachePool.pop();b===void 0&&r.renderCache.length<50&&(b=r.renderCache.length,r.renderCache.push(this._createFBO())),b!==void 0&&(r.proxyCachedFBO[v.key]={},r.proxyCachedFBO[v.key][_.start]=b,r.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,c,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,_=g.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let v;if(c.isTileClipped())v=r.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);v=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+v>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=v,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Pn.disabled}_renderTileClippingMasks(t,r){const c=this.painter,f=this.painter.context,g=f.gl;c._tileClippingMaskIDs={},f.setColorMode(On.disabled),f.setDepthMode(an.disabled);const _=c.getOrCreateProgram("clippingMask");for(const v of t){const b=c._tileClippingMaskIDs[v.key]=--r;_.draw(c,g.TRIANGLES,an.disabled,new Pn({func:g.ALWAYS,mask:0},b,255,g.KEEP,g.KEEP,g.REPLACE),On.disabled,In.disabled,Na(v.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const c=[t.x,t.y,1,1];s.aC(c,c,r.pixelMatrixInverse),s.cK(c,c,1/c[3]),c[0]/=r.worldSize,c[1]/=r.worldSize;const f=r._camera.position,g=s.cf(1,r.center.lat),_=[f[0],f[1],f[2]/g,0],v=s.da([],c.slice(0,3),_);s.aw(v,v);const b=this.raycast(_,v,this._exaggeration);return b!==null&&b?(s.bH(_,_,v,b),_[3]=_[2],_[2]*=g,_):null}_setupProxiedCoordsForOrtho(t,r,c){if(t.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(t,r,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const f=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let b=0;b<g.length;b++){const I=g[b],C=this._findTileCoveringTileID(I,t);if(C){const O=this._createProxiedId(I,C,c[I.key]&&c[I.key][t.id]);f.push(O),this.proxyToSource[I.key][t.id]=[O]}}let _=!1;const v=new Set;for(let b=0;b<r.length;b++){const I=t.getTile(r[b]);if(!I||!I.hasData())continue;const C=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==I.tileID.canonical.z){const O=this.proxyToSource[C.tileID.key][t.id],L=this._createProxiedId(C.tileID,I,c[C.tileID.key]&&c[C.tileID.key][t.id]);O?O.splice(O.length-1,0,L):this.proxyToSource[C.tileID.key][t.id]=[L];const D=this.proxyToSource[C.tileID.key][t.id];v.has(D)||v.add(D),f.push(L),_=!0}}if(this._sourceTilesOverlap[t.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const b of v)b.sort(((I,C)=>C.overscaledZ-I.overscaledZ))}_setupProxiedCoordsForImageSource(t,r,c){if(!t.getSource().loaded())return;const f=this.proxiedCoords[t.id]=[],g=this.proxyCoords,_=t.getSource(),v=_.tileID;if(!v)return;const b=new s.P(v.x,v.y)._div(1<<v.z),I=_.coordinates.map(s.ae.fromLngLat).reduce(((O,L)=>(O.min.x=Math.min(O.min.x,L.x-b.x),O.min.y=Math.min(O.min.y,L.y-b.y),O.max.x=Math.max(O.max.x,L.x-b.x),O.max.y=Math.max(O.max.y,L.y-b.y),O)),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(O,L)=>{const D=O.wrap+O.canonical.x/(1<<O.canonical.z),V=O.canonical.y/(1<<O.canonical.z),j=s.al/(1<<O.canonical.z),Z=L.wrap+L.canonical.x/(1<<L.canonical.z),q=L.canonical.y/(1<<L.canonical.z);return D+j<Z+I.min.x||D>Z+I.max.x||V+j<q+I.min.y||V>q+I.max.y};for(let O=0;O<g.length;O++){const L=g[O];for(let D=0;D<r.length;D++){const V=t.getTile(r[D]);if(!V||!V.hasData()||C(L,V.tileID))continue;const j=this._createProxiedId(L,V,c[L.key]&&c[L.key][t.id]),Z=this.proxyToSource[L.key][t.id];Z?Z.push(j):this.proxyToSource[L.key][t.id]=[j],f.push(j)}}}_createProxiedId(t,r,c){let f=this.orthoMatrix;if(c){const g=c.find((_=>_.key===r.tileID.key));if(g)return g}if(r.tileID.key!==t.key){const g=t.canonical.z-r.tileID.canonical.z;let _,v,b;f=s.bC();const I=r.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(_=s.al>>g,v=_*((r.tileID.canonical.x<<g)-t.canonical.x+I),b=_*((r.tileID.canonical.y<<g)-t.canonical.y)):(_=s.al<<-g,v=s.al*(r.tileID.canonical.x-(t.canonical.x+I<<-g)),b=s.al*(r.tileID.canonical.y-(t.canonical.y<<-g))),s.ce(f,0,_,0,_,0,1),s.br(f,f,[v,b,0])}return new qu(r.tileID,t.key,f)}_findTileCoveringTileID(t,r){let c=r.getTile(t);if(c&&c.hasData())return c;const f=this._findCoveringTileCache[r.id],g=f[t.key];if(c=g?r.getTileByID(g):null,c&&c.hasData()||g===null)return c;let _=c?c.tileID:t,v=_.overscaledZ;const b=r.getSource().minzoom,I=[];if(!g){const O=r.getSource().maxzoom;if(t.canonical.z>=O){const L=t.canonical.z-O;r.getSource().reparseOverscaled?(v=Math.max(t.canonical.z+2,r.transform.tileZoom),_=new s.aQ(v,t.wrap,O,t.canonical.x>>L,t.canonical.y>>L)):L!==0&&(v=O,_=new s.aQ(v,t.wrap,O,t.canonical.x>>L,t.canonical.y>>L))}_.key!==t.key&&(I.push(_.key),c=r.getTile(_))}const C=O=>{I.forEach((L=>{f[L]=O})),I.length=0};for(v-=1;v>=b&&(!c||!c.hasData());v--){c&&C(c.tileID.key);const O=_.calculateScaledKey(v);if(c=r.getTileByID(O),c&&c.hasData())break;const L=f[O];if(L===null)break;L===void 0?I.push(O):c=r.getTileByID(L)}return C(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[r.key]=!0}}function os(l,t,r){const c=(function(v,b,I){const C=s.bJ(b,v),O=s.bJ(I,[.2126,.7152,.0722]),L=(V,j,Z)=>(1-Z)*V+Z*j,D=L(1-.3*Math.min(O,1),1,Math.min(C+1,1));return L(.92,1,Math.asin(s.aA(b[2],-1,1))/Math.PI+.5)*D})(l,[0,0,1],t),f=[0,0,0];s.c5(f,r.slice(0,3),c);const g=[0,0,0];s.c5(g,t.slice(0,3),l[2]);const _=[0,0,0];return s.d8(_,f,g),s.db(_)}const Yc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],tc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Ml{static cacheKey(t,r,c,f){const g=[r];f&&g.push(f.cacheKey);for(const _ of c)t.usedDefines.has(_)&&g.push(_);return g.join("/")}constructor(t,r,c,f,g,_){const v=t.gl;this.program=v.createProgram(),this.configuration=f,this.name=r,this.fixedDefines=[..._];const b=`#version 300 es
${(f?f.defines():[]).concat(_.map((j=>`#define ${j}`))).join(`
`)}`,I=[b,Lh];for(const j of c.fragmentIncludes)I.push(Jl[j]);I.push(c.fragmentSource);const C=I.join(`
`),O=[b,Bf];for(const j of c.vertexIncludes)O.push(Jl[j]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&O.push("uniform int u_instanceID;"),O.push(c.vertexSource);let L=O.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(L=L.replaceAll("gl_InstanceID","u_instanceID"));const D=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(D,C),v.compileShader(D),v.attachShader(this.program,D);const V=v.createShader(v.VERTEX_SHADER);v.isContextLost()?this.failedToCreate=!0:(v.shaderSource(V,L),v.compileShader(V),v.attachShader(this.program,V),this.attributes={},v.linkProgram(this.program),v.deleteShader(V),v.deleteShader(D),this.fixedUniforms=g(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=f?f.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(j=>({u_instanceID:new s.ch(j)}))(t)),(_.includes("TERRAIN")||r.includes("symbol")||r.includes("circle"))&&(this.terrainUniforms=(j=>({u_dem:new s.ch(j),u_dem_prev:new s.ch(j),u_dem_tl:new s.ck(j),u_dem_scale:new s.cj(j),u_dem_tl_prev:new s.ck(j),u_dem_scale_prev:new s.cj(j),u_dem_size:new s.cj(j),u_dem_lerp:new s.cj(j),u_exaggeration:new s.cj(j),u_depth:new s.ch(j),u_depth_size_inv:new s.ck(j),u_depth_range_unpack:new s.ck(j),u_occluder_half_size:new s.cj(j),u_occlusion_depth_offset:new s.cj(j),u_meter_to_dem:new s.cj(j),u_label_plane_matrix_inv:new s.cl(j)}))(t)),_.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new s.ci(j),u_tile_tr_up:new s.ci(j),u_tile_br_up:new s.ci(j),u_tile_bl_up:new s.ci(j),u_tile_up_scale:new s.cj(j)}))(t)),_.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new s.cl(j),u_fog_range:new s.ck(j),u_fog_color:new s.d3(j),u_fog_horizon_blend:new s.cj(j),u_fog_vertical_limit:new s.ck(j),u_fog_temporal_offset:new s.cj(j),u_frustum_tl:new s.ci(j),u_frustum_tr:new s.ci(j),u_frustum_br:new s.ci(j),u_frustum_bl:new s.ci(j),u_globe_pos:new s.ci(j),u_globe_radius:new s.cj(j),u_globe_transition:new s.cj(j),u_is_globe:new s.ch(j),u_viewport:new s.ck(j)}))(t)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(j=>({u_cutoff_params:new s.d3(j)}))(t)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(j=>({u_lighting_ambient_color:new s.ci(j),u_lighting_directional_dir:new s.ci(j),u_lighting_directional_color:new s.ci(j),u_ground_radiance:new s.ci(j)}))(t)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(j=>({u_light_matrix_0:new s.cl(j),u_light_matrix_1:new s.cl(j),u_fade_range:new s.ck(j),u_shadow_normal_offset:new s.ci(j),u_shadow_intensity:new s.cj(j),u_shadow_texel_size:new s.cj(j),u_shadow_map_resolution:new s.cj(j),u_shadow_direction:new s.ci(j),u_shadow_bias:new s.ci(j),u_shadowmap_0:new s.ch(j),u_shadowmap_1:new s.ch(j)}))(t)))}getAttributeLocation(t,r){let c=this.attributes[r];return c===void 0&&(c=this.attributes[r]=t.getAttribLocation(this.program,r)),c}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f]&&c[f].set(this.program,f,r[f])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f]&&c[f].set(this.program,f,r[f])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const f in r)c[f].set(this.program,f,r[f])}_drawDebugWireframe(t,r,c,f,g,_,v,b,I,C){const O=t.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;const L=t.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||t._terrain&&t._terrain.renderingToTexture||!Yc.includes(this.name))||!(!O.layers3D||!tc.includes(this.name))))return;const D=L.gl,V=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,L);if(!V)return;const j=[...this.fixedDefines,"DEBUG_WIREFRAME"],Z=t.getOrCreateProgram(this.name,{config:this.configuration,defines:j});L.program.set(Z.program);const q=(te,ye,pe)=>{if(ye[te]&&pe[te])for(const ge in ye[te])pe[te][ge]&&pe[te][ge].set(pe.program,ge,ye[te][ge].current)};I&&I.setUniforms(Z.program,L,Z.binderUniforms,v,{zoom:b}),q("fixedUniforms",this,Z),q("terrainUniforms",this,Z),q("globeUniforms",this,Z),q("fogUniforms",this,Z),q("lightsUniforms",this,Z),q("shadowUniforms",this,Z),V.bind(),L.setColorMode(new On([D.ONE,D.ONE_MINUS_SRC_ALPHA,D.ZERO,D.ONE],s.ao.transparent,[!0,!0,!0,!1])),L.setDepthMode(new an(r.func===D.LESS?D.LEQUAL:r.func,an.ReadOnly,r.range)),L.setStencilMode(Pn.disabled);const ee=3*_.primitiveLength*2,ie=3*_.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const te=C||1;for(let ye=0;ye<te;++ye)Z.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),D.drawElements(D.LINES,ee,D.UNSIGNED_SHORT,ie)}else C&&C>1?D.drawElementsInstanced(D.LINES,ee,D.UNSIGNED_SHORT,ie,C):D.drawElements(D.LINES,ee,D.UNSIGNED_SHORT,ie);g.bind(),L.program.set(this.program),L.setDepthMode(r),L.setStencilMode(c),L.setColorMode(f)}checkUniforms(t,r,c){if(this.fixedDefines.includes(r)){for(const f of Object.keys(c))if(!c[f].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${f} not set but required by ${r} being defined`)}}draw(t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z){const q=t.context,ee=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(c),q.setStencilMode(f),q.setColorMode(g),q.setCullFace(_);for(const[ue,le]of this.fixedUniformsEntries)le.set(this.program,ue,v[ue]);V&&V.setUniforms(this.program,q,this.binderUniforms,L,{zoom:D});const ie={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[r];this.checkUniforms(b,"RENDER_SHADOWS",this.shadowUniforms);const te=j||[],ye=V?V.getPaintVertexBuffers():[],pe=r===ee.TRIANGLES&&C,ge=Z&&Z>0?1:void 0;for(const ue of O.get()){const le=ue.vaos||(ue.vaos={});if((le[b]||(le[b]=new Fu)).bind(q,this,I,ye,C,ue.vertexOffset,te,ge),this.forceManualRenderingForInstanceIDShaders){const xe=Z||1;for(let Re=0;Re<xe;++Re)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Re),C?ee.drawElements(r,ue.primitiveLength*ie,ee.UNSIGNED_SHORT,ue.primitiveOffset*ie*2):ee.drawArrays(r,ue.vertexOffset,ue.vertexLength)}else Z&&Z>1?ee.drawElementsInstanced(r,ue.primitiveLength*ie,ee.UNSIGNED_SHORT,ue.primitiveOffset*ie*2,Z):C?ee.drawElements(r,ue.primitiveLength*ie,ee.UNSIGNED_SHORT,ue.primitiveOffset*ie*2):ee.drawArrays(r,ue.vertexOffset,ue.vertexLength);pe&&this._drawDebugWireframe(t,c,f,g,C,ue,L,D,V,Z)}}}function bc(l,t,r=0){const c=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,g=f*(t.tileID.canonical.x+t.tileID.wrap*c),_=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,l.transform.tileZoom),u_pixel_coord_upper:[g>>16,_>>16],u_pixel_coord_lower:[65535&g,65535&_],u_pattern_transition:r}}const Vh={terrain:0,flat:1},Gf=s.bC(),Zu=(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q)=>{const ee=t.style.light,ie=ee.properties.get("position"),te=[ie.x,ie.y,ie.z],ye=s.dO();ee.properties.get("anchor")==="viewport"&&(s.dP(ye,-t.transform.angle),s.dQ(te,te,ye));const pe=ee.properties.get("color").toPremultipliedRenderColor(null),ge=t.transform,ue={u_matrix:l,u_lightpos:te,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_vertical_gradient:+r,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Vh[I],u_base_type:Vh[C],u_ao:f,u_edge_radius:g,u_width_scale:_,u_flood_light_color:V,u_vertical_scale:j,u_flood_light_intensity:Z,u_ground_shadow_factor:q};return ge.projection.name==="globe"&&(ue.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],ue.u_zoom_transition=O,ue.u_inv_rot_matrix=D,ue.u_merc_center=L,ue.u_up_dir=ge.projection.upVector(new s.cD(0,0,0),L[0]*s.al,L[1]*s.al),ue.u_height_lift=b),ue},Os=(l,t,r,c,f,g)=>({u_matrix:l,u_edge_radius:t,u_width_scale:r,u_vertical_scale:c,u_height_type:Vh[f],u_base_type:Vh[g]}),na=(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q)=>{const ee=Zu(l,t,r,c,f,g,_,v,I,C,O,L,D,V,j,Z,1,[0,0,0]),ie={u_height_factor:-Math.pow(2,v.overscaledZ)/b.tileSize/8};return Object.assign(ee,bc(t,b,q),ie)},zr=(l,t,r,c,f,g,_,v,b,I,C)=>({u_matrix:t,u_opacity:r,u_ao_pass:c?1:0,u_meter_to_tile:f,u_ao:g,u_flood_light_intensity:_,u_flood_light_color:v,u_attenuation:b,u_edge_radius:I,u_fb:0,u_fb_size:C,u_dynamic_offset:1}),ya=(l,t,r)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:r}),Yd=(l,t,r,c,f,g=0)=>Object.assign(ya(l,t,f),bc(r,c,g)),$f=(l,t,r,c)=>({u_matrix:l,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:c}),Uh=(l,t,r,c,f,g,_=0)=>Object.assign(Yd(l,t,r,c,g,_),{u_world:f}),Pl=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),Tc=(l,t,r,c,f)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:c,u_reset_depth:f}),Kc=(l,t,r,c,f,g,_,v,b)=>({u_matrix:l,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:c,u_camera_pos:f,u_tile_to_meter:g,u_facade_emissive_chance:_,u_flood_light_color:v,u_flood_light_intensity:b}),Hf=l=>({u_matrix:l}),va=l=>({u_matrix:l}),Gh=(l,t,r,c,f,g,_,v)=>{const b=s.al/g.tileSize;return{u_matrix:l,u_inv_rot_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(v),u_extrude_scale:[r.pixelsToGLUnits[0]/b,r.pixelsToGLUnits[1]/b],u_zoom_transition:c,u_tile_id:_,u_merc_center:f}},$h=(l,t,r=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:r}),Xu=s.bC(),Hh=(l,t,r,c,f,g,_)=>{const v=l.transform,b=v.projection.name==="globe",I=b?s.dR(v.zoom,t.canonical)*v._pixelsPerMercatorPixel:s.ay(r,1,g),C={u_matrix:t.projMatrix,u_extrude_scale:I,u_intensity:_,u_inv_rot_matrix:Xu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){C.u_inv_rot_matrix=c,C.u_merc_center=f,C.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],C.u_zoom_transition=s.aj(v.zoom);const O=f[0]*s.al,L=f[1]*s.al;C.u_up_dir=v.projection.upVector(new s.cD(0,0,0),O,L)}return C};function Wh(l,[t,r,c,f],[g,_]){if(g===_)return[0,0,0,0];const v=255*(l-1)/(l*(_-g));return[t*v,r*v,c*v,f*v]}function qh(l,t,[r,c]){return r===c?0:.5/l+(t-r)*(l-1)/(l*(c-r))}const Jc=(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee,ie,te)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:g,u_scale_parent:I,u_fade_t:C.mix,u_opacity:C.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(O.paint.get("raster-saturation")),u_contrast_factor:s.dS(O.paint.get("raster-contrast")),u_spin_weights:Wf(O.paint.get("raster-hue-rotate")),u_perspective_transform:L,u_raster_elevation:D,u_zoom_transition:_,u_merc_center:v,u_cutoff_params:b,u_colorization_mix:Wh(s.dU,j,q),u_colorization_offset:qh(s.dU,Z,q),u_color_ramp:V,u_texture_offset:[ie/(ee+2*ie),ee/(ee+2*ie)],u_texture_res:[ee+2*ie,ee+2*ie],u_emissive_strength:te});function Wf(l){l*=Math.PI/180;const t=Math.sin(l),r=Math.cos(l);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const xa=.05,Kd=(l,t,r,c,f,g,_,v,b,I,C,O)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:g,u_scale_parent:I,u_fade_t:C.mix,u_opacity:C.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:_,u_merc_center:v,u_cutoff_params:b}),Yu=(l,t,r,c,f,g,_,v,b,I)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:c,u_color_ramp:g,u_velocity_res:f,u_max_speed:_,u_uv_offset:v,u_data_scale:[255*b[0],255*b[1]],u_data_offset:I,u_particle_pos_scale:1.1,u_particle_pos_offset:[xa,xa]}),Jd=(l,t,r,c,f,g,_,v,b,I)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:c,u_max_speed:f,u_speed_factor:g,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:v,u_data_scale:[255*b[0],255*b[1]],u_data_offset:I,u_particle_pos_scale:1.1,u_particle_pos_offset:[xa,xa]}),Qd=s.bC(),Ku=(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee,ie,te,ye,pe,ge)=>{const ue=f.transform,le={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(ee),u_rotate_symbol:+r,u_aspect_ratio:ue.width/ue.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:_,u_coord_matrix:v,u_is_text:+I,u_elevation_from_sea:b?1:0,u_pitch_with_map:+c,u_texsize:C,u_texsize_icon:O,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Qd,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:pe||0,u_gamma_scale:c?f.transform.getCameraToCenterDistance(ee)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ge||1,u_ground_shadow_factor:ie,u_inv_matrix:s.bl(s.bC(),_),u_normal_scale:te,u_lutTexture:fo.LUT};return ee.name==="globe"&&(le.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],le.u_zoom_transition=V,le.u_inv_rot_matrix=Z,le.u_merc_center=j,le.u_camera_forward=ue._camera.forward(),le.u_ecef_origin=s.dV(ue.globeMatrix,D.toUnwrapped()),le.u_tile_matrix=Float32Array.from(ue.globeMatrix),le.u_up_vector=q),le},Qc=(l,t,r,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:r,u_color:c}),wa=(l,t,r,c,f,g,_,v,b)=>Object.assign((function(I,C,O,L,D,V){const{width:j,height:Z}=L.imageManager.getPixelSize(C),q=Math.pow(2,V.tileID.overscaledZ),ee=V.tileSize*Math.pow(2,L.transform.tileZoom)/q,ie=ee*(V.tileID.canonical.x+V.tileID.wrap*q),te=ee*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[j,Z],u_pattern_size:O.displaySize,u_pattern_units_to_pixels:D?[L.transform.width,-1*L.transform.height]:[1/s.ay(V,1,L.transform.tileZoom),1/s.ay(V,1,L.transform.tileZoom)],u_pixel_coord_upper:[ie>>16,te>>16],u_pixel_coord_lower:[65535&ie,65535&te]}})(0,g,_,c,v,b),{u_matrix:l,u_emissive_strength:t,u_opacity:r}),ss=new Float32Array(s.bA([])),ba=(l,t,r,c,f,g,_,v,b,I,C,O,L,D=[0,0,0],V,j,Z)=>{const q=f.style.light,ee=q.properties.get("position"),ie=[-ee.x,-ee.y,ee.z],te=s.dO();q.properties.get("anchor")==="viewport"&&(s.dP(te,-f.transform.angle),s.dQ(ie,ie,te));const ye=C.alphaMode==="MASK",pe=q.properties.get("color").toNonPremultipliedRenderColor(null),ge=L.paint.get("model-ambient-occlusion-intensity"),ue=L.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return ue.a=L.paint.get("model-color-mix-intensity").constantOr(0),Z&&(ue.r=Z[0],ue.g=Z[1],ue.b=Z[2],ue.a=Z[3]),j&&(ue.r=j.color.r,ue.g=j.color.g,ue.b=j.color.b,ue.a=j.colorMix,O=j.emissionStrength,g*=j.opacity),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:c||ss,u_lightpos:ie,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:D,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+ye,u_alphaCutoff:C.alphaCutoff,u_baseColorFactor:_.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:b,u_roughnessFactor:I,u_baseColorTexture:fo.BaseColor,u_metallicRoughnessTexture:fo.MetallicRoughness,u_normalTexture:fo.Normal,u_occlusionTexture:fo.Occlusion,u_emissionTexture:fo.Emission,u_lutTexture:fo.LUT,u_color_mix:ue.toArray01(),u_aoIntensity:ge,u_emissive_strength:O,u_occlusionTextureTransform:V||[0,0,0,0]}},Zh=(l,t=ss,r=ss)=>({u_matrix:l,u_instance:t,u_node_matrix:r}),Xh={fillExtrusion:l=>({u_matrix:new s.cl(l),u_lightpos:new s.ci(l),u_lightintensity:new s.cj(l),u_lightcolor:new s.ci(l),u_vertical_gradient:new s.cj(l),u_opacity:new s.cj(l),u_edge_radius:new s.cj(l),u_width_scale:new s.cj(l),u_ao:new s.ck(l),u_height_type:new s.ch(l),u_base_type:new s.ch(l),u_tile_id:new s.ci(l),u_zoom_transition:new s.cj(l),u_inv_rot_matrix:new s.cl(l),u_merc_center:new s.ck(l),u_up_dir:new s.ci(l),u_height_lift:new s.cj(l),u_flood_light_color:new s.ci(l),u_vertical_scale:new s.cj(l),u_flood_light_intensity:new s.cj(l),u_ground_shadow_factor:new s.ci(l)}),fillExtrusionDepth:l=>({u_matrix:new s.cl(l),u_edge_radius:new s.cj(l),u_width_scale:new s.cj(l),u_vertical_scale:new s.cj(l),u_height_type:new s.ch(l),u_base_type:new s.ch(l)}),fillExtrusionPattern:l=>({u_matrix:new s.cl(l),u_lightpos:new s.ci(l),u_lightintensity:new s.cj(l),u_lightcolor:new s.ci(l),u_vertical_gradient:new s.cj(l),u_height_factor:new s.cj(l),u_edge_radius:new s.cj(l),u_width_scale:new s.cj(l),u_ao:new s.ck(l),u_height_type:new s.ch(l),u_base_type:new s.ch(l),u_tile_id:new s.ci(l),u_zoom_transition:new s.cj(l),u_inv_rot_matrix:new s.cl(l),u_merc_center:new s.ck(l),u_up_dir:new s.ci(l),u_height_lift:new s.cj(l),u_image:new s.ch(l),u_texsize:new s.ck(l),u_pixel_coord_upper:new s.ck(l),u_pixel_coord_lower:new s.ck(l),u_tile_units_to_pixels:new s.cj(l),u_opacity:new s.cj(l),u_pattern_transition:new s.cj(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new s.cl(l),u_opacity:new s.cj(l),u_ao_pass:new s.cj(l),u_meter_to_tile:new s.cj(l),u_ao:new s.ck(l),u_flood_light_intensity:new s.cj(l),u_flood_light_color:new s.ci(l),u_attenuation:new s.cj(l),u_edge_radius:new s.cj(l),u_fb:new s.ch(l),u_fb_size:new s.cj(l),u_dynamic_offset:new s.cj(l)}),fill:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_ground_shadow_factor:new s.ci(l)}),fillPattern:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_image:new s.ch(l),u_texsize:new s.ck(l),u_pixel_coord_upper:new s.ck(l),u_pixel_coord_lower:new s.ck(l),u_tile_units_to_pixels:new s.cj(l),u_ground_shadow_factor:new s.ci(l),u_pattern_transition:new s.cj(l)}),fillOutline:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_world:new s.ck(l),u_ground_shadow_factor:new s.ci(l)}),fillOutlinePattern:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_world:new s.ck(l),u_image:new s.ch(l),u_texsize:new s.ck(l),u_pixel_coord_upper:new s.ck(l),u_pixel_coord_lower:new s.ck(l),u_tile_units_to_pixels:new s.cj(l),u_ground_shadow_factor:new s.ci(l),u_pattern_transition:new s.cj(l)}),building:l=>({u_matrix:new s.cl(l),u_normal_matrix:new s.cl(l),u_opacity:new s.cj(l),u_faux_facade_ao_intensity:new s.cj(l),u_camera_pos:new s.ci(l),u_tile_to_meter:new s.cj(l),u_facade_emissive_chance:new s.cj(l),u_flood_light_color:new s.ci(l),u_flood_light_intensity:new s.cj(l)}),buildingBloom:l=>({u_matrix:new s.cl(l)}),buildingDepth:l=>({u_matrix:new s.cl(l)}),elevatedStructuresDepth:l=>({u_matrix:new s.cl(l),u_depth_bias:new s.cj(l)}),elevatedStructures:l=>({u_matrix:new s.cl(l),u_ground_shadow_factor:new s.ci(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new s.cl(l),u_camera_pos:new s.ci(l),u_depth_bias:new s.cj(l),u_height_scale:new s.cj(l),u_reset_depth:new s.cj(l)}),circle:s.dY,collisionBox:l=>({u_matrix:new s.cl(l),u_inv_rot_matrix:new s.cl(l),u_camera_to_center_distance:new s.cj(l),u_extrude_scale:new s.ck(l),u_zoom_transition:new s.cj(l),u_merc_center:new s.ck(l),u_tile_id:new s.ci(l)}),collisionCircle:l=>({u_matrix:new s.cl(l),u_inv_matrix:new s.cl(l),u_camera_to_center_distance:new s.cj(l),u_viewport_size:new s.ck(l)}),debug:l=>({u_color:new s.dB(l),u_matrix:new s.cl(l),u_overlay:new s.ch(l),u_overlay_scale:new s.cj(l)}),clippingMask:l=>({u_matrix:new s.cl(l)}),heatmap:l=>({u_extrude_scale:new s.cj(l),u_intensity:new s.cj(l),u_matrix:new s.cl(l),u_inv_rot_matrix:new s.cl(l),u_merc_center:new s.ck(l),u_tile_id:new s.ci(l),u_zoom_transition:new s.cj(l),u_up_dir:new s.ci(l)}),heatmapTexture:l=>({u_image:new s.ch(l),u_color_ramp:new s.ch(l),u_opacity:new s.cj(l)}),hillshade:l=>({u_matrix:new s.cl(l),u_image:new s.ch(l),u_latrange:new s.ck(l),u_light:new s.ck(l),u_shadow:new s.dB(l),u_highlight:new s.dB(l),u_emissive_strength:new s.cj(l),u_accent:new s.dB(l)}),hillshadePrepare:l=>({u_matrix:new s.cl(l),u_image:new s.ch(l),u_dimension:new s.ck(l),u_zoom:new s.cj(l)}),line:s.dX,linePattern:s.dW,raster:l=>({u_matrix:new s.cl(l),u_normalize_matrix:new s.cl(l),u_globe_matrix:new s.cl(l),u_merc_matrix:new s.cl(l),u_grid_matrix:new s.dC(l),u_tl_parent:new s.ck(l),u_scale_parent:new s.cj(l),u_fade_t:new s.cj(l),u_opacity:new s.cj(l),u_image0:new s.ch(l),u_image1:new s.ch(l),u_brightness_low:new s.cj(l),u_brightness_high:new s.cj(l),u_saturation_factor:new s.cj(l),u_contrast_factor:new s.cj(l),u_spin_weights:new s.ci(l),u_perspective_transform:new s.ck(l),u_raster_elevation:new s.cj(l),u_zoom_transition:new s.cj(l),u_merc_center:new s.ck(l),u_cutoff_params:new s.d3(l),u_colorization_mix:new s.d3(l),u_colorization_offset:new s.cj(l),u_color_ramp:new s.ch(l),u_texture_offset:new s.ck(l),u_texture_res:new s.ck(l),u_emissive_strength:new s.cj(l)}),rasterParticle:l=>({u_matrix:new s.cl(l),u_normalize_matrix:new s.cl(l),u_globe_matrix:new s.cl(l),u_merc_matrix:new s.cl(l),u_grid_matrix:new s.dC(l),u_tl_parent:new s.ck(l),u_scale_parent:new s.cj(l),u_fade_t:new s.cj(l),u_opacity:new s.cj(l),u_image0:new s.ch(l),u_image1:new s.ch(l),u_raster_elevation:new s.cj(l),u_zoom_transition:new s.cj(l),u_merc_center:new s.ck(l),u_cutoff_params:new s.d3(l)}),rasterParticleTexture:l=>({u_texture:new s.ch(l),u_opacity:new s.cj(l)}),rasterParticleDraw:l=>({u_particle_texture:new s.ch(l),u_particle_texture_side_len:new s.cj(l),u_tile_offset:new s.ck(l),u_velocity:new s.ch(l),u_color_ramp:new s.ch(l),u_velocity_res:new s.ck(l),u_max_speed:new s.cj(l),u_uv_offset:new s.ck(l),u_data_scale:new s.ck(l),u_data_offset:new s.cj(l),u_particle_pos_scale:new s.cj(l),u_particle_pos_offset:new s.ck(l)}),rasterParticleUpdate:l=>({u_particle_texture:new s.ch(l),u_particle_texture_side_len:new s.cj(l),u_velocity:new s.ch(l),u_velocity_res:new s.ck(l),u_max_speed:new s.cj(l),u_speed_factor:new s.cj(l),u_reset_rate:new s.cj(l),u_rand_seed:new s.cj(l),u_uv_offset:new s.ck(l),u_data_scale:new s.ck(l),u_data_offset:new s.cj(l),u_particle_pos_scale:new s.cj(l),u_particle_pos_offset:new s.ck(l)}),symbol:l=>({u_is_size_zoom_constant:new s.ch(l),u_is_size_feature_constant:new s.ch(l),u_size_t:new s.cj(l),u_size:new s.cj(l),u_camera_to_center_distance:new s.cj(l),u_rotate_symbol:new s.ch(l),u_aspect_ratio:new s.cj(l),u_fade_change:new s.cj(l),u_matrix:new s.cl(l),u_label_plane_matrix:new s.cl(l),u_coord_matrix:new s.cl(l),u_is_text:new s.ch(l),u_elevation_from_sea:new s.ch(l),u_pitch_with_map:new s.ch(l),u_texsize:new s.ck(l),u_texsize_icon:new s.ck(l),u_texture:new s.ch(l),u_texture_icon:new s.ch(l),u_gamma_scale:new s.cj(l),u_device_pixel_ratio:new s.cj(l),u_tile_id:new s.ci(l),u_zoom_transition:new s.cj(l),u_inv_rot_matrix:new s.cl(l),u_merc_center:new s.ck(l),u_camera_forward:new s.ci(l),u_tile_matrix:new s.cl(l),u_up_vector:new s.ci(l),u_ecef_origin:new s.ci(l),u_is_halo:new s.ch(l),u_icon_transition:new s.cj(l),u_color_adj_mat:new s.cl(l),u_scale_factor:new s.cj(l),u_ground_shadow_factor:new s.ci(l),u_inv_matrix:new s.cl(l),u_normal_scale:new s.cj(l),u_lutTexture:new s.ch(l)}),background:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_opacity:new s.cj(l),u_color:new s.dB(l)}),backgroundPattern:l=>({u_matrix:new s.cl(l),u_emissive_strength:new s.cj(l),u_opacity:new s.cj(l),u_image:new s.ch(l),u_pattern_tl:new s.ck(l),u_pattern_br:new s.ck(l),u_texsize:new s.ck(l),u_pattern_size:new s.ck(l),u_pixel_coord_upper:new s.ck(l),u_pixel_coord_lower:new s.ck(l),u_pattern_units_to_pixels:new s.ck(l)}),terrainRaster:l=>({u_matrix:new s.cl(l),u_image0:new s.ch(l),u_image1:new s.ch(l),u_skirt_height:new s.cj(l),u_ground_shadow_factor:new s.ci(l),u_emissive_texture_available:new s.cj(l)}),skybox:l=>({u_matrix:new s.cl(l),u_sun_direction:new s.ci(l),u_cubemap:new s.ch(l),u_opacity:new s.cj(l),u_temporal_offset:new s.cj(l)}),skyboxGradient:l=>({u_matrix:new s.cl(l),u_color_ramp:new s.ch(l),u_center_direction:new s.ci(l),u_radius:new s.cj(l),u_opacity:new s.cj(l),u_temporal_offset:new s.cj(l)}),skyboxCapture:l=>({u_matrix_3f:new s.dC(l),u_sun_direction:new s.ci(l),u_sun_intensity:new s.cj(l),u_color_tint_r:new s.d3(l),u_color_tint_m:new s.d3(l),u_luminance:new s.cj(l)}),globeRaster:l=>({u_proj_matrix:new s.cl(l),u_globe_matrix:new s.cl(l),u_normalize_matrix:new s.cl(l),u_merc_matrix:new s.cl(l),u_zoom_transition:new s.cj(l),u_merc_center:new s.ck(l),u_image0:new s.ch(l),u_image1:new s.ch(l),u_grid_matrix:new s.dC(l),u_skirt_height:new s.cj(l),u_far_z_cutoff:new s.cj(l),u_frustum_tl:new s.ci(l),u_frustum_tr:new s.ci(l),u_frustum_br:new s.ci(l),u_frustum_bl:new s.ci(l),u_globe_pos:new s.ci(l),u_globe_radius:new s.cj(l),u_viewport:new s.ck(l),u_emissive_texture_available:new s.cj(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.ci(l),u_frustum_tr:new s.ci(l),u_frustum_br:new s.ci(l),u_frustum_bl:new s.ci(l),u_horizon:new s.cj(l),u_transition:new s.cj(l),u_fadeout_range:new s.cj(l),u_atmosphere_fog_color:new s.d3(l),u_high_color:new s.d3(l),u_space_color:new s.d3(l),u_temporal_offset:new s.cj(l),u_horizon_angle:new s.cj(l)}),model:l=>({u_matrix:new s.cl(l),u_lighting_matrix:new s.cl(l),u_normal_matrix:new s.cl(l),u_node_matrix:new s.cl(l),u_lightpos:new s.ci(l),u_lightintensity:new s.cj(l),u_lightcolor:new s.ci(l),u_camera_pos:new s.ci(l),u_opacity:new s.cj(l),u_baseColorFactor:new s.d3(l),u_emissiveFactor:new s.d3(l),u_metallicFactor:new s.cj(l),u_roughnessFactor:new s.cj(l),u_baseTextureIsAlpha:new s.ch(l),u_alphaMask:new s.ch(l),u_alphaCutoff:new s.cj(l),u_baseColorTexture:new s.ch(l),u_metallicRoughnessTexture:new s.ch(l),u_normalTexture:new s.ch(l),u_occlusionTexture:new s.ch(l),u_emissionTexture:new s.ch(l),u_lutTexture:new s.ch(l),u_color_mix:new s.d3(l),u_aoIntensity:new s.cj(l),u_emissive_strength:new s.cj(l),u_occlusionTextureTransform:new s.d3(l)}),modelDepth:l=>({u_matrix:new s.cl(l),u_instance:new s.cl(l),u_node_matrix:new s.cl(l)}),groundShadow:l=>({u_matrix:new s.cl(l),u_ground_shadow_factor:new s.ci(l)}),stars:l=>({u_matrix:new s.cl(l),u_up:new s.ci(l),u_right:new s.ci(l),u_intensity_multiplier:new s.cj(l)}),snowParticle:l=>({u_modelview:new s.cl(l),u_projection:new s.cl(l),u_time:new s.cj(l),u_cam_pos:new s.ci(l),u_velocityConeAperture:new s.cj(l),u_velocity:new s.cj(l),u_horizontalOscillationRadius:new s.cj(l),u_horizontalOscillationRate:new s.cj(l),u_boxSize:new s.cj(l),u_billboardSize:new s.cj(l),u_simpleShapeParameters:new s.ck(l),u_screenSize:new s.ck(l),u_thinningCenterPos:new s.ck(l),u_thinningShape:new s.ci(l),u_thinningAffectedRatio:new s.cj(l),u_thinningParticleOffset:new s.cj(l),u_particleColor:new s.d3(l),u_direction:new s.ci(l)}),rainParticle:l=>({u_modelview:new s.cl(l),u_projection:new s.cl(l),u_time:new s.cj(l),u_cam_pos:new s.ci(l),u_texScreen:new s.ch(l),u_velocityConeAperture:new s.cj(l),u_velocity:new s.cj(l),u_boxSize:new s.cj(l),u_rainDropletSize:new s.ck(l),u_distortionStrength:new s.cj(l),u_rainDirection:new s.ci(l),u_color:new s.d3(l),u_screenSize:new s.ck(l),u_thinningCenterPos:new s.ck(l),u_thinningShape:new s.ci(l),u_thinningAffectedRatio:new s.cj(l),u_thinningParticleOffset:new s.cj(l),u_shapeDirectionalPower:new s.cj(l),u_shapeNormalPower:new s.cj(l),u_mode:new s.cj(l)}),vignette:l=>({u_vignetteShape:new s.ci(l),u_vignetteColor:new s.d3(l)}),occlusion:l=>({u_matrix:new s.cl(l),u_anchorPos:new s.ci(l),u_screenSizePx:new s.ck(l),u_occluderSizePx:new s.ck(l),u_color:new s.d3(l)})};class No{constructor(t,r,c,f){this.id=No.uniqueIdxCounter,No.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||f||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=No.uniqueIdxCounter,No.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}No.uniqueIdxCounter=0;const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ef{constructor(t,r,c,f,g,_){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=f,this.instanceCount=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||g||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const f=r.getAttributeLocation(t,this.attributes[c].name);f!==-1&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,r,c){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],_=r.getAttributeLocation(t,g.name);_!==-1&&t.vertexAttribPointer(_,g.components,t[Rl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,r,c){for(let f=0;f<this.attributes.length;f++){const g=r.getAttributeLocation(t,this.attributes[f].name);g!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qf{constructor(t,r,c,f,g){this.context=t,this.width=r,this.height=c;const _=this.framebuffer=t.gl.createFramebuffer();f>0&&(this.colorAttachment0=new Ql(t,_,0)),f>1&&(this.colorAttachment1=new Ql(t,_,1)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new Bo(t,_):new wc(t,_))}createColorAttachment(t,r){r===0?this.colorAttachment0=new Ql(t,this.framebuffer,0):r===1&&(this.colorAttachment1=new Ql(t,this.framebuffer,1))}removeColorAttachment(t,r){const c=this.context.gl;let f;r===0?(f=this.colorAttachment0.get(),this.colorAttachment0=void 0):r===1&&(f=this.colorAttachment1.get(),this.colorAttachment1=void 0),f&&c.deleteTexture(f)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const r=this.colorAttachment0.get();r&&t.deleteTexture(r)}if(this.colorAttachment1){const r=this.colorAttachment1.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class ia{constructor(t,r){this.gl=t,this.clearColor=new Wd(this),this.clearDepth=new qd(this),this.clearStencil=new Oh(this),this.colorMask=new Bu(this),this.depthMask=new Fh(this),this.stencilMask=new Wc(this),this.stencilFunc=new qc(this),this.stencilOp=new Bh(this),this.stencilTest=new Nu(this),this.depthRange=new Zd(this),this.depthTest=new El(this),this.depthFunc=new jf(this),this.blend=new el(this),this.blendFunc=new _a(this),this.blendColor=new yc(this),this.blendEquation=new tl(this),this.cullFace=new ju(this),this.cullFaceSide=new Nh(this),this.frontFace=new Mp(this),this.program=new vc(this),this.activeTexture=new Vu(this),this.viewport=new nl(this),this.bindFramebuffer=new jh(this),this.bindRenderbuffer=new Vf(this),this.bindTexture=new Uu(this),this.bindVertexBuffer=new xc(this),this.bindElementBuffer=new Vr(this),this.bindVertexArrayOES=new Fr(this),this.pixelStoreUnpack=new Il(this),this.pixelStoreUnpackPremultiplyAlpha=new Yo(this),this.pixelStoreUnpackFlipY=new Ds(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,c){return new No(this,t,r,c)}createVertexBuffer(t,r,c,f,g){return new ef(this,t,r,c,f,g)}createRenderbuffer(t,r,c){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,r,c,f){return new qf(this,t,r,c,f)}clear({color:t,depth:r,stencil:c,colorMask:f}){const g=this.gl;let _=0;t&&(_|=g.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(f||[!0,!0,!0,!0])),r!==void 0&&(_|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),g.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.by(t.blendFunction,On.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ra;function qt(l,t,r,c,f,g,_){const v=l.context,b=v.gl,I=l.transform,C=[s.aF(I.center.lng),s.aJ(I.center.lat)],O=r.layout.get("symbol-placement"),L=r.layout.get("text-variable-anchor"),D=r.layout.get("icon-rotation-alignment")==="map",V=r.layout.get("text-rotation-alignment")==="map",j=O!=="point",Z=[];let q=0,ee=0;for(let le=0;le<c.length;le++){const xe=c[le],Re=t.getTile(xe),Ae=Re.getBucket(r);if(!Ae)continue;const $e=Ae.getProjection().createInversionMatrix(I,xe.canonical),He=[],it=Iu(xe,Ae,I),xt=!_&&D&&j,Ne=_&&V&&j,Ee=L&&Ae.hasTextData(),We=Ae.hasIconTextFit()&&Ee&&Ae.hasIconData(),Ue=xt||Ne||_&&Ee||We,dt=Ae.projection.name==="globe",Rt=dt?s.aj(I.zoom):0;dt&&(He.push("PROJECTION_GLOBE_VIEW"),Ue&&He.push("PROJECTED_POS_ON_VIEWPORT"));const Lt=l.getOrCreateProgram("collisionBox",{defines:He});let At=it;f[0]===0&&f[1]===0||(At=l.translatePosMatrix(it,Re,f,g));const wt=_?Ae.textCollisionBox:Ae.iconCollisionBox,tn=Ae.collisionCircleArray;if(tn.length>0){const Bt=s.bC(),Ht=At;s.cP(Bt,Ae.placementInvProjMatrix,I.glCoordMatrix),s.cP(Bt,Bt,Ae.placementViewportMatrix),Z.push({circleArray:tn,circleOffset:ee,transform:Ht,invTransform:Bt,projection:Ae.getProjection()}),q+=tn.length/4,ee=q}if(!wt)continue;l.terrain&&l.terrain.setupElevationDraw(Re,Lt);const Yt=dt?[xe.canonical.x,xe.canonical.y,1<<xe.canonical.z]:[0,0,0];Lt.draw(l,b.LINES,an.disabled,Pn.disabled,l.colorModeForRenderPass(),In.disabled,Gh(At,$e,I,Rt,C,Re,Yt,Ae.getProjection()),r.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,I.zoom,null,[wt.collisionVertexBuffer,wt.collisionVertexBufferExt])}if(!_||!Z.length)return;const ie=l.getOrCreateProgram("collisionCircle"),te=new s.dZ;te.resize(4*q),te._trim();let ye=0;for(const le of Z)for(let xe=0;xe<le.circleArray.length/4;xe++){const Re=4*xe,Ae=le.circleArray[Re+0],$e=le.circleArray[Re+1],He=le.circleArray[Re+2],it=le.circleArray[Re+3];te.emplace(ye++,Ae,$e,He,it,0),te.emplace(ye++,Ae,$e,He,it,1),te.emplace(ye++,Ae,$e,He,it,2),te.emplace(ye++,Ae,$e,He,it,3)}(!ra||ra.length<2*q)&&(ra=(function(le){const xe=2*le,Re=new s.b0;Re.resize(xe),Re._trim();for(let Ae=0;Ae<xe;Ae++){const $e=6*Ae;Re.uint16[$e+0]=4*Ae+0,Re.uint16[$e+1]=4*Ae+1,Re.uint16[$e+2]=4*Ae+2,Re.uint16[$e+3]=4*Ae+2,Re.uint16[$e+4]=4*Ae+3,Re.uint16[$e+5]=4*Ae+0}return Re})(q));const pe=v.createIndexBuffer(ra,!0),ge=v.createVertexBuffer(te,s.d_.members,!0);for(const le of Z){const xe={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ue=I).getCameraToCenterDistance(le.projection),u_viewport_size:[ue.width,ue.height]};ie.draw(l,b.TRIANGLES,an.disabled,Pn.disabled,l.colorModeForRenderPass(),In.disabled,xe,r.id,ge,pe,s.bg.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,I.zoom)}var ue;ge.destroy(),pe.destroy()}const Ju=s.bC();function ja(l){const t=l._camera.getWorldToCamera(l.worldSize,1),r=s.aB([],t,l.globeMatrix);s.bl(r,r);const c=[0,0,0],f=[0,1,0,0];return s.aC(f,f,r),c[0]=f[0],c[1]=f[1],c[2]=f[2],s.aw(c,c),c}function nc({width:l,height:t,anchor:r,textOffset:c,textScale:f},g){const{horizontalAlign:_,verticalAlign:v}=s.c1(r),b=-(_-.5)*l,I=-(v-.5)*t,C=s.c2(r,c);return new s.P((b/f+C[0])*g,(I/f+C[1])*g)}function yn(l,t,r,c,f,g,_,v,b,I){const C=l.text.placedSymbolArray,O=l.text.dynamicLayoutVertexArray,L=l.icon.dynamicLayoutVertexArray,D={},V=l.getProjection(),j=fa(_,V,f),Z=f.elevation,q=V.upVectorScale(_.canonical,f.center.lat,f.worldSize).metersToTile;O.clear();for(let ee=0;ee<C.length;ee++){const ie=C.get(ee),{tileAnchorX:te,tileAnchorY:ye,numGlyphs:pe}=ie,ge=ie.hidden||!ie.crossTileID||l.allowVerticalPlacement&&!ie.placedOrientation?null:c[ie.crossTileID];if(ge){let ue=0,le=0,xe=0;const Re=l.elevationType==="road";if(Z||Re){const Ue=Re?l.getElevationFeatureForText(ee):null,dt=s.bV.getAtTileOffset(_,new s.P(te,ye),Z,Ue),[Rt,Lt,At]=V.upVector(_.canonical,te,ye);ue=dt*Rt*q,le=dt*Lt*q,xe=dt*At*q}let[Ae,$e,He,it]=ms(ie.projectedAnchorX+ue,ie.projectedAnchorY+le,ie.projectedAnchorZ+xe,r?j:g);const xt=Vi(f.getCameraToCenterDistance(V),it);let Ne=s.bM(l.textSizeData,b,ie)*xt/s.bY;r&&(Ne*=l.tilePixelRatio/v);const Ee=nc(ge,Ne);r?({x:Ae,y:$e,z:He}=V.projectTilePoint(te+Ee.x,ye+Ee.y,_.canonical),[Ae,$e,He]=ms(Ae+ue,$e+le,He+xe,g)):(t&&Ee._rotate(-f.angle),Ae+=Ee.x,$e+=Ee.y,He=0);const We=l.allowVerticalPlacement&&ie.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let Ue=0;Ue<pe;Ue++)s.bO(O,Ae,$e,He,We);I&&ie.associatedIconIndex>=0&&(D[ie.associatedIconIndex]={x:Ae,y:$e,z:He,angle:We})}else pa(pe,O)}if(I){L.clear();const ee=l.icon.placedSymbolArray;for(let ie=0;ie<ee.length;ie++){const te=ee.get(ie),{numGlyphs:ye}=te,pe=D[ie];if(te.hidden||!pe)pa(ye,L);else{const{x:ge,y:ue,z:le,angle:xe}=pe;for(let Re=0;Re<ye;Re++)s.bO(L,ge,ue,le,xe)}}l.icon.dynamicLayoutVertexBuffer.updateData(L)}l.text.dynamicLayoutVertexBuffer.updateData(O)}function oa(l,t,r,c,f,g,_={}){const v=r.paint.get("icon-translate"),b=r.paint.get("text-translate"),I=r.paint.get("icon-translate-anchor"),C=r.paint.get("text-translate-anchor"),O=r.layout.get("icon-rotation-alignment"),L=r.layout.get("text-rotation-alignment"),D=r.layout.get("icon-pitch-alignment"),V=r.layout.get("text-pitch-alignment"),j=r.layout.get("icon-keep-upright"),Z=r.layout.get("text-keep-upright"),q=r.paint.get("icon-color-saturation"),ee=r.paint.get("icon-color-contrast"),ie=r.paint.get("icon-color-brightness-min"),te=r.paint.get("icon-color-brightness-max"),ye=r.layout.get("symbol-elevation-reference")==="sea",pe=r.layout.get("icon-image-use-theme")==="none",ge=l.context,ue=ge.gl,le=l.transform,xe=O==="map",Re=L==="map",Ae=D==="map",$e=V==="map",He=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const xt=l.depthModeForSublayer(0,an.ReadOnly),Ne=new an(l.context.gl.LEQUAL,an.ReadOnly,l.depthRangeFor3D),Ee=[s.aF(le.center.lng),s.aJ(le.center.lat)],We=r.layout.get("text-variable-anchor"),Ue=le.projection.name==="globe",dt=[],Rt=[0,-1,0];for(const Lt of c){const At=t.getTile(Lt),wt=At.getBucket(r);if(!wt||wt.projection.name==="mercator"&&Ue||wt.fullyClipped)continue;const tn=wt.projection.name==="globe",Yt=tn?s.aj(le.zoom):0,Bt=fa(Lt,wt.getProjection(),le),Ht=le.calculatePixelsToTileUnitsMatrix(At),_n=We&&wt.hasTextData(),An=wt.hasIconTextFit()&&_n&&wt.hasIconData(),si=wt.getProjection().createInversionMatrix(le,Lt.canonical),Ri=(1<<At.tileID.canonical.z)*s.al/l.transform.worldSize,Kt=Ci=>{let hi=[0,0,0];if(Ci){const Wn=l.style.directionalLight,tr=l.style.ambientLight;Wn&&tr&&(hi=ma(l.style,Wn,tr))}return hi},wi=Ci=>{le.depthOcclusionForSymbolsAndCircles&&(r.hasOcclusionOpacityProperties||l.terrain)&&(Ci.push("DEPTH_D24"),Ci.push("DEPTH_OCCLUSION"))},Mn=Ci=>{r.lut&&!pe&&(r.lut.texture||(r.lut.texture=new s.d$(l.context,r.lut.image,[r.lut.image.height,r.lut.image.height,r.lut.image.height],ge.gl.RGBA8)),ge.activeTexture.set(ge.gl.TEXTURE0+fo.LUT),r.lut.texture&&r.lut.texture.bind(ge.gl.LINEAR,ge.gl.CLAMP_TO_EDGE),Ci.push("APPLY_LUT_ON_GPU"))},Ai=()=>{const Ci=xe&&r.layout.get("symbol-placement")!=="point",hi=[];wi(hi),Mn(hi);const Wn=Ci||An,tr=wt.elevationType==="road",Mr=l.shadowRenderer,dr=tr&&Ae&&!!Mr&&Mr.enabled,Hi=Kt(dr),Go=tr&&Ae&&!l.terrain?Ne:xt,Co=r.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&Ae&&hi.push("PITCH_WITH_MAP_TERRAIN"),tn&&(hi.push("PROJECTION_GLOBE_VIEW"),Wn&&hi.push("PROJECTED_POS_ON_VIEWPORT")),Co>0&&wt.hasAnySecondaryIcon&&hi.push("ICON_TRANSITION"),!wt.icon.zOffsetVertexBuffer||tr&&l.terrain||hi.push("Z_OFFSET"),q===0&&ee===0&&ie===0&&te===1||hi.push("COLOR_ADJUSTMENT"),wt.sdfIcons&&hi.push("RENDER_SDF"),dr&&hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),tr&&Ae&&!l.terrain&&wt.icon.orientationVertexBuffer&&hi.push("ELEVATED_ROADS");const Ur=wt.icon.programConfigurations.get(r.id),$o=l.getOrCreateProgram("symbol",{config:Ur,defines:hi}),es=At.imageAtlasTexture?At.imageAtlasTexture.size:[0,0],go=wt.iconSizeData,Sa=s.bK(go,le.zoom),Ts=Ae||!le.isOrthographic,Ns=kr(Bt,At.tileID.canonical,Ae,xe,le,wt.getProjection(),Ht),fr=Bc(Bt,At.tileID.canonical,Ae,xe,le,wt.getProjection(),Ht),d=l.translatePosMatrix(fr,At,v,I,!0),m=l.translatePosMatrix(Bt,At,v,I),w=Wn?Ju:Ns,M=xe&&!Ae&&!Ci;let B=Rt;!Ue&&!le.mercatorFromTransition||xe||(B=ja(le));const W=tn?B:Rt,ce=r.getColorAdjustmentMatrix(q,ee,ie,te),Fe=Ku(go.kind,Sa,M,Ae,l,m,w,d,ye,!1,es,[0,0],0,Lt,Yt,Ee,si,W,wt.getProjection(),Hi,Ri,ce,Co,null),Ze=At.imageAtlasTexture?At.imageAtlasTexture:null,kt=r.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,en=wt.sdfIcons||l.options.rotating||l.options.zooming||kt||Ts?ue.LINEAR:ue.NEAREST,ln=wt.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,rn=l.terrain&&Ae&&Ci?s.bl(s.bC(),Ns):Ju;if(Ci&&wt.icon){const zn=s.bV.getAtTileOffsetFunc(Lt,le.center.lat,le.worldSize,wt.getProjection()),Bn=Wl(Bt,At.tileID.canonical,Ae,xe,le,wt.getProjection(),Ht),Nn=r.layout.get("icon-size-scale-range"),Lr=s.aA(l.scaleFactor,Nn[0],Nn[1]);Rd(wt,Bt,l,!1,Bn,fr,Ae,j,zn,Lt,Lr)}return{program:$o,buffers:wt.icon,uniformValues:Fe,atlasTexture:Ze,atlasTextureIcon:null,atlasInterpolation:en,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:ln,depthMode:Go,tile:At,renderWithShadows:dr,labelPlaneMatrixInv:rn}},ji=()=>{const Ci=Re&&r.layout.get("symbol-placement")!=="point",hi=[],Wn=Ci||We||An,tr=wt.elevationType==="road",Mr=l.shadowRenderer,dr=tr&&$e&&!!Mr&&Mr.enabled,Hi=Kt(dr),Go=tr&&$e&&!l.terrain?Ne:xt;l.terrainRenderModeElevated()&&$e&&hi.push("PITCH_WITH_MAP_TERRAIN"),tn&&(hi.push("PROJECTION_GLOBE_VIEW"),Wn&&hi.push("PROJECTED_POS_ON_VIEWPORT")),!wt.text.zOffsetVertexBuffer||tr&&l.terrain||hi.push("Z_OFFSET"),wt.iconsInText&&hi.push("RENDER_TEXT_AND_SYMBOL"),hi.push("RENDER_SDF"),dr&&hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),tr&&$e&&!l.terrain&&wt.text.orientationVertexBuffer&&hi.push("ELEVATED_ROADS"),wi(hi);const Co=wt.text.programConfigurations.get(r.id),Ur=l.getOrCreateProgram("symbol",{config:Co,defines:hi});let $o,es=[0,0],go=null;const Sa=wt.textSizeData;wt.iconsInText&&(es=At.imageAtlasTexture?At.imageAtlasTexture.size:[0,0],go=At.imageAtlasTexture?At.imageAtlasTexture:null,$o=$e||!le.isOrthographic||l.options.rotating||l.options.zooming||Sa.kind==="composite"||Sa.kind==="camera"?ue.LINEAR:ue.NEAREST);const Ts=At.glyphAtlasTexture?At.glyphAtlasTexture.size:[0,0],Ns=r.layout.get("text-size-scale-range"),fr=s.aA(l.scaleFactor,Ns[0],Ns[1]),d=s.bK(Sa,le.zoom,fr),m=kr(Bt,At.tileID.canonical,$e,Re,le,wt.getProjection(),Ht),w=Bc(Bt,At.tileID.canonical,$e,Re,le,wt.getProjection(),Ht),M=l.translatePosMatrix(w,At,b,C,!0),B=l.translatePosMatrix(Bt,At,b,C),W=Wn?Ju:m,ce=Re&&!$e&&!Ci;let Fe=Rt;!Ue&&!le.mercatorFromTransition||Re||(Fe=ja(le));const Ze=Ku(Sa.kind,d,ce,$e,l,B,W,M,ye,!0,Ts,es,0,Lt,Yt,Ee,si,tn?Fe:Rt,wt.getProjection(),Hi,Ri,null,null,fr),kt=At.glyphAtlasTexture?At.glyphAtlasTexture:null,en=ue.LINEAR,ln=r.paint.get("text-halo-width").constantOr(1)!==0,rn=l.terrain&&$e&&Ci?s.bl(s.bC(),m):Ju;if(Ci&&wt.text){const zn=s.bV.getAtTileOffsetFunc(Lt,le.center.lat,le.worldSize,wt.getProjection()),Bn=Wl(Bt,At.tileID.canonical,$e,Re,le,wt.getProjection(),Ht);Rd(wt,Bt,l,!0,Bn,w,$e,Z,zn,Lt,fr)}return{program:Ur,buffers:wt.text,uniformValues:Ze,atlasTexture:kt,atlasTextureIcon:go,atlasInterpolation:en,atlasInterpolationIcon:$o,isSDF:!0,hasHalo:ln,depthMode:Go,tile:At,renderWithShadows:dr,labelPlaneMatrixInv:rn}},Fi=wt.icon.segments.get().length,Ii=wt.text.segments.get().length,Gn=Fi&&!_.onlyText?Ai():null,zi=Ii&&!_.onlyIcons?ji():null,_r=r.paint.get("icon-opacity").constantOr(1),ur=r.paint.get("text-opacity").constantOr(1);if(He&&wt.canOverlap){it=!0;const Ci=_r&&!_.onlyText?wt.icon.segments.get():[],hi=ur&&!_.onlyIcons?wt.text.segments.get():[];for(const Wn of Ci)dt.push({segments:new s.bg([Wn]),sortKey:Wn.sortKey,state:Gn});for(const Wn of hi)dt.push({segments:new s.bg([Wn]),sortKey:Wn.sortKey,state:zi})}else _.onlyText||dt.push({segments:_r?wt.icon.segments:new s.bg([]),sortKey:0,state:Gn}),_.onlyIcons||dt.push({segments:ur?wt.text.segments:new s.bg([]),sortKey:0,state:zi})}it&&dt.sort(((Lt,At)=>Lt.sortKey-At.sortKey));for(const Lt of dt){const At=Lt.state;if(At)if(l.terrain?l.terrain.setupElevationDraw(At.tile,At.program,{useDepthForOcclusion:le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:At.labelPlaneMatrixInv}):l.setupDepthForOcclusion(le.depthOcclusionForSymbolsAndCircles,At.program),ge.activeTexture.set(ue.TEXTURE0),At.atlasTexture&&At.atlasTexture.bind(At.atlasInterpolation,ue.CLAMP_TO_EDGE,!0),At.atlasTextureIcon&&(ge.activeTexture.set(ue.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,ue.CLAMP_TO_EDGE,!0)),At.renderWithShadows&&l.shadowRenderer.setupShadows(At.tile.tileID.toUnwrapped(),At.program,"vector-tile"),l.uploadCommonLightUniforms(l.context,At.program),At.hasHalo){const wt=At.uniformValues;wt.u_is_halo=1,eu(At.buffers,Lt.segments,r,l,At.program,At.depthMode,f,g,wt,2),wt.u_is_halo=0}else{if(At.isSDF){const wt=At.uniformValues;At.hasHalo&&(wt.u_is_halo=1,eu(At.buffers,Lt.segments,r,l,At.program,At.depthMode,f,g,wt,1)),wt.u_is_halo=0}eu(At.buffers,Lt.segments,r,l,At.program,At.depthMode,f,g,At.uniformValues,1)}}}function eu(l,t,r,c,f,g,_,v,b,I){const C=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];f.draw(c,c.context.gl.TRIANGLES,g,_,v,In.disabled,b,r.id,l.layoutVertexBuffer,l.indexBuffer,t,r.paint,c.transform.zoom,l.programConfigurations.get(r.id),C,I)}function Qu(l,t){const r=1<<l.canonical.z,c=(t.x*r-l.canonical.x-l.wrap*r)*s.al,f=(t.y*r-l.canonical.y)*s.al,g=s.e8(t.z,t.y);return s.d5(c,f,g)}function kl(l,t,r,c,f){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const g=l.context.gl,_=new an(l.context.gl.LEQUAL,an.ReadWrite,l.depthRangeFor3D),v=new an(l.context.gl.GREATER,an.ReadWrite,l.depthRangeFor3D),b=(function(D){let V=.01;return D.isOrthographic&&(V=s.ak(1e-4,V,s.d0(D.pitch>=Oa?1:D.pitch/Oa))),2*V})(l.transform),I=l.transform.getFreeCameraOptions().position,C="elevatedStructuresDepthReconstruct",O=l.getOrCreateProgram(C,{defines:["DEPTH_RECONSTRUCTION"]}),L=l.getOrCreateProgram(C);for(const D of c){const V=t.getTile(D),j=V.getBucket(r);if(!j)continue;const Z=j.elevatedStructures;if(!Z)continue;const q=j.elevationBufferData.heightRange,ee=Qu(D.toUnwrapped(),I),ie=l.translatePosMatrix(D.projMatrix,V,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let te,ye,pe,ge;if(f==="initialize"){if(!q||q.min>=1||Z.depthSegments.segments[0].primitiveLength===0)continue;te=Tc(ie,ee,b,1,0),ye=_,pe=Z.depthSegments,ge=O}else if(f==="reset"){if(!q||q.min>=0||Z.maskSegments.segments[0].primitiveLength===0)continue;te=Tc(ie,ee,0,0,1),ye=v,pe=Z.maskSegments,ge=O}else if(f==="geometry"){if(Z.depthSegments.segments[0].primitiveLength===0)continue;te=Tc(ie,ee,b,1,0),ye=_,pe=Z.depthSegments,ge=L}ge.draw(l,g.TRIANGLES,ye,Pn.disabled,On.disabled,In.disabled,te,r.id,Z.vertexBuffer,Z.indexBuffer,pe,r.paint,l.transform.zoom)}}function eh(l,t,r,c){const{painter:f,sourceCache:g,layer:_,coords:v,colorMode:b,elevationType:I,terrainEnabled:C,pass:O}=l,L=f.context.gl,D=_.paint.get("fill-pattern"),V=_.paint.get("fill-pattern-cross-fade"),j=D.constantOr(null);let Z=I;I!=="road"||t&&!C||(Z="none");const q=Z==="road",ee=l.painter.shadowRenderer,ie=q&&!!ee&&ee.enabled,te=new an(f.context.gl.LEQUAL,an.ReadOnly,f.depthRangeFor3D);let ye=[0,0,0];if(ie){const le=f.style.directionalLight,xe=f.style.ambientLight;le&&xe&&(ye=ma(f.style,le,xe))}const pe=D&&D.constantOr(1),ge=f.terrain&&f.terrain.renderingToTexture,ue=(le,xe)=>{let Re,Ae,$e,He,it;xe?(Re=pe&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$e=L.LINES):(Re=pe?"fillPattern":"fill",$e=L.TRIANGLES);for(const xt of v){const Ne=g.getTile(xt);if(pe&&!Ne.patternsLoaded())continue;const Ee=Ne.getBucket(_);if(!Ee)continue;const We=t?Ee.elevationBufferData:Ee.bufferData;if(We.isEmpty())continue;f.prepareDrawTile();const Ue=We.programConfigurations.get(_.id),dt=f.isTileAffectedByFog(xt),Rt=[],Lt=[];q&&(Rt.push("ELEVATED_ROADS"),Lt.push(We.elevatedLayoutVertexBuffer)),ie&&Rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&r&&Rt.push("USE_MRT1"),pe&&(f.context.activeTexture.set(L.TEXTURE0),Ne.imageAtlasTexture&&Ne.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ue.updatePaintBuffers());let At=!1;if(j&&Ne.imageAtlas){const Ht=Ne.imageAtlas,_n=s.e3.from(j),An=_n.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),si=_n.getSecondary(),Ri=Ht.patternPositions.get(An),Kt=si?Ht.patternPositions.get(si.scaleSelf(s.o.devicePixelRatio).toString()):null;At=!!Ri&&!!Kt,Ri&&Ue.setConstantPatternPositions(Ri,Kt)}V>0&&(At||Ue.getPatternTransitionVertexBuffer("fill-pattern"))&&Rt.push("FILL_PATTERN_TRANSITION");const wt=f.getOrCreateProgram(Re,{config:Ue,overrideFog:dt,defines:Rt}),tn=f.translatePosMatrix(xt.projMatrix,Ne,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));ie&&ee.setupShadows(Ne.tileID.toUnwrapped(),wt,"vector-tile");const Yt=_.paint.get("fill-emissive-strength");if(xe){He=We.lineIndexBuffer,it=We.lineSegments;const Ht=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[L.drawingBufferWidth,L.drawingBufferHeight];Ae=Re==="fillOutlinePattern"&&pe?Uh(tn,Yt,f,Ne,Ht,ye,V):$f(tn,Yt,Ht,ye)}else He=We.indexBuffer,it=We.triangleSegments,Ae=pe?Yd(tn,Yt,f,Ne,ye,V):ya(tn,Yt,ye);f.uploadCommonUniforms(f.context,wt,xt.toUnwrapped());let Bt=le;(I==="road"&&!C||I==="offset")&&(Bt=te),wt.draw(f,$e,Bt,c||f.stencilModeForClipping(xt),b,In.disabled,Ae,_.id,We.layoutVertexBuffer,He,it,_.paint,f.transform.zoom,Ue,Lt)}};f.renderPass===O&&ue(f.depthModeForSublayer(1,f.renderPass==="opaque"?an.ReadWrite:an.ReadOnly),!1),Z==="none"&&f.renderPass==="translucent"&&_.paint.get("fill-antialias")&&ue(f.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly),!0)}function ic(l,t,r,c,f,g,_,v){r.resetLayerRenderingStats(l);const b=l.context,I=b.gl,C=l.transform,O=r.paint.get("fill-extrusion-pattern"),L=r.paint.get("fill-extrusion-pattern-cross-fade"),D=O.constantOr(null),V=O.constantOr(1),j=r.paint.get("fill-extrusion-opacity"),Z=l.style.enable3dLights(),q=r.paint.get(Z&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],ie=r.layout.get("fill-extrusion-edge-radius"),te=ie>0&&!r.paint.get("fill-extrusion-rounded-roof"),ye=te?0:ie,pe=C.projection.name==="globe"?s.eb():0,ge=C.projection.name==="globe",ue=ge?s.aj(C.zoom):0,le=[s.aF(C.center.lng),s.aJ(C.center.lat)],xe=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Re=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:r.lut).toArray01().slice(0,3),Ae=r.paint.get("fill-extrusion-flood-light-intensity"),$e=r.paint.get("fill-extrusion-vertical-scale"),He=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,it=r.paint.get("fill-extrusion-height-alignment"),xt=r.paint.get("fill-extrusion-base-alignment"),Ne=Zl(l,r.paint.get("fill-extrusion-cutoff-fade-range")),Ee=[];let We;ge&&Ee.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Ee.push("FAUX_AO"),te&&Ee.push("ZERO_ROOF_RADIUS"),v&&Ee.push("HAS_CENTROID"),Ae>0&&Ee.push("FLOOD_LIGHT"),Ne.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),He&&Ee.push("RENDER_WALL_MODE");const Ue=l.renderPass==="shadow",dt=l.shadowRenderer,Rt=Ue&&!!dt,Lt=Ue?In.disabled:In.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let At=[0,0,0];if(dt){const Yt=l.style.directionalLight,Bt=l.style.ambientLight;Yt&&Bt&&(At=ma(l.style,Yt,Bt)),Ue||(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),dt.useNormalOffset&&Ee.push("NORMAL_OFFSET")),We=Ee.concat(["SHADOWS_SINGLE_CASCADE"])}const wt=Rt?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",tn=r.getLayerRenderingStats();for(const Yt of c){const Bt=t.getTile(Yt),Ht=Bt.getBucket(r);if(!Ht||Ht.projection.name!==C.projection.name)continue;let _n=!1;dt&&(_n=dt.getMaxCascadeForTile(Yt.toUnwrapped())===0);const An=l.isTileAffectedByFog(Yt),si=Ht.programConfigurations.get(r.id);let Ri=!1;if(D&&Bt.imageAtlas){const Ii=Bt.imageAtlas,Gn=s.e3.from(D),zi=Gn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),_r=Gn.getSecondary(),ur=Ii.patternPositions.get(zi),Ci=_r?Ii.patternPositions.get(_r.scaleSelf(s.o.devicePixelRatio).toString()):null;Ri=!!ur&&!!Ci,ur&&si.setConstantPatternPositions(ur,Ci)}L>0&&(Ri||si.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ee.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Kt=l.getOrCreateProgram(wt,{config:si,defines:_n?We:Ee,overrideFog:An});if(l.terrain&&l.terrain.setupElevationDraw(Bt,Kt,{useMeterToDem:!0}),!Ht.centroidVertexBuffer){const Ii=Kt.getAttributeLocation(I,"a_centroid_pos");Ii!==-1&&I.vertexAttrib2f(Ii,0,0)}!Ue&&dt&&dt.setupShadows(Bt.tileID.toUnwrapped(),Kt,"vector-tile"),V&&(l.context.activeTexture.set(I.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),si.updatePaintBuffers());const wi=r.paint.get("fill-extrusion-vertical-gradient"),Mn=1/Ht.tileToMeter;let Ai;if(Ue&&dt){if(Va(Bt.tileID,Ht.maxHeight,l))continue;const Ii=dt.calculateShadowPassMatrixFromTile(Bt.tileID.toUnwrapped());Ai=Os(Ii,ye,Mn,$e,it,xt)}else{const Ii=l.translatePosMatrix(Yt.expandedProjMatrix,Bt,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Gn=C.projection.createInversionMatrix(C,Yt.canonical);Ai=V?na(Ii,l,wi,j,ee,ye,Mn,Yt,Bt,pe,it,xt,ue,le,Gn,Re,$e,L):Zu(Ii,l,wi,j,ee,ye,Mn,Yt,pe,it,xt,ue,le,Gn,Re,$e,Ae,At)}l.uploadCommonUniforms(b,Kt,Yt.toUnwrapped(),null,Ne);let ji=Ht.segments;if(C.projection.name==="mercator"&&!Ue&&(ji=Ht.getVisibleSegments(Bt.tileID,l.terrain,l.transform.getFrustum(0)),!ji.get().length))continue;if(tn)if(Ue)for(const Ii of ji.get())tn.numRenderedVerticesInShadowPass+=Ii.primitiveLength;else for(const Ii of ji.get())tn.numRenderedVerticesInTransparentPass+=Ii.primitiveLength;const Fi=[];(l.terrain||v)&&Fi.push(Ht.centroidVertexBuffer),ge&&Fi.push(Ht.layoutVertexExtBuffer),He&&Fi.push(Ht.wallVertexBuffer),Kt.draw(l,b.gl.TRIANGLES,f,g,_,Lt,Ai,r.id,Ht.layoutVertexBuffer,Ht.indexBuffer,ji,r.paint,l.transform.zoom,si,Fi)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}class tf{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function il(l,t,r,c,f,g,_,v,b,I,C,O,L,D,V,j,Z,q,ee,ie){const te=t.context,ye=te.gl,pe=t.transform,ge=t.transform.zoom,ue=[],le=l.translate,xe=l.translateAnchor,Re=l.edgeRadius,Ae=Zl(t,l.cutoffFadeRange);C==="clear"?(ue.push("CLEAR_SUBPASS"),ie&&(ue.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(ye.TEXTURE0),ie.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):C==="sdf"?ue.push("SDF_SUBPASS"):C==="emissive"&&(ue.push("USE_MRT1"),te.activeTexture.set(ye.TEXTURE0),ie.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)),q&&ue.push("HAS_CENTROID"),Ae.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");const $e=(He,it,xt,Ne,Ee)=>{let We=ue;it.groundRadiusBuffer!=null&&(We=ue.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ue=it.programConfigurations.get(c.id),dt=t.isTileAffectedByFog(He),Rt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:We,overrideFog:dt}),Lt=zr(t,Ne,O,I,Ee,[L,D*Ee],V,j,Z,ge>=17?0:Re*Ee,ie?ie.size[0]:0),At=[];q&&At.push(it.hiddenByLandmarkVertexBuffer),it.groundRadiusBuffer!=null&&At.push(it.groundRadiusBuffer),t.uploadCommonUniforms(te,Rt,He.toUnwrapped(),null,Ae),Rt.draw(t,te.gl.TRIANGLES,g,_,v,b,Lt,c.id,it.vertexBuffer,it.indexBuffer,xt,c.paint,ge,Ue,At)};for(const He of f){const it=r.getTile(He),xt=it.getBucket(c);if(!xt||xt.projection.name!==pe.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const Ne=xt.groundEffect,Ee=1/xt.tileToMeter;{const We=t.translatePosMatrix(He.projMatrix,it,le,xe),Ue=Ne.getDefaultSegment();$e(He,Ne,Ue,We,Ee)}if(ee)for(let We=0;We<4;We++){const Ue=s.e9[We](He),dt=r.getTile(Ue);if(!dt)continue;const Rt=dt.getBucket(c);if(!Rt||Rt.projection.name!==pe.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const Lt=Rt.groundEffect;let At,wt;We===0?(At=[-s.al,0,0],wt=1):We===1?(At=[s.al,0,0],wt=0):We===2?(At=[0,-s.al,0],wt=3):(At=[0,s.al,0],wt=2);const tn=Lt.regionSegments[wt];if(!tn)continue;const Yt=new Float32Array(16);s.br(Yt,He.projMatrix,At),$e(He,Lt,tn,t.translatePosMatrix(Yt,it,le,xe),Ee)}}}function po(l,t,r,c,f,g,_){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const v=g?g.findDEMTileFor(r):null;if(!(v&&v.dem||_))return;g&&v&&v.dem&&c.selfDEMTileTimestamp!==v.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=v.dem._timestamp);const b=q=>new s.P(Math.ceil((q+s.ed)*s.ee),0),I=q=>{const ee=t.getSource().minzoom,ie=ye=>{const pe=t.getTileByID(ye);if(pe&&pe.hasData())return pe.getBucket(f)},te=[0,-1,1];for(const ye of te){if(q.overscaledZ+ye<ee)continue;const pe=ie(q.calculateScaledKey(q.overscaledZ+ye));if(pe)return pe}},C=[0,0,0],O=(q,ee)=>(C[0]=Math.min(q.min.y,ee.min.y),C[1]=Math.max(q.max.y,ee.max.y),C[2]=s.al-ee.min.x>q.max.x?ee.min.x-s.al:q.max.x,C),L=(q,ee)=>(C[0]=Math.min(q.min.x,ee.min.x),C[1]=Math.max(q.max.x,ee.max.x),C[2]=s.al-ee.min.y>q.max.y?ee.min.y-s.al:q.max.y,C),D=[(q,ee)=>O(q,ee),(q,ee)=>O(ee,q),(q,ee)=>L(q,ee),(q,ee)=>L(ee,q)],V=(q,ee,ie,te,ye,pe,ge)=>{if(!g)return 0;const ue=[[pe?ie:q,pe?q:ie,0],[pe?ie:ee,pe?ee:ie,0]],le=ge<0?s.al+ge:ge,xe=[pe?le:(q+ee)/2,pe?(q+ee)/2:le,0];return ie===0&&ge<0||ie!==0&&ge>0?g.getForTilePoints(ye,[xe],!0,te):ue.push(xe),g.getForTilePoints(r,ue,!0,v),Math.max(ue[0][2],ue[1][2],xe[2])/g.exaggeration()};for(let q=0;q<4;q++){const ee=c.borderFeatureIndices[q];if(ee.length===0)continue;const ie=s.e9[q](r),te=I(ie);if(!(te&&te instanceof s.ea))continue;const ye=g?g.findDEMTileFor(ie):null;if(!(ye&&ye.dem||_)||(g&&ye&&ye.dem&&c.borderDEMTileTimestamp[q]!==ye.dem._timestamp&&(c.borderDoneWithNeighborZ[q]=-1,c.borderDEMTileTimestamp[q]=ye.dem._timestamp),c.borderDoneWithNeighborZ[q]===te.canonical.z))continue;te.centroidVertexArray.length===0&&te.createCentroidsBuffer();const pe=(q<2?1:5)-q,ge=te.borderDoneWithNeighborZ[pe]!==c.canonical.z,ue=te.borderFeatureIndices[pe];let le=0;if(c.canonical.z!==te.canonical.z){for(const xe of ee)c.showCentroid(c.featuresOnBorder[xe]);if(ge)for(const xe of ue)te.showCentroid(te.featuresOnBorder[xe]);c.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[pe]=c.canonical.z}for(const xe of ee){const Re=c.featuresOnBorder[xe],Ae=c.centroidData[Re.centroidDataIndex],$e=Re.borders[q];let He;for(;le<ue.length;){He=te.featuresOnBorder[ue[le]];const it=He.borders[pe];if(it[1]>$e[0]+3||it[0]>$e[0]-3)break;te.showCentroid(He),le++}if(He&&le<ue.length){const it=le;let xt=0;for(;!(He.borders[pe][0]>$e[1]-3)&&(xt++,++le!==ue.length);)He=te.featuresOnBorder[ue[le]];He=te.featuresOnBorder[ue[it]];let Ne=!1;if(xt>=1){const Ue=He.borders[pe];Math.abs($e[0]-Ue[0])<3&&Math.abs($e[1]-Ue[1])<3&&(xt=1,Ne=!0,le=it+1)}else if(xt===0){c.showCentroid(Re);continue}const Ee=te.centroidData[He.centroidDataIndex];_&&Ne&&(((j=Ae).flags|(Z=Ee).flags)&s.ec?(j.flags|=s.ec,Z.flags|=s.ec):(j.flags&=~s.ec,Z.flags&=~s.ec));const We=Re.intersectsCount()>1||He.intersectsCount()>1;if(xt>1)le=it,Ae.centroidXY=Ee.centroidXY=new s.P(0,0);else if(ye&&ye.dem&&!We){const Ue=D[q](Ae,Ee),dt=q%2?s.al-1:0,Rt=V(Ue[0],Math.min(s.al-1,Ue[1]),dt,ye,ie,q<2,Ue[2]);Ae.centroidXY=Ee.centroidXY=b(Rt)}else We?Ae.centroidXY=Ee.centroidXY=new s.P(0,0):(Ae.centroidXY=c.encodeBorderCentroid(Re),Ee.centroidXY=te.encodeBorderCentroid(He));c.writeCentroidToBuffer(Ae),te.writeCentroidToBuffer(Ee)}else c.showCentroid(Re)}c.borderDoneWithNeighborZ[q]=te.canonical.z,te.borderDoneWithNeighborZ[pe]=c.canonical.z}var j,Z;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const as=[1,0,0],Yh=[0,1,0],Ko=[0,0,1];function Va(l,t,r){const c=r.transform,f=r.shadowRenderer;if(!f)return!0;const g=l.toUnwrapped(),_=c.tileSize*f._cascades[r.currentShadowCascade].scale;let v=t;if(c.elevation){const j=c.elevation.getMinMaxForTile(l);j&&(v+=j.max)}const b=[...f.shadowDirection];b[2]=-b[2];const I=f.computeSimplifiedTileShadowVolume(g,v,_,b);if(!I)return!1;const C=[as,Yh,Ko,b,[b[0],0,b[2]],[0,b[1],b[2]]],O=c.projection.name==="globe",L=c.scaleZoom(_),D=s.cB.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,L,!O),V=f.getCurrentCascadeFrustum();return D.intersectsPrecise(I.vertices,I.planes,C)===0||V.intersectsPrecise(I.vertices,I.planes,C)===0}function tu(l){const{painter:t,source:r,layer:c,coords:f}=l;let g=l.defines;const _=t.context,v=t.renderPass==="shadow",b=t.renderPass==="light-beam",I=t.shadowRenderer,C=s.ef(t.transform.center.lat,t.transform.zoom),O=Zl(t,c.paint.get("building-cutoff-fade-range"));O.shouldRenderCutoff&&(g=g.concat("RENDER_CUTOFF")),l.floodLightIntensity>0&&(g=g.concat("FLOOD_LIGHT"));for(const L of f){const D=r.getTile(L),V=D.getBucket(c);if(!V)continue;I&&I.getMaxCascadeForTile(L.toUnwrapped())===0&&(g=g.concat("SHADOWS_SINGLE_CASCADE"));const j=V.programConfigurations.get(c.id);let Z,q,ee,ie=t.translatePosMatrix(L.expandedProjMatrix,D,[0,0],"map");if(ie=s.cS(s.bC(),ie,[1,1,l.verticalScale]),v&&I){if(Va(D.tileID,V.maxHeight*C,t))continue;let ye=I.calculateShadowPassMatrixFromTile(D.tileID.toUnwrapped());ye=s.cS(s.bC(),ye,[1,1,l.verticalScale]),ee=va(ye),Z=q=t.getOrCreateProgram("buildingDepth",{config:j,defines:g,overrideFog:!1})}else if(b)Z=q=t.getOrCreateProgram("buildingBloom",{config:j,defines:g,overrideFog:!1}),ee=Hf(ie);else{const ye=t.transform.calculatePosMatrix(L.toUnwrapped(),t.transform.worldSize);s.cS(ye,ye,[1,1,l.verticalScale]);const pe=s.bC();s.cS(pe,ye,[1,-1,1/C]),s.bl(pe,pe),s.eg(pe,pe);const ge=t.transform.getFreeCameraOptions().position,ue=1<<L.canonical.z;if(ee=Kc(ie,pe,l.opacity,l.facadeAOIntensity,[((ge.x-L.wrap)*ue-L.canonical.x)*s.al,(ge.y*ue-L.canonical.y)*s.al,ge.z*ue*s.al],V.tileToMeter,l.facadeEmissiveChance,l.floodLightColor,l.floodLightIntensity),q=t.getOrCreateProgram("building",{config:j,defines:g,overrideFog:!1}),l.depthOnly===!0)Z=q;else{const le=g.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);Z=t.getOrCreateProgram("building",{config:j,defines:le,overrideFog:!1})}I&&(I.setupShadowsFromMatrix(ye,q,!0),Z!==q&&I.setupShadowsFromMatrix(ye,Z,!0))}const te=(ye,pe)=>{if(b){const ge=ye.entranceBloom;pe.draw(t,_.gl.TRIANGLES,l.depthMode,Pn.disabled,l.blendMode,In.disabled,ee,c.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segmentsBucket,c.paint,t.transform.zoom,j,[ge.layoutAttenuationBuffer,ge.layoutColorBuffer])}else{const ge=ye.segmentsBucket;let ue=[ye.layoutNormalBuffer,ye.layoutCentroidBuffer,ye.layoutColorBuffer,ye.layoutFloodLightDataBuffer];ye.layoutFacadePaintBuffer&&(ue=ue.concat([ye.layoutFacadeDataBuffer,ye.layoutFacadeVerticalRangeBuffer,ye.layoutFacadePaintBuffer])),pe.draw(t,_.gl.TRIANGLES,l.depthMode,Pn.disabled,l.blendMode,v?In.disabled:In.backCW,ee,c.id,ye.layoutVertexBuffer,ye.indexBuffer,ge,c.paint,t.transform.zoom,j,ue)}};t.uploadCommonUniforms(_,q,L.toUnwrapped(),null,O),V.buildingWithoutFacade&&te(V.buildingWithoutFacade,q),V.buildingWithFacade&&(Z!==q&&t.uploadCommonUniforms(_,Z,L.toUnwrapped(),null,O),te(V.buildingWithFacade,Z))}}function zl(l,t,r,c,f,g,_,v,b,I,C,O,L){const D=l.context.gl,V=l.depthModeForSublayer(1,an.ReadOnly,D.LEQUAL,!0),j=.1*(1-(Z=C))+3*Z;var Z;const q=l._showOverdrawInspector,ee=O,ie=new tf;q||il(ie,l,t,r,c,V,new Pn({func:D.ALWAYS,mask:255},255,255,D.KEEP,D.KEEP,D.REPLACE),new On([D.ONE,D.ONE,D.ONE,D.ONE],s.ao.transparent,[!1,!1,!1,!0],D.MIN),In.disabled,f,"sdf",g,_,v,b,I,j,ee,!1);{const te=q?Pn.disabled:new Pn({func:D.EQUAL,mask:255},255,255,D.KEEP,D.DECR,D.DECR),ye=q?l.colorModeForRenderPass():new On([D.ONE_MINUS_DST_ALPHA,D.DST_ALPHA,D.ONE,D.ONE],s.ao.transparent,[!0,!0,!0,!0]);il(ie,l,t,r,c,V,te,ye,In.disabled,f,"color",g,_,v,b,I,j,ee,!1)}}function Xr(l){return[l[0]*s.eh,l[1]*s.eh,l[2]*s.eh,0]}function mo(l,t,r,c,f,g,_,v,b){const I=c.getSource(),C=r.globeSharedBuffers;if(!C)return;let O,L,D;if(t&&(O=c.getTile(t)),I instanceof s.aU?(L=I.texture,D=s.dK(0,0,r.transform)):O&&t&&(L=O.texture,D=s.dK(t.canonical.z,t.canonical.x,r.transform)),!L||!D)return;l||(D=s.cS(s.bC(),D,[1,-1,1]));const V=r.context,j=V.gl,Z=f.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR,q=r.colorModeForDrapableLayerRenderPass(g),ee=_.defines;ee.push("GLOBE_POLES");const ie=new an(j.LEQUAL,an.ReadWrite,r.depthRangeFor3D),te=Float32Array.from(r.transform.expandedFarZProjMatrix),ye=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),L.bind(Z,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),L.bind(Z,j.CLAMP_TO_EDGE),"useMipmap"in L&&V.extTextureFilterAnisotropic&&r.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const[pe,ge,ue,le]=t?C.getPoleBuffers(t.canonical.z,!1):C.getPoleBuffers(0,!0),xe=f.paint.get("raster-elevation");let Re;l?(Re=pe,r.renderDefaultNorthPole=xe!==0):(Re=ge,r.renderDefaultSouthPole=xe!==0);const Ae=Xr(_.mix),$e=((it,xt,Ne,Ee,We,Ue,dt,Rt,Lt,At,wt,tn,Yt)=>Jc(it,xt,Ne,new Float32Array(16),new Float32Array(9),[0,0],Ee,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],Rt,2,At,wt,tn,1,0,Yt))(te,ye,D,s.aj(r.transform.zoom),0,f,0,xe,0,Ae,_.offset,_.range,g),He=r.getOrCreateProgram("raster",{defines:ee});r.uploadCommonUniforms(V,He,null),He.draw(r,j.TRIANGLES,ie,b,q,v,$e,f.id,Re,ue,le)}function jo(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,f=.2*l.height,g=t+f;return[t,r,(g-f-t)/c,(g-t)/c]}function Ua(l,t,r,c){if(l)return t instanceof Oo&&l instanceof Cd?t.getTextureDescriptor(l,r,!0):{texture:l.texture,mix:Xr(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Xi=s.ei([{name:"a_index",type:"Int16",components:1}]);class Sc{constructor(t,r,c,f){const g={width:c[0],height:c[1],data:null},_=t.gl;this.targetColorTexture=new s.T(t,g,_.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,g,_.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,f),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,f=r.width*r.height;this.particleTexture0=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1});const g=new s.ej;g.reserve(f);for(let _=0;_<f;_++)g.emplaceBack(_);this.particleIndexBuffer=this.context.createVertexBuffer(g,Xi.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Zf(l,t,r){if(!l)return null;const c=t.getTextureDescriptor(l,r,!0);if(!c)return null;let{texture:f,mix:g,offset:_,tileSize:v,buffer:b,format:I}=c;if(!f||!I)return null;let C=!1;return I==="uint32"&&(C=!0,g[3]=0,g=Wh(s.ek,g,[0,r.paint.get("raster-particle-max-speed")]),_=qh(s.ek,_,[0,r.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[b/(v+2*b),v/(v+2*b)],tileSize:v,scalarData:C,scale:g,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[I]]}}function ls(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,f=.2*l.height,g=t+f;return[t,r,(g-f-t)/c,(g-t)/c]}const nf=new s.ao(1,0,0,1),rf=new s.ao(0,1,0,1),of=new s.ao(0,0,1,1),vs=new s.ao(1,0,1,1),Jo=new s.ao(0,1,1,1);function Tt(l,t,r,c,f,g){for(let _=0;_<r.length;_++)if(f){const I=new s.ao(c.r*.8,c.g*.8,c.b*.8,1);Dt(l,t,r[_],c,-1,-1,g),Dt(l,t,r[_],c,-1,1,g),Dt(l,t,r[_],c,1,1,g),Dt(l,t,r[_],c,1,-1,g),Dt(l,t,r[_],I,0,0,g)}else Dt(l,t,r[_],c,0,0,g)}function Dt(l,t,r,c,f,g,_){const v=l.context,b=l.transform,I=v.gl,C=b.projection.name==="globe",O=C?["PROJECTION_GLOBE_VIEW"]:[];let L=s.bz(r.projMatrix);if(C&&s.aj(b.zoom)>0){const Ae=s.bj(r.canonical,b),$e=s.el(Ae);L=s.aB(new Float32Array(16),b.globeMatrix,$e),s.aB(L,b.projMatrix,L)}const D=s.bC();D[12]+=2*f/(s.o.devicePixelRatio*b.width),D[13]+=2*g/(s.o.devicePixelRatio*b.height),s.aB(L,D,L);const V=l.getOrCreateProgram("debug",{defines:O}),j=t.getTileByID(r.key);l.terrain&&l.terrain.setupElevationDraw(j,V);const Z=an.disabled,q=Pn.disabled,ee=l.colorModeForRenderPass(),ie="$debug";v.activeTexture.set(I.TEXTURE0),l.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),C?j._makeGlobeTileDebugBuffers(l.context,b):j._makeDebugTileBoundsBuffers(l.context,b.projection);const te=j._tileDebugBuffer||l.debugBuffer,ye=j._tileDebugIndexBuffer||l.debugIndexBuffer,pe=j._tileDebugSegments||l.debugSegments;if(V.draw(l,I.LINE_STRIP,Z,q,ee,In.disabled,$h(L,c.toPremultipliedRenderColor(null)),ie,te,ye,pe,null,null,null,[j._globeTileDebugBorderBuffer]),_){const Ae=j.latestRawTileData,$e=Math.floor((Ae&&Ae.byteLength||0)/1024);let He=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(He+=` => ${r.overscaledZ}`),He+=` ${j.state}`,He+=` ${$e}kb`,(function(it,xt){it.initDebugOverlayCanvas();const Ne=it.debugOverlayCanvas,Ee=it.context.gl,We=it.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,Ne.width,Ne.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(xt,5,5),We.strokeText(xt,5,5),it.debugOverlayTexture.update(Ne),it.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)})(l,He)}const ge=t.getTile(r).tileSize,ue=512/Math.min(ge,512)*(r.overscaledZ/b.zoom)*.5,le=j._tileDebugTextBuffer||l.debugBuffer,xe=j._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Re=j._tileDebugTextSegments||l.debugSegments;V.draw(l,I.TRIANGLES,Z,q,On.alphaBlended,In.disabled,$h(L,s.ao.transparent.toPremultipliedRenderColor(null),ue),ie,le,xe,Re,null,null,null,[j._globeTileDebugTextBuffer])}function rc(l,t,r,c){Le(l,0,t+r/2,l.transform.width,r,c)}function Tr(l,t,r,c){Le(l,t-r/2,0,r,l.transform.height,c)}function Le(l,t,r,c,f,g){const _=l.context,v=_.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*s.o.devicePixelRatio,r*s.o.devicePixelRatio,c*s.o.devicePixelRatio,f*s.o.devicePixelRatio),_.clear({color:g}),v.disable(v.SCISSOR_TEST)}const Xf=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Kh}=Xf;function rl(l,t,r,c){l.emplaceBack(t,r,c)}class Jh{constructor(t){this.vertexArray=new s.em,this.indices=new s.b0,rl(this.vertexArray,-1,-1,1),rl(this.vertexArray,1,-1,1),rl(this.vertexArray,-1,1,1),rl(this.vertexArray,1,1,1),rl(this.vertexArray,-1,-1,-1),rl(this.vertexArray,1,-1,-1),rl(this.vertexArray,-1,1,-1),rl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Kh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function Ec(l,t,r,c,f,g){const _=l.context.gl,v=t.paint.get("sky-atmosphere-color"),b=t.paint.get("sky-atmosphere-halo-color"),I=t.paint.get("sky-atmosphere-sun-intensity"),C=((O,L,D,V,j)=>({u_matrix_3f:O,u_sun_direction:L,u_sun_intensity:D,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(s.eo(s.dO(),c),f,I,v.toPremultipliedRenderColor(null),b.toPremultipliedRenderColor(null));_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),r.draw(l,_.TRIANGLES,an.disabled,Pn.disabled,On.unblended,In.frontCW,C,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Yf=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ll{constructor(t){const r=new s.ep;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const c=new s.b0;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Yf.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pp=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class sf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Qh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new On([1,Ja,1,Ja],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new On([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new sf,this.updateNeeded=!0}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ll(r);const c=this.params.sizeRange,f=this.params.intensityRange,g=(function(C){const O=s.eq(30),L=[];for(let D=0;D<C;++D){const V=2*Math.PI*O(),j=Math.acos(1-2*O())-.5*Math.PI;L.push(s.d5(Math.cos(j)*Math.cos(V),Math.cos(j)*Math.sin(V),Math.sin(j)))}return L})(this.params.starsCount),_=s.eq(300),v=new s.er,b=new s.b0;let I=0;for(let C=0;C<g.length;++C){const O=s.c5([],g[C],200),L=Math.max(0,1+.01*c*(1*_()-.5)),D=Math.max(0,1+.01*f*(1*_()-.5));v.emplaceBack(O[0],O[1],O[2],-1,-1,L,D),v.emplaceBack(O[0],O[1],O[2],1,-1,L,D),v.emplaceBack(O[0],O[1],O[2],1,1,L,D),v.emplaceBack(O[0],O[1],O[2],-1,1,L,D),b.emplaceBack(I+0,I+1,I+2),b.emplaceBack(I+0,I+2,I+3),I+=4}this.starsVx=r.createVertexBuffer(v,Pp.members),this.starsIdx=r.createIndexBuffer(b),this.starsSegments=s.bg.simpleSegment(0,0,v.length,b.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const c=t.context,f=c.gl,g=t.transform,_=new an(f.LEQUAL,an.ReadOnly,[0,1]),v=s.aj(g.zoom),b=t.style.getLut(r.scope),I=r.properties.get("color-use-theme")==="none",C=r.properties.get("color").toNonPremultipliedRenderColor(I?null:b),O=r.properties.get("high-color-use-theme")==="none",L=r.properties.get("high-color").toNonPremultipliedRenderColor(O?null:b),D=r.properties.get("space-color-use-theme")==="none",V=r.properties.get("space-color").toNonPremultipliedRenderColor(D?null:b),j=5e-4,Z=s.es(r.properties.get("horizon-blend"),0,1,j,.25),q=s.dE(t,c,g)&&Z===j?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,ee=t.frameCounter/1e3%1,ie=s.ag(g.globeCenterInViewSpace),te=Math.sqrt(Math.pow(ie,2)-Math.pow(q,2)),ye=Math.acos(te/ie),pe=ge=>{const ue=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ge&&ue.push("ALPHA_PASS");const le=t.getOrCreateProgram("globeAtmosphere",{defines:ue}),xe=((Ae,$e,He,it,xt,Ne,Ee,We,Ue,dt,Rt,Lt)=>({u_frustum_tl:Ae,u_frustum_tr:$e,u_frustum_br:He,u_frustum_bl:it,u_horizon:xt,u_transition:Ne,u_fadeout_range:Ee,u_atmosphere_fog_color:We.toArray01(),u_high_color:Ue.toArray01(),u_space_color:dt.toArray01(),u_temporal_offset:Rt,u_horizon_angle:Lt}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,v,Z,C,L,V,ee,ye);t.uploadCommonUniforms(c,le);const Re=this.atmosphereBuffer;Re&&le.draw(t,f.TRIANGLES,_,Pn.disabled,ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,In.backCW,xe,ge?"atmosphere_glow_alpha":"atmosphere_glow",Re.vertexBuffer,Re.indexBuffer,Re.segments)};pe(!1),pe(!0)}drawStars(t,r){const c=s.aA(r.properties.get("star-intensity"),0,1);if(c===0)return;const f=t.context,g=f.gl,_=t.transform,v=t.getOrCreateProgram("stars"),b=s.c7([]);s.c9(b,b,-_._pitch),s.c8(b,b,-_.angle),s.c9(b,b,s.an(_._center.lat)),s.et(b,b,-s.an(_._center.lng));const I=s.cc(new Float32Array(16),b),C=s.aB([],_.starsProjMatrix,I),O=s.eo([],I),L=s.eu([],O),D=[0,1,0];s.dQ(D,D,L),s.c5(D,D,this.params.sizeMultiplier);const V=[1,0,0];s.dQ(V,V,L),s.c5(V,V,this.params.sizeMultiplier);const j=(Z=D,q=V,ee=c,{u_matrix:Float32Array.from(C),u_up:Z,u_right:q,u_intensity_multiplier:ee});var Z,q,ee;t.uploadCommonUniforms(f,v),this.starsVx&&this.starsIdx&&v.draw(t,g.TRIANGLES,an.disabled,Pn.disabled,this.colorModeAlphaBlendedWriteRGB,In.disabled,j,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ed{constructor(){this.visibleTiles=[]}updateBorders(t,r){const c=[],f=[],g=t._getRenderableCoordinates(!1,!0);for(const b of g){const I=t.getTile(b);if(!I.hasData())continue;const C=I.getBucket(r);C&&(C.isEmpty()||(c.push(b.key),f.push({bucket:C,tileID:b.canonical})))}let _=c.length!==this.visibleTiles.length;if(!_){c.sort();for(let b=0;b<c.length;b++)if(c[b]!==this.visibleTiles[b]){_=!0;break}}if(!_)return;const v=new Set;this.visibleTiles=c,f.sort(((b,I)=>b.tileID.z-I.tileID.z||b.tileID.x-I.tileID.x||b.tileID.y-I.tileID.y));for(const b of f){const I=new Array,C=new Array,O=b.bucket;for(const L of O.featuresOnBorder)v.has(L.featureId)?C.push(L.footprintIndex):(v.add(L.featureId),I.push(L.footprintIndex));O.updateFootprintHiddenFlags(I,s.ev,!1),O.updateFootprintHiddenFlags(C,s.ev,!0)}}}function th(l,t){const r=[...l],c=t.cameraWorldSizeForFog/t.worldSize,f=s.bA([]);return s.cS(f,f,[c,c,1]),s.aB(r,f,r),s.aB(r,t.worldToFogMatrix,r),r}function td(l,t,r,c,f){const g=r.material,_=c.context,{baseColorTexture:v,metallicRoughnessTexture:b}=g.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:C,emissionTexture:O}=g;function L(V,j,Z){if(V&&(l.push(j),_.activeTexture.set(_.gl.TEXTURE0+Z),V.gfxTexture)){const{minFilter:q,magFilter:ee,wrapS:ie,wrapT:te}=V.sampler;V.gfxTexture.bindExtraParam(q,ee,ie,te)}}L(v,"HAS_TEXTURE_u_baseColorTexture",fo.BaseColor),L(b,"HAS_TEXTURE_u_metallicRoughnessTexture",fo.MetallicRoughness),L(I,"HAS_TEXTURE_u_normalTexture",fo.Normal),L(C,"HAS_TEXTURE_u_occlusionTexture",fo.Occlusion),L(O,"HAS_TEXTURE_u_emissionTexture",fo.Emission),f&&(f.texture||(f.texture=new s.d$(c.context,f.image,[f.image.height,f.image.height,f.image.height],_.gl.RGBA8)),_.activeTexture.set(_.gl.TEXTURE0+fo.LUT),f.texture&&f.texture.bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(l.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||l.push("DIFFUSE_SHADED");const D=c.shadowRenderer;D&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),D.useNormalOffset&&l.push("NORMAL_OFFSET"))}function nd(l,t,r,c,f,g){const _=l.modelOpacity,v=t.context,b=new an(t.context.gl.LEQUAL,l.isLightMesh?an.ReadOnly:an.ReadWrite,t.depthRangeFor3D),I=t.transform,C=l.mesh,O=C.material,L=O.pbrMetallicRoughness,D=t.style.fog;let V;V=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:s.aB([],c.zScaleMatrix,l.nodeModelMatrix),s.aB(V,c.negCameraPosMatrix,V);const j=s.bl([],V);s.eg(j,j);const Z=r.paint.get("model-color-use-theme").constantOr("default")==="none",q=r.paint.get("model-emissive-strength").constantOr(0),ee=ba(new Float32Array(l.worldViewProjection),new Float32Array(V),new Float32Array(j),null,t,_,L.baseColorFactor,O.emissiveFactor,L.metallicFactor,L.roughnessFactor,O,q,r,void 0,void 0,l.materialOverride,l.modelColor),ie={defines:[]},te=[],ye=t.shadowRenderer;ye&&(ye.useNormalOffset=!1),td(ie.defines,te,C,t,Z?null:r.lut);let pe=null;if(D){const le=th(l.nodeModelMatrix,t.transform);if(pe=new Float32Array(le),I.projection.name!=="globe"){const xe=C.aabb.min,Re=C.aabb.max,[Ae,$e]=D.getOpacityForBounds(le,xe[0],xe[1],Re[0],Re[1]);ie.overrideFog=Ae>=lt||$e>=lt}}const ge=Zl(t,r.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&ie.defines.push("RENDER_CUTOFF");const ue=t.getOrCreateProgram("model",ie);t.uploadCommonUniforms(v,ue,null,pe,ge),t.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(l.nodeModelMatrix,ue),ue.draw(t,v.gl.TRIANGLES,b,f,g,C.material.doubleSided?In.disabled:In.backCCW,ee,r.id,C.vertexBuffer,C.indexBuffer,C.segments,r.paint,t.transform.zoom,void 0,te)}function nh(l,t){return l.style._importedAsBasemap?"basemap":t.scope}function Ic(l,t,r,c,f,g,_,v,b,I){const C=l.transform,O=!!t.isGeometryBloom&&t.isGeometryBloom;if(O&&l.renderPass==="shadow")return;const L=C.projection.name==="globe"?s.eD(r,C):[...r];s.aB(L,L,t.globalMatrix);const D=s.aB([],c,L);if(t.meshes)for(const V of t.meshes){const j=v.get(V.material.name);if(j&&j.opacity<=0)continue;if(V.material.alphaMode!=="BLEND"){_.push({mesh:V,depth:0,modelIndex:f,worldViewProjection:D,nodeModelMatrix:L,isLightMesh:O,materialOverride:j,modelOpacity:b,modelColor:I});continue}const Z=s.af([],V.centroid,D);!C.isOrthographic&&Z[2]<=0||g.push({mesh:V,depth:Z[2],modelIndex:f,worldViewProjection:D,nodeModelMatrix:L,isLightMesh:O,materialOverride:j,modelOpacity:b,modelColor:I})}if(t.children)for(const V of t.children)Ic(l,V,r,c,f,g,_,v,b,I)}function Ta(l,t,r,c){const f=r.shadowRenderer;if(!f)return;const g=f.getShadowPassDepthMode(),_=f.getShadowPassColorMode(),v=f.calculateShadowPassMatrixFromMatrix(t),b=Zh(v);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,g,Pn.disabled,_,In.disabled,b,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,r.transform.zoom,void 0,void 0)}function Kf(l,t,r,c,f,g){for(const _ of f){const v=Object.assign({},c);v.part=_;const b={type:"Unknown",id:t,properties:v},I={orientation:l.paint.get("model-rotation").evaluate(b,r)};g.set(_,I)}}function Jf(l,t,r,c,f,g){for(const _ of f){const v=Object.assign({},c);v.part=_;const b={type:"Unknown",id:t,properties:v},I={color:l.paint.get("model-color").evaluate(b,r),colorMix:l.paint.get("model-color-mix-intensity").evaluate(b,r),opacity:l.paint.get("model-opacity").evaluate(b,r),emissionStrength:l.paint.get("model-emissive-strength").evaluate(b,r)};g.set(_,I)}}function Qf(l,t,r,c,f){let g=!1;for(const v of c)v.modelOpacity!==1&&(nd(v,l,t,f[v.modelIndex],Pn.disabled,On.disabled),g=!0);for(const v of c)nd(v,l,t,f[v.modelIndex],v.modelOpacity!==1?l.stencilModeFor3D():Pn.disabled,l.colorModeForRenderPass());g&&l.resetStencilClippingMasks();const _=On.additive;for(const v of r)nd(v,l,t,f[v.modelIndex],Pn.disabled,v.isLightMesh?_:l.colorModeForRenderPass())}function Rp(l,t,r){const c=t.updateZoomBasedPaintProperties(),f=(function(g,_,v){let b,I,C,O=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&O>0){const L=g.terrain,D=L.findDEMTileFor(v);D&&D.dem?b=s.eF.create(L,v,D):O=0}if(O===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),O===_.validForExaggeration&&(O===0||b&&b._demTile&&b._demTile.tileID===_.validForDEMTile.id&&b._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const L in _.instancesPerModel){const D=_.instancesPerModel[L];for(let V=0;V<D.instancedDataArray.length;++V){const j=(b?O*b.getElevationAt(0|D.instancedDataArray.float32[16*V],0|D.instancedDataArray.float32[16*V+1],!0,!0):0)+D.instancesEvaluatedElevation[V];D.instancedDataArray.float32[16*V+6]=j,I=I?Math.min(_.terrainElevationMin,j):j,C=C?Math.max(_.terrainElevationMax,j):j}}return _.terrainElevationMin=I||0,_.terrainElevationMax=C||0,_.validForExaggeration=O,_.validForDEMTile=b&&b._demTile?{id:b._demTile.tileID,timestamp:b._dem._timestamp}:{id:void 0,timestamp:0},!0})(l,t,r);(c||f)&&(t.uploaded=!1,t.upload(l.context))}const ol={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function xs(l,t){const r=1<<l.canonical.z,c=t.getFreeCameraOptions().position,f=t.elevation,g=l.canonical.x/r,_=(l.canonical.x+1)/r,v=l.canonical.y/r,b=(l.canonical.y+1)/r;let I=t._centerAltitude;if(f){const D=f.getMinMaxForTile(l);D&&D.max>I&&(I=D.max)}const C=s.aA(c.x,g,_)-c.x,O=s.aA(c.y,v,b)-c.y,L=s.cf(I,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(C*C+O*O+L*L))}function kp(l,t,r,c,f,g,_){const v=l.context,b=l.renderPass==="shadow",I=l.shadowRenderer,C=b&&I?I.getShadowPassDepthMode():new an(v.gl.LEQUAL,an.ReadWrite,l.depthRangeFor3D),O=l.isTileAffectedByFog(g),L=l.transform.projection.name==="globe";if(r.meshes)for(const D of r.meshes){const V=L?[]:["MODEL_POSITION_ON_GPU"],j=[];let Z,q,ee;const ie=!L&&c.instancedDataArray.length>20;ie&&V.push("INSTANCED_ARRAYS");const te=Zl(l,t.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),b&&I)Z=l.getOrCreateProgram("modelDepth",{defines:V}),q=Zh(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(r.globalMatrix)),ee=I.getShadowPassColorMode();else{td(V,j,D,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Z=l.getOrCreateProgram("model",{defines:V,overrideFog:O});const pe=D.material,ge=pe.pbrMetallicRoughness,ue=t.paint.get("model-opacity").constantOr(1),le=t.paint.get("model-emissive-strength").constantOr(0);q=ba(g.expandedProjMatrix,Float32Array.from(r.globalMatrix),new Float32Array(16),null,l,ue,ge.baseColorFactor,pe.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,pe,le,t,f),I&&(_.shadowUniformsInitialized?Z.setShadowUniformValues(v,I.getShadowUniformValues()):(I.setupShadows(g.toUnwrapped(),Z,"model-tile"),_.shadowUniformsInitialized=!0)),ee=te.shouldRenderCutoff||ue<1||pe.alphaMode!=="OPAQUE"?On.alphaBlended:On.unblended}l.uploadCommonUniforms(v,Z,g.toUnwrapped(),null,te);const ye=D.material.doubleSided?In.disabled:In.backCCW;if(ie)j.push(c.instancedDataBuffer),Z.draw(l,v.gl.TRIANGLES,C,Pn.disabled,ee,ye,q,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,l.transform.zoom,void 0,j,c.instancedDataArray.length);else{const pe=b?"u_instance":"u_normal_matrix";for(let ge=0;ge<c.instancedDataArray.length;++ge)q[pe]=new Float32Array(c.instancedDataArray.arrayBuffer,64*ge,16),Z.draw(l,v.gl.TRIANGLES,C,Pn.disabled,ee,ye,q,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,l.transform.zoom,void 0,j)}}if(r.children)for(const D of r.children)kp(l,t,D,c,f,g,_)}const ih=[1,-1,1];function zp(l,t,r,c){if(!r.modelManager)return!0;const f=r.modelManager;if(!r.shadowRenderer)return!0;const g=r.shadowRenderer,_=t.aabb;let v=!0,b=l.maxHeight;if(b===0){let C=0;for(const O in l.instancesPerModel){const L=f.getModel(O,c);L?C=Math.max(C,Math.max(Math.max(L.aabb.max[0],L.aabb.max[1]),L.aabb.max[2])):v=!1}b=l.maxScale*C*1.41+l.maxVerticalOffset,v&&(l.maxHeight=b)}_.max[2]=b,_.min[2]+=l.terrainElevationMin,_.max[2]+=l.terrainElevationMax,s.af(_.min,_.min,t.tileMatrix),s.af(_.max,_.max,t.tileMatrix);const I=_.intersects(g.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=I===2),I===0}function cr(l,t){const r=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],g=l.uniformValues.u_cutoff_params[3];return c===r||g===f?1:s.aA(((t-r)/(c-r)-f)/(g-f),0,1)}function ni(l,t,r,c){if(t.pitch<20)return 1;const f=t.getWorldToCameraMatrix();s.aB(f,f,l);const g=s.bU(r.min[0],r.min[1],r.min[2],1);let _=s.aC(s.eG(),g,f),v=_,b=_;g[1]=r.max[1],_=s.aC(s.eG(),g,f),v=_[1]<v[1]?_:v,b=_[1]>b[1]?_:b,g[0]=r.max[0],_=s.aC(s.eG(),g,f),v=_[1]<v[1]?_:v,b=_[1]>b[1]?_:b,g[1]=r.min[1],_=s.aC(s.eG(),g,f),v=_[1]<v[1]?_:v,b=_[1]>b[1]?_:b;const I=s.aA(c[0],0,1),C=100*t.pixelsPerMeter*s.aA(c[1],0,1),O=s.aA(c[2],0,1),L=s.eH(s.eG(),v,b,I),D=Math.tan(.5*t.fovX),V=-L[2]*D;if(C===0)return L[1]<-Math.abs(V)?O:1;const j=(-Math.abs(V)-L[1])/C,Z=(ee,ie,te)=>(1-te)*ee+te*ie,q=s.aA(Z(1,O,j),O,1);return Z(1,q,s.aA((t.pitch-20)/20,0,1))}class Lp{}class Ac{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,c){{const O=this._storage.get(r.id);if(O)return O.lastUsedFrameIdx=t,O.buf}const f=c.gl,g=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),_=new ArrayBuffer(g),v=new Int16Array(_);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const b=new s.eJ;for(let O=0;O<g/2;O+=3){const L=v[O],D=v[O+1],V=v[O+2];b.emplaceBack(L,D),b.emplaceBack(D,V),b.emplaceBack(V,L)}const I=c.bindVertexArrayOES.current,C=new Lp;return C.buf=new No(c,b),C.lastUsedFrameIdx=t,this._storage.set(r.id,C),c.bindVertexArrayOES.set(I),C.buf}update(t){for(const[r,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class rh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const ws=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class sl{constructor(t){this.revealStart=11,this.revealRange=2}}const oh=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class af{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const _=new s.eK,v=new s.b0;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(1,1),_.emplaceBack(-1,1),v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(_,oh.members),this.vignetteIdx=t.context.createIndexBuffer(v)}const f=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const _={u_vignetteShape:(g={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,an.disabled,Pn.disabled,On.alphaBlended,In.disabled,_,"vignette",this.vignetteVx,this.vignetteIdx,f)}var g}}class lf{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const c=t.getFreeCameraOptions().position,f=c.toAltitude(),g=c.toLngLat(),_=s.an(g.lng),v=s.an(g.lat),b=t.pixelsPerMeter/r,I=_*s.eM,C=s.eM*Math.log(Math.tan(Math.PI/4+v/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const O=-this._offsetYPrev+C,L=-this._elevationPrev+f;this._accumulatedOffsetX+=(-this._offsetXPrev+I)*b,this._accumulatedOffsetY+=O*b,this._accumulatedElevation+=L*b,this._offsetXPrev=I,this._offsetYPrev=C,this._elevationPrev=f}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function id(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Fs(l){const t=s.eq(1323123451230),r=[];for(let c=0;c<l;++c){const f=2*t()-1,g=2*t()-1,_=2*t()-1;r.push(s.d5(f,g,_))}return r}function ko(l,t,r,c,f){const g=s.aA((f-r)/(c-r),0,1);return(1-g)*l+g*t}class oc{constructor(t){this._movement=new lf,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new af,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const f=c.starsProjMatrix,g=s.c7([]);s.c9(g,g,s.an(90)-c._pitch),s.c8(g,g,-c.angle);const _=s.cc(new Float32Array(16),g),v=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),b=s.eg([],v),I=s.aB([],b,_),C=Date.now()/1e3;return this._accumulatedTimeFromStart+=(C-this._prevTime)*r,this._prevTime=C,{projectionMatrix:f,modelviewMatrix:I}}}class sh extends oc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new sl("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=Fs(this.particlesCount),f=new s.eN,g=new s.b0;let _=0;const v=s.eq(1323123451230);for(let b=0;b<c.length;++b){const I=c[b],C=[2*v()-1,v(),v(),v()];f.emplaceBack(I[0],I[1],I[2],-1,-1,...C),f.emplaceBack(I[0],I[1],I[2],1,-1,...C),f.emplaceBack(I[0],I[1],I[2],1,1,...C),f.emplaceBack(I[0],I[1],I[2],-1,1,...C),g.emplaceBack(_+0,_+1,_+2),g.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=r.createVertexBuffer(f,ws.members),this.particlesIdx=r.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(r.revealStart>c)return;const f=ko(0,1,r.revealStart,r.revealStart+r.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let _=[-g.direction.x,g.direction.y,-100];s.aw(_,_);const v=structuredClone(this._vignetteParams);v.strength*=f,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),_=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,v.strength=1,v.color=structuredClone(t.style.rain.state.vignetteColor));const b=this.updateOnRender(t,g.timeFactor),I=t.context,C=I.gl,O=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(I,{width:t.width,height:t.height,data:null},C.RGBA8)),g.distortionStrength>0&&(I.activeTexture.set(C.TEXTURE0),this.screenTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const L=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(I,L),I.activeTexture.set(C.TEXTURE0),this.screenTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const D=[g.color.r,g.color.g,g.color.b,g.color.a],V=(j,Z)=>{const q=id(this._movement.getPosition(),j),ee=g.dropletSizeX,ie=g.dropletSizeX*g.dropletSizeYScale,te=t.width/2,ye=t.height/2,pe=ko(0,g.screenThinning.start,0,1,g.screenThinning.intensity),ge=ko(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),ue=ko(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),le=(xe={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:j,rainDropletSize:[ee,ie],distortionStrength:g.distortionStrength,rainDirection:_,color:D,screenSize:[O.width,O.height],thinningCenterPos:[te,ye],thinningShape:[pe,ge,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:Z?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;const Re=Math.round(g.intensity*this.particlesCount),Ae=s.bg.simpleSegment(0,0,4*Re,2*Re);L.draw(t,C.TRIANGLES,an.disabled,Pn.disabled,On.alphaBlended,In.disabled,le,"rain_particles",this.particlesVx,this.particlesIdx,Ae)};g.distortionStrength>0&&V(g.boxSize,!0),V(g.boxSize,!1),this._vignette.draw(t,v)}}const ep=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class cf extends oc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new sl("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=Fs(this.particlesCount),f=new s.eO,g=new s.b0;let _=0;const v=s.eq(1323123451230);for(let b=0;b<c.length;++b){const I=c[b],C=v(),O=v(),L=v(),D=[b/c.length,C,O,L],V=[v(),v()];f.emplaceBack(I[0],I[1],I[2],-1,-1,...D,...V),f.emplaceBack(I[0],I[1],I[2],1,-1,...D,...V),f.emplaceBack(I[0],I[1],I[2],1,1,...D,...V),f.emplaceBack(I[0],I[1],I[2],-1,1,...D,...V),g.emplaceBack(_+0,_+1,_+2),g.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=r.createVertexBuffer(f,ep.members),this.particlesIdx=r.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let c=[-r.direction.x,r.direction.y,-100];s.aw(c,c);const f=structuredClone(this._vignetteParams),g=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=t.transform.zoom;if(g.revealStart>_)return;const v=ko(0,1,g.revealStart,g.revealStart+g.revealRange,_);f.strength*=v,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,f.strength=1,f.color=structuredClone(t.style.snow.state.vignetteColor));const b=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const I=t.context,C=I.gl,O=t.transform,L=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(I,L),((D,V,j)=>{const Z=id(this._movement.getPosition(),D),q=O.width/2,ee=O.height/2,ie=ko(0,j.screenThinning.start,0,1,j.screenThinning.intensity),te=ko(.001,j.screenThinning.range,0,1,j.screenThinning.intensity),ye=ko(0,j.screenThinning.particleOffset,0,1,j.screenThinning.intensity),pe=(ge={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:j.velocityConeAperture,velocity:j.velocity,horizontalOscillationRadius:j.horizontalOscillationRadius,horizontalOscillationRate:j.horizontalOscillationRate,boxSize:D,billboardSize:1*j.billboardSize,simpleShapeParameters:[j.shapeFadeStart,j.shapeFadePower],screenSize:[O.width,O.height],thinningCenterPos:[q,ee],thinningShape:[ie,te,Math.pow(10,j.screenThinning.fadePower)],thinningAffectedRatio:j.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[j.color.r,j.color.g,j.color.b,j.color.a],direction:c},{u_modelview:Float32Array.from(ge.modelview),u_projection:Float32Array.from(ge.projection),u_time:ge.time,u_cam_pos:ge.camPos,u_velocityConeAperture:ge.velocityConeAperture,u_velocity:ge.velocity,u_horizontalOscillationRadius:ge.horizontalOscillationRadius,u_horizontalOscillationRate:ge.horizontalOscillationRate,u_boxSize:ge.boxSize,u_billboardSize:ge.billboardSize,u_simpleShapeParameters:ge.simpleShapeParameters,u_screenSize:ge.screenSize,u_thinningCenterPos:ge.thinningCenterPos,u_thinningShape:ge.thinningShape,u_thinningAffectedRatio:ge.thinningAffectedRatio,u_thinningParticleOffset:ge.thinningParticleOffset,u_particleColor:ge.color,u_direction:ge.direction});var ge;const ue=Math.round(j.intensity*this.particlesCount),le=s.bg.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&L.draw(t,C.TRIANGLES,an.disabled,Pn.disabled,On.alphaBlended,In.disabled,pe,"snow_particles",this.particlesVx,this.particlesIdx,le)})(r.boxSize,0,r),this._vignette.draw(t,f)}}const sc={symbol:function(l,t,r,c,f){if(l.renderPass!=="translucent")return;const g=Pn.disabled,_=l.colorModeForRenderPass(),v=r.layout.get("text-variable-anchor"),b=r.layout.get("text-size-scale-range"),I=s.aA(l.scaleFactor,b[0],b[1]);v&&(function(L,D,V,j,Z,q,ee,ie){const te=D.transform,ye=Z==="map",pe=q==="map";for(const ge of L){const ue=j.getTile(ge),le=ue.getBucket(V);if(!le||!le.text||!le.text.segments.get().length)continue;const xe=s.bK(le.textSizeData,te.zoom,ie),Re=fa(ge,le.getProjection(),te),Ae=te.calculatePixelsToTileUnitsMatrix(ue),$e=kr(Re,ue.tileID.canonical,pe,ye,te,le.getProjection(),Ae),He=le.hasIconTextFit()&&le.hasIconData();xe&&yn(le,ye,pe,ee,te,$e,ge,Math.pow(2,te.zoom-ue.tileID.overscaledZ),xe,He)}})(c,l,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),f,I);const C=r.paint.get("icon-opacity").constantOr(1)!==0,O=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||O)?oa(l,t,r,c,g,_):(C&&oa(l,t,r,c,g,_,{onlyIcons:!0}),O&&oa(l,t,r,c,g,_,{onlyText:!0})),t.map.showCollisionBoxes&&(qt(l,t,r,c,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),qt(l,t,r,c,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,r,c){if(l.renderPass!=="translucent")return;const f=r.paint.get("circle-opacity"),g=r.paint.get("circle-stroke-width"),_=r.paint.get("circle-stroke-opacity"),v=r.layout.get("circle-sort-key").constantOr(1)!==void 0,b=r.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(g.constantOr(1)===0||_.constantOr(1)===0))return;const I=l.context,C=I.gl,O=l.transform,L=!(!l.terrain||!l.terrain.enabled),D=r.layout.get("circle-elevation-reference"),V=l.depthModeForSublayer(0,an.ReadOnly),j=new an(l.context.gl.LEQUAL,an.ReadOnly,l.depthRangeFor3D),Z=D==="none"||L?V:j,q=Pn.disabled,ee=l.colorModeForDrapableLayerRenderPass(b),ie=O.projection.name==="globe",te=[s.aF(O.center.lng),s.aJ(O.center.lat)],ye=[];for(let ge=0;ge<c.length;ge++){const ue=c[ge],le=t.getTile(ue),xe=le.getBucket(r);if(!xe||xe.projection.name!==O.projection.name)continue;const Re=xe.programConfigurations.get(r.id),Ae=xe.layoutVertexBuffer,$e=xe.globeExtVertexBuffer,He=xe.indexBuffer,it=s.e0(r),xt=[$e],Ne=l.isTileAffectedByFog(ue);ie&&it.push("PROJECTION_GLOBE_VIEW"),it.push("DEPTH_D24"),l.terrain&&O.depthOcclusionForSymbolsAndCircles&&it.push("DEPTH_OCCLUSION"),xe.hasElevation&&!l.terrain&&(it.push("ELEVATED_ROADS"),xt.push(xe.elevatedLayoutVertexBuffer));const Ee=l.getOrCreateProgram("circle",{config:Re,defines:it,overrideFog:Ne}),We=O.projection.createInversionMatrix(O,ue.canonical),Ue={programConfiguration:Re,program:Ee,layoutVertexBuffer:Ae,dynamicBuffers:xt,indexBuffer:He,uniformValues:s.e1(l,ue,le,We,te,r),tile:le};if(v){const dt=xe.segments.get();for(const Rt of dt)ye.push({segments:new s.bg([Rt]),sortKey:Rt.sortKey,state:Ue})}else ye.push({segments:xe.segments,sortKey:0,state:Ue})}v&&ye.sort(((ge,ue)=>ge.sortKey-ue.sortKey));const pe={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(const ge of ye){const{programConfiguration:ue,program:le,layoutVertexBuffer:xe,dynamicBuffers:Re,indexBuffer:Ae,uniformValues:$e,tile:He}=ge.state,it=ge.segments;l.terrain&&l.terrain.setupElevationDraw(He,le,pe),l.uploadCommonUniforms(I,le,He.tileID.toUnwrapped()),le.draw(l,C.TRIANGLES,Z,q,ee,In.disabled,$e,r.id,xe,Ae,it,r.paint,O.zoom,ue,Re)}},heatmap:function(l,t,r,c){if(r.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const f=l.context,g=f.gl,_=Pn.disabled,v=new On([g.ONE,g.ONE,g.ONE,g.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(D,V,j,Z){const q=D.gl,ee=V.width*Z,ie=V.height*Z;D.activeTexture.set(q.TEXTURE1),D.viewport.set([0,0,ee,ie]);let te=j.heatmapFbo;if(!te||te&&(te.width!==ee||te.height!==ie)){te&&te.destroy();const ye=q.createTexture();q.bindTexture(q.TEXTURE_2D,ye),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),te=j.heatmapFbo=D.createFramebuffer(ee,ie,1,null),(function(pe,ge,ue,le,xe,Re){const Ae=pe.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,pe.extRenderToTextureHalfFloat?Ae.RGBA16F:Ae.RGBA,xe,Re,0,Ae.RGBA,pe.extRenderToTextureHalfFloat?Ae.HALF_FLOAT:Ae.UNSIGNED_BYTE,null),le.colorAttachment0.set(ue)})(D,0,ye,te,ee,ie)}else q.bindTexture(q.TEXTURE_2D,te.colorAttachment0.get()),D.bindFramebuffer.set(te.framebuffer)})(f,l,r,l.transform.projection.name==="globe"?.5:.25),f.clear({color:s.ao.transparent});const b=l.transform,I=b.projection.name==="globe",C=I?["PROJECTION_GLOBE_VIEW"]:[],O=I?In.frontCCW:In.disabled,L=[s.aF(b.center.lng),s.aJ(b.center.lat)];for(let D=0;D<c.length;D++){const V=c[D];if(t.hasRenderableParent(V))continue;const j=t.getTile(V),Z=j.getBucket(r);if(!Z||Z.projection.name!==b.projection.name)continue;const q=l.isTileAffectedByFog(V),ee=Z.programConfigurations.get(r.id),ie=l.getOrCreateProgram("heatmap",{config:ee,defines:C,overrideFog:q}),{zoom:te}=l.transform;l.terrain&&l.terrain.setupElevationDraw(j,ie),l.uploadCommonUniforms(f,ie,V.toUnwrapped());const ye=b.projection.createInversionMatrix(b,V.canonical);ie.draw(l,g.TRIANGLES,an.disabled,_,v,O,Hh(l,V,j,ye,L,te,r.paint.get("heatmap-intensity")),r.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,r.paint,l.transform.zoom,ee,I?[Z.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),(function(f,g){const _=f.context,v=_.gl,b=g.heatmapFbo;if(!b)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,b.colorAttachment0.get()),_.activeTexture.set(v.TEXTURE1);let I=g.colorRampTexture;I||(I=g.colorRampTexture=new s.T(_,g.colorRamp,v.RGBA8)),I.bind(v.LINEAR,v.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,v.TRIANGLES,an.disabled,Pn.disabled,f.colorModeForRenderPass(),In.disabled,((C,O,L,D)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,g),g.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,g.paint,f.transform.zoom)})(l,r))},line:function(l,t,r,c){if(l.renderPass!=="translucent")return;const f=r.paint.get("line-opacity"),g=r.paint.get("line-width");if(f.constantOr(1)===0||g.constantOr(1)===0)return;const _=r.paint.get("line-emissive-strength").isConstant(),v=r.paint.get("line-emissive-strength").constantOr(0),b=r.paint.get("line-occlusion-opacity"),I=r.layout.get("line-elevation-reference"),C=r.layout.get("line-width-unit")==="meters",O=I==="sea",L=!(!l.terrain||!l.terrain.enabled),D=l.context,V=D.gl;if(r.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const j=r.layout.get("line-cross-slope"),Z=j!==void 0,q=j<1,ee=l.colorModeForDrapableLayerRenderPass(_?v:null),ie=l.terrain&&l.terrain.renderingToTexture,te=ie?1:s.o.devicePixelRatio,ye=r.paint.get("line-dasharray"),pe=ye.constantOr(1),ge=r.layout.get("line-cap"),ue=ye.constantOr(null),le=ge.constantOr(null),xe=r.paint.get("line-pattern"),Re=xe.constantOr(1),Ae=r.paint.get("line-pattern-cross-fade"),$e=xe.constantOr(null),He=r.paint.get("line-opacity").constantOr(1);let it=!Re&&He!==1||l.depthOcclusion&&b>0&&b<1;const xt=r.paint.get("line-gradient"),Ne=Re?"linePattern":"line",Ee=s.e2(r);let We;if(ie&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(it=!1),b!==0&&l.depthOcclusion){const Lt=r.paint._values["line-opacity"];Lt&&Lt.value&&Lt.value.kind==="constant"?We=Lt.value:s.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&Ee.push("VARIABLE_LINE_WIDTH"),ie&&(l.emissiveMode!=="dual-source-blending"||_?l.emissiveMode==="mrt-fallback"&&Ee.push("USE_MRT1"):Ee.push("DUAL_SOURCE_BLENDING"));const Ue=(Lt,At,wt,tn,Yt,Bt)=>{for(const Ht of Lt){const _n=t.getTile(Ht);if(Re&&!_n.patternsLoaded())continue;const An=_n.getBucket(r);if(!An||An.elevationType!=="none"&&!Yt||An.elevationType==="none"&&Yt)continue;l.prepareDrawTile();const si=[...At],Ri=l.shadowRenderer,Kt=An.elevationType==="road"&&!!Ri&&Ri.enabled;let wi=[0,0,0];if(Kt){const Wn=l.style.directionalLight,tr=l.style.ambientLight;Wn&&tr&&(wi=ma(l.style,Wn,tr)),si.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mn=An.programConfigurations.get(r.id);let Ai=!1;if($e&&_n.imageAtlas){const Wn=s.e3.from($e),tr=Wn.getPrimary().scaleSelf(te).toString(),Mr=_n.imageAtlas.patternPositions.get(tr),dr=Wn.getSecondary(),Hi=dr?_n.imageAtlas.patternPositions.get(dr.scaleSelf(te).toString()):null;Ai=!!Mr&&!!Hi,Mr&&Mn.setConstantPatternPositions(Mr,Hi)}Ae>0&&(Ai||Mn.getPatternTransitionVertexBuffer("line-pattern"))&&si.push("LINE_PATTERN_TRANSITION");const ji=l.isTileAffectedByFog(Ht),Fi=l.getOrCreateProgram(Ne,{config:Mn,defines:si,overrideFog:ji});if(!Re&&ue&&le&&_n.lineAtlas){const Wn=_n.lineAtlas.getDash(ue,le);Wn&&Mn.setConstantPatternPositions(Wn)}Kt&&Ri.setupShadows(_n.tileID.toUnwrapped(),Fi,"vector-tile");let[Ii,Gn]=r.paint.get("line-trim-offset");(le==="round"||le==="square")&&Ii!==Gn&&(Ii===0&&(Ii-=1),Gn===1&&(Gn+=1));const zi=ie?Ht.projMatrix:null,_r=C?1/An.tileToMeter/s.ay(_n,1,l.transform.zoom):1,ur=C?1/An.tileToMeter/s.ay(_n,1,Math.floor(l.transform.zoom)):1,Ci=Re?s.e4(l,_n,r,zi,te,_r,ur,[Ii,Gn],wi,Ae):s.e5(l,_n,r,zi,An.lineClipsArray.length,te,_r,ur,[Ii,Gn],wi);if(xt){const Wn=An.gradients[r.id];let tr=Wn.texture;if(r.gradientVersion!==Wn.version){let Mr=256;if(r.stepInterpolant){const dr=t.getSource().maxzoom,Hi=Ht.canonical.z===dr?Math.ceil(1<<l.transform.maxZoom-Ht.canonical.z):1;Mr=s.aA(s.e6(An.maxLineLength/s.al*1024*Hi),256,D.maxTextureSize)}Wn.gradient=s.e7({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Mr,image:Wn.gradient||void 0,clips:An.lineClipsArray}),Wn.texture?Wn.texture.update(Wn.gradient):Wn.texture=new s.T(D,Wn.gradient,V.RGBA8),Wn.version=r.gradientVersion,tr=Wn.texture}D.activeTexture.set(V.TEXTURE1),tr.bind(r.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}pe&&(D.activeTexture.set(V.TEXTURE0),_n.lineAtlasTexture&&_n.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),Mn.updatePaintBuffers()),Re&&(D.activeTexture.set(V.TEXTURE0),_n.imageAtlasTexture&&_n.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Mn.updatePaintBuffers()),Yt&&!O&&l.terrain.setupElevationDraw(_n,Fi),l.uploadCommonUniforms(D,Fi,Ht.toUnwrapped());const hi=Wn=>{We!=null&&(We.value=He*b),Fi.draw(l,V.TRIANGLES,wt,Wn,ee,In.disabled,Ci,r.id,An.layoutVertexBuffer,An.indexBuffer,An.segments,r.paint,l.transform.zoom,Mn,[An.layoutVertexBuffer2,An.patternVertexBuffer,An.zOffsetVertexBuffer]),We!=null&&(We.value=He)};if(it&&!Yt){const Wn=l.stencilModeForClipping(Ht).ref;Wn===0&&ie&&D.clear({stencil:0});const tr={func:V.EQUAL,mask:255};Ci.u_alpha_discard_threshold=.8,hi(new Pn(tr,Wn,255,V.KEEP,V.KEEP,V.INVERT)),Ci.u_alpha_discard_threshold=0,hi(new Pn(tr,Wn,255,V.KEEP,V.KEEP,V.KEEP))}else Ci.u_alpha_discard_threshold=it&&Yt&&Bt?.8:0,hi(Yt?tn:l.stencilModeForClipping(Ht))}};let dt=l.depthModeForSublayer(0,an.ReadOnly);const Rt=new an(l.depthOcclusion?V.GREATER:V.LEQUAL,an.ReadOnly,l.depthRangeFor3D);if(r.hasNonElevatedBuckets){const Lt=!ie&&l.terrain;b!==0&&Lt?s.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):Lt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):Ue(c,Ee,dt,Pn.disabled,!1,!0)}if(r.hasElevatedBuckets){I==="hd-road-markup"?L||(dt=Rt,Ee.push("ELEVATED_ROADS")):(Ee.push("ELEVATED"),dt=Rt,Z&&Ee.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&Ee.push("ELEVATION_REFERENCE_SEA"));const Lt=it?l.stencilModeFor3D():Pn.disabled;l.forceTerrainMode=!0,Ue(c,Ee,dt,Lt,!0,!0),it&&Ue(c,Ee,dt,Lt,!0,!1),l.forceTerrainMode=!1}it&&(l.resetStencilClippingMasks(),ie&&D.clear({stencil:0})),b===0||l.depthOcclusion||ie||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,r,c){const f=r.paint.get("fill-color"),g=r.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const _=r.paint.get("fill-emissive-strength"),v=l.colorModeForDrapableLayerRenderPass(_),b=r.paint.get("fill-pattern"),I=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&f.constantOr(s.ao.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let C="none";r.layout.get("fill-elevation-reference")!=="none"?C="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(C="offset");const O=!(!l.terrain||!l.terrain.enabled),L={painter:l,sourceCache:t,layer:r,coords:c,colorMode:v,elevationType:C,terrainEnabled:O,pass:I};if(l.renderPass==="shadow")return void(l.shadowRenderer&&C==="road"&&!O&&(function(V){const{painter:j,sourceCache:Z,layer:q,coords:ee}=V,ie=j.context.gl,te=V.painter.shadowRenderer;for(const ye of ee){const pe=Z.getTile(ye),ge=pe.getBucket(q);if(!ge)continue;const ue=ge.elevatedStructures;if(!ue||!ue.shadowCasterSegments||ue.shadowCasterSegments.segments[0].primitiveLength===0)continue;j.prepareDrawTile();const le=ge.bufferData.programConfigurations.get(q.id),xe=j.isTileAffectedByFog(ye),Re=j.getOrCreateProgram("elevatedStructuresDepth",{config:le,overrideFog:xe}),Ae=te.calculateShadowPassMatrixFromTile(pe.tileID.toUnwrapped());j.uploadCommonUniforms(j.context,Re,ye.toUnwrapped());const $e={u_matrix:Ae,u_depth_bias:0};Re.draw(j,ie.TRIANGLES,te.getShadowPassDepthMode(),Pn.disabled,te.getShadowPassColorMode(),In.disabled,$e,q.id,ue.vertexBuffer,ue.indexBuffer,ue.shadowCasterSegments,q.paint,j.transform.zoom,le)}})(L));const D=l.emissiveMode==="mrt-fallback";if(C!=="offset"){if(eh(L,!1,D),C==="road"){const V=!O&&l.renderPass==="translucent";V&&kl(l,t,r,c,"geometry"),eh(L,!0,D,Pn.disabled),V&&(function(j){const{painter:Z,sourceCache:q,layer:ee,coords:ie,colorMode:te}=j,ye=Z.context.gl,pe=j.painter.shadowRenderer,ge=!!pe&&pe.enabled,ue=new an(Z.context.gl.LEQUAL,an.ReadOnly,Z.depthRangeFor3D);let le=[0,0,0];if(ge){const Re=Z.style.directionalLight,Ae=Z.style.ambientLight;Re&&Ae&&(le=ma(Z.style,Re,Ae))}const xe=Re=>{for(const Ae of ie){const $e=q.getTile(Ae),He=$e.getBucket(ee);if(!He)continue;const it=He.elevatedStructures;if(!it)continue;let xt,Ne;if(Re?(xt=it.renderableBridgeSegments,Ne=it.bridgeProgramConfigurations.get(ee.id)):(xt=it.renderableTunnelSegments,Ne=it.tunnelProgramConfigurations.get(ee.id)),!xt||xt.segments[0].primitiveLength===0)continue;Ne.updatePaintBuffers(),Z.prepareDrawTile();const Ee=Z.isTileAffectedByFog(Ae),We=[];ge&&We.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ue=Z.getOrCreateProgram("elevatedStructures",{config:Ne,overrideFog:Ee,defines:We}),dt=Z.translatePosMatrix(Ae.projMatrix,$e,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"));ge&&pe.setupShadows($e.tileID.toUnwrapped(),Ue,"vector-tile");const Rt=Pl(dt,le);Z.uploadCommonUniforms(Z.context,Ue,Ae.toUnwrapped()),Ue.draw(Z,ye.TRIANGLES,ue,Pn.disabled,te,In.backCCW,Rt,ee.id,it.vertexBuffer,it.indexBuffer,xt,ee.paint,Z.transform.zoom,Ne,[it.vertexBufferNormal])}};xe(!0),xe(!1)})(L)}}else eh(L,!1,D,l.stencilModeFor3D())},"fill-extrusion":function(l,t,r,c){const f=r.paint.get("fill-extrusion-opacity"),g=l.context,_=g.gl,v=l.terrain,b=v&&v.renderingToTexture;if(f===0)return;const I=l.emissiveMode==="mrt-fallback",C=l.conflationActive&&l.style.isLayerClipped(r,t.getSource()),O=l.style.order.indexOf(r.fqid);if(C&&(function(L,D,V,j,Z){for(const q of j){const ee=D.getTile(q).getBucket(V);ee&&(ee.updateReplacement(q,L.replacementSource,Z),ee.uploadCentroid(L.context))}})(l,t,r,c,O),v||C)for(const L of c){const D=t.getTile(L).getBucket(r);D&&po(l.context,t,L,D,r,v,C)}if(l.renderPass==="shadow"&&l.shadowRenderer){const L=l.shadowRenderer;if(v&&f<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const D=L.getShadowPassDepthMode(),V=L.getShadowPassColorMode();ic(l,t,r,c,D,Pn.disabled,V,C)}else if(l.renderPass==="translucent"){const L=!r.paint.get("fill-extrusion-pattern").constantOr(1),D=r.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!b&&D.a!==0){const V=new an(l.context.gl.LEQUAL,an.ReadWrite,l.depthRangeFor3D);f===1&&L?ic(l,t,r,c,V,Pn.disabled,On.unblended,C):(ic(l,t,r,c,V,Pn.disabled,On.disabled,C),ic(l,t,r,c,V,l.stencilModeFor3D(),l.colorModeForRenderPass(),C),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&L&&(!v&&l.transform.projection.name!=="globe"||b)){const V=r.paint.get("fill-extrusion-opacity"),j=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=r.paint.get("fill-extrusion-flood-light-intensity"),ee=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ee?null:r.lut).toArray01().slice(0,3),te=j>0&&Z>0,ye=q>0,pe=(le,xe,Re)=>(1-Re)*le+Re*xe,ge=new tf;ge.translate=r.paint.get("fill-extrusion-translate"),ge.translateAnchor=r.paint.get("fill-extrusion-translate-anchor"),ge.edgeRadius=r.layout.get("fill-extrusion-edge-radius"),ge.cutoffFadeRange=r.paint.get("fill-extrusion-cutoff-fade-range");const ue=le=>{const xe=l.depthModeForSublayer(1,an.ReadOnly,_.LEQUAL,!0),Re=r.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=pe(.1,3,Re),$e=l._showOverdrawInspector;if(!$e){const He=new Pn({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),it=new On([_.ONE,_.ONE,_.ONE,_.ONE],s.ao.transparent,[!1,!1,!1,!0],_.MIN);il(ge,l,t,r,c,xe,He,it,In.disabled,le,"sdf",V,j,Z,q,ie,Ae,C,!1)}{const He=$e?Pn.disabled:new Pn({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),it=$e?l.colorModeForRenderPass():new On([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],s.ao.transparent,[!0,!0,!0,!0]);il(ge,l,t,r,c,xe,He,it,In.disabled,le,"color",V,j,Z,q,ie,Ae,C,!1)}};if(b){const le=()=>{const Re=v.drapeBufferSize[0],Ae=v.drapeBufferSize[1];let $e=v.framebufferCopyTexture;return $e&&(!$e||$e.size[0]===Re&&$e.size[1]===Ae)||($e&&$e.destroy(),$e=v.framebufferCopyTexture=new s.T(g,new s.q({width:Re,height:Ae}),_.RGBA8)),$e.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,0,0,Re,Ae),$e},xe=(Re,Ae,$e)=>{const He=l.depthModeForSublayer(1,an.ReadOnly,_.LEQUAL,!1),it=r.paint.get(Re?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xt=pe(.1,3,it);{const Ne=new On([_.ONE,_.ONE,_.ONE,_.ONE],s.ao.transparent,[!1,!1,!1,!0]);il(ge,l,t,r,c,He,Pn.disabled,Ne,In.disabled,Re,"clear",V,j,Z,q,ie,xt,C,Ae)}{const Ne=new Pn({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),Ee=new On([_.ONE,_.ONE,_.ONE,_.ONE],s.ao.transparent,[!1,!1,!1,!0],_.MIN);il(ge,l,t,r,c,He,Ne,Ee,In.disabled,Re,"sdf",V,j,Z,q,ie,xt,C,Ae)}I&&!Re&&($e=le());{const Ne=Re?_.ZERO:_.ONE_MINUS_DST_ALPHA,Ee=new Pn({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),We=new On([Ne,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],s.ao.transparent,[!0,!0,!0,!0]);il(ge,l,t,r,c,He,Ee,We,In.disabled,Re,"color",V,j,Z,q,ie,xt,C,Ae)}if(!I||Re){const Ne=new On([_.ONE,_.ONE,_.ONE,Re?_.ZERO:_.ONE],s.ao.transparent,[!1,!1,!1,!0],Re?_.FUNC_ADD:_.MAX);il(ge,l,t,r,c,He,Pn.disabled,Ne,In.disabled,Re,"clear",V,j,Z,q,ie,xt,C,Ae,$e)}else{_.drawBuffers([_.NONE,_.COLOR_ATTACHMENT1]);const Ne=new Pn({func:_.EQUAL,mask:255},254,255,_.KEEP,_.DECR,_.DECR),Ee=new On([_.ONE,_.ONE,_.ONE,_.ONE],s.ao.transparent,[!0,!1,!1,!1],_.MAX);il(ge,l,t,r,c,He,Ne,Ee,In.disabled,Re,"emissive",V,j,Z,q,ie,xt,C,Ae,$e),_.drawBuffers([_.COLOR_ATTACHMENT0])}};if(te||ye){let Re;l.prepareDrawTile(),I&&!te||(Re=le()),te&&xe(!0,!1,Re),ye&&xe(!1,!0,Re)}}else te&&ue(!0),ye&&ue(!1),(te||ye)&&l.resetStencilClippingMasks()}}},building:function(l,t,r,c){l.currentLayer<l.firstLightBeamLayer&&(l.firstLightBeamLayer=l.currentLayer);const f=r.paint.get("building-ambient-occlusion-ground-intensity"),g=r.paint.get("building-ambient-occlusion-ground-radius"),_=r.paint.get("building-ambient-occlusion-ground-attenuation"),v=r.paint.get("building-opacity");if(v<=0)return;let b=f>0&&g>0,I=!0;const C=r.paint.get("building-vertical-scale");if(C<=0)return;l.shadowRenderer||(I=!1);const O=l.conflationActive&&l.style.isLayerClipped(r,t.getSource()),L=l.style.order.indexOf(r.fqid);if((function(D,V,j,Z,q,ee){for(const ie of ee){const te=V.getTile(ie).getBucket(j);te&&(q&&te.updateReplacement(ie,D.replacementSource,Z),te.uploadUpdatedIndexBuffer(D.context))}})(l,t,r,L,O,c),(function(D,V,j,Z){for(const q of Z){const ee=V.getTile(q).getBucket(j);ee&&ee.needsEvaluation()&&ee.uploadUpdatedColorBuffer(D.context)}})(l,t,r,c),r.resetLayerRenderingStats(l),l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0),l.renderPass==="shadow"&&l.shadowRenderer){const D=l.shadowRenderer,V=[],j=D.getShadowPassDepthMode();tu({painter:l,source:t,layer:r,coords:c,defines:V,blendMode:D.getShadowPassColorMode(),depthMode:j,opacity:v,verticalScale:C,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(l.renderPass==="translucent"){let D=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];I&&(D=D.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),l.shadowRenderer&&l.shadowRenderer.useNormalOffset&&(D=D.concat("NORMAL_OFFSET"));const V=r.paint.get("building-facade-emissive-chance"),j=r.paint.get("building-ambient-occlusion-intensity"),Z=r.paint.get("building-flood-light-intensity"),q=r.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ee=r.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(q?null:r.lut).toArray01().slice(0,3),ie=r.paint.get("building-flood-light-ground-attenuation"),te=Z>0,ye=new an(l.context.gl.LEQUAL,an.ReadWrite,l.depthRangeFor3D);v<1&&tu({painter:l,source:t,layer:r,coords:c,defines:D,blendMode:On.disabled,depthMode:ye,opacity:v,verticalScale:C,facadeEmissiveChance:V,facadeAOIntensity:j,floodLightIntensity:Z,floodLightColor:ee,depthOnly:!0});const pe=l.colorModeForRenderPass();tu({painter:l,source:t,layer:r,coords:c,defines:D,blendMode:pe,depthMode:ye,opacity:v,verticalScale:C,facadeEmissiveChance:V,facadeAOIntensity:j,floodLightIntensity:Z,floodLightColor:ee}),b&&zl(l,t,r,c,!0,v,f,g,Z,ee,_,O),te&&zl(l,t,r,c,!1,v,f,g,Z,ee,ie,O)}else if(l.renderPass==="light-beam"){const D=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],V=new an(l.context.gl.LEQUAL,an.ReadOnly,l.depthRangeFor3D);tu({painter:l,source:t,layer:r,coords:c,defines:D,blendMode:On.alphaBlended,depthMode:V,opacity:v,verticalScale:C,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1),l.resetStencilClippingMasks()},hillshade:function(l,t,r,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const f=l.context,g=l.terrain&&l.terrain.renderingToTexture,[_,v]=l.renderPass!=="translucent"||g?[{},c]:l.stencilConfigForOverlap(c);for(const b of v){const I=t.getTile(b);if(I.needsHillshadePrepare&&l.renderPass==="offscreen")Cp(l,I,r);else if(l.renderPass==="translucent"){const C=l.depthModeForSublayer(0,an.ReadOnly),O=r.paint.get("hillshade-emissive-strength"),L=l.colorModeForDrapableLayerRenderPass(O),D=g&&l.terrain?l.terrain.stencilModeForRTTOverlap(b):_[b.overscaledZ];xm(l,b,I,r,C,D,L)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,r,c,f,g){if(l.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const _=l.transform.projection.name==="globe",v=r.paint.get("raster-elevation")!==0,b=v&&_;if(l.renderElevatedRasterBackface&&!b)return;const I=l.context,C=I.gl,O=t.getSource(),L=(function(pe,ge,ue,le,xe){const Re=ge.paint.get("raster-color"),Ae=pe.type==="raster-array",$e=[],He=ge.paint.get("raster-resampling"),it=ge.paint.get("raster-color-mix");let xt=ge.paint.get("raster-color-range");const Ne=[it[0],it[1],it[2],0],Ee=it[3];let We=He==="nearest"?le.NEAREST:le.LINEAR;if(Ae&&($e.push("RASTER_ARRAY"),Re||$e.push("RASTER_COLOR"),He==="linear"&&$e.push("RASTER_ARRAY_LINEAR"),We=le.NEAREST,!xt&&pe.rasterLayers)){const Ue=pe.rasterLayers.find((({id:dt})=>dt===ge.sourceLayer));Ue&&Ue.fields&&Ue.fields.range&&(xt=Ue.fields.range)}if(xt=xt||[0,1],Re){$e.push("RASTER_COLOR"),ue.activeTexture.set(le.TEXTURE2),ge.updateColorRamp(xt);let Ue=ge.colorRampTexture;Ue||(Ue=ge.colorRampTexture=new s.T(ue,ge.colorRamp,le.RGBA8)),Ue.bind(le.LINEAR,le.CLAMP_TO_EDGE)}return xe&&$e.push("USE_MRT1"),{mix:Ne,range:xt,offset:Ee,defines:$e,resampling:We}})(O,r,I,C,l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback");if(O instanceof s.aU&&!c.length&&!_)return;const D=r.paint.get("raster-emissive-strength"),V=l.colorModeForDrapableLayerRenderPass(D),j=l.terrain&&l.terrain.renderingToTexture,Z=!l.options.moving,q=r.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;if(O instanceof s.aU&&!c.length&&(O.onNorthPole||O.onSouthPole)){const pe=v?l.stencilModeFor3D():Pn.disabled;return void mo(!!O.onNorthPole,null,l,t,r,D,L,In.disabled,pe)}if(!c.length)return;const[ee,ie]=O instanceof s.aU||j?[{},c]:l.stencilConfigForOverlap(c),te=ie[ie.length-1].overscaledZ;b&&L.defines.push("PROJECTION_GLOBE_VIEW"),v&&L.defines.push("RENDER_CUTOFF");const ye=(pe,ge,ue)=>{for(const le of pe){const xe=le.toUnwrapped(),Re=t.getTile(le);if(j&&(!Re||!Re.hasData()))continue;I.activeTexture.set(C.TEXTURE0);const Ae=Ua(Re,O,r,L);if(!Ae||!Ae.texture)continue;const{texture:$e,mix:He,offset:it,tileSize:xt,buffer:Ne}=Ae;let Ee,We;j?(Ee=an.disabled,We=le.projMatrix):v?(Ee=new an(C.LEQUAL,an.ReadWrite,l.depthRangeFor3D),We=_?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(xe,Z)):(Ee=l.depthModeForSublayer(le.overscaledZ-te,r.paint.get("raster-opacity")===1?an.ReadWrite:an.ReadOnly,C.LESS),We=l.transform.calculateProjMatrix(xe,Z));const Ue=l.terrain&&j?l.terrain.stencilModeForRTTOverlap(le):ee[le.overscaledZ],dt=g?0:r.paint.get("raster-fade-duration");Re.registerFadeDuration(dt);const Rt=t.findLoadedParent(le,0),Lt=Cl(Re,Rt,t,l.transform,dt);let At,wt;!Lt.isFading&&Re.refreshedUponExpiration&&(Re.refreshedUponExpiration=!1),l.terrain&&l.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),$e.bind(q,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(q,C.CLAMP_TO_EDGE),At=Math.pow(2,Rt.tileID.overscaledZ-Re.tileID.overscaledZ),wt=[Re.tileID.canonical.x*At%1,Re.tileID.canonical.y*At%1]):$e.bind(q,C.CLAMP_TO_EDGE),"useMipmap"in $e&&I.extTextureFilterAnisotropic&&l.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const tn=l.transform;let Yt;const Bt=v?jo(tn):[0,0,0,0];let Ht,_n,An,si,Ri,Kt=0;if(b&&O instanceof s.aU&&O.coordinates.length>3)Ht=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),_n=Float32Array.from(tn.globeMatrix),An=Float32Array.from(s.dF(tn)),si=[s.aF(tn.center.lng),s.aJ(tn.center.lat)],Yt=O.elevatedGlobePerspectiveTransform,Ri=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(b){const ji=s.dG(le.canonical);Kt=s.dH(ji.getCenter().lat),Ht=Float32Array.from(s.bk(s.dJ(le.canonical))),_n=Float32Array.from(tn.globeMatrix),An=Float32Array.from(s.dF(tn)),si=[s.aF(tn.center.lng),s.aJ(tn.center.lat)],Yt=[0,0],Ri=Float32Array.from(s.dI(le.canonical,ji,Kt,tn.worldSize/tn._pixelsPerMercatorPixel))}else Yt=O instanceof s.aU?O.perspectiveTransform:[0,0],Ht=new Float32Array(16),_n=new Float32Array(9),An=new Float32Array(16),si=[0,0],Ri=new Float32Array(9);const wi=Jc(We,Ht,_n,An,Ri,wt||[0,0],s.aj(l.transform.zoom),si,Bt,At||1,Lt,r,Yt,v?r.paint.get("raster-elevation"):0,2,He,it,L.range,xt,Ne,D),Mn=l.isTileAffectedByFog(le),Ai=l.getOrCreateProgram("raster",{defines:L.defines,overrideFog:Mn});if(l.uploadCommonUniforms(I,Ai,xe),O instanceof s.aU){const ji=O.elevatedGlobeVertexBuffer,Fi=O.elevatedGlobeIndexBuffer;if(j||!_)O.boundsBuffer&&O.boundsSegments&&Ai.draw(l,C.TRIANGLES,Ee,Pn.disabled,V,In.disabled,wi,r.id,O.boundsBuffer,l.quadTriangleIndexBuffer,O.boundsSegments);else if(ji&&Fi){const Ii=tn.zoom<=s.c_?O.elevatedGlobeSegments:O.getSegmentsForLongitude(tn.center.lng);Ii&&Ai.draw(l,C.TRIANGLES,Ee,Pn.disabled,V,ge,wi,r.id,ji,Fi,Ii)}}else if(b){Ee=new an(C.LEQUAL,an.ReadOnly,l.depthRangeFor3D);const ji=l.globeSharedBuffers;if(ji){const[Fi,Ii,Gn]=ji.getGridBuffers(Kt,!1);Ai.draw(l,C.TRIANGLES,Ee,ue||Ue,l.colorModeForRenderPass(),ge,wi,r.id,Fi,Ii,Gn)}}else{const{tileBoundsBuffer:ji,tileBoundsIndexBuffer:Fi,tileBoundsSegments:Ii}=l.getTileBoundsBuffers(Re);Ai.draw(l,C.TRIANGLES,Ee,Ue,V,In.disabled,wi,r.id,ji,Fi,Ii)}}if(!(O instanceof s.aU)&&b)for(const le of pe){const xe=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&mo(!0,le,l,t,r,D,L,ge,ue||Pn.disabled),xe&&mo(!1,le,l,t,r,D,L,ge===In.frontCW?In.backCW:In.frontCW,ue||Pn.disabled)}};b?ye(ie,l.renderElevatedRasterBackface?In.backCW:In.frontCW,l.stencilModeFor3D()):ye(ie,In.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,r,c,f,g){l.renderPass==="offscreen"&&(function(_,v,b,I){if(!I.length)return;const C=_.context,O=C.gl,L=v.getSource();if(!(L instanceof Oo))return;const D=Math.ceil(Math.sqrt(b.paint.get("raster-particle-count")));let V=b.particlePositionRGBAImage;if(!V||V.width!==D){const ie=(function(te){const ye=te*te,pe=new Uint8Array(4*ye),ge=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let le=0;le<ye;le++){const xe=ue*(ge(2*le+0)+xa),Re=ue*(ge(2*le+1)+xa),Ae=255*xe%1,$e=255*Re%1,He=Ae,it=Re-$e/255,xt=$e;pe[4*le+0]=255*(xe-Ae/255),pe[4*le+1]=255*He,pe[4*le+2]=255*it,pe[4*le+3]=255*xt}return pe})(D);V=b.particlePositionRGBAImage=new s.q({width:D,height:D},ie)}let j=b.particleFramebuffer;j?j.width!==D&&(j.destroy(),j=b.particleFramebuffer=C.createFramebuffer(D,D,1,null)):j=b.particleFramebuffer=C.createFramebuffer(D,D,1,null);const Z=[];for(const ie of I){const te=v.getTile(ie);if(!(te instanceof Cd))continue;const ye=Zf(te,L,b);if(!ye)continue;const pe=[te.tileSize,te.tileSize];let ge=b.tileFramebuffer;ge||(ge=b.tileFramebuffer=C.createFramebuffer(pe[0],pe[1],1,null));let ue=te.rasterParticleState;ue||(ue=te.rasterParticleState=new Sc(C,ie,pe,V));const le=ue.update(b.lastInvalidatedAt);ue.particleTextureDimension!==D&&ue.updateParticleTexture(ie,V);const xe=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=xe;const Re=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=Re,Z.push([ie,ye,ue,le])}if(Z.length===0)return;const q=s.o.now(),ee=b.previousDrawTimestamp?.001*(q-b.previousDrawTimestamp):.0167;if(b.previousDrawTimestamp=q,b.hasColorMap()){C.activeTexture.set(O.TEXTURE0+2);let ie=b.colorRampTexture;ie||(ie=b.colorRampTexture=new s.T(C,b.colorRamp,O.RGBA8)),ie.bind(O.LINEAR,O.CLAMP_TO_EDGE)}C.bindFramebuffer.set(b.tileFramebuffer.framebuffer),(function(ie,te,ye){const pe=ie.context,ge=pe.gl,ue=te.tileFramebuffer;pe.activeTexture.set(ge.TEXTURE0);const le={u_texture:0,u_opacity:1.05*(Re=te.paint.get("raster-particle-fade-opacity-factor"))/(Re+.05)},xe=ie.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Re;for(const Ae of ye){const[,,$e,He]=Ae;ue.colorAttachment0.set($e.targetColorTexture.texture),pe.viewport.set([0,0,ue.width,ue.height]),pe.clear({color:s.ao.transparent}),He&&($e.backgroundColorTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE),xe.draw(ie,ge.TRIANGLES,an.disabled,Pn.disabled,On.alphaBlended,In.disabled,le,te.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments))}})(_,b,Z),(function(ie,te,ye,pe){const ge=ie.context,ue=ge.gl,le=ye.tileFramebuffer,xe=ie.transform.projection.name==="globe",Re=ye.paint.get("raster-particle-max-speed");for(const Ae of pe){const[$e,He,it]=Ae;ge.activeTexture.set(ue.TEXTURE0+0),He.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),le.colorAttachment0.set(it.targetColorTexture.texture);const xt=ie.getOrCreateProgram("rasterParticleDraw",{defines:He.defines,overrideFog:!1});ge.activeTexture.set(ue.TEXTURE0+1);const Ne=He.scalarData?[]:[0,1,2,3].map((Ue=>s.e9[Ue]($e)));Ne.push($e);const Ee=$e.canonical.x,We=$e.canonical.y;for(const Ue of Ne){const dt=te.getTile(xe?Ue.wrapped():Ue);if(!dt)continue;const Rt=dt.rasterParticleState;if(!Rt)continue;const Lt=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-$e.wrap),At=Ue.canonical.y;Rt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const wt=Yu(1,Rt.particleTexture0.size[0],[Lt-Ee,At-We],0,He.texture.size,2,Re,He.textureOffset,He.scale,He.offset);xt.draw(ie,ue.POINTS,an.disabled,Pn.disabled,On.alphaBlended,In.disabled,wt,ye.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}})(_,v,b,Z),C.bindFramebuffer.set(b.particleFramebuffer.framebuffer),(function(ie,te,ye,pe){const ge=ie.context,ue=ge.gl,le=te.paint.get("raster-particle-max-speed"),xe=pe*te.paint.get("raster-particle-speed-factor")*.15,Re=(function($e){return Math.pow($e,6)})(.01+1*te.paint.get("raster-particle-reset-rate-factor")),Ae=te.particleFramebuffer;ge.viewport.set([0,0,Ae.width,Ae.height]);for(const $e of ye){const[,He,it]=$e;ge.activeTexture.set(ue.TEXTURE0+0),He.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ge.activeTexture.set(ue.TEXTURE0+1);const xt=it.particleTexture0;xt.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const Ne=Jd(1,xt.size[0],0,He.texture.size,le,xe,Re,He.textureOffset,He.scale,He.offset);Ae.colorAttachment0.set(it.particleTexture1.texture),ge.clear({color:s.ao.transparent}),ie.getOrCreateProgram("rasterParticleUpdate",{defines:He.defines}).draw(ie,ue.TRIANGLES,an.disabled,Pn.disabled,On.unblended,In.disabled,Ne,te.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments)}})(_,b,Z,ee)})(l,t,r,c),l.renderPass==="translucent"&&((function(_,v,b,I,C){const O=_.context,L=O.gl,D=v.getSource().tileSize,V=5*(1-s.ah(s.cL,s.cL+1,_.transform.zoom))*D+b.paint.get("raster-particle-elevation"),j=!_.options.moving,Z=_.transform.projection.name==="globe";if(!I.length)return;const[q,ee]=_.stencilConfigForOverlap(I),ie=[];Z&&ie.push("PROJECTION_GLOBE_VIEW");const te=_.stencilModeFor3D();for(const ye of ee){const pe=ye.toUnwrapped(),ge=v.getTile(ye);if(!ge.rasterParticleState)continue;const ue=ge.rasterParticleState,le=100;ge.registerFadeDuration(le);const xe=v.findLoadedParent(ye,0),Re=Cl(ge,xe,v,_.transform,le);let Ae,$e;_.terrain&&_.terrain.prepareDrawTile(),O.activeTexture.set(L.TEXTURE0),ue.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),O.activeTexture.set(L.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ae=Math.pow(2,xe.tileID.overscaledZ-ge.tileID.overscaledZ),$e=[ge.tileID.canonical.x*Ae%1,ge.tileID.canonical.y*Ae%1]):ue.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const He=Z?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(pe,j),it=_.transform,xt=ls(it),Ne=s.dG(ye.canonical),Ee=s.dH(Ne.getCenter().lat);let We,Ue,dt,Rt,Lt;Z?(We=Float32Array.from(s.bk(s.dJ(ye.canonical))),Ue=Float32Array.from(it.globeMatrix),dt=Float32Array.from(s.dF(it)),Rt=[s.aF(it.center.lng),s.aJ(it.center.lat)],Lt=Float32Array.from(s.dI(ye.canonical,Ne,Ee,it.worldSize/it._pixelsPerMercatorPixel))):(We=new Float32Array(16),Ue=new Float32Array(9),dt=new Float32Array(16),Rt=[0,0],Lt=new Float32Array(9));const At=Kd(He,We,Ue,dt,Lt,$e||[0,0],s.aj(_.transform.zoom),Rt,xt,Ae||1,Re,V),wt=_.isTileAffectedByFog(ye),tn=_.getOrCreateProgram("rasterParticle",{defines:ie,overrideFog:wt});if(_.uploadCommonUniforms(O,tn,pe),Z){const Yt=new an(L.LEQUAL,an.ReadOnly,_.depthRangeFor3D),Bt=0,Ht=_.globeSharedBuffers;if(Ht){const[_n,An,si]=Ht.getGridBuffers(Ee,Bt!==0);tn.draw(_,L.TRIANGLES,Yt,te,On.alphaBlended,_.renderElevatedRasterBackface?In.frontCCW:In.backCCW,At,b.id,_n,An,si)}}else{const Yt=_.depthModeForSublayer(0,an.ReadOnly),Bt=q[ye.overscaledZ],{tileBoundsBuffer:Ht,tileBoundsIndexBuffer:_n,tileBoundsSegments:An}=_.getTileBoundsBuffers(ge);tn.draw(_,L.TRIANGLES,Yt,Bt,On.alphaBlended,In.disabled,At,b.id,Ht,_n,An)}}_.resetStencilClippingMasks()})(l,t,r,c),l.style.map.triggerRepaint())},background:function(l,t,r,c){const f=r.paint.get("background-color"),g=r.paint.get("background-color-use-theme").constantOr("default")==="none",_=r.paint.get("background-opacity"),v=r.paint.get("background-emissive-strength"),b=r.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const I=l.context,C=I.gl,O=l.transform,L=O.tileSize,D=r.paint.get("background-pattern");let V;if(D!==void 0&&(D===null||(V=l.imageManager.getPattern(s.I.from(D.toString()),r.scope,l.style.getLut(r.scope)),!V)))return;const j=!D&&f.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==j)return;const Z=Pn.disabled,q=l.depthModeForSublayer(0,j==="opaque"?an.ReadWrite:an.ReadOnly),ee=l.colorModeForDrapableLayerRenderPass(v),ie=D?"backgroundPattern":"background";let te,ye=c;ye||(te=l.getBackgroundTiles(),ye=Object.values(te).map((ge=>ge.tileID))),D&&(I.activeTexture.set(C.TEXTURE0),l.imageManager.bind(l.context,r.scope));const pe=[];if(l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&pe.push("USE_MRT1"),b){const ge=l.getOrCreateProgram(ie,{overrideFog:!1,overrideRtt:!0,defines:pe}),ue=new Float32Array(s.bA([])),le=new s.aQ(0,0,0,0,0),xe=D?wa(ue,v,_,l,0,r.scope,V,b,{tileID:le,tileSize:L}):Qc(ue,v,_,f.toPremultipliedRenderColor(g?null:r.lut));ge.draw(l,C.TRIANGLES,q,Z,ee,In.disabled,xe,r.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const ge of ye){const ue=l.isTileAffectedByFog(ge),le=l.getOrCreateProgram(ie,{overrideFog:ue,defines:pe}),xe=ge.toUnwrapped(),Re=c?ge.projMatrix:l.transform.calculateProjMatrix(xe);l.prepareDrawTile();const Ae=t?t.getTile(ge):te?te[ge.key]:new Ys(ge,L,O.zoom,l),$e=D?wa(Re,v,_,l,0,r.scope,V,b,{tileID:ge,tileSize:L}):Qc(Re,v,_,f.toPremultipliedRenderColor(g?null:r.lut));l.uploadCommonUniforms(I,le,xe);const{tileBoundsBuffer:He,tileBoundsIndexBuffer:it,tileBoundsSegments:xt}=l.getTileBoundsBuffers(Ae);le.draw(l,C.TRIANGLES,q,Z,ee,In.disabled,$e,r.id,He,it,xt)}},sky:function(l,t,r){const c=l._atmosphere?s.aj(l.transform.zoom):1,f=r.paint.get("sky-opacity")*c;if(f===0)return;const g=l.context,_=r.paint.get("sky-type"),v=new an(g.gl.LEQUAL,an.ReadOnly,[0,1]),b=l.frameCounter/1e3%1;_==="atmosphere"?l.renderPass==="offscreen"?r.needsSkyboxCapture(l)&&((function(I,C,O,L){const D=I.context,V=D.gl;let j=C.skyboxFbo;if(!j){j=C.skyboxFbo=D.createFramebuffer(32,32,1,null),C.skyboxGeometry=new Jh(D),C.skyboxTexture=D.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,C.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let ie=0;ie<6;++ie)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}D.bindFramebuffer.set(j.framebuffer),D.viewport.set([0,0,32,32]);const Z=C.getCenter(I,!0),q=I.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);s.bA(ee),s.en(ee,ee,.5*-Math.PI),Ec(I,C,q,ee,Z,0),s.bA(ee),s.en(ee,ee,.5*Math.PI),Ec(I,C,q,ee,Z,1),s.bA(ee),s.cU(ee,ee,.5*-Math.PI),Ec(I,C,q,ee,Z,2),s.bA(ee),s.cU(ee,ee,.5*Math.PI),Ec(I,C,q,ee,Z,3),s.bA(ee),Ec(I,C,q,ee,Z,4),s.bA(ee),s.en(ee,ee,Math.PI),Ec(I,C,q,ee,Z,5),D.viewport.set([0,0,I.width,I.height])})(l,r),r.markSkyboxValid(l)):l.renderPass==="sky"&&(function(I,C,O,L,D){const V=I.context,j=V.gl,Z=I.transform,q=I.getOrCreateProgram("skybox");V.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_CUBE_MAP,C.skyboxTexture);const ee=((ie,te,ye,pe,ge)=>({u_matrix:ie,u_sun_direction:te,u_cubemap:0,u_opacity:pe,u_temporal_offset:ge}))(Z.skyboxMatrix,C.getCenter(I,!1),0,L,D);I.uploadCommonUniforms(V,q),q.draw(I,j.TRIANGLES,O,Pn.disabled,I.colorModeForRenderPass(),In.backCW,ee,"skybox",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)})(l,r,v,f,b):_==="gradient"&&l.renderPass==="sky"&&(function(I,C,O,L,D){const V=I.context,j=V.gl,Z=I.transform,q=I.getOrCreateProgram("skyboxGradient");C.skyboxGeometry||(C.skyboxGeometry=new Jh(V)),V.activeTexture.set(j.TEXTURE0);let ee=C.colorRampTexture;ee||(ee=C.colorRampTexture=new s.T(V,C.colorRamp,j.RGBA8)),ee.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ie=((te,ye,pe,ge,ue)=>({u_matrix:te,u_color_ramp:0,u_center_direction:ye,u_radius:s.an(pe),u_opacity:ge,u_temporal_offset:ue}))(Z.skyboxMatrix,C.getCenter(I,!1),C.paint.get("sky-gradient-radius"),L,D);I.uploadCommonUniforms(V,q),q.draw(I,j.TRIANGLES,O,Pn.disabled,I.colorModeForRenderPass(),In.backCW,ie,"skyboxGradient",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)})(l,r,v,f,b)},custom:function(l,t,r,c){const f=l.context,g=r.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&r.isDraped(t)){if(l.renderPass==="offscreen"){const _=g.prerender;if(_){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const v=l.transform.pointMerc;_.call(g,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.aj(l.transform.zoom),[v.x,v.y],l.transform.pixelsPerMeterRatio)}else _.call(g,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const v=g.renderToTile;if(v){const b=c[0].canonical,I={x:b.x+c[0].wrap*(g.wrapTileId?0:1<<b.z),y:b.y,z:b.z};f.setDepthMode(an.disabled),f.setStencilMode(Pn.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),v.call(g,f.gl,I),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(Pn.disabled);const _=g.renderingMode==="3d"?new an(l.context.gl.LEQUAL,an.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,an.ReadOnly);if(f.setDepthMode(_),l.transform.projection.name==="globe"){const v=l.transform.pointMerc;g.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.aj(l.transform.zoom),[v.x,v.y],l.transform.pixelsPerMeterRatio)}else g.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,r,c){if(l.renderPass==="opaque")return;const f=r.paint.get("model-opacity").constantOr(1),g=r.paint.get("model-elevation-reference"),_=g==="ground",v=g==="ground";if(f===0)return;const b=r.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!b||l.terrain&&f<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const I=l.shadowRenderer,C=r.paint.get("model-receive-shadows");I&&(I.useNormalOffset=!0,C||(I.enabled=!1));const O=()=>{I&&(I.useNormalOffset=!0,C||(I.enabled=!0))},L=t.getSource();if(l.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return(function(te,ye,pe,ge,ue){const le=te.transform,xe=le.projection.name==="globe",Re=le.getFreeCameraOptions().position;if(!te.modelManager)return;const Ae=te.modelManager;pe.modelManager=Ae;const $e=te.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const He=pe._unevaluatedLayout._values["model-id"],it=Object.assign({},pe.layout.get("model-id").parameters),xt=te.style.order.indexOf(pe.fqid),Ne=pe.paint.get("model-opacity").constantOr(1);for(const Ee of ge){const We=ye.getTile(Ee).getBucket(pe);if(!We||We.projection.name!==le.projection.name)continue;const Ue=We.getModelUris();if(Ue&&!We.modelsRequested&&(Ae.addModelsFromBucket(Ue,ue),We.modelsRequested=!0),xe)it.zoom=Ee.overscaledZ;else{const Bt=xs(Ee,le);it.zoom=Bt}const dt=He.possiblyEvaluate(it);if(Rp(te,We,Ee),ol.shadowUniformsInitialized=!1,ol.useSingleShadowCascade=!!$e&&$e.getMaxCascadeForTile(Ee.toUnwrapped())===0,te.renderPass==="shadow"&&$e){if(te.currentShadowCascade===1&&We.isInsideFirstShadowMapFrustum)continue;const Bt=le.calculatePosMatrix(Ee.toUnwrapped(),le.worldSize);if(ol.tileMatrix.set(Bt),ol.shadowTileMatrix=Float32Array.from($e.calculateShadowPassMatrixFromMatrix(Bt)),ol.aabb.min=[0,0,0],ol.aabb.max[0]=ol.aabb.max[1]=s.al,ol.aabb.max[2]=0,zp(We,ol,te,pe.scope))continue}const Rt=1<<Ee.canonical.z,Lt=[((Re.x-Ee.wrap)*Rt-Ee.canonical.x)*s.al,(Re.y*Rt-Ee.canonical.y)*s.al,Re.z*Rt*s.al];te.conflationActive&&Object.keys(We.instancesPerModel).length>0&&te.style.isLayerClipped(pe,ye.getSource())&&We.updateReplacement(Ee,te.replacementSource,xt,pe.scope)&&(We.uploaded=!1,We.upload(te.context));let At=0;const wt=new Array,tn=new Array,Yt=new Array;for(let Bt in We.instancesPerModel){const Ht=We.instancesPerModel[Bt];Ht.features.length>0&&!xe&&(Bt=dt.evaluate(Ht.features[0].feature,{}));const _n=Ae.getModel(Bt,ue);if(_n||Ae.hasURLBeenRequested(Bt)||We.modelUris.includes(Bt)||(We.modelUris.push(Bt),We.modelsRequested=!1),_n&&_n.uploaded)if(xe){const An=s.c5([],[Re.x,Re.y,Re.z],te.transform.worldSize);s.ew(An,An);for(let si=0;si<Ht.instancedDataArray.length;++si){const Ri=[0,0,0],Kt=[1,1,1],wi=s.ex(),Mn=Ht.tileCoordinatesForInstance(si),Ai=Ht.transformForInstance(si);s.ey(Kt,Ai),s.ez(wi,Ai),s.eA(Ri,wi);const ji=Ht.translationForInstance(si),Fi=new s.aT(0,0);s.eB(We.canonical,Fi,Mn.x,Mn.y);const Ii=s.bC();s.eC(Ii,_n,te.transform,Fi,Ri,Kt,ji,!0,!1,!1);const Gn=Ht.colorForInstance(si),zi=s.bA([]),_r=s.ef(Fi.lat,te.transform.zoom),ur=s.bq([],[1,1,1/_r]);s.br(zi,zi,An),Yt.push({zScaleMatrix:ur,negCameraPosMatrix:zi});for(const Ci of _n.nodes)Ic(te,Ci,Ii,te.transform.expandedFarZProjMatrix,At,wt,tn,_n.materialOverrides,Ne,Gn);++At}}else for(const An of _n.nodes)kp(te,pe,An,Ht,Lt,Ee,ol)}if(xe)if(te.renderPass==="shadow"){for(const Bt of tn)Ta(Bt.mesh,Bt.nodeModelMatrix,te,pe);for(const Bt of wt)Ta(Bt.mesh,Bt.nodeModelMatrix,te,pe)}else Qf(te,pe,wt,tn,Yt)}})(l,t,r,c,nh(l,r)),void O();if(!L.loaded())return;if(L.type==="batched-model")return(function(te,ye,pe,ge){pe.resetLayerRenderingStats(te);const ue=te.context,le=te.transform,xe=te.style.fog,Re=te.shadowRenderer;if(le.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);const Ae=te.transform.getFreeCameraOptions().position,$e=s.c5([],[Ae.x,Ae.y,Ae.z],te.transform.worldSize),He=s.ew([],$e),it=s.bA([]),xt=s.ef(le.center.lat,le.zoom),Ne=s.bq([],[1,1,1/xt]);s.br(it,it,He);const Ee=pe.paint.get("model-opacity").constantOr(1),We=new an(ue.gl.LEQUAL,an.ReadWrite,te.depthRangeFor3D),Ue=new an(ue.gl.LEQUAL,an.ReadOnly,te.depthRangeFor3D),dt=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Rt=te.renderPass==="shadow",Lt=Rt&&Re?Re.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),At=pe.paint.get("model-front-cutoff"),wt=At[2]<1,tn=Zl(te,pe.paint.get("model-cutoff-fade-range")),Yt=pe.getLayerRenderingStats();(function(Bt,Ht,_n,An){const si=Bt.terrain?Bt.terrain.exaggeration():0,Ri=Bt.transform.zoom;for(const Kt of An){const wi=Ht.getTile(Kt).getBucket(_n);wi&&(wi.setFilter(_n.filter),Bt.conflationActive&&wi.updateReplacement(Kt,Bt.replacementSource),wi.evaluateTransform(Bt,_n),Bt.terrain&&si>0&&wi.elevationUpdate(Bt.terrain,si,Kt,_n.source),wi.needsReEvaluation(Bt,Ri,_n)&&wi.evaluate(_n))}})(te,ye,pe,ge),(function(){let Bt,Ht,_n;wt?(Bt=ge.length-1,Ht=-1,_n=-1):(Bt=0,Ht=ge.length,_n=1);const An=new Float64Array(16),si=s.cA(),Ri=new s.P(0,0);for(let Kt=Bt;Kt!==Ht;Kt+=_n){const wi=ge[Kt],Mn=ye.getTile(wi).getBucket(pe);if(!Mn||!Mn.uploaded)continue;let Ai=!1;Re&&(Ai=Re.getMaxCascadeForTile(wi.toUnwrapped())===0);const ji=le.calculatePosMatrix(wi.toUnwrapped(),le.worldSize),Fi=Mn.modelTraits;!Rt&&wt&&(s.bl(An,ji),s.af(si,$e,An),Ri.x=si[0],Ri.y=si[1]);const Ii=[];Mn.setFilter(pe.filter);for(const Gn of Mn.getNodesInfo()){if(Gn.hiddenByReplacement||!Gn.node.meshes)continue;const zi=Gn.node;let _r=0;te.terrain&&zi.elevation&&(_r=zi.elevation*te.terrain.exaggeration());const ur=(()=>{const $o=Gn.aabb;return dt.min=[...$o.min],dt.max=[...$o.max],dt.min[2]+=_r,dt.max[2]+=_r,s.af(dt.min,dt.min,ji),s.af(dt.max,dt.max,ji),dt})(),Ci=Gn.evaluatedScale;if(Ci[0]<=1&&Ci[1]<=1&&Ci[2]<=1&&ur.intersects(Lt)===0)continue;if(!Rt&&wt){const $o=.16666666666666666;Gn.cameraCollisionOpacity=$e[0]>ur.min[0]&&$e[0]<ur.max[0]&&$e[1]>ur.min[1]&&$e[1]<ur.max[1]&&$e[2]*xt<ur.max[2]&&zi.footprint&&s.c0(Ri,zi.footprint)?Math.max(Gn.cameraCollisionOpacity-$o,0):Math.min(1,Gn.cameraCollisionOpacity+$o)}const hi=[...ji],Wn=1/s.d7(wi.canonical),tr=zi.anchor?zi.anchor[0]:0,Mr=zi.anchor?zi.anchor[1]:0;s.br(hi,hi,[tr*(Ci[0]-1)+Gn.evaluatedTranslation[0]*Wn,Mr*(Ci[1]-1)+Gn.evaluatedTranslation[1]*Wn,_r+Gn.evaluatedTranslation[2]]),s.cq(Ci,s.eE)||s.cS(hi,hi,Ci);const dr=s.aB([],hi,zi.globalMatrix),Hi=s.aB([],le.expandedFarZProjMatrix,dr),Go=s.aB([],le.expandedFarZProjMatrix,hi),Co=s.aC([],[tr,Mr,_r,1],Hi)[2];zi.hidden=!1;let Ur=Ee;Rt||(wt&&(Ur*=Gn.cameraCollisionOpacity,Ur*=ni(hi,le,Gn.aabb,At)),Ur*=cr(tn,Co)),Ur!==0?Ii.push({nodeInfo:Gn,depth:Co,opacity:Ur,wvpForNode:Hi,wvpForTile:Go,nodeModelMatrix:dr,tileModelMatrix:hi}):zi.hidden=!0}Rt||Ii.sort(((Gn,zi)=>!wt||Gn.opacity===1&&zi.opacity===1?Gn.depth<zi.depth?-1:1:Gn.opacity===1?-1:zi.opacity===1?1:Gn.depth>zi.depth?-1:1));for(const Gn of Ii){const zi=Gn.nodeInfo,_r=zi.node;let ur=s.aB([],Ne,Gn.tileModelMatrix);s.aB(ur,it,ur);const Ci=s.bl([],ur);s.eg(Ci,Ci),s.cS(Ci,Ci,ih),ur=s.aB(ur,ur,_r.globalMatrix);const hi=te.renderPass==="light-beam",Wn=pe.paint.get("model-color-use-theme").constantOr("default")==="none",tr=Fi&s.eI.HasMapboxMeshFeatures,Mr=tr?0:zi.evaluatedRMEA[0][2];for(let dr=0;dr<_r.meshes.length;++dr){const Hi=_r.meshes[dr],Go=dr===_r.lightMeshIndex;let Co=Gn.wvpForNode;if(Go){if(!hi&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}Co=Gn.wvpForTile}else if(hi)continue;const Ur={defines:[]},$o=[];if(!Rt&&Re&&(Re.useNormalOffset=!!Hi.normalBuffer),td(Ur.defines,$o,Hi,te,Wn?null:pe.lut),tr||Ur.defines.push("DIFFUSE_SHADED"),Ai&&Ur.defines.push("SHADOWS_SINGLE_CASCADE"),Yt&&(Rt?Yt.numRenderedVerticesInShadowPass+=Hi.vertexArray.length:Yt.numRenderedVerticesInTransparentPass+=Hi.vertexArray.length),Rt){Ta(Hi,Gn.nodeModelMatrix,te,pe);continue}let es=null;if(xe){const d=th(Gn.nodeModelMatrix,te.transform);if(es=new Float32Array(d),le.projection.name!=="globe"){const m=Hi.aabb.min,w=Hi.aabb.max,[M,B]=xe.getOpacityForBounds(d,m[0],m[1],w[0],w[1]);Ur.overrideFog=M>=lt||B>=lt}}const go=Hi.material;let Sa;go.occlusionTexture&&go.occlusionTexture.offsetScale&&(Sa=go.occlusionTexture.offsetScale,Ur.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ts=te.getOrCreateProgram("model",Ur);!Rt&&Re&&Re.setupShadowsFromMatrix(Gn.tileModelMatrix,Ts,Re.useNormalOffset),te.uploadCommonUniforms(ue,Ts,null,es);const Ns=go.pbrMetallicRoughness;Ns.metallicFactor=.9,Ns.roughnessFactor=.5;const fr=ba(new Float32Array(Co),new Float32Array(ur),new Float32Array(Ci),new Float32Array(_r.globalMatrix),te,Gn.opacity,Ns.baseColorFactor,go.emissiveFactor,Ns.metallicFactor,Ns.roughnessFactor,go,Mr,pe,[0,0,0],Sa);!Go&&(zi.hasTranslucentParts||Gn.opacity<1)&&Ts.draw(te,ue.gl.TRIANGLES,We,Pn.disabled,On.disabled,In.backCCW,fr,pe.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,pe.paint,te.transform.zoom,void 0,$o),Ts.draw(te,ue.gl.TRIANGLES,Go?Ue:We,Pn.disabled,Go||Gn.opacity<1||zi.hasTranslucentParts?On.alphaBlended:On.unblended,In.backCCW,fr,pe.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,pe.paint,te.transform.zoom,void 0,$o)}}}})()})(l,t,r,c),void O();if(L.type!=="model")return;const D=L.getModels(),V=[],j=l.transform.getFreeCameraOptions().position,Z=s.c5([],[j.x,j.y,j.z],l.transform.worldSize);s.ew(Z,Z);const q=[],ee=[];let ie=0;for(const te of D){const ye=t.getFeatureState("",te.id),pe={type:"Unknown",id:te.id,properties:te.featureProperties},ge=r.paint.get("model-rotation").evaluate(pe,ye),ue=r.paint.get("model-scale").evaluate(pe,ye),le=r.paint.get("model-translation").evaluate(pe,ye),xe=r.paint.get("model-opacity").evaluate(pe,ye);Kf(r,te.id,ye,te.featureProperties,te.nodeOverrideNames,te.nodeOverrides),Jf(r,te.id,ye,te.featureProperties,te.materialOverrideNames,te.materialOverrides),te.nodeOverrides.size>0&&te.computeBoundsAndApplyParent(),te.computeModelMatrix(l,ge,ue,le,v,_,!1);const Re=s.bA([]),Ae=s.ef(te.position.lat,l.transform.zoom),$e=s.bq([],[1,1,1/Ae]);s.br(Re,Re,Z),V.push({zScaleMatrix:$e,negCameraPosMatrix:Re});for(const He of te.nodes)Ic(l,He,te.matrix,l.transform.expandedFarZProjMatrix,ie,q,ee,te.materialOverrides,xe);ie++}if(q.sort(((te,ye)=>ye.depth-te.depth)),l.renderPass!=="shadow")Qf(l,r,q,ee,V),O();else{for(const te of ee)Ta(te.mesh,te.nodeModelMatrix,l,r);for(const te of q)Ta(te.mesh,te.nodeModelMatrix,l,r);O()}}},rd={line:function(l,t,r){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const f of c){const g=t.getTile(f).getBucket(l);if(g&&(g.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,r){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,nh(r,l)));if(c.type==="batched-model"||c.type!=="model")return;const f=c.getModels();for(const g of f)g.upload(r.context)},raster:function(l,t,r){const c=t.getSource();if(!(c instanceof Oo&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const g=l.paint.get("raster-array-band")||c.getInitialBand(f);if(g==null)return;const _=t.getIds().map((v=>t.getTileByID(v)));for(const v of _)v.updateNeeded(l.id,g)&&c.prepareTile(v,f,l.id,g)},"raster-particle":function(l,t,r){const c=t.getSource();if(!(c instanceof Oo&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const g=l.paint.get("raster-particle-array-band")||c.getInitialBand(f);if(g==null)return;const _=t.getIds().map((v=>t.getTileByID(v)));for(const v of _)v.updateNeeded(l.id,g)&&c.prepareTile(v,f,l.id,g)}},sa={fill:kl},od={fill:function(l,t,r,c){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const f=l.context.gl,g=new an(f.LEQUAL,an.ReadOnly,l.depthRangeFor3D),_=new Pn({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),v=l.transform.getFreeCameraOptions().position,b=l.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const I of c){const C=t.getTile(I),O=C.getBucket(r);if(!O)continue;const L=O.elevatedStructures;if(!L||L.depthSegments.segments[0].primitiveLength===0)continue;const D=Qu(I.toUnwrapped(),v),V=l.translatePosMatrix(I.projMatrix,C,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),j=Tc(V,D,0,1,0);b.draw(l,f.TRIANGLES,g,_,On.disabled,In.disabled,j,r.id,L.vertexBuffer,L.indexBuffer,L.depthSegments,r.paint,l.transform.zoom)}}};class uf{constructor(t,r,c,f,g){this.context=new ia(t,r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const _=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const b of _)this._debugParams.enabledLayers[b]=!0;for(const b of _);this.occlusionParams=new rh,this.setup(),this.numSublayers=Ks.maxUnderzooming+Ks.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new zu(this),this._wireframeDebugCache=new Ac,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const v=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,v,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=f,this.worldview=g,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,r){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ta(this,t));const f=this._terrain;this.transform.elevation=c?f:null,f.update(t,this.transform,r),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,f]=r.getFovAdjustedRange(this.transform._fov);if(c>f)return void(this.transform.fogCullDistSq=null);const g=c+.78*(f-c);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new ta(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*s.o.devicePixelRatio,this.height=r*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,r=new s.bd;r.emplaceBack(0,0),r.emplaceBack(s.al,0),r.emplaceBack(0,s.al),r.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(r,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(c,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const f=new s.bd;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const g=new s.b1;g.emplaceBack(0,0,0,0),g.emplaceBack(s.al,0,s.al,0),g.emplaceBack(0,s.al,0,s.al),g.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(g,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const _=new s.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const v=new s.be;for(const I of[0,1,3,2,0])v.emplaceBack(I);this.debugIndexBuffer=t.createIndexBuffer(v),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bC();const b=this.context.gl;this.stencilClearMode=new Pn({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,an.disabled,this.stencilClearMode,On.disabled,In.disabled,Na(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,c){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let v=!1;for(const b of c)if(this._tileClippingMaskIDs[b.key]===void 0){v=!0;break}if(!v)return}this.currentStencilSource=r.id;const f=this.context,g=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(On.disabled),f.setDepthMode(an.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of c){const b=r.getTile(v),I=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,{tileBoundsBuffer:C,tileBoundsIndexBuffer:O,tileBoundsSegments:L}=this.getTileBoundsBuffers(b);_.draw(this,g.TRIANGLES,an.disabled,new Pn({func:g.ALWAYS,mask:0},I,255,g.KEEP,g.KEEP,g.REPLACE),On.disabled,In.disabled,Na(v.projMatrix),"$clipping",C,O,L)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Pn({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new Pn({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,c=t.sort(((_,v)=>v.overscaledZ-_.overscaledZ)),f=c[c.length-1].overscaledZ,g=c[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const _={};for(let v=0;v<g;v++)_[v+f]=new Pn({func:r.GEQUAL,mask:255},v+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=g,[_,c]}return[{[f]:Pn.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new On([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?On.unblended:On.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new On([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new On([r.ONE,r.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,r.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,r,c,f=!1){if(this.depthOcclusion)return new an(this.context.gl.GREATER,an.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return an.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new an(c||this.context.gl.LEQUAL,r,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),c=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&c!==0&&(this.depthFBO=new qf(this.context,r,c,0,"texture"),this.depthTexture=new s.T(this.context,{width:r,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,c,0,0,r,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,r)=>t+r/this._fpsHistory.length),0))}render(t,r){const c=s.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const f=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),_=()=>this.style._getOrder(g).filter((Ne=>{const Ee=f[Ne];return!(Ee.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ee.type]}));let v=_(),b=!1,I=!1,C=null,O=0,L=!1;for(const Ne of v){const Ee=f[Ne];Ee.visibility!=="none"&&(Ee.type==="circle"?b=!0:Ee.type==="building"?(C=Ee,++O):Ee.type==="symbol"&&(Ee.hasOcclusionOpacityProperties?I=!0:b=!0))}this.updateEmissiveMode();let D=v.map((Ne=>f[Ne]));const V=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Ne in V){const Ee=V[Ne];Ee.used&&(Ee.prepare(this.context),Ee.getSource().usedInConflation&&++O)}let j=!1;for(const Ne of D)Ne.isHidden(this.transform.zoom)||(Ne.type==="clip"&&(j=!0),this.prepareLayer(Ne));const Z={},q={},ee={},ie={},te={};for(const Ne in V){const Ee=V[Ne];Z[Ne]=Ee.getVisibleCoordinates(),q[Ne]=Z[Ne].slice().reverse(),ee[Ne]=Ee.getVisibleCoordinates(!0).reverse(),ie[Ne]=Ee.getShadowCasterCoordinates(),te[Ne]=Ee.sortCoordinatesByDistance(Z[Ne])}const ye=Ne=>{const Ee=this.style.getLayerSourceCache(Ne);return Ee&&Ee.used?Ee.getSource():null};if(O||j||this._clippingActiveLastFrame){const Ne=[],Ee=[];let We=0;for(const Ue of D)this.isSourceForClippingOrConflation(Ue,ye(Ue))&&(Ne.push(Ue),Ee.push(We)),We++;if(Ne&&(j||Ne.length>1)||this._clippingActiveLastFrame){j=!1;const Ue=[];for(let dt=0;dt<Ne.length;dt++){const Rt=Ne[dt],Lt=Ee[dt],At=this.style.getLayerSourceCache(Rt);if(!At||!At.used||!At.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let wt=s.eQ,tn=s.b_.None;const Yt=[];let Bt=!0;if(Rt.type==="building")wt=s.eS;else if(Rt.type==="clip"){wt=Lt;for(const Ht of Rt.layout.get("clip-layer-types"))tn|=Ht==="model"?s.b_.Model:Ht==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const Ht of Rt.layout.get("clip-layer-scope"))Yt.push(Ht);Rt.isHidden(this.transform.zoom)?Bt=!1:j=!0}Bt&&Ue.push({layer:Rt.fqid,cache:At,order:wt,clipMask:tn,clipScope:Yt})}this.replacementSource.setSources(Ue),L=!0}}this._clippingActiveLastFrame=j,L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ne=0;Ne<D.length;Ne++){const Ee=D[Ne];if(Ee.visibility==="none")continue;const We=Ee.cutoffRange();if(this.longestCutoffRange=Math.max(We,this.longestCutoffRange),We>0){const Ue=ye(Ee);Ue&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom)),Ee.minzoom&&(this.minCutoffZoom=Math.max(Ee.minzoom,this.minCutoffZoom))}Ee.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ne),this._lastOcclusionLayer=Ne)}const pe=this.style&&this.style.fog;pe?(this._fogVisible=pe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=pe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,v=_(),D=v.map((Ne=>f[Ne])));const ge=this._shadowRenderer;if(ge){ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ne in V)for(const Ee of Z[Ne]){let We={min:0,max:0};this.terrain&&(We=this.terrain.getMinMaxForTile(Ee)||We),ge.addShadowReceiver(Ee.toUnwrapped(),We.min,We.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Qh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ue&&!this._snow&&(this._snow=new cf(this)),!ue&&this._snow&&(this._snow.destroy(),delete this._snow),le&&!this._rain&&(this._rain=new sh(this)),!le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),C){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ed);const Ne=this.style.getLayerSourceCache(C);this.buildingTileBorderManager.updateBorders(Ne,C)}if(!vo.has(this.context.gl))return;this.renderPass="offscreen";for(const Ne of D){const Ee=t.getLayerSourceCache(Ne);if(!Ne.hasOffscreenPass()||Ne.isHidden(this.transform.zoom))continue;const We=Ee?q[Ee.id]:void 0;(Ne.type==="custom"||Ne.type==="raster"||Ne.type==="raster-particle"||Ne.isSky()||We&&We.length)&&this.renderLayer(this,Ee,Ne,We)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(r.showOverdrawInspector)return s.ao.black;const Ne=this.style.fog;if(Ne&&this.transform.projection.supportsFog){const Ee=this.style.getLut(Ne.scope);if(!xe){const We=Ne.properties.get("color-use-theme")==="none",Ue=Ne.properties.get("color").toNonPremultipliedRenderColor(We?null:Ee).toArray01();return new s.ao(...Ue)}if(xe){const We=Ne.properties.get("space-color-use-theme")==="none",Ue=Ne.properties.get("space-color").toNonPremultipliedRenderColor(We?null:Ee).toArray01();return new s.ao(...Ue)}}return s.ao.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Ne=D[this.currentLayer],Ee=t.getLayerSourceCache(Ne);if(Ne.isSky())continue;const We=Ee?(Ne.is3D(g)?te:q)[Ee.id]:void 0;this._renderTileClippingMasks(Ne,Ee,We),this.renderLayer(this,Ee,Ne,We)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Ne=D[this.currentLayer],Ee=t.getLayerSourceCache(Ne);Ne.isSky()&&this.renderLayer(this,Ee,Ne,Ee?q[Ee.id]:void 0)}function Ae(Ne,Ee){let We;return Ee&&(We=(Ne.type==="symbol"?ee:Ne.is3D(g)?te:q)[Ee.id]),We}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const Ne=D[this.currentLayer];if(Ne.type==="raster"||Ne.type==="raster-particle"){const Ee=t.getLayerSourceCache(Ne);this.renderLayer(this,Ee,Ne,Ae(Ne,Ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let $e=0;ge&&($e=ge.getShadowCastingLayerCount());let He=!1,it=-1;for(let Ne=0;Ne<v.length;++Ne){const Ee=D[Ne];Ee.isHidden(this.transform.zoom)||Ee.is3D(g)&&(it=Ne)}I&&it===-1&&(b=!0);let xt=!1;for(;this.currentLayer<v.length;){const Ne=D[this.currentLayer],Ee=t.getLayerSourceCache(Ne);if(Ne.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ne)){if(Ne.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!xt&&Ne.is3D(g)&&!g){const We=this.currentLayer,Ue=dt=>{for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const Rt=D[this.currentLayer];if(sa[Rt.type]){const Lt=this.style.getLayerSourceCache(Rt);sa[Rt.type](this,Lt,Rt,Ae(Rt,Lt),dt)}}};Ue("initialize"),Ue("reset"),this.currentLayer=We,xt=!0}if(b&&!He&&this.terrain&&!this.transform.isOrthographic&&(He=!0,this.blitDepth()),I&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ne,Ee,Ee?Z[Ee.id]:void 0),this.renderLayer(this,Ee,Ne,Ae(Ne,Ee)),!this.terrain&&ge&&$e>0&&Ne.hasShadowPass()&&--$e==0){{this.clearStencil(),this.resetStencilClippingMasks();const We=this.currentLayer;for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const Ue=D[this.currentLayer];if(od[Ue.type]){const dt=this.style.getLayerSourceCache(Ue);od[Ue.type](this,dt,Ue,Ae(Ue,dt))}}this.currentLayer=We}if(ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const We=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=We;this.currentLayer++){const Ue=D[this.currentLayer];if(!Ue.hasLightBeamPass())continue;const dt=t.getLayerSourceCache(Ue);this.renderLayer(this,dt,Ue,dt?q[dt.id]:void 0)}this.currentLayer=We,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const We=this.currentLayer;this.depthOcclusion=!0;for(const Ue of this.layersWithOcclusionOpacity){this.currentLayer=Ue;const dt=D[this.currentLayer],Rt=t.getLayerSourceCache(dt),Lt=Rt?q[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(dt,Rt,Rt?Z[Rt.id]:void 0),this.renderLayer(this,Rt,dt,Lt)}this.depthOcclusion=!1,this.currentLayer=We,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ne=null;D.forEach((Ee=>{const We=t.getLayerSourceCache(Ee);We&&!Ee.isHidden(this.transform.zoom)&&We.getVisibleCoordinates().length&&(!Ne||Ne.getSource().maxzoom<We.getSource().maxzoom)&&(Ne=We)})),Ne&&this.options.showTileBoundaries&&Tt(this,Ne,Ne.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Tt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Ne){const Ee=Ne.transform.padding;rc(Ne,Ne.transform.height-(Ee.top||0),3,nf),rc(Ne,Ee.bottom||0,3,rf),Tr(Ne,Ee.left||0,3,of),Tr(Ne,Ne.transform.width-(Ee.right||0),3,vs);const We=Ne.transform.centerPoint;(function(Ue,dt,Rt,Lt){Le(Ue,dt-1,Rt-10,2,20,Lt),Le(Ue,dt-10,Rt-1,20,2,Lt)})(Ne,We.x,Ne.transform.height-We.y,Jo)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,c=!r||!r.includes(t.type);if(rd[t.type]&&(c||this.terrain&&t.type==="custom")){const f=this.style.getLayerSourceCache(t);rd[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,r,c,f){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||f&&f.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||sc[c.type](t,r,c,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,c=this.context.gl;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),f.calls++,c.beginQuery(r.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,c=r.createQuery();this.deferredRenderGpuTimeQueries.push(c),r.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const c in t){const f=t[c],g=this.context.extTimerQuery,_=g.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(f.query),r[c]=_}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let c=0;for(const f of t)c+=r.getQueryParameter(f,r.QUERY_RESULT)/1e6,r.deleteQuery(f);return c}translatePosMatrix(t,r,c,f,g){if(!c[0]&&!c[1])return t;const _=g?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(_){const I=Math.sin(_),C=Math.cos(_);c=[c[0]*C-c[1]*I,c[0]*I+c[1]*C]}const v=[g?c[0]:s.ay(r,c[0],this.transform.zoom),g?c[1]:s.ay(r,c[1],this.transform.zoom),0],b=new Float32Array(16);return s.br(b,t,v),b}saveTileTexture(t){if(t.context!==this.context)return;const r=t.size[0],c=this._tileTextures[r];c?c.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,c){const f=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||f||r!==void 0&&!r||g.push("FOG","FOG_DITHERING"),f&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,r){this.cache=this.cache||{};const c=r&&r.defines||[],f=r&&r.config,g=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(c),_=Ml.cacheKey(Dh[t],t,g,f);return this.cache[_]||(this.cache[_]=new Ml(this.context,t,Dh[t],f,Xh[t],g)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const c=this.style.directionalLight,f=this.style.ambientLight;if(c&&f){const g=((_,v,b)=>{const I=_.properties.get("direction"),C=_.properties.get("color-use-theme")==="none",O=_.properties.get("color").toNonPremultipliedRenderColor(C?null:b.getLut(_.scope)).toArray01(),L=_.properties.get("intensity"),D=v.properties.get("color-use-theme")==="none",V=v.properties.get("color").toNonPremultipliedRenderColor(D?null:b.getLut(v.scope)).toArray01(),j=v.properties.get("intensity"),Z=[I.x,I.y,I.z],q=s.dN(V,j),ee=s.dN(O,L);return{u_lighting_ambient_color:q,u_lighting_directional_dir:Z,u_lighting_directional_color:ee,u_ground_radiance:os(Z,ee,q)}})(c,f,this.style);r.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,r,c,f,g){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch),b=((I,C,O,L,D,V,j,Z,q,ee,ie,te)=>{const ye=I.transform,pe=C.properties.get("color-use-theme")==="none",ge=C.properties.get("color").toNonPremultipliedRenderColor(pe?null:I.style.getLut(C.scope)).toArray01();ge[3]=L;const ue=I.frameCounter/1e3%1,[le,xe]=C.properties.get("vertical-range");return{u_fog_matrix:O?ye.calculateFogTileMatrix(O):te||I.identityMat,u_fog_range:C.getFovAdjustedRange(ye._fov),u_fog_color:ge,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,xe),xe],u_fog_temporal_offset:ue,u_frustum_tl:D,u_frustum_tr:V,u_frustum_br:j,u_frustum_bl:Z,u_globe_pos:q,u_globe_radius:ee,u_viewport:ie,u_globe_transition:s.aj(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,_,c,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],f);r.setFogUniformValues(t,b)}g&&r.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const f of c)r[f.key]=t[f.key]||new Ys(f,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=lt||r[1]>=lt}setupDepthForOcclusion(t,r,c){const f=this.context,g=f.gl,_=!!c;var v;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((v=this.depthRangeFor3D)[1]-v[0]),-1-2*v[0]/(v[1]-v[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),f.activeTexture.set(g.TEXTURE0),_||r.setTerrainUniformValues(f,c)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function cs(l,t){let r=!1,c=null;const f=()=>{c=null,r&&(l(),c=setTimeout(f,t),r=!1)};return()=>(r=!0,c||f(),c)}class us{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=cs(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Jr(t);if(this._hashName){const c=this._hashName;let f=!1;const g=location.hash.slice(1).split("&").map((_=>{const v=_.split("=")[0];return v===c?(f=!0,`${v}=${r}`):_})).filter((_=>_));return f||g.push(`${c}=${r}`),`#${g.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(r=c)})),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some((c=>isNaN(Number(c))))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Jr(l,t){const r=l.getCenter(),c=Math.round(100*l.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),_=Math.round(r.lng*g)/g,v=Math.round(r.lat*g)/g,b=l.getBearing(),I=l.getPitch();let C=t?`/${_}/${v}/${c}`:`${c}/${v}/${_}`;return(b||I)&&(C+="/"+Math.round(10*b)/10),I&&(C+=`/${Math.round(I)}`),C}const nu={linearity:.3,easing:s.eT(0,0,.3,1)},hf=Object.assign({deceleration:2500,maxSpeed:1400},nu),df=Object.assign({deceleration:20,maxSpeed:1400},nu),Cc=Object.assign({deceleration:1e3,maxSpeed:360},nu),sd=Object.assign({deceleration:1e3,maxSpeed:90},nu);class ff{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)r.zoom+=g.zoomDelta||0,r.bearing+=g.bearingDelta||0,r.pitch+=g.pitchDelta||0,g.panDelta&&r.pan._add(g.panDelta),g.around&&(r.around=g.around),g.pinchAround&&(r.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(r.pan.mag()){const g=al(r.pan.mag(),c,Object.assign({},hf,t||{}));f.offset=r.pan.mult(g.amount/r.pan.mag()),f.center=this._map.transform.center,Mc(f,g)}if(r.zoom){const g=al(r.zoom,c,df);f.zoom=this._map.transform.zoom+g.amount,Mc(f,g)}if(r.bearing){const g=al(r.bearing,c,Cc);f.bearing=this._map.transform.bearing+s.aA(g.amount,-179,179),Mc(f,g)}if(r.pitch){const g=al(r.pitch,c,sd);f.pitch=this._map.transform.pitch+g.amount,Mc(f,g)}if(f.zoom||f.bearing){const g=r.pinchAround===void 0?r.around:r.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Mc(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function al(l,t,r){const{maxSpeed:c,linearity:f,deceleration:g}=r,_=s.aA(l*f/(t/1e3),-c,c),v=Math.abs(_)/(g*f);return{easing:r.easing,duration:1e3*v,amount:_*(v/2)}}class bs extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,f={}){const g=Mt(r.getCanvasContainer(),c),_=r.unproject(g);super(t,Object.assign({point:g,lngLat:_,originalEvent:c},f)),this._defaultPrevented=!1,this.target=r}}class Dl extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const f=t==="touchend"?c.changedTouches:c.touches,g=Rn(r.getCanvasContainer(),f),_=g.map((b=>r.unproject(b))),v=g.reduce(((b,I,C,O)=>b.add(I.div(O.length))),new s.P(0,0));super(t,{points:g,point:v,lngLats:_,lngLat:r.unproject(v),originalEvent:c}),this._defaultPrevented=!1}}class ad extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class ld{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new ad(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new bs(t.type,this._map,t))}mouseup(t){this._map.fire(new bs(t.type,this._map,t))}preclick(t){const r=new MouseEvent("preclick",t);this._map.fire(new bs(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new bs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new bs(t.type,this._map,t))}mouseover(t){this._map.fire(new bs(t.type,this._map,t))}mouseout(t){this._map.fire(new bs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Dl(t.type,this._map,t))}touchmove(t){this._map.fire(new Dl(t.type,this._map,t))}touchend(t){this._map.fire(new Dl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Dl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new bs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new bs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class iu{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ct(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r,f=this._startPos,g=this._lastPos;if(!f||!g||g.equals(c)||!this._box&&c.dist(f)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Ce("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(f.x,c.x),v=Math.max(f.x,c.x),b=Math.min(f.y,c.y),I=Math.max(f.y,c.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${_}px,${b}px)`,this._box.style.width=v-_+"px",this._box.style.height=I-b+"px")}))}mouseupWindow(t,r){if(!this._active)return;const c=this._startPos,f=r;if(c&&t.button===0){if(this.reset(),jt(),c.x!==f.x||c.y!==f.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tt(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.z(t,{originalEvent:r}))}}function pf(l,t){const r={};for(let c=0;c<l.length;c++)r[l[c].identifier]=t[c];return r}class tp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const g=new s.P(0,0);for(const _ of f)g._add(_);return g.div(f.length)})(r),this.touches=pf(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const f=pf(c,r);for(const g in this.touches){const _=f[g];(!_||_.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ah{constructor(t){this.singleTap=new tp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const f=this.singleTap.touchend(t,r,c);if(f){const g=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(f)<30;if(g&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class np{constructor(){this._zoomIn=new ah({numTouches:1,numTaps:2}),this._zoomOut=new ah({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const f=this._zoomIn.touchend(t,r,c),g=this._zoomOut.touchend(t,r,c);return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(f)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ud={0:1,2:2},ll={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class mf{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const c=Kn(t);this._correctButton(t,c)&&(this._lastPoint=r,this._eventButton=c)}mousemoveWindow(t,r){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&(function(f,g){const _=ud[g];return f.buttons===void 0||(f.buttons&_)!==_})(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(c,r)}}mouseupWindow(t){this._lastPoint&&Kn(t)===this._eventButton&&(this._moved&&jt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ip extends mf{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class hd extends mf{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?ll[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=.8*(r.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class gf extends mf{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?ll[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=-.5*(r.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class rp{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,c)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const f=pf(c,r),g=new s.P(0,0),_=new s.P(0,0);let v=0;for(const I in f){const C=f[I],O=this._touches[I];O&&(g._add(C),_._add(C.sub(O)),v++,f[I]=C)}if(this._touches=f,v<this._minTouches||!_.mag())return;const b=_.div(v);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(v),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ce("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Pc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,c){return{}}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){const f=this._firstTwoTouches;if(!f)return;t.preventDefault();const[g,_]=f,v=zo(c,r,g),b=zo(c,r,_);if(!v||!b)return;const I=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],I,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,_=zo(c,r,f),v=zo(c,r,g);_&&v||(this._active&&jt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zo(l,t,r){for(let c=0;c<l.length;c++)if(l[c].identifier===r)return t[c]}function Dp(l,t){return Math.log2(l/t)}class wm extends Pc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Dp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dp(this._distance,c),pinchAround:r}}}function dd(l,t){return 180*l.angleWith(t)/Math.PI}class ki extends Pc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:dd(this._vector,c),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const f=dd(t,c);return Math.abs(f)<r}}function _f(l){return Math.abs(l.y)>Math.abs(l.x)}class Zn extends Pc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,_f(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){const f=this._lastPoints;if(!f)return;const g=t[0].sub(f[0]),_=t[1].sub(f[1]);return this._map._cooperativeGestures&&!s.eU()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(g,_,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+_.y)/2*-.5})}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,g=r.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const _=t.y>0==r.y>0;return _f(t)&&_f(r)&&_}}const lh={panStep:100,bearingStep:15,pitchStep:10};class op{constructor(){const t=lh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,f=0,g=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:v=>{const b=v.getZoom();v.easeTo({duration:300,easeId:"keyboardHandler",easing:ch,zoom:r?Math.round(b)+r*(t.shiftKey?2:1):b,bearing:v.getBearing()+c*this._bearingStep,pitch:v.getPitch()+f*this._pitchStep,offset:[-g*this._panStep,-_*this._panStep],center:v.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ch(l){return l*(2-l)}const sp=4.000244140625,ru=1/450;class ou{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ru,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.o.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%sp==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Mt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>sp?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&C!==0&&(C=1/C);const O=r(),L=Math.pow(2,O),D=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(D*C))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:r(),f=this._startZoom,g=this._easing;let _,v=!1;if(this._type==="wheel"&&f&&g){const I=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),C=g(I);_=s.ak(f,c,C),I<1?this._frameId||(this._frameId=!0):v=!0}else _=c,v=!0;this._active=!0,v&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let b=_-r();return b*this._lastDelta<0&&(b=0),{noInertia:!0,needsRenderFrame:!v,zoomDelta:b,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.eV;if(this._prevEase){const c=this._prevEase,f=(s.o.now()-c.start)/c.duration,g=c.easing(f+.01)-c.easing(f),_=.27/Math.sqrt(g*g+1e-4)*.01,v=Math.sqrt(.0729-_*_);r=s.eT(_,v,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ce("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class cl{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(){this._tap=new ah({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=r[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,r,c))}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=r[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,r,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class su{constructor(t,r,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class uh{constructor(t,r,c,f){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ao=l=>l.zoom||l.drag||l.pitch||l.rotate;class hl extends s.z{}class Ga{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const c=s.av([],r,t);this.radius=s.ag(c[2]<0?s.eX([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.eX(t,t,this.constants),s.aw(t,t),s.eY(t,t,this.constants);const r=s.c5([],t,this.radius);if(r[2]>0){const c=s.c5([],[0,0,1],s.bJ(r,[0,0,1])),f=s.c5([],s.aw([],[r[0],r[1],0]),this.radius),g=s.d8([],r,s.c5([],s.av([],s.d8([],f,c),r),2));r[0]=g[0],r[1]=g[1]}return r}}function pd(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Op{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ff(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ga,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),s.aY(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,_]of this._listeners){const v=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(g,v,_)}}destroy(){for(const[t,r,c]of this._listeners){const f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,f,c)}}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new ld(r,t));const f=r.boxZoom=new iu(r,t);this._add("boxZoom",f);const g=new np,_=new fd;r.doubleClickZoom=new cl(_,g),this._add("tapZoom",g),this._add("clickZoom",_);const v=new Qr;this._add("tapDragZoom",v);const b=r.touchPitch=new Zn(r);this._add("touchPitch",b);const I=new hd(t),C=new gf(t);r.dragRotate=new su(t,I,C),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]);const O=new ip(t),L=new rp(r,t);r.dragPan=new ul(c,O,L),this._add("mousePan",O),this._add("touchPan",L,["touchZoom","touchRotate"]);const D=new ki,V=new wm;r.touchZoomRotate=new uh(c,V,D,v),this._add("touchRotate",D,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cd(r));const j=r.scrollZoom=new ou(r,this);this._add("scrollZoom",j,["mousePan"]);const Z=r.keyboard=new op;this._add("keyboard",Z);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[q]&&r[q].enable(t[q])}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ao(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,c){for(const f in t)if(f!==c&&(!r||r.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}handleEvent(t,r){this._updatingCamera=!0;const c=t.type==="renderFrame",f=c?void 0:t,g={needsRenderFrame:!1},_={},v={},b=t.touches?this._getMapTouches(t.touches):void 0,I=b?Rn(this._el,b):c?void 0:Mt(this._el,t);for(const{handlerName:L,handler:D,allowed:V}of this._handlers){if(!D.isEnabled())continue;let j;this._blockedByActive(v,V,L)?D.reset():D[r||t.type]&&(j=D[r||t.type](t,I,b),this.mergeHandlerResult(g,_,j,L,f),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||D.isActive())&&(v[L]=D)}const C={};for(const L in this._previousActiveHandlers)v[L]||(C[L]=f);this._previousActiveHandlers=v,(Object.keys(C).length||pd(g))&&(this._changes.push([g,_,C]),this._triggerRenderFrame()),(Object.keys(v).length||pd(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=g;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(t,r,c,f,g){if(!c)return;Object.assign(t,c);const _={handlerName:f,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(r.zoom=_),c.panDelta!==void 0&&(r.drag=_),c.pitchDelta!==void 0&&(r.pitch=_),c.bearingDelta!==void 0&&(r.rotate=_)}_applyChanges(){const t={},r={},c={};for(const[f,g,_]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),Object.assign(r,g),Object.assign(c,_);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const f=this._map,g=f.transform,_=ee=>[ee.x,ee.y,ee.z];if((ee=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!pd(t)){const ee=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),ee!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&f._stop(!0),!pd(t))return void this._fireEvents(r,c,!0);let{panDelta:v,zoomDelta:b,bearingDelta:I,pitchDelta:C,around:O,aroundCoord:L,pinchAround:D}=t;g._isCameraConstrained&&(b>0&&(b=0),g._isCameraConstrained=!1),D!==void 0&&(O=D),(b||(ee=>r[ee]&&!this._eventsInProgress[ee])("drag"))&&O&&(this._dragOrigin=_(g.pointCoordinate3D(O)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",f._stop(!0),O=O||f.transform.centerPoint,I&&(g.bearing+=I),C&&(g.pitch+=C),g._updateCameraState();const V=[0,0,0];if(v)if(g.projection.name==="mercator"){const ee=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(O).dir),ie=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(O.sub(v)).dir);V[0]=ie[0]-ee[0],V[1]=ie[1]-ee[1]}else{const ee=g.pointCoordinate(O);if(g.projection.name==="globe"){v=v.rotate(-g.angle);const ie=g._pixelsPerMercatorPixel/g.worldSize;V[0]=-v.x*s.eW(s.a$(ee.y))*ie,V[1]=-v.y*s.eW(g.center.lat)*ie}else{const ie=g.pointCoordinate(O.sub(v));ee&&ie&&(V[0]=ie.x-ee.x,V[1]=ie.y-ee.y)}}const j=g.zoom,Z=[0,0,0];if(b){const ee=_(L||g.pointCoordinate3D(O)),ie={dir:s.aw([],s.av([],ee,g._camera.position))};if(ie.dir[2]<0){const te=g.zoomDeltaToMovement(ee,b);s.c5(Z,ie.dir,te)}}const q=s.d8(V,V,Z);g._translateCameraConstrained(q),b&&Math.abs(g.zoom-j)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const f=Ao(this._eventsInProgress),g=Ao(t),_={};for(const C in t){const{originalEvent:O}=t[C];this._eventsInProgress[C]||(_[`${C}start`]=O),this._eventsInProgress[C]=t[C]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const C in _)this._fireEvent(C,_[C]);g&&this._fireEvent("move",g.originalEvent);for(const C in t){const{originalEvent:O}=t[C];this._fireEvent(C,O)}const v={};let b;for(const C in this._eventsInProgress){const{handlerName:O,originalEvent:L}=this._eventsInProgress[C];this._handlersById[O].isActive()||(delete this._eventsInProgress[C],b=r[O]||L,v[`${C}end`]=b)}for(const C in v)this._fireEvent(C,v[C]);const I=Ao(this._eventsInProgress);if(c&&(f||g)&&!I){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;C?(O(C.bearing||this._map.getBearing())&&(C.bearing=0),this._map.easeTo(C,{originalEvent:b})):(this._map.fire(new s.z("moveend",{originalEvent:b})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new hl("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const aa="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class yf extends s.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,c){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),c)}panTo(t,r,c){return this.easeTo(Object.assign({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(Object.assign({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(Object.assign({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,Object.assign({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=s.aI.convert(t);const c=r&&r.bearing||0,f=r&&r.pitch||0,g=t.getNorthWest(),_=t.getSouthEast();return this._cameraForBounds(this.transform,g,_,c,f,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},r,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const c=r.max[0]-r.min[0],f=r.max[1]-r.min[1];return c/f>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,c,f,g,_){const v=t.clone(),b=this._extendCameraOptions(_);v.bearing=f,v.pitch=g;const I=s.aT.convert(r),C=s.aT.convert(c),O=.5*(I.lat+C.lat),L=.5*(I.lng+C.lng),D=s.eZ(O,L),V=s.aw([],D),j=s.aw([],s.bI([],V,[0,1,0])),Z=s.bI([],j,V),q=[j[0],j[1],j[2],0,Z[0],Z[1],Z[2],0,V[0],V[1],V[2],0,0,0,0,1],ee=[D,s.eZ(I.lat,I.lng),s.eZ(C.lat,I.lng),s.eZ(C.lat,C.lng),s.eZ(I.lat,C.lng),s.eZ(O,I.lng),s.eZ(O,C.lng),s.eZ(I.lat,L),s.eZ(C.lat,L)];let ie=s.d9.fromPoints(ee.map((Ue=>[s.bJ(j,Ue),s.bJ(Z,Ue),s.bJ(V,Ue)])));const te=s.af([],ie.center,q);s.e_(te)===0&&s.e$(te,0,0,1),s.aw(te,te),s.c5(te,te,s.aD),v.center=s.f0(te);const ye=v.getWorldToCameraMatrix(),pe=s.bl(new Float64Array(16),ye);ie=s.d9.applyTransform(ie,s.aB([],ye,q));const ge=this._extendAABB(ie,v,b,f);if(!ge)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=ge,s.af(te,te,ye);const ue=.5*(ie.max[2]-ie.min[2]),le=this._minimumAABBFrustumDistance(v,ie),xe=s.c5([],[0,0,1],ue),Re=s.d8(xe,te,xe),Ae=le+(v.pitch===0?0:s.bG(te,Re)),$e=v.globeCenterInViewSpace,He=s.av([],te,[$e[0],$e[1],$e[2]]);s.aw(He,He),s.c5(He,He,Ae);const it=s.d8([],te,He);s.af(it,it,pe);const xt=s.eM/s.aD,Ne=s.ag(it),Ee=s.cf(Math.max(Ne*xt-s.eM,Number.EPSILON),0),We=Math.min(v.zoomFromMercatorZAdjusted(Ee),b.maxZoom);return We>.5*(s.c_+s.cL)?(v.setProjection({name:"mercator"}),v.zoom=We,this._cameraForBounds(v,r,c,f,g,_)):{center:v.center,zoom:We,bearing:f,pitch:g}}_extendAABB(t,r,c,f){const g=.5*((c.padding.left||0)+(c.padding.right||0)),_=.5*((c.padding.top||0)+(c.padding.bottom||0)),v=_,b=g,I=g,C=_,O=r.width-(b+I),L=r.height-(v+C),D=s.av([],t.max,t.min),V=Math.min(O/D[0],L/D[1]),j=Math.min(r.scaleZoom(r.scale*V),c.maxZoom);if(isNaN(j))return null;const Z=r.scale/r.zoomScale(j),q=new s.d9([t.min[0]-b*Z,t.min[1]-C*Z,t.min[2]],[t.max[0]+I*Z,t.max[1]+v*Z,t.max[2]]),ee=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new s.P(c.offset.x,c.offset.y):s.P.convert(c.offset)).rotate(-s.an(f));return q.center[0]-=ee.x*Z,q.center[1]+=ee.y*Z,q}queryTerrainElevation(t,r){const c=this.transform.elevation;return c?(r=Object.assign({},{exaggerated:!0},r),c.getAtPoint(s.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,c,f,g,_){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,c,f,g,_);const v=t.clone(),b=this._extendCameraOptions(_);v.bearing=f,v.pitch=g;const I=s.aT.convert(r),C=s.aT.convert(c),O=new s.aT(I.lng,C.lat),L=new s.aT(C.lng,I.lat),D=v.project(I),V=v.project(C),j=this.queryTerrainElevation(I),Z=this.queryTerrainElevation(C),q=this.queryTerrainElevation(O),ee=this.queryTerrainElevation(L),ie=[[D.x,D.y,Math.min(j||0,Z||0,q||0,ee||0)],[V.x,V.y,Math.max(j||0,Z||0,q||0,ee||0)]];let te=s.d9.fromPoints(ie);const ye=v.getWorldToCameraMatrix(),pe=s.bl(new Float64Array(16),ye);te=s.d9.applyTransform(te,ye);const ge=this._extendAABB(te,v,b,f);if(!ge)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=ge;const ue=.5*s.av([],te.max,te.min)[2],le=this._minimumAABBFrustumDistance(v,te),xe=[0,0,1,0];s.aC(xe,xe,ye),s.f1(xe,xe);const Re=s.c5([],xe,le+ue),Ae=s.d8([],te.center,Re);s.af(te.center,te.center,pe),s.af(Ae,Ae,pe);const $e=v.unproject(new s.P(te.center[0],te.center[1])),He=s.f2(v.projection,$e),it=Math.pow(2,He),xt=Math.min(v._zoomFromMercatorZ(Ae[2]*v.pixelsPerMeter*it/v.worldSize),b.maxZoom);return v.mercatorFromTransition&&xt<.5*(s.c_+s.cL)?(v.setProjection({name:"globe"}),v.zoom=xt,this._cameraForBounds(v,r,c,f,g,_)):{center:$e,zoom:xt,bearing:f,pitch:g}}fitBounds(t,r,c){const f=this.cameraForBounds(t,r);return this._fitInternal(f,r,c)}fitScreenCoordinates(t,r,c,f,g){const _=s.P.convert(t),v=s.P.convert(r),b=new s.P(Math.min(_.x,v.x),Math.min(_.y,v.y)),I=new s.P(Math.max(_.x,v.x),Math.max(_.y,v.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,v))return this;const C=this.transform.pointLocation3D(b),O=this.transform.pointLocation3D(I),L=this.transform.pointLocation3D(new s.P(b.x,I.y)),D=this.transform.pointLocation3D(new s.P(I.x,b.y)),V=[Math.min(C.lng,O.lng,L.lng,D.lng),Math.min(C.lat,O.lat,L.lat,D.lat)],j=[Math.max(C.lng,O.lng,L.lng,D.lng),Math.max(C.lat,O.lat,L.lat,D.lat)],Z=f&&f.pitch?f.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,V,j,c,Z,f);return this._fitInternal(q,f,g)}_fitInternal(t,r,c){return t?(r=Object.assign(t,r)).linear?this.easeTo(r,c):this.flyTo(r,c):this}jumpTo(t,r){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let f=!1,g=!1,_=!1;"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.aT.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.pitch=+t.pitch);const v=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(v))if(t.retainPadding===!1){const b=c.clone();b.padding=v,c.setLocationAtPoint(c.center,b.centerPoint)}else c.padding=v;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new s.z("movestart",r)).fire(new s.z("move",r)),f&&this.fire(new s.z("zoomstart",r)).fire(new s.z("zoom",r)).fire(new s.z("zoomend",r)),g&&this.fire(new s.z("rotatestart",r)).fire(new s.z("rotate",r)).fire(new s.z("rotateend",r)),_&&this.fire(new s.z("pitchstart",r)).fire(new s.z("pitch",r)).fire(new s.z("pitchend",r)),this.fire(new s.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(aa),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const c=this.transform;if(!c.projection.supportsFreeCamera)return s.w(aa),this;this.stop();const f=c.zoom,g=c.pitch,_=c.bearing;c.setFreeCameraOptions(t);const v=f!==c.zoom,b=g!==c.pitch,I=_!==c.bearing;return this.fire(new s.z("movestart",r)).fire(new s.z("move",r)),v&&this.fire(new s.z("zoomstart",r)).fire(new s.z("zoom",r)).fire(new s.z("zoomend",r)),I&&this.fire(new s.z("rotatestart",r)).fire(new s.z("rotate",r)).fire(new s.z("rotateend",r)),b&&this.fire(new s.z("pitchstart",r)).fire(new s.z("pitch",r)).fire(new s.z("pitchend",r)),this.fire(new s.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,f=this.getZoom(),g=this.getBearing(),_=this.getPitch(),v=this.getPadding(),b="zoom"in t?+t.zoom:f,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,C="pitch"in t?+t.pitch:_,O=this._extendPadding(t.padding),L=s.P.convert(t.offset);let D,V,j;if(c.projection.name==="globe"){const xe=s.ae.fromLngLat(c.center),Re=L.rotate(-c.angle);xe.x+=Re.x/c.worldSize,xe.y+=Re.y/c.worldSize;const Ae=xe.toLngLat(),$e=s.aT.convert(t.center||Ae);this._normalizeCenter($e),D=c.centerPoint.add(Re),V=new s.P(xe.x,xe.y).mult(c.worldSize),j=new s.P(s.aF($e.lng),s.aJ($e.lat)).mult(c.worldSize).sub(V)}else{D=c.centerPoint.add(L);const xe=c.pointLocation(D),Re=s.aT.convert(t.center||xe);this._normalizeCenter(Re),V=c.project(xe),j=c.project(Re).sub(V)}const Z=c.zoomScale(b-f);let q,ee;t.around&&(q=s.aT.convert(t.around),ee=c.locationPoint(q));const ie=this._zooming||b!==f,te=this._rotating||g!==I,ye=this._pitching||C!==_,pe=!c.isPaddingEqual(O),ge=t.retainPadding===!1?c.clone():c,ue=xe=>Re=>{if(ie&&(xe.zoom=s.ak(f,b,Re)),te&&(xe.bearing=s.ak(g,I,Re)),ye&&(xe.pitch=s.ak(_,C,Re)),pe&&(ge.interpolatePadding(v,O,Re),D=ge.centerPoint.add(L)),q)xe.setLocationAtPoint(q,ee);else{const Ae=xe.zoomScale(xe.zoom-f),$e=b>f?Math.min(2,Z):Math.max(.5,Z),He=Math.pow($e,1-Re),it=xe.unproject(V.add(j.mult(Re*He)).mult(Ae));xe.setLocationAtPoint(xe.renderWorldCopies?it.wrap():it,D)}return t.preloadOnly||this._fireMoveEvents(r),xe};if(t.preloadOnly){const xe=this._emulate(ue,t.duration,c);return this._preloadTiles(xe),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=te,this._pitching=ye,this._padding=pe,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,le),this._ease(ue(c),(xe=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(r,xe)}),t),this}_prepareEase(t,r,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||c.moving||this.fire(new s.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,f=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.z("zoomend",t)),f&&this.fire(new s.z("rotateend",t)),g&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Ue=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ue,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},t);const c=this.transform,f=this.getZoom(),g=this.getBearing(),_=this.getPitch(),v=this.getPadding(),b="zoom"in t?s.aA(+t.zoom,c.minZoom,c.maxZoom):f,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,C="pitch"in t?+t.pitch:_,O=this._extendPadding(t.padding),L=c.zoomScale(b-f),D=s.P.convert(t.offset);let V=c.centerPoint.add(D);const j=c.pointLocation(V),Z=s.aT.convert(t.center||j);this._normalizeCenter(Z);const q=c.project(j),ee=c.project(Z).sub(q);let ie=t.curve;const te=Math.max(c.width,c.height),ye=te/L,pe=ee.mag();if("minZoom"in t){const Ue=s.aA(Math.min(t.minZoom,f,b),c.minZoom,c.maxZoom),dt=te/c.zoomScale(Ue-f);ie=Math.sqrt(dt/pe*2)}const ge=ie*ie;function ue(Ue){const dt=(ye*ye-te*te+(Ue?-1:1)*ge*ge*pe*pe)/(2*(Ue?ye:te)*ge*pe);return Math.log(Math.sqrt(dt*dt+1)-dt)}function le(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function xe(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Re=ue(0);let Ae=function(Ue){return xe(Re)/xe(Re+ie*Ue)},$e=function(Ue){return te*((xe(Re)*(le(dt=Re+ie*Ue)/xe(dt))-le(Re))/ge)/pe;var dt},He=(ue(1)-Re)/ie;if(Math.abs(pe)<1e-6||!isFinite(He)){if(Math.abs(te-ye)<1e-6)return this.easeTo(t,r);const Ue=ye<te?-1:1;He=Math.abs(Math.log(ye/te))/ie,$e=function(){return 0},Ae=function(dt){return Math.exp(Ue*ie*dt)}}t.duration="duration"in t?+t.duration:1e3*He/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const it=g!==I,xt=C!==_,Ne=!c.isPaddingEqual(O),Ee=t.retainPadding===!1?c.clone():c,We=Ue=>dt=>{const Rt=dt*He,Lt=1/Ae(Rt);Ue.zoom=dt===1?b:f+Ue.scaleZoom(Lt),it&&(Ue.bearing=s.ak(g,I,dt)),xt&&(Ue.pitch=s.ak(_,C,dt)),Ne&&(Ee.interpolatePadding(v,O,dt),V=Ee.centerPoint.add(D));const At=dt===1?Z:Ue.unproject(q.add(ee.mult($e(Rt))).mult(Lt));return Ue.setLocationAtPoint(Ue.renderWorldCopies?At.wrap():At,V),Ue._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Ue};if(t.preloadOnly){const Ue=this._emulate(We,t.duration,c);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=it,this._pitching=xt,this._padding=Ne,this._prepareEase(r,!1),this._ease(We(c),(()=>this._afterEase(r)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,r)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=s.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=s.bT(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const c=t.lng-r.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,c){const f=Math.ceil(15*r/1e3),g=[],_=t(c.clone());for(let v=0;v<=f;v++){const b=_(v/f);g.push(b.clone())}return g}_preloadTiles(t,r){}}class la{constructor(t={}){this.options=t,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ce("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const f=Ce("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",c),this._innerContainer=Ce("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const c=r.reduce(((f,g,_)=>(g.value&&(f+=`${g.key}=${g.value}${_<r.length-1?"&":""}`),f)),"?");t.href=`${s.e.FEEDBACK_URL}/${c}#${Jr(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const r=this._map.style._mergedSourceCaches;for(const f in r){const g=r[f];if(g.used){const _=g.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort(((f,g)=>f.length-g.length)),t=t.filter(((f,g)=>{for(let _=g+1;_<t.length;_++)if(t[_].indexOf(f)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.map((f=>(function(g){const _=new DOMParser().parseFromString(g,"text/html");return Array.from(_.body.querySelectorAll("*")).forEach((v=>{const b=v.textContent||"";if(v.tagName!=="A")return void v.replaceWith(_.createTextNode(b));const I=v.getAttribute("href");if(!I||!/^(https?:|mailto:)/i.test(I))return void v.replaceWith(_.createTextNode(b));const C=_.createElement("a");C.href=I,C.textContent=b,C.rel="noopener nofollow";const O=v.getAttribute("class");O&&(C.className=O),v.replaceWith(C)})),_.body.innerHTML})(f))).join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class md{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ce("div","mapboxgl-ctrl");const r=Ce("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const c=t[r].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class au{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(r=>this._onIndoorUpdate(r))),this._container}_createButton(t,r){const c=Ce("button",t,this._container);return c.type="button",c.addEventListener("click",r),c}_createSeparator(){return Ce("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,r){this._map&&(t.setAttribute("aria-label",r),t.textContent=r)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const r=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",r&&Array.from(this._container.children).forEach((c=>c.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const r=this._map;this._model&&r&&r._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));Ce("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,r){for(let c=0;c<t.length;c++){const f=t[c],g=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(f.id)}));this._setButtonTitle(g,f.zIndex.toString()),this._model&&f.id===this._model.selectedFloorId&&r&&g.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(g),c<t.length-1&&this._createSeparator()}}}class Ol{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Fl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=s.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,c){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+c}}const Bl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Rc extends s.z{constructor(t,r,c,f){const{point:g,lngLat:_,originalEvent:v,target:b}=t;super(t.type,{point:g,lngLat:_,originalEvent:v,target:b}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=c,this.feature=f}}class ca{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=r.filter;let f=r.type;c&&this.filters.set(t,s.b6(c)),f==="mouseover"&&(f="mouseenter"),f==="mouseout"&&(f="mouseleave");const g=this.interactionsByType.get(f)||new Map;f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):g.size===0&&this.map.on(f,this.handleType),g.size===0&&this.interactionsByType.set(f,g),g.set(t,r),this.typeById.set(t,f)}get(t){const r=this.typeById.get(t);if(!r)return;const c=this.interactionsByType.get(r);return c?c.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(r);c&&(c.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const c=[];for(const[f,g]of r)g.target&&c.push({targetId:f,target:g.target,filter:this.filters.get(f)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const c=new Map;for(const[f,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(f)||c.set(g.id,g);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map((({feature:c})=>c));r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const f=Array.from(this.interactionsByType.get(t.type)).reverse(),g=!!r;r=r||this.queryTargets(t.point,f);let _=!1;const v=new Set;for(const b of r){for(const[I,C]of f){if(!C.target)continue;const O=b.variants?b.variants[I]:null;if(O){for(const L of O){if(mr(L,b,v,I))continue;const D=new s.dx(b,L),V=Gl(L,b,I);g&&D.id!==void 0&&(D.state=this.map.getFeatureState(D));const j=c?this.prevHoveredFeatures.get(V):null,Z=new Rc(t,I,C,D),q=j?j.stop:C.handler(Z);if(c&&this.hoveredFeatures.set(V,{feature:b,stop:q}),q!==!1){_=!0;break}}if(_)break}}if(_)break}if(!_)for(const[b,I]of f){const{handler:C,target:O}=I;if(!O&&C(new Rc(t,b,I,null))!==!1)break}}}function ap(l,t){if(Array.isArray(l)&&Array.isArray(t)){const r=new Set(l),c=new Set(t);return r.size===c.size&&l.every((f=>c.has(f)))}return s.by(l,t)}const $a={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qo{constructor(t,r,c=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new hd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new gf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Ct()}move(t,r){const c=this.map,f=this.mouseRotate.mousemoveWindow(t,r),g=f&&f.bearingDelta;if(g&&c.setBearing(c.getBearing()+g),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,r),v=_&&_.pitchDelta;v&&c.setPitch(c.getPitch()+v)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Mt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Mt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Rn(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Rn(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function wo(l,t,r){if(l=new s.aT(l.lng,l.lat),t){const c=new s.aT(l.lng-360,l.lat),f=new s.aT(l.lng+360,l.lat),g=360*Math.ceil(Math.abs(l.lng-r.center.lng)/360),_=r.locationPoint3D(l).distSqr(t),v=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(c).distSqr(t)<_&&(v||Math.abs(c.lng-r.center.lng)<g)?l=c:r.locationPoint3D(f).distSqr(t)<_&&(v||Math.abs(f.lng-r.center.lng)<g)&&(l=f)}for(;Math.abs(l.lng-r.center.lng)>180;){const c=r.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=r.width&&c.y<=r.height)break;l.lng>r.center.lng?l.lng-=360:l.lng+=360}return l}const gr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},so={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ac extends s.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:f="#3FB1CE",scale:g=1,draggable:_=!1,clickTolerance:v=0,rotation:b=so.rotation,rotationAlignment:I=so.rotationAlignment,pitchAlignment:C=so.pitchAlignment,occludedOpacity:O=so.occludedOpacity,altitude:L=so.altitude}=t||{};this._anchor=c,this._color=f,this._scale=g,this._draggable=_,this._clickTolerance=v,this._rotation=b,this._rotationAlignment=I,this._pitchAlignment=C,this._occludedOpacity=O,this._altitude=L,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(j=>{j.preventDefault()})),this._element.addEventListener("mousedown",(j=>{j.preventDefault()}));const D=this._element.classList;for(const j in gr)D.remove(`mapboxgl-marker-anchor-${j}`);D.add(`mapboxgl-marker-anchor-${this._anchor}`);const V=t&&t.className?t.className.trim().split(/\s+/):[];D.add(...V),this._popup=null}_createDefaultMarker(){const t=Ce("div"),r=Be("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=Be("radialGradient",{id:"shadowGradient"},Be("defs",{},r));Be("stop",{offset:"10%","stop-opacity":.4},c),Be("stop",{offset:"100%","stop-opacity":.05},c),Be("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return Be("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),Be("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),Be("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||so.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,c=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,c=this._element;this._popup&&(r===c||c.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const c=t.unproject(r,this._altitude),f=t.getFreeCameraOptions();if(!f.position)return!1;const g=f.position.toLngLat();return g.distanceTo(c)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(r,this._altitude);let f;t._showingGlobe()&&s.f5(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${gr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,c=this.getPitchAlignment();if(!r||!t||c!=="map")return"";if(!r._showingGlobe()){const b=r.getPitch();return b?`rotateX(${b}deg)`:""}const f=s.cX(s.f6(r.transform,this._lngLat)),g=t.sub(s.f7(r.transform)),_=Math.abs(g.x)+Math.abs(g.y);if(_===0)return"";const v=f/_;return`rotateX(${-g.y*v}deg) rotateY(${g.x*v}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let c=0;const f=this.getRotationAlignment();if(f==="map")if(r._showingGlobe()){const g=r.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),_=r.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);c=s.cX(Math.atan2(_.y,_.x))-90}else c=-r.getBearing();else if(f==="horizon"){const g=s.ah(4,6,r.getZoom()),_=s.f7(r.transform);_.y+=g*r.transform.height;const v=t.sub(_),b=s.cX(Math.atan2(v.y,v.x));c=(b>90?b-270:b+90)*(1-g)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=wo(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),r._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const c=this._pointerdownPos,f=this._positionDelta;if(c&&f){if(!this._isDragging){const g=this._clickTolerance||r._clickTolerance;if(t.point.dist(c)<g)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,c=this._pos;r&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||so.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||so.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||so.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||so.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Nl={maxWidth:100,unit:"metric"},lc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Bs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dl(l=new s.P(0,0),t="bottom"){if(typeof l=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new s.P(0,l);case"top-left":return new s.P(r,r);case"top-right":return new s.P(-r,r);case"bottom":return new s.P(0,-l);case"bottom-left":return new s.P(r,-r);case"bottom-right":return new s.P(-r,-r);case"left":return new s.P(l,0);case"right":return new s.P(-l,0)}return new s.P(0,0)}return l instanceof s.P||Array.isArray(l)?s.P.convert(l):s.P.convert(l[t]||[0,0])}return{version:he,supported:st.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends yf{constructor(l){Me.mark(ae.create);const t=l;if((l=Object.assign({},$a,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.f3(window)&&(l.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bd(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Ol,this._domRenderTaskQueue=new Ol,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Bl,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Fl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new mi(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const r=document.getElementById(l.container);if(!r)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=r}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Op(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||s.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new us(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const r=l.bounds;r&&(this.resize(),this.fitBounds(r,Object.assign({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new la({customAttribution:l.customAttribution})),this._logoControl=new md,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(r=>{this._update(r.dataType==="style"),this.fire(new s.z(`${r.dataType}data`,r))})),this.on("dataloading",(r=>{this.fire(new s.z(`${r.dataType}dataloading`,r))})),this._interactions=new ca(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",l)).fire(new s.z("move",l)),this.fire(new s.z("resize",l)),t&&this.fire(new s.z("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.aI.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map((t=>t==="auto"?navigator.language:t)):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let r;t==="globe"&&l.zoom>=s.cL?(l.setMercatorFromTransition(),r=!0):t==="mercator"&&l.zoom<s.cL&&(l.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;const r=this.transform.mercatorFromTransition;t=l.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate();const c=this.transform.getProjection().name==="mercator"&&r!==this.transform.mercatorFromTransition;return(t||c)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(s.aT.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(s.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,r){const c=f=>{let g=[];if(Array.isArray(t)){const _=t.filter((v=>this.getLayer(v)));g=_.length?this.queryRenderedFeatures(f,{layers:_}):[]}else g=this.queryRenderedFeatures(f,{target:t});return g};if(l==="mouseenter"||l==="mouseover"){let f=!1;return{listener:r,targets:t,delegates:{mousemove:_=>{const v=c(_.point);v.length?f||(f=!0,r.call(this,new bs(l,this,_.originalEvent,{features:v}))):f=!1},mouseout:()=>{f=!1}}}}if(l==="mouseleave"||l==="mouseout"){let f=!1;return{listener:r,targets:t,delegates:{mousemove:v=>{c(v.point).length?f=!0:f&&(f=!1,r.call(this,new bs(l,this,v.originalEvent)))},mouseout:v=>{f&&(f=!1,r.call(this,new bs(l,this,v.originalEvent)))}}}}{const f=g=>{const _=c(g.point);_.length&&(g.features=_,r.call(this,g),delete g.features)};return{listener:r,targets:t,delegates:{[l]:f}}}}on(l,t,r){if(typeof t=="function"||r===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const f in c.delegates)this.on(f,c.delegates[f]);return this}once(l,t,r){if(typeof t=="function"||r===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,r);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(l,t,r){if(typeof t=="function"||r===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(f=>{for(let g=0;g<f.length;g++){const _=f[g];if(_.listener===r&&ap(_.targets,t)){for(const v in _.delegates)this.off(v,_.delegates[v]);return f.splice(g,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof s.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(l,void 0,this.transform),_=this.style.queryRenderedFeatureset(l,void 0,this.transform);return g.concat(_)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let f=[];return c&&(f=f.concat(this.style.queryRenderedFeatures(l,t,this.transform))),r&&(f=f.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),f}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}queryRasterValue(l,t,r){return this._isValidId(l)?this.style.queryRasterValue(l,t,r):Promise.resolve(null)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,((r,c)=>{if(r){const f=typeof r=="string"?r:r instanceof Error?r.message:r.error;s.w(`Unable to perform style diff: ${f}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new is(this,r).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new is(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(l)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,r)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:r=1,sdf:c=!1,stretchX:f,stretchY:g,content:_}={}){this._lazyInitEmptyStyle();const v=s.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:b,height:I,data:C}=s.o.getImageData(t);this.style.addImage(v,{data:new s.q({width:b,height:I},C),pixelRatio:r,stretchX:f,stretchY:g,content:_,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:I}=t,C=t;this.style.addImage(v,{data:new s.q({width:b,height:I},new Uint8Array(C.data)),pixelRatio:r,stretchX:f,stretchY:g,content:_,sdf:c,usvg:!1,version:0,userImage:C}),C.onAdd&&C.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const r=s.I.from(l),c=this.style.getImage(r);if(!c)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:g,height:_,data:v}=f;if(g===void 0||_===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||_!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${g}, ${_})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const b=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let I=!1;c.usvg?(c.data=new s.q({width:g,height:_},new Uint8Array(v)),c.usvg=!1,c.icon=void 0,I=!0):c.data.replace(v,b),this.style.updateImage(r,c,I)}hasImage(l){return l?!!this.style&&!!this.style.getImage(s.I.from(l)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(s.I.from(l))}loadImage(l,t){s.n(this._requestManager.transformRequest(l,s.R.Image),((r,c)=>{t(r,c instanceof HTMLImageElement?s.o.getImageData(c):c)}))}listImages(){return this.style.listImages().map((l=>l.name))}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch((r=>this.fire(new s.y(new Error("Failed to add import",r))))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,r){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,r),this._update(!0)):this}setFilter(l,t,r={}){return this._isValidId(l)?(this.style.setFilter(l,t,r),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,r,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,r,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}setLayerProperty(l,t,r,c={}){return this._isValidId(l)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(l,t,r,c),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,r){return this.style.setConfigProperty(l,t,r),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_selectIndoorFloor(l){this.indoor.selectFloor(l)}_setIndoorActiveFloorsVisibility(l){this.indoor.setActiveFloorsVisibility(l)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new au),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,c,f,g=this._container;for(;g&&(!c||!f);){const _=window.getComputedStyle(g).transform;_&&_!=="none"&&(r=_.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(c=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(f=r[3])),g=g.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Ud(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ce("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Ce("div","mapboxgl-canvas-container",l);this._canvas=Ce("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Ce("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((f=>{c[f]=Ce("div",`mapboxgl-ctrl-${f}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const r=s.o.devicePixelRatio||1;this._canvas.width=r*Math.ceil(l),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=Object.assign({},st.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Pr(t,!0),this.painter=new uf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new s.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,c=s.o.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,C=this.transform.pitch,O=s.o.now(),L=new s.ac(I,{now:O,fadeDuration:g,pitch:C,transition:this.style.transition,worldview:this._worldview});this.style.update(L)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(c);const v=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),v&&(this._placementDirty=v.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Me.mark(ae.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const I=s.o.now()-c;f.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const C=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:I,gpuTime:C}))}),50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout((()=>{const C=this.painter.queryGpuTimers(I);this.fire(new s.z("gpu-timing-layer",{layerTimes:C}))}),50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const C=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:C}))}),50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(b||this._repaint)this.triggerRepaint();else{const I=this.idle();if(I&&(_=this._updateAverageElevation(c,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,Me.mark(ae.fullLoad),this._performanceMetricsCollection&&Gi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const r=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const f=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=l;const _=Math.abs(f-g);if(_>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(g),r(g);this._averageElevation.easeTo(g,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(g),r(g)}return!!this._averageElevation.isEasing(l)&&r(this._averageElevation.getValue(l))}_authenticate(){Es(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(l=>{if(l&&(l.message===dn||l.status===401)){const t=this.painter.context.gl;Pr(t,!1),this._logoControl instanceof md&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),jn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&cn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&xn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){_i(this._requestManager._customAccessToken)}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,c=r.createFramebuffer();function f(g){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,g,0);const _=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,_),_}return r.bindFramebuffer(r.FRAMEBUFFER,c),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,r){let c=r[1]-r[0];const f=l.length/4;for(let g=0;g<t.length;g++){const _=t[g];let v=0;for(let b=0;b<_.length;b+=4)_[b]===l[b]&&_[b+1]===l[b+1]&&_[b+2]===l[b+2]&&_[b+3]===l[b+3]&&(v+=1);c+=(r[g+2]-r[g+1])*(1-v/f)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),vo.delete(this.painter.context.gl),yo.remove(),gn.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.o.frame((t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)})))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return s.bw(t,((r,c)=>r._preloadTiles(l,c)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this.style&&l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,t){s.f4(l,t)}get version(){return he}},NavigationControl:class{constructor(l={}){this.options=Object.assign({},Sr,l),this._container=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),Ce("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),Ce("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))})),this._compassIcon=Ce("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),r=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const r=Ce("button",l,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(l,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",r),l.firstElementChild&&l.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends s.E{constructor(l={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Vo,l),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=cs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,l(r)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((r=>t(r.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),r=l.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:l.coords,timestamp:l.timestamp},l.toJSON?{toJSON:l.toJSON.bind(l)}:{}))),this._finish()}}_updateCamera(l){const t=new s.aT(l.coords.longitude,l.coords.latitude),r=l.coords.accuracy,c=this._map.getBearing(),f=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),f,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.aT(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=s.cf(1,l._center.lat)*l.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ce("button","mapboxgl-ctrl-geolocate",this._container),Ce("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ce("div","mapboxgl-user-location"),this._dotElement.appendChild(Ce("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ce("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ac({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ce("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ac({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))}))}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&l()})).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:la,ScaleControl:class{constructor(l={}){this.options=Object.assign({},Nl,l),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,c=t._containerWidth/2-l/2,f=t.unproject([c,r]),g=t.unproject([c+l,r]),_=f.distanceTo(g);if(this.options.unit==="imperial"){const v=3.2808*_;v>5280?this._setScale(l,v/5280,"mile"):this._setScale(l,v,"foot")}else this.options.unit==="nautical"?this._setScale(l,_/1852,"nautical-mile"):_>=1e3?this._setScale(l,_/1e3,"kilometer"):this._setScale(l,_,"meter")}_setScale(l,t,r){this._map._requestDomTask((()=>{const c=(function(g){const _=Math.pow(10,`${Math.floor(g)}`.length-1);let v=g/_;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:(function(b){const I=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*I)/I})(v),_*v})(t),f=c/t;this._container.innerHTML=r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(c):`${c}&nbsp;${lc[r]}`,this._container.style.width=l*f+"px"}))}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Ce("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ce("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:au,Popup:class extends s.E{constructor(l){super(),this.options=Object.assign(Object.create(Bs),l),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.aT.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=l;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ce("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const r=this._closeButton=Ce("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,c=this._pos;if(!t||!r||!c)return"bottom";const f=r.offsetWidth,g=r.offsetHeight,_=c.x<f/2,v=c.x>t.transform.width-f/2;if(c.y+l<g)return _?"top-left":v?"top-right":"top";if(c.y>t.transform.height-g){if(_)return"bottom-left";if(v)return"bottom-right"}return _?"left":v?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let c=this._container;if(c||(c=this._container=Ce("div","mapboxgl-popup",t.getContainer()),this._tip=Ce("div","mapboxgl-popup-tip",c),c.appendChild(r)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wo(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const f=this._pos=this._trackPointer&&l instanceof s.P?l:t.project(this._lngLat,this._altitude),g=dl(this.options.offset),_=this._anchor=this._getAnchor(g.y),v=dl(this.options.offset,_),b=f.add(v).round();t._requestDomTask((()=>{this._container&&_&&(this._container.style.transform=`${gr[_]} translate(${b.x}px,${b.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const f=s.f5(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ua);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:ac,Style:is,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:ys,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(l){s.e.ACCESS_TOKEN=l},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(l){s.e.API_URL=l},get workerCount(){return s.fi.workerCount},set workerCount(l){s.fi.workerCount=l},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.fh(l)},get workerUrl(){return s.fg.workerUrl},set workerUrl(l){s.fg.workerUrl=l},get workerClass(){return s.fg.workerClass},set workerClass(l){s.fg.workerClass=l},get workerParams(){return s.fg.workerParams},set workerParams(l){s.fg.workerParams=l},get dracoUrl(){return s.ff()},set dracoUrl(l){s.fe(l)},get meshoptUrl(){return s.fd()},set meshoptUrl(l){s.fc(l)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}}));var re=X;return re}))})(E_)),E_.exports}var xR=vR();const gl=Yv(xR);function wR(T,R=[]){let z=[];function N(J,re){const s=be.createContext(re);s.displayName=J+"Context";const he=z.length;z=[...z,re];const ae=oe=>{const{scope:Oe,children:je,...st}=oe,Ce=Oe?.[T]?.[he]||s,Be=be.useMemo(()=>st,Object.values(st));return $.jsx(Ce.Provider,{value:Be,children:je})};ae.displayName=J+"Provider";function Me(oe,Oe){const je=Oe?.[T]?.[he]||s,st=be.useContext(je);if(st)return st;if(re!==void 0)return re;throw new Error(`\`${oe}\` must be used within \`${J}\``)}return[ae,Me]}const X=()=>{const J=z.map(re=>be.createContext(re));return function(s){const he=s?.[T]||J;return be.useMemo(()=>({[`__scope${T}`]:{...s,[T]:he}}),[s,he])}};return X.scopeName=T,[N,bR(X,...R)]}function bR(...T){const R=T[0];if(T.length===1)return R;const z=()=>{const N=T.map(X=>({useScope:X(),scopeName:X.scopeName}));return function(J){const re=N.reduce((s,{useScope:he,scopeName:ae})=>{const oe=he(J)[`__scope${ae}`];return{...s,...oe}},{});return be.useMemo(()=>({[`__scope${R.scopeName}`]:re}),[re])}};return z.scopeName=R.scopeName,z}var TR=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ix=TR.reduce((T,R)=>{const z=GT(`Primitive.${R}`),N=be.forwardRef((X,J)=>{const{asChild:re,...s}=X,he=re?z:R;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),$.jsx(he,{...s,ref:J})});return N.displayName=`Primitive.${R}`,{...T,[R]:N}},{}),wv={exports:{}},bv={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kb;function SR(){if(kb)return bv;kb=1;var T=j_();function R(oe,Oe){return oe===Oe&&(oe!==0||1/oe===1/Oe)||oe!==oe&&Oe!==Oe}var z=typeof Object.is=="function"?Object.is:R,N=T.useState,X=T.useEffect,J=T.useLayoutEffect,re=T.useDebugValue;function s(oe,Oe){var je=Oe(),st=N({inst:{value:je,getSnapshot:Oe}}),Ce=st[0].inst,Be=st[1];return J(function(){Ce.value=je,Ce.getSnapshot=Oe,he(Ce)&&Be({inst:Ce})},[oe,je,Oe]),X(function(){return he(Ce)&&Be({inst:Ce}),oe(function(){he(Ce)&&Be({inst:Ce})})},[oe]),re(je),je}function he(oe){var Oe=oe.getSnapshot;oe=oe.value;try{var je=Oe();return!z(oe,je)}catch{return!0}}function ae(oe,Oe){return Oe()}var Me=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ae:s;return bv.useSyncExternalStore=T.useSyncExternalStore!==void 0?T.useSyncExternalStore:Me,bv}var zb;function ER(){return zb||(zb=1,wv.exports=SR()),wv.exports}var IR=ER();function AR(){return IR.useSyncExternalStore(CR,()=>!0,()=>!1)}function CR(){return()=>{}}var rx="Avatar",[MR]=wR(rx),[PR,QT]=MR(rx),eS=be.forwardRef((T,R)=>{const{__scopeAvatar:z,...N}=T,[X,J]=be.useState("idle");return $.jsx(PR,{scope:z,imageLoadingStatus:X,onImageLoadingStatusChange:J,children:$.jsx(ix.span,{...N,ref:R})})});eS.displayName=rx;var tS="AvatarImage",nS=be.forwardRef((T,R)=>{const{__scopeAvatar:z,src:N,onLoadingStatusChange:X=()=>{},...J}=T,re=QT(tS,z),s=RR(N,J),he=Ed(ae=>{X(ae),re.onImageLoadingStatusChange(ae)});return Us(()=>{s!=="idle"&&he(s)},[s,he]),s==="loaded"?$.jsx(ix.img,{...J,ref:R,src:N}):null});nS.displayName=tS;var iS="AvatarFallback",rS=be.forwardRef((T,R)=>{const{__scopeAvatar:z,delayMs:N,...X}=T,J=QT(iS,z),[re,s]=be.useState(N===void 0);return be.useEffect(()=>{if(N!==void 0){const he=window.setTimeout(()=>s(!0),N);return()=>window.clearTimeout(he)}},[N]),re&&J.imageLoadingStatus!=="loaded"?$.jsx(ix.span,{...X,ref:R}):null});rS.displayName=iS;function Lb(T,R){return T?R?(T.src!==R&&(T.src=R),T.complete&&T.naturalWidth>0?"loaded":"loading"):"error":"idle"}function RR(T,{referrerPolicy:R,crossOrigin:z}){const N=AR(),X=be.useRef(null),J=N?(X.current||(X.current=new window.Image),X.current):null,[re,s]=be.useState(()=>Lb(J,T));return Us(()=>{s(Lb(J,T))},[J,T]),Us(()=>{const he=oe=>()=>{s(oe)};if(!J)return;const ae=he("loaded"),Me=he("error");return J.addEventListener("load",ae),J.addEventListener("error",Me),R&&(J.referrerPolicy=R),typeof z=="string"&&(J.crossOrigin=z),()=>{J.removeEventListener("load",ae),J.removeEventListener("error",Me)}},[J,z,R]),re}var kR=eS,zR=nS,LR=rS;function DR({className:T,...R}){return $.jsx(kR,{"data-slot":"avatar",className:Wo("relative flex size-10 shrink-0 overflow-hidden rounded-full",T),...R})}function OR({className:T,...R}){return $.jsx(zR,{"data-slot":"avatar-image",className:Wo("aspect-square size-full",T),...R})}function FR({className:T,...R}){return $.jsx(LR,{"data-slot":"avatar-fallback",className:Wo("bg-muted flex size-full items-center justify-center rounded-full",T),...R})}const BR=tx("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function yu({className:T,variant:R,size:z,asChild:N=!1,...X}){const J=N?$T:"button";return $.jsx(J,{"data-slot":"button",className:Wo(BR({variant:R,size:z,className:T})),...X})}function _u({className:T,...R}){return $.jsx("div",{"data-slot":"skeleton",className:Wo("bg-accent animate-pulse rounded-md",T),...R})}const NR=tx("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function xg({className:T,variant:R,...z}){return $.jsx("div",{"data-slot":"alert",role:"alert",className:Wo(NR({variant:R}),T),...z})}function oS({className:T,...R}){return $.jsx("div",{"data-slot":"alert-title",className:Wo("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",T),...R})}function wg({className:T,...R}){return $.jsx("div",{"data-slot":"alert-description",className:Wo("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",T),...R})}const ox="bmaixhphttpjoktleafr",yp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJtYWl4aHBodHRwam9rdGxlYWZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1MTc0ODcsImV4cCI6MjA4MzA5MzQ4N30.Ba_1jLQnxn5obgIB7v6osX8ssYeNsCWuRDVxtdrWwN8",jR="pk.eyJ1IjoidGFtYWtpaWkiLCJhIjoiY21qemtjMWp5MDBobDNwb3F1emFsNDV3NSJ9.JdlzkWCF5oyOLUdBV9Illg",Db="a96c621bdb7a200005963f01601a9020";function VR(){const T=be.useRef(null),R=be.useRef(null),z=be.useRef({}),[N,X]=be.useState(!0),[J,re]=be.useState(!1),[s,he]=be.useState(!1),[ae,Me]=be.useState([{id:"1",name:"Alex Chen",location:"Quezon City",latitude:14.676,longitude:121.0437,lastSeen:"Just now",avatar:"AC",status:"online",speed:0,heading:45},{id:"2",name:"Maria Santos",location:"Makati",latitude:14.5547,longitude:121.0244,lastSeen:"2 mins ago",avatar:"MS",status:"online",speed:15,heading:180},{id:"3",name:"John Reyes",location:"Pasig",latitude:14.5764,longitude:121.0851,lastSeen:"5 mins ago",avatar:"JR",status:"away",speed:35,heading:270},{id:"4",name:"Sarah Cruz",location:"Cebu City",latitude:10.3157,longitude:123.8854,lastSeen:"10 mins ago",avatar:"SC",status:"online",speed:0,heading:0}]),[oe,Oe]=be.useState(null),je=`https://${ox}.supabase.co/functions/v1/make-server-aedf23c8`,st=async()=>{try{if((await fetch(`${je}/health`,{headers:{Authorization:`Bearer ${yp}`}})).ok)return he(!0),!0}catch{console.log("Backend not available, using local data")}return he(!1),!1},Ce=async()=>{try{const tt=await fetch(`${je}/friends/locations`,{headers:{Authorization:`Bearer ${yp}`}});if(tt.ok){const Nt=await tt.json();if(Nt.friends&&Nt.friends.length>0)return Nt.friends.map(Mt=>{const Rn=ae.find(Kn=>Kn.id===Mt.friendId);return{id:Mt.friendId,name:Rn?.name||`Friend ${Mt.friendId}`,location:Mt.location||"Unknown",latitude:Mt.latitude,longitude:Mt.longitude,lastSeen:Mt.lastSeen||"Unknown",avatar:Rn?.avatar||Mt.friendId.substring(0,2).toUpperCase(),status:Rn?.status||"online",speed:Mt.speed||0,heading:Mt.heading||0}})}}catch(tt){console.error("Error fetching friends from backend:",tt)}return null},Be=async()=>{if(s)try{for(const tt of ae)await fetch(`${je}/friends/location`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${yp}`},body:JSON.stringify({friendId:tt.id,latitude:tt.latitude,longitude:tt.longitude,location:tt.location,heading:tt.heading,speed:tt.speed})})}catch(tt){console.error("Error syncing friends to backend:",tt)}},Xe=async(tt,Nt)=>{try{const jt=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${tt}&lon=${Nt}&units=metric&appid=${Db}`);if(!jt.ok)return{temp:28+Math.random()*5,condition:["Clear","Cloudy","Light Rain"][Math.floor(Math.random()*3)],humidity:70+Math.floor(Math.random()*20),windSpeed:10+Math.floor(Math.random()*15),icon:"01d"};const Mt=await jt.json();return{temp:Math.round(Mt.main.temp),condition:Mt.weather[0].main,humidity:Mt.main.humidity,windSpeed:Math.round(Mt.wind.speed*3.6),icon:Mt.weather[0].icon}}catch(jt){return console.error("Error fetching weather:",jt),{temp:28+Math.random()*5,condition:["Clear","Cloudy","Light Rain"][Math.floor(Math.random()*3)],humidity:70+Math.floor(Math.random()*20),windSpeed:10+Math.floor(Math.random()*15),icon:"01d"}}},ot=async()=>{re(!0);const tt=await Promise.all(ae.map(async Nt=>{const jt=await Xe(Nt.latitude,Nt.longitude);if(s)try{await fetch(`${je}/friends/weather`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${yp}`},body:JSON.stringify({friendId:Nt.id,...jt})})}catch(Mt){console.error("Error syncing weather to backend:",Mt)}return{...Nt,weather:jt}}));Me(tt),re(!1)};be.useEffect(()=>{if(!(!T.current||R.current))return gl.accessToken=jR,R.current=new gl.Map({container:T.current,style:"mapbox://styles/mapbox/streets-v12",center:[121.0244,14.5547],zoom:10,pitch:45,bearing:0}),R.current.on("load",()=>{X(!1),R.current&&R.current.addLayer({id:"weather-layer",type:"raster",source:{type:"raster",tiles:[`https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${Db}`],tileSize:256},paint:{"raster-opacity":.4}})}),R.current.addControl(new gl.NavigationControl,"top-right"),R.current.addControl(new gl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right"),()=>{R.current?.remove(),R.current=null}},[]),be.useEffect(()=>{if(!(!R.current||N)&&(Object.values(z.current).forEach(tt=>tt.remove()),z.current={},ae.forEach(tt=>{const Nt=document.createElement("div");if(Nt.className="friend-marker",Nt.style.cssText=`
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        background: ${tt.status==="online"?"#10b981":tt.status==="away"?"#f59e0b":"#6b7280"};
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 14px;
        position: relative;
      `,Nt.textContent=tt.avatar,tt.speed&&tt.speed>5){const Rn=document.createElement("div");Rn.style.cssText=`
          position: absolute;
          top: -15px;
          left: 50%;
          transform: translateX(-50%) rotate(${tt.heading}deg);
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-bottom: 10px solid #3b82f6;
        `,Nt.appendChild(Rn)}const jt=new gl.Marker(Nt).setLngLat([tt.longitude,tt.latitude]).addTo(R.current),Mt=new gl.Popup({offset:25}).setHTML(`
        <div style="padding: 8px; min-width: 200px;">
          <div style="font-weight: bold; margin-bottom: 4px;">${tt.name}</div>
          <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">${tt.location}</div>
          ${tt.weather?`
            <div style="border-top: 1px solid #e5e7eb; padding-top: 8px; margin-top: 8px;">
              <div style="font-size: 14px; margin-bottom: 4px;">
                <strong>${tt.weather.temp}C</strong> - ${tt.weather.condition}
              </div>
              <div style="display: flex; gap: 12px; font-size: 12px; color: #6b7280;">
                <div> ${tt.weather.humidity}%</div>
                <div> ${tt.weather.windSpeed} km/h</div>
              </div>
            </div>
          `:""}
          <div style="font-size: 11px; color: #9ca3af; margin-top: 8px;">
            Last seen: ${tt.lastSeen}
          </div>
        </div>
      `);jt.setPopup(Mt),Nt.addEventListener("click",()=>{Oe(tt),R.current?.flyTo({center:[tt.longitude,tt.latitude],zoom:14,duration:2e3})}),z.current[tt.id]=jt}),ae.length>0)){const tt=new gl.LngLatBounds;ae.forEach(Nt=>{tt.extend([Nt.longitude,Nt.latitude])}),R.current.fitBounds(tt,{padding:50,maxZoom:12})}},[ae,N]),be.useEffect(()=>{(async()=>{if(await st()){const Rn=await Ce();Rn&&Rn.length>0?Me(Rn):await Be()}await ot()})();const Nt=setInterval(ot,300*1e3),jt=setInterval(async()=>{if(s){const Mt=await Ce();Mt&&Mt.length>0&&Me(Mt)}},3e4);return()=>{clearInterval(Nt),clearInterval(jt)}},[s]);const Ke=tt=>{switch(tt?.toLowerCase()){case"clear":case"sunny":return $.jsx(z_,{className:"h-4 w-4 text-yellow-500"});case"clouds":case"cloudy":return $.jsx(Td,{className:"h-4 w-4 text-gray-500"});case"rain":case"light rain":case"drizzle":return $.jsx(Dv,{className:"h-4 w-4 text-blue-500"});case"snow":return $.jsx(Ov,{className:"h-4 w-4 text-blue-300"});default:return $.jsx(Td,{className:"h-4 w-4 text-gray-500"})}},Ct=tt=>{switch(tt){case"online":return"bg-green-500";case"away":return"bg-yellow-500";default:return"bg-gray-500"}};return $.jsxs("div",{className:"space-y-4 p-4",children:[!s&&$.jsxs(xg,{children:[$.jsx(XT,{className:"h-4 w-4"}),$.jsx(wg,{children:"Using local data. Enable Supabase backend for real-time friend location sync across devices."})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(vp,{className:"h-5 w-5"}),$.jsx("span",{children:"Live Location & Weather Map"}),s&&$.jsxs(vu,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300",children:[$.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"}),"Live"]})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(yu,{variant:"outline",size:"sm",onClick:ot,disabled:J,children:$.jsx(k_,{className:`h-4 w-4 ${J?"animate-spin":""}`})}),$.jsx(yu,{variant:"outline",size:"sm",children:$.jsx(oR,{className:"h-4 w-4"})})]})]})}),$.jsxs(jr,{className:"p-0",children:[N&&$.jsx("div",{className:"h-96 flex items-center justify-center",children:$.jsx(_u,{className:"h-full w-full"})}),$.jsx("div",{ref:T,className:"h-96 rounded-b-lg overflow-hidden",style:{display:N?"none":"block"}})]})]}),$.jsx(Nr,{className:"bg-blue-50 border-blue-200",children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-center justify-between text-sm",children:[$.jsxs("div",{className:"flex items-center space-x-4",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full border-2 border-white"}),$.jsx("span",{children:"Online"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded-full border-2 border-white"}),$.jsx("span",{children:"Away"})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx("div",{className:"w-4 h-4 bg-gray-500 rounded-full border-2 border-white"}),$.jsx("span",{children:"Offline"})]})]}),$.jsxs("span",{className:"text-xs text-blue-700",children:[ae.length," friends tracked"]})]})})}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(KT,{className:"h-5 w-5"}),$.jsx("span",{children:"Friends Weather Status"})]})}),$.jsx(jr,{className:"space-y-3",children:ae.map(tt=>$.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg border cursor-pointer transition-all hover:shadow-md ${oe?.id===tt.id?"bg-blue-50 border-blue-300":""}`,onClick:()=>{Oe(tt),R.current?.flyTo({center:[tt.longitude,tt.latitude],zoom:14,duration:2e3})},children:[$.jsxs("div",{className:"relative",children:[$.jsxs(DR,{className:"h-12 w-12",children:[$.jsx(OR,{src:"",alt:tt.name}),$.jsx(FR,{children:tt.avatar})]}),$.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${Ct(tt.status)}`})]}),$.jsxs("div",{className:"flex-1 min-w-0",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsx("p",{className:"font-medium",children:tt.name}),tt.speed&&tt.speed>5&&$.jsxs(vu,{variant:"outline",className:"text-xs",children:[$.jsx(YT,{className:"h-3 w-3 mr-1"}),tt.speed," km/h"]})]}),$.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[$.jsx(vp,{className:"h-3 w-3 text-muted-foreground"}),$.jsx("span",{className:"text-sm text-muted-foreground",children:tt.location})]}),tt.weather?$.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[$.jsxs("div",{className:"flex items-center space-x-1",children:[Ke(tt.weather.condition),$.jsxs("span",{className:"text-sm",children:[tt.weather.temp,"C"]})]}),$.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[$.jsx(nx,{className:"h-3 w-3"}),$.jsxs("span",{children:[tt.weather.humidity,"%"]})]}),$.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[$.jsx(um,{className:"h-3 w-3"}),$.jsxs("span",{children:[tt.weather.windSpeed," km/h"]})]})]}):$.jsx(_u,{className:"h-4 w-32 mt-2"}),$.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:tt.lastSeen})]})]},tt.id))})]}),$.jsx(Nr,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-start space-x-2",children:[$.jsx(Td,{className:"h-5 w-5 text-blue-600 mt-0.5"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-blue-800",children:s?"Real-time Weather & Location Sync Enabled":"Real-time Weather Updates Active"}),$.jsx("p",{className:"text-xs text-blue-600 mt-1",children:s?"Friend locations and weather sync across all devices in real-time. Weather layers show temperature overlays.":"Weather conditions update automatically. Connect to Supabase backend for real-time location sharing across devices."})]})]})})})]})}function Ob(T,[R,z]){return Math.min(z,Math.max(R,T))}function UR(T,R=globalThis?.document){const z=Ed(T);be.useEffect(()=>{const N=X=>{X.key==="Escape"&&z(X)};return R.addEventListener("keydown",N,{capture:!0}),()=>R.removeEventListener("keydown",N,{capture:!0})},[z,R])}var GR="DismissableLayer",jv="dismissableLayer.update",$R="dismissableLayer.pointerDownOutside",HR="dismissableLayer.focusOutside",Fb,sS=be.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),aS=be.forwardRef((T,R)=>{const{disableOutsidePointerEvents:z=!1,onEscapeKeyDown:N,onPointerDownOutside:X,onFocusOutside:J,onInteractOutside:re,onDismiss:s,...he}=T,ae=be.useContext(sS),[Me,oe]=be.useState(null),Oe=Me?.ownerDocument??globalThis?.document,[,je]=be.useState({}),st=Vs(R,jt=>oe(jt)),Ce=Array.from(ae.layers),[Be]=[...ae.layersWithOutsidePointerEventsDisabled].slice(-1),Xe=Ce.indexOf(Be),ot=Me?Ce.indexOf(Me):-1,Ke=ae.layersWithOutsidePointerEventsDisabled.size>0,Ct=ot>=Xe,tt=ZR(jt=>{const Mt=jt.target,Rn=[...ae.branches].some(Kn=>Kn.contains(Mt));!Ct||Rn||(X?.(jt),re?.(jt),jt.defaultPrevented||s?.())},Oe),Nt=XR(jt=>{const Mt=jt.target;[...ae.branches].some(Kn=>Kn.contains(Mt))||(J?.(jt),re?.(jt),jt.defaultPrevented||s?.())},Oe);return UR(jt=>{ot===ae.layers.size-1&&(N?.(jt),!jt.defaultPrevented&&s&&(jt.preventDefault(),s()))},Oe),be.useEffect(()=>{if(Me)return z&&(ae.layersWithOutsidePointerEventsDisabled.size===0&&(Fb=Oe.body.style.pointerEvents,Oe.body.style.pointerEvents="none"),ae.layersWithOutsidePointerEventsDisabled.add(Me)),ae.layers.add(Me),Bb(),()=>{z&&ae.layersWithOutsidePointerEventsDisabled.size===1&&(Oe.body.style.pointerEvents=Fb)}},[Me,Oe,z,ae]),be.useEffect(()=>()=>{Me&&(ae.layers.delete(Me),ae.layersWithOutsidePointerEventsDisabled.delete(Me),Bb())},[Me,ae]),be.useEffect(()=>{const jt=()=>je({});return document.addEventListener(jv,jt),()=>document.removeEventListener(jv,jt)},[]),$.jsx(_o.div,{...he,ref:st,style:{pointerEvents:Ke?Ct?"auto":"none":void 0,...T.style},onFocusCapture:eo(T.onFocusCapture,Nt.onFocusCapture),onBlurCapture:eo(T.onBlurCapture,Nt.onBlurCapture),onPointerDownCapture:eo(T.onPointerDownCapture,tt.onPointerDownCapture)})});aS.displayName=GR;var WR="DismissableLayerBranch",qR=be.forwardRef((T,R)=>{const z=be.useContext(sS),N=be.useRef(null),X=Vs(R,N);return be.useEffect(()=>{const J=N.current;if(J)return z.branches.add(J),()=>{z.branches.delete(J)}},[z.branches]),$.jsx(_o.div,{...T,ref:X})});qR.displayName=WR;function ZR(T,R=globalThis?.document){const z=Ed(T),N=be.useRef(!1),X=be.useRef(()=>{});return be.useEffect(()=>{const J=s=>{if(s.target&&!N.current){let he=function(){lS($R,z,ae,{discrete:!0})};const ae={originalEvent:s};s.pointerType==="touch"?(R.removeEventListener("click",X.current),X.current=he,R.addEventListener("click",X.current,{once:!0})):he()}else R.removeEventListener("click",X.current);N.current=!1},re=window.setTimeout(()=>{R.addEventListener("pointerdown",J)},0);return()=>{window.clearTimeout(re),R.removeEventListener("pointerdown",J),R.removeEventListener("click",X.current)}},[R,z]),{onPointerDownCapture:()=>N.current=!0}}function XR(T,R=globalThis?.document){const z=Ed(T),N=be.useRef(!1);return be.useEffect(()=>{const X=J=>{J.target&&!N.current&&lS(HR,z,{originalEvent:J},{discrete:!1})};return R.addEventListener("focusin",X),()=>R.removeEventListener("focusin",X)},[R,z]),{onFocusCapture:()=>N.current=!0,onBlurCapture:()=>N.current=!1}}function Bb(){const T=new CustomEvent(jv);document.dispatchEvent(T)}function lS(T,R,z,{discrete:N}){const X=z.originalEvent.target,J=new CustomEvent(T,{bubbles:!1,cancelable:!0,detail:z});R&&X.addEventListener(T,R,{once:!0}),N?IC(X,J):X.dispatchEvent(J)}var Tv=0;function YR(){be.useEffect(()=>{const T=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",T[0]??Nb()),document.body.insertAdjacentElement("beforeend",T[1]??Nb()),Tv++,()=>{Tv===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(R=>R.remove()),Tv--}},[])}function Nb(){const T=document.createElement("span");return T.setAttribute("data-radix-focus-guard",""),T.tabIndex=0,T.style.outline="none",T.style.opacity="0",T.style.position="fixed",T.style.pointerEvents="none",T}var Sv="focusScope.autoFocusOnMount",Ev="focusScope.autoFocusOnUnmount",jb={bubbles:!1,cancelable:!0},KR="FocusScope",cS=be.forwardRef((T,R)=>{const{loop:z=!1,trapped:N=!1,onMountAutoFocus:X,onUnmountAutoFocus:J,...re}=T,[s,he]=be.useState(null),ae=Ed(X),Me=Ed(J),oe=be.useRef(null),Oe=Vs(R,Ce=>he(Ce)),je=be.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;be.useEffect(()=>{if(N){let Ce=function(Ke){if(je.paused||!s)return;const Ct=Ke.target;s.contains(Ct)?oe.current=Ct:Af(oe.current,{select:!0})},Be=function(Ke){if(je.paused||!s)return;const Ct=Ke.relatedTarget;Ct!==null&&(s.contains(Ct)||Af(oe.current,{select:!0}))},Xe=function(Ke){if(document.activeElement===document.body)for(const tt of Ke)tt.removedNodes.length>0&&Af(s)};document.addEventListener("focusin",Ce),document.addEventListener("focusout",Be);const ot=new MutationObserver(Xe);return s&&ot.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Ce),document.removeEventListener("focusout",Be),ot.disconnect()}}},[N,s,je.paused]),be.useEffect(()=>{if(s){Ub.add(je);const Ce=document.activeElement;if(!s.contains(Ce)){const Xe=new CustomEvent(Sv,jb);s.addEventListener(Sv,ae),s.dispatchEvent(Xe),Xe.defaultPrevented||(JR(ik(uS(s)),{select:!0}),document.activeElement===Ce&&Af(s))}return()=>{s.removeEventListener(Sv,ae),setTimeout(()=>{const Xe=new CustomEvent(Ev,jb);s.addEventListener(Ev,Me),s.dispatchEvent(Xe),Xe.defaultPrevented||Af(Ce??document.body,{select:!0}),s.removeEventListener(Ev,Me),Ub.remove(je)},0)}}},[s,ae,Me,je]);const st=be.useCallback(Ce=>{if(!z&&!N||je.paused)return;const Be=Ce.key==="Tab"&&!Ce.altKey&&!Ce.ctrlKey&&!Ce.metaKey,Xe=document.activeElement;if(Be&&Xe){const ot=Ce.currentTarget,[Ke,Ct]=QR(ot);Ke&&Ct?!Ce.shiftKey&&Xe===Ct?(Ce.preventDefault(),z&&Af(Ke,{select:!0})):Ce.shiftKey&&Xe===Ke&&(Ce.preventDefault(),z&&Af(Ct,{select:!0})):Xe===ot&&Ce.preventDefault()}},[z,N,je.paused]);return $.jsx(_o.div,{tabIndex:-1,...re,ref:Oe,onKeyDown:st})});cS.displayName=KR;function JR(T,{select:R=!1}={}){const z=document.activeElement;for(const N of T)if(Af(N,{select:R}),document.activeElement!==z)return}function QR(T){const R=uS(T),z=Vb(R,T),N=Vb(R.reverse(),T);return[z,N]}function uS(T){const R=[],z=document.createTreeWalker(T,NodeFilter.SHOW_ELEMENT,{acceptNode:N=>{const X=N.tagName==="INPUT"&&N.type==="hidden";return N.disabled||N.hidden||X?NodeFilter.FILTER_SKIP:N.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;z.nextNode();)R.push(z.currentNode);return R}function Vb(T,R){for(const z of T)if(!ek(z,{upTo:R}))return z}function ek(T,{upTo:R}){if(getComputedStyle(T).visibility==="hidden")return!0;for(;T;){if(R!==void 0&&T===R)return!1;if(getComputedStyle(T).display==="none")return!0;T=T.parentElement}return!1}function tk(T){return T instanceof HTMLInputElement&&"select"in T}function Af(T,{select:R=!1}={}){if(T&&T.focus){const z=document.activeElement;T.focus({preventScroll:!0}),T!==z&&tk(T)&&R&&T.select()}}var Ub=nk();function nk(){let T=[];return{add(R){const z=T[0];R!==z&&z?.pause(),T=Gb(T,R),T.unshift(R)},remove(R){T=Gb(T,R),T[0]?.resume()}}}function Gb(T,R){const z=[...T],N=z.indexOf(R);return N!==-1&&z.splice(N,1),z}function ik(T){return T.filter(R=>R.tagName!=="A")}const rk=["top","right","bottom","left"],Cf=Math.min,uc=Math.max,D_=Math.round,v_=Math.floor,_h=T=>({x:T,y:T}),ok={left:"right",right:"left",bottom:"top",top:"bottom"},sk={start:"end",end:"start"};function Vv(T,R,z){return uc(T,Cf(R,z))}function Id(T,R){return typeof T=="function"?T(R):T}function Ad(T){return T.split("-")[0]}function pm(T){return T.split("-")[1]}function sx(T){return T==="x"?"y":"x"}function ax(T){return T==="y"?"height":"width"}const ak=new Set(["top","bottom"]);function gh(T){return ak.has(Ad(T))?"y":"x"}function lx(T){return sx(gh(T))}function lk(T,R,z){z===void 0&&(z=!1);const N=pm(T),X=lx(T),J=ax(X);let re=X==="x"?N===(z?"end":"start")?"right":"left":N==="start"?"bottom":"top";return R.reference[J]>R.floating[J]&&(re=O_(re)),[re,O_(re)]}function ck(T){const R=O_(T);return[Uv(T),R,Uv(R)]}function Uv(T){return T.replace(/start|end/g,R=>sk[R])}const $b=["left","right"],Hb=["right","left"],uk=["top","bottom"],hk=["bottom","top"];function dk(T,R,z){switch(T){case"top":case"bottom":return z?R?Hb:$b:R?$b:Hb;case"left":case"right":return R?uk:hk;default:return[]}}function fk(T,R,z,N){const X=pm(T);let J=dk(Ad(T),z==="start",N);return X&&(J=J.map(re=>re+"-"+X),R&&(J=J.concat(J.map(Uv)))),J}function O_(T){return T.replace(/left|right|bottom|top/g,R=>ok[R])}function pk(T){return{top:0,right:0,bottom:0,left:0,...T}}function hS(T){return typeof T!="number"?pk(T):{top:T,right:T,bottom:T,left:T}}function F_(T){const{x:R,y:z,width:N,height:X}=T;return{width:N,height:X,top:z,left:R,right:R+N,bottom:z+X,x:R,y:z}}function Wb(T,R,z){let{reference:N,floating:X}=T;const J=gh(R),re=lx(R),s=ax(re),he=Ad(R),ae=J==="y",Me=N.x+N.width/2-X.width/2,oe=N.y+N.height/2-X.height/2,Oe=N[s]/2-X[s]/2;let je;switch(he){case"top":je={x:Me,y:N.y-X.height};break;case"bottom":je={x:Me,y:N.y+N.height};break;case"right":je={x:N.x+N.width,y:oe};break;case"left":je={x:N.x-X.width,y:oe};break;default:je={x:N.x,y:N.y}}switch(pm(R)){case"start":je[re]-=Oe*(z&&ae?-1:1);break;case"end":je[re]+=Oe*(z&&ae?-1:1);break}return je}const mk=async(T,R,z)=>{const{placement:N="bottom",strategy:X="absolute",middleware:J=[],platform:re}=z,s=J.filter(Boolean),he=await(re.isRTL==null?void 0:re.isRTL(R));let ae=await re.getElementRects({reference:T,floating:R,strategy:X}),{x:Me,y:oe}=Wb(ae,N,he),Oe=N,je={},st=0;for(let Ce=0;Ce<s.length;Ce++){const{name:Be,fn:Xe}=s[Ce],{x:ot,y:Ke,data:Ct,reset:tt}=await Xe({x:Me,y:oe,initialPlacement:N,placement:Oe,strategy:X,middlewareData:je,rects:ae,platform:re,elements:{reference:T,floating:R}});Me=ot??Me,oe=Ke??oe,je={...je,[Be]:{...je[Be],...Ct}},tt&&st<=50&&(st++,typeof tt=="object"&&(tt.placement&&(Oe=tt.placement),tt.rects&&(ae=tt.rects===!0?await re.getElementRects({reference:T,floating:R,strategy:X}):tt.rects),{x:Me,y:oe}=Wb(ae,Oe,he)),Ce=-1)}return{x:Me,y:oe,placement:Oe,strategy:X,middlewareData:je}};async function fg(T,R){var z;R===void 0&&(R={});const{x:N,y:X,platform:J,rects:re,elements:s,strategy:he}=T,{boundary:ae="clippingAncestors",rootBoundary:Me="viewport",elementContext:oe="floating",altBoundary:Oe=!1,padding:je=0}=Id(R,T),st=hS(je),Be=s[Oe?oe==="floating"?"reference":"floating":oe],Xe=F_(await J.getClippingRect({element:(z=await(J.isElement==null?void 0:J.isElement(Be)))==null||z?Be:Be.contextElement||await(J.getDocumentElement==null?void 0:J.getDocumentElement(s.floating)),boundary:ae,rootBoundary:Me,strategy:he})),ot=oe==="floating"?{x:N,y:X,width:re.floating.width,height:re.floating.height}:re.reference,Ke=await(J.getOffsetParent==null?void 0:J.getOffsetParent(s.floating)),Ct=await(J.isElement==null?void 0:J.isElement(Ke))?await(J.getScale==null?void 0:J.getScale(Ke))||{x:1,y:1}:{x:1,y:1},tt=F_(J.convertOffsetParentRelativeRectToViewportRelativeRect?await J.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:ot,offsetParent:Ke,strategy:he}):ot);return{top:(Xe.top-tt.top+st.top)/Ct.y,bottom:(tt.bottom-Xe.bottom+st.bottom)/Ct.y,left:(Xe.left-tt.left+st.left)/Ct.x,right:(tt.right-Xe.right+st.right)/Ct.x}}const gk=T=>({name:"arrow",options:T,async fn(R){const{x:z,y:N,placement:X,rects:J,platform:re,elements:s,middlewareData:he}=R,{element:ae,padding:Me=0}=Id(T,R)||{};if(ae==null)return{};const oe=hS(Me),Oe={x:z,y:N},je=lx(X),st=ax(je),Ce=await re.getDimensions(ae),Be=je==="y",Xe=Be?"top":"left",ot=Be?"bottom":"right",Ke=Be?"clientHeight":"clientWidth",Ct=J.reference[st]+J.reference[je]-Oe[je]-J.floating[st],tt=Oe[je]-J.reference[je],Nt=await(re.getOffsetParent==null?void 0:re.getOffsetParent(ae));let jt=Nt?Nt[Ke]:0;(!jt||!await(re.isElement==null?void 0:re.isElement(Nt)))&&(jt=s.floating[Ke]||J.floating[st]);const Mt=Ct/2-tt/2,Rn=jt/2-Ce[st]/2-1,Kn=Cf(oe[Xe],Rn),Ti=Cf(oe[ot],Rn),pi=Kn,dn=jt-Ce[st]-Ti,mi=jt/2-Ce[st]/2+Mt,Hn=Vv(pi,mi,dn),Wt=!he.arrow&&pm(X)!=null&&mi!==Hn&&J.reference[st]/2-(mi<pi?Kn:Ti)-Ce[st]/2<0,Jt=Wt?mi<pi?mi-pi:mi-dn:0;return{[je]:Oe[je]+Jt,data:{[je]:Hn,centerOffset:mi-Hn-Jt,...Wt&&{alignmentOffset:Jt}},reset:Wt}}}),_k=function(T){return T===void 0&&(T={}),{name:"flip",options:T,async fn(R){var z,N;const{placement:X,middlewareData:J,rects:re,initialPlacement:s,platform:he,elements:ae}=R,{mainAxis:Me=!0,crossAxis:oe=!0,fallbackPlacements:Oe,fallbackStrategy:je="bestFit",fallbackAxisSideDirection:st="none",flipAlignment:Ce=!0,...Be}=Id(T,R);if((z=J.arrow)!=null&&z.alignmentOffset)return{};const Xe=Ad(X),ot=gh(s),Ke=Ad(s)===s,Ct=await(he.isRTL==null?void 0:he.isRTL(ae.floating)),tt=Oe||(Ke||!Ce?[O_(s)]:ck(s)),Nt=st!=="none";!Oe&&Nt&&tt.push(...fk(s,Ce,st,Ct));const jt=[s,...tt],Mt=await fg(R,Be),Rn=[];let Kn=((N=J.flip)==null?void 0:N.overflows)||[];if(Me&&Rn.push(Mt[Xe]),oe){const mi=lk(X,re,Ct);Rn.push(Mt[mi[0]],Mt[mi[1]])}if(Kn=[...Kn,{placement:X,overflows:Rn}],!Rn.every(mi=>mi<=0)){var Ti,pi;const mi=(((Ti=J.flip)==null?void 0:Ti.index)||0)+1,Hn=jt[mi];if(Hn&&(!(oe==="alignment"?ot!==gh(Hn):!1)||Kn.every(nt=>gh(nt.placement)===ot?nt.overflows[0]>0:!0)))return{data:{index:mi,overflows:Kn},reset:{placement:Hn}};let Wt=(pi=Kn.filter(Jt=>Jt.overflows[0]<=0).sort((Jt,nt)=>Jt.overflows[1]-nt.overflows[1])[0])==null?void 0:pi.placement;if(!Wt)switch(je){case"bestFit":{var dn;const Jt=(dn=Kn.filter(nt=>{if(Nt){const mn=gh(nt.placement);return mn===ot||mn==="y"}return!0}).map(nt=>[nt.placement,nt.overflows.filter(mn=>mn>0).reduce((mn,sn)=>mn+sn,0)]).sort((nt,mn)=>nt[1]-mn[1])[0])==null?void 0:dn[0];Jt&&(Wt=Jt);break}case"initialPlacement":Wt=s;break}if(X!==Wt)return{reset:{placement:Wt}}}return{}}}};function qb(T,R){return{top:T.top-R.height,right:T.right-R.width,bottom:T.bottom-R.height,left:T.left-R.width}}function Zb(T){return rk.some(R=>T[R]>=0)}const yk=function(T){return T===void 0&&(T={}),{name:"hide",options:T,async fn(R){const{rects:z}=R,{strategy:N="referenceHidden",...X}=Id(T,R);switch(N){case"referenceHidden":{const J=await fg(R,{...X,elementContext:"reference"}),re=qb(J,z.reference);return{data:{referenceHiddenOffsets:re,referenceHidden:Zb(re)}}}case"escaped":{const J=await fg(R,{...X,altBoundary:!0}),re=qb(J,z.floating);return{data:{escapedOffsets:re,escaped:Zb(re)}}}default:return{}}}}},dS=new Set(["left","top"]);async function vk(T,R){const{placement:z,platform:N,elements:X}=T,J=await(N.isRTL==null?void 0:N.isRTL(X.floating)),re=Ad(z),s=pm(z),he=gh(z)==="y",ae=dS.has(re)?-1:1,Me=J&&he?-1:1,oe=Id(R,T);let{mainAxis:Oe,crossAxis:je,alignmentAxis:st}=typeof oe=="number"?{mainAxis:oe,crossAxis:0,alignmentAxis:null}:{mainAxis:oe.mainAxis||0,crossAxis:oe.crossAxis||0,alignmentAxis:oe.alignmentAxis};return s&&typeof st=="number"&&(je=s==="end"?st*-1:st),he?{x:je*Me,y:Oe*ae}:{x:Oe*ae,y:je*Me}}const xk=function(T){return T===void 0&&(T=0),{name:"offset",options:T,async fn(R){var z,N;const{x:X,y:J,placement:re,middlewareData:s}=R,he=await vk(R,T);return re===((z=s.offset)==null?void 0:z.placement)&&(N=s.arrow)!=null&&N.alignmentOffset?{}:{x:X+he.x,y:J+he.y,data:{...he,placement:re}}}}},wk=function(T){return T===void 0&&(T={}),{name:"shift",options:T,async fn(R){const{x:z,y:N,placement:X}=R,{mainAxis:J=!0,crossAxis:re=!1,limiter:s={fn:Be=>{let{x:Xe,y:ot}=Be;return{x:Xe,y:ot}}},...he}=Id(T,R),ae={x:z,y:N},Me=await fg(R,he),oe=gh(Ad(X)),Oe=sx(oe);let je=ae[Oe],st=ae[oe];if(J){const Be=Oe==="y"?"top":"left",Xe=Oe==="y"?"bottom":"right",ot=je+Me[Be],Ke=je-Me[Xe];je=Vv(ot,je,Ke)}if(re){const Be=oe==="y"?"top":"left",Xe=oe==="y"?"bottom":"right",ot=st+Me[Be],Ke=st-Me[Xe];st=Vv(ot,st,Ke)}const Ce=s.fn({...R,[Oe]:je,[oe]:st});return{...Ce,data:{x:Ce.x-z,y:Ce.y-N,enabled:{[Oe]:J,[oe]:re}}}}}},bk=function(T){return T===void 0&&(T={}),{options:T,fn(R){const{x:z,y:N,placement:X,rects:J,middlewareData:re}=R,{offset:s=0,mainAxis:he=!0,crossAxis:ae=!0}=Id(T,R),Me={x:z,y:N},oe=gh(X),Oe=sx(oe);let je=Me[Oe],st=Me[oe];const Ce=Id(s,R),Be=typeof Ce=="number"?{mainAxis:Ce,crossAxis:0}:{mainAxis:0,crossAxis:0,...Ce};if(he){const Ke=Oe==="y"?"height":"width",Ct=J.reference[Oe]-J.floating[Ke]+Be.mainAxis,tt=J.reference[Oe]+J.reference[Ke]-Be.mainAxis;je<Ct?je=Ct:je>tt&&(je=tt)}if(ae){var Xe,ot;const Ke=Oe==="y"?"width":"height",Ct=dS.has(Ad(X)),tt=J.reference[oe]-J.floating[Ke]+(Ct&&((Xe=re.offset)==null?void 0:Xe[oe])||0)+(Ct?0:Be.crossAxis),Nt=J.reference[oe]+J.reference[Ke]+(Ct?0:((ot=re.offset)==null?void 0:ot[oe])||0)-(Ct?Be.crossAxis:0);st<tt?st=tt:st>Nt&&(st=Nt)}return{[Oe]:je,[oe]:st}}}},Tk=function(T){return T===void 0&&(T={}),{name:"size",options:T,async fn(R){var z,N;const{placement:X,rects:J,platform:re,elements:s}=R,{apply:he=()=>{},...ae}=Id(T,R),Me=await fg(R,ae),oe=Ad(X),Oe=pm(X),je=gh(X)==="y",{width:st,height:Ce}=J.floating;let Be,Xe;oe==="top"||oe==="bottom"?(Be=oe,Xe=Oe===(await(re.isRTL==null?void 0:re.isRTL(s.floating))?"start":"end")?"left":"right"):(Xe=oe,Be=Oe==="end"?"top":"bottom");const ot=Ce-Me.top-Me.bottom,Ke=st-Me.left-Me.right,Ct=Cf(Ce-Me[Be],ot),tt=Cf(st-Me[Xe],Ke),Nt=!R.middlewareData.shift;let jt=Ct,Mt=tt;if((z=R.middlewareData.shift)!=null&&z.enabled.x&&(Mt=Ke),(N=R.middlewareData.shift)!=null&&N.enabled.y&&(jt=ot),Nt&&!Oe){const Kn=uc(Me.left,0),Ti=uc(Me.right,0),pi=uc(Me.top,0),dn=uc(Me.bottom,0);je?Mt=st-2*(Kn!==0||Ti!==0?Kn+Ti:uc(Me.left,Me.right)):jt=Ce-2*(pi!==0||dn!==0?pi+dn:uc(Me.top,Me.bottom))}await he({...R,availableWidth:Mt,availableHeight:jt});const Rn=await re.getDimensions(s.floating);return st!==Rn.width||Ce!==Rn.height?{reset:{rects:!0}}:{}}}};function U_(){return typeof window<"u"}function mm(T){return fS(T)?(T.nodeName||"").toLowerCase():"#document"}function hc(T){var R;return(T==null||(R=T.ownerDocument)==null?void 0:R.defaultView)||window}function vh(T){var R;return(R=(fS(T)?T.ownerDocument:T.document)||window.document)==null?void 0:R.documentElement}function fS(T){return U_()?T instanceof Node||T instanceof hc(T).Node:!1}function xu(T){return U_()?T instanceof Element||T instanceof hc(T).Element:!1}function yh(T){return U_()?T instanceof HTMLElement||T instanceof hc(T).HTMLElement:!1}function Xb(T){return!U_()||typeof ShadowRoot>"u"?!1:T instanceof ShadowRoot||T instanceof hc(T).ShadowRoot}const Sk=new Set(["inline","contents"]);function bg(T){const{overflow:R,overflowX:z,overflowY:N,display:X}=wu(T);return/auto|scroll|overlay|hidden|clip/.test(R+N+z)&&!Sk.has(X)}const Ek=new Set(["table","td","th"]);function Ik(T){return Ek.has(mm(T))}const Ak=[":popover-open",":modal"];function G_(T){return Ak.some(R=>{try{return T.matches(R)}catch{return!1}})}const Ck=["transform","translate","scale","rotate","perspective"],Mk=["transform","translate","scale","rotate","perspective","filter"],Pk=["paint","layout","strict","content"];function cx(T){const R=ux(),z=xu(T)?wu(T):T;return Ck.some(N=>z[N]?z[N]!=="none":!1)||(z.containerType?z.containerType!=="normal":!1)||!R&&(z.backdropFilter?z.backdropFilter!=="none":!1)||!R&&(z.filter?z.filter!=="none":!1)||Mk.some(N=>(z.willChange||"").includes(N))||Pk.some(N=>(z.contain||"").includes(N))}function Rk(T){let R=Mf(T);for(;yh(R)&&!hm(R);){if(cx(R))return R;if(G_(R))return null;R=Mf(R)}return null}function ux(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const kk=new Set(["html","body","#document"]);function hm(T){return kk.has(mm(T))}function wu(T){return hc(T).getComputedStyle(T)}function $_(T){return xu(T)?{scrollLeft:T.scrollLeft,scrollTop:T.scrollTop}:{scrollLeft:T.scrollX,scrollTop:T.scrollY}}function Mf(T){if(mm(T)==="html")return T;const R=T.assignedSlot||T.parentNode||Xb(T)&&T.host||vh(T);return Xb(R)?R.host:R}function pS(T){const R=Mf(T);return hm(R)?T.ownerDocument?T.ownerDocument.body:T.body:yh(R)&&bg(R)?R:pS(R)}function pg(T,R,z){var N;R===void 0&&(R=[]),z===void 0&&(z=!0);const X=pS(T),J=X===((N=T.ownerDocument)==null?void 0:N.body),re=hc(X);if(J){const s=Gv(re);return R.concat(re,re.visualViewport||[],bg(X)?X:[],s&&z?pg(s):[])}return R.concat(X,pg(X,[],z))}function Gv(T){return T.parent&&Object.getPrototypeOf(T.parent)?T.frameElement:null}function mS(T){const R=wu(T);let z=parseFloat(R.width)||0,N=parseFloat(R.height)||0;const X=yh(T),J=X?T.offsetWidth:z,re=X?T.offsetHeight:N,s=D_(z)!==J||D_(N)!==re;return s&&(z=J,N=re),{width:z,height:N,$:s}}function hx(T){return xu(T)?T:T.contextElement}function lm(T){const R=hx(T);if(!yh(R))return _h(1);const z=R.getBoundingClientRect(),{width:N,height:X,$:J}=mS(R);let re=(J?D_(z.width):z.width)/N,s=(J?D_(z.height):z.height)/X;return(!re||!Number.isFinite(re))&&(re=1),(!s||!Number.isFinite(s))&&(s=1),{x:re,y:s}}const zk=_h(0);function gS(T){const R=hc(T);return!ux()||!R.visualViewport?zk:{x:R.visualViewport.offsetLeft,y:R.visualViewport.offsetTop}}function Lk(T,R,z){return R===void 0&&(R=!1),!z||R&&z!==hc(T)?!1:R}function xp(T,R,z,N){R===void 0&&(R=!1),z===void 0&&(z=!1);const X=T.getBoundingClientRect(),J=hx(T);let re=_h(1);R&&(N?xu(N)&&(re=lm(N)):re=lm(T));const s=Lk(J,z,N)?gS(J):_h(0);let he=(X.left+s.x)/re.x,ae=(X.top+s.y)/re.y,Me=X.width/re.x,oe=X.height/re.y;if(J){const Oe=hc(J),je=N&&xu(N)?hc(N):N;let st=Oe,Ce=Gv(st);for(;Ce&&N&&je!==st;){const Be=lm(Ce),Xe=Ce.getBoundingClientRect(),ot=wu(Ce),Ke=Xe.left+(Ce.clientLeft+parseFloat(ot.paddingLeft))*Be.x,Ct=Xe.top+(Ce.clientTop+parseFloat(ot.paddingTop))*Be.y;he*=Be.x,ae*=Be.y,Me*=Be.x,oe*=Be.y,he+=Ke,ae+=Ct,st=hc(Ce),Ce=Gv(st)}}return F_({width:Me,height:oe,x:he,y:ae})}function H_(T,R){const z=$_(T).scrollLeft;return R?R.left+z:xp(vh(T)).left+z}function _S(T,R){const z=T.getBoundingClientRect(),N=z.left+R.scrollLeft-H_(T,z),X=z.top+R.scrollTop;return{x:N,y:X}}function Dk(T){let{elements:R,rect:z,offsetParent:N,strategy:X}=T;const J=X==="fixed",re=vh(N),s=R?G_(R.floating):!1;if(N===re||s&&J)return z;let he={scrollLeft:0,scrollTop:0},ae=_h(1);const Me=_h(0),oe=yh(N);if((oe||!oe&&!J)&&((mm(N)!=="body"||bg(re))&&(he=$_(N)),yh(N))){const je=xp(N);ae=lm(N),Me.x=je.x+N.clientLeft,Me.y=je.y+N.clientTop}const Oe=re&&!oe&&!J?_S(re,he):_h(0);return{width:z.width*ae.x,height:z.height*ae.y,x:z.x*ae.x-he.scrollLeft*ae.x+Me.x+Oe.x,y:z.y*ae.y-he.scrollTop*ae.y+Me.y+Oe.y}}function Ok(T){return Array.from(T.getClientRects())}function Fk(T){const R=vh(T),z=$_(T),N=T.ownerDocument.body,X=uc(R.scrollWidth,R.clientWidth,N.scrollWidth,N.clientWidth),J=uc(R.scrollHeight,R.clientHeight,N.scrollHeight,N.clientHeight);let re=-z.scrollLeft+H_(T);const s=-z.scrollTop;return wu(N).direction==="rtl"&&(re+=uc(R.clientWidth,N.clientWidth)-X),{width:X,height:J,x:re,y:s}}const Yb=25;function Bk(T,R){const z=hc(T),N=vh(T),X=z.visualViewport;let J=N.clientWidth,re=N.clientHeight,s=0,he=0;if(X){J=X.width,re=X.height;const Me=ux();(!Me||Me&&R==="fixed")&&(s=X.offsetLeft,he=X.offsetTop)}const ae=H_(N);if(ae<=0){const Me=N.ownerDocument,oe=Me.body,Oe=getComputedStyle(oe),je=Me.compatMode==="CSS1Compat"&&parseFloat(Oe.marginLeft)+parseFloat(Oe.marginRight)||0,st=Math.abs(N.clientWidth-oe.clientWidth-je);st<=Yb&&(J-=st)}else ae<=Yb&&(J+=ae);return{width:J,height:re,x:s,y:he}}const Nk=new Set(["absolute","fixed"]);function jk(T,R){const z=xp(T,!0,R==="fixed"),N=z.top+T.clientTop,X=z.left+T.clientLeft,J=yh(T)?lm(T):_h(1),re=T.clientWidth*J.x,s=T.clientHeight*J.y,he=X*J.x,ae=N*J.y;return{width:re,height:s,x:he,y:ae}}function Kb(T,R,z){let N;if(R==="viewport")N=Bk(T,z);else if(R==="document")N=Fk(vh(T));else if(xu(R))N=jk(R,z);else{const X=gS(T);N={x:R.x-X.x,y:R.y-X.y,width:R.width,height:R.height}}return F_(N)}function yS(T,R){const z=Mf(T);return z===R||!xu(z)||hm(z)?!1:wu(z).position==="fixed"||yS(z,R)}function Vk(T,R){const z=R.get(T);if(z)return z;let N=pg(T,[],!1).filter(s=>xu(s)&&mm(s)!=="body"),X=null;const J=wu(T).position==="fixed";let re=J?Mf(T):T;for(;xu(re)&&!hm(re);){const s=wu(re),he=cx(re);!he&&s.position==="fixed"&&(X=null),(J?!he&&!X:!he&&s.position==="static"&&!!X&&Nk.has(X.position)||bg(re)&&!he&&yS(T,re))?N=N.filter(Me=>Me!==re):X=s,re=Mf(re)}return R.set(T,N),N}function Uk(T){let{element:R,boundary:z,rootBoundary:N,strategy:X}=T;const re=[...z==="clippingAncestors"?G_(R)?[]:Vk(R,this._c):[].concat(z),N],s=re[0],he=re.reduce((ae,Me)=>{const oe=Kb(R,Me,X);return ae.top=uc(oe.top,ae.top),ae.right=Cf(oe.right,ae.right),ae.bottom=Cf(oe.bottom,ae.bottom),ae.left=uc(oe.left,ae.left),ae},Kb(R,s,X));return{width:he.right-he.left,height:he.bottom-he.top,x:he.left,y:he.top}}function Gk(T){const{width:R,height:z}=mS(T);return{width:R,height:z}}function $k(T,R,z){const N=yh(R),X=vh(R),J=z==="fixed",re=xp(T,!0,J,R);let s={scrollLeft:0,scrollTop:0};const he=_h(0);function ae(){he.x=H_(X)}if(N||!N&&!J)if((mm(R)!=="body"||bg(X))&&(s=$_(R)),N){const je=xp(R,!0,J,R);he.x=je.x+R.clientLeft,he.y=je.y+R.clientTop}else X&&ae();J&&!N&&X&&ae();const Me=X&&!N&&!J?_S(X,s):_h(0),oe=re.left+s.scrollLeft-he.x-Me.x,Oe=re.top+s.scrollTop-he.y-Me.y;return{x:oe,y:Oe,width:re.width,height:re.height}}function Iv(T){return wu(T).position==="static"}function Jb(T,R){if(!yh(T)||wu(T).position==="fixed")return null;if(R)return R(T);let z=T.offsetParent;return vh(T)===z&&(z=z.ownerDocument.body),z}function vS(T,R){const z=hc(T);if(G_(T))return z;if(!yh(T)){let X=Mf(T);for(;X&&!hm(X);){if(xu(X)&&!Iv(X))return X;X=Mf(X)}return z}let N=Jb(T,R);for(;N&&Ik(N)&&Iv(N);)N=Jb(N,R);return N&&hm(N)&&Iv(N)&&!cx(N)?z:N||Rk(T)||z}const Hk=async function(T){const R=this.getOffsetParent||vS,z=this.getDimensions,N=await z(T.floating);return{reference:$k(T.reference,await R(T.floating),T.strategy),floating:{x:0,y:0,width:N.width,height:N.height}}};function Wk(T){return wu(T).direction==="rtl"}const qk={convertOffsetParentRelativeRectToViewportRelativeRect:Dk,getDocumentElement:vh,getClippingRect:Uk,getOffsetParent:vS,getElementRects:Hk,getClientRects:Ok,getDimensions:Gk,getScale:lm,isElement:xu,isRTL:Wk};function xS(T,R){return T.x===R.x&&T.y===R.y&&T.width===R.width&&T.height===R.height}function Zk(T,R){let z=null,N;const X=vh(T);function J(){var s;clearTimeout(N),(s=z)==null||s.disconnect(),z=null}function re(s,he){s===void 0&&(s=!1),he===void 0&&(he=1),J();const ae=T.getBoundingClientRect(),{left:Me,top:oe,width:Oe,height:je}=ae;if(s||R(),!Oe||!je)return;const st=v_(oe),Ce=v_(X.clientWidth-(Me+Oe)),Be=v_(X.clientHeight-(oe+je)),Xe=v_(Me),Ke={rootMargin:-st+"px "+-Ce+"px "+-Be+"px "+-Xe+"px",threshold:uc(0,Cf(1,he))||1};let Ct=!0;function tt(Nt){const jt=Nt[0].intersectionRatio;if(jt!==he){if(!Ct)return re();jt?re(!1,jt):N=setTimeout(()=>{re(!1,1e-7)},1e3)}jt===1&&!xS(ae,T.getBoundingClientRect())&&re(),Ct=!1}try{z=new IntersectionObserver(tt,{...Ke,root:X.ownerDocument})}catch{z=new IntersectionObserver(tt,Ke)}z.observe(T)}return re(!0),J}function Xk(T,R,z,N){N===void 0&&(N={});const{ancestorScroll:X=!0,ancestorResize:J=!0,elementResize:re=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:he=!1}=N,ae=hx(T),Me=X||J?[...ae?pg(ae):[],...pg(R)]:[];Me.forEach(Xe=>{X&&Xe.addEventListener("scroll",z,{passive:!0}),J&&Xe.addEventListener("resize",z)});const oe=ae&&s?Zk(ae,z):null;let Oe=-1,je=null;re&&(je=new ResizeObserver(Xe=>{let[ot]=Xe;ot&&ot.target===ae&&je&&(je.unobserve(R),cancelAnimationFrame(Oe),Oe=requestAnimationFrame(()=>{var Ke;(Ke=je)==null||Ke.observe(R)})),z()}),ae&&!he&&je.observe(ae),je.observe(R));let st,Ce=he?xp(T):null;he&&Be();function Be(){const Xe=xp(T);Ce&&!xS(Ce,Xe)&&z(),Ce=Xe,st=requestAnimationFrame(Be)}return z(),()=>{var Xe;Me.forEach(ot=>{X&&ot.removeEventListener("scroll",z),J&&ot.removeEventListener("resize",z)}),oe?.(),(Xe=je)==null||Xe.disconnect(),je=null,he&&cancelAnimationFrame(st)}}const Yk=xk,Kk=wk,Jk=_k,Qk=Tk,ez=yk,Qb=gk,tz=bk,nz=(T,R,z)=>{const N=new Map,X={platform:qk,...z},J={...X.platform,_c:N};return mk(T,R,{...X,platform:J})};var iz=typeof document<"u",rz=function(){},I_=iz?be.useLayoutEffect:rz;function B_(T,R){if(T===R)return!0;if(typeof T!=typeof R)return!1;if(typeof T=="function"&&T.toString()===R.toString())return!0;let z,N,X;if(T&&R&&typeof T=="object"){if(Array.isArray(T)){if(z=T.length,z!==R.length)return!1;for(N=z;N--!==0;)if(!B_(T[N],R[N]))return!1;return!0}if(X=Object.keys(T),z=X.length,z!==Object.keys(R).length)return!1;for(N=z;N--!==0;)if(!{}.hasOwnProperty.call(R,X[N]))return!1;for(N=z;N--!==0;){const J=X[N];if(!(J==="_owner"&&T.$$typeof)&&!B_(T[J],R[J]))return!1}return!0}return T!==T&&R!==R}function wS(T){return typeof window>"u"?1:(T.ownerDocument.defaultView||window).devicePixelRatio||1}function eT(T,R){const z=wS(T);return Math.round(R*z)/z}function Av(T){const R=be.useRef(T);return I_(()=>{R.current=T}),R}function oz(T){T===void 0&&(T={});const{placement:R="bottom",strategy:z="absolute",middleware:N=[],platform:X,elements:{reference:J,floating:re}={},transform:s=!0,whileElementsMounted:he,open:ae}=T,[Me,oe]=be.useState({x:0,y:0,strategy:z,placement:R,middlewareData:{},isPositioned:!1}),[Oe,je]=be.useState(N);B_(Oe,N)||je(N);const[st,Ce]=be.useState(null),[Be,Xe]=be.useState(null),ot=be.useCallback(nt=>{nt!==Nt.current&&(Nt.current=nt,Ce(nt))},[]),Ke=be.useCallback(nt=>{nt!==jt.current&&(jt.current=nt,Xe(nt))},[]),Ct=J||st,tt=re||Be,Nt=be.useRef(null),jt=be.useRef(null),Mt=be.useRef(Me),Rn=he!=null,Kn=Av(he),Ti=Av(X),pi=Av(ae),dn=be.useCallback(()=>{if(!Nt.current||!jt.current)return;const nt={placement:R,strategy:z,middleware:Oe};Ti.current&&(nt.platform=Ti.current),nz(Nt.current,jt.current,nt).then(mn=>{const sn={...mn,isPositioned:pi.current!==!1};mi.current&&!B_(Mt.current,sn)&&(Mt.current=sn,yg.flushSync(()=>{oe(sn)}))})},[Oe,R,z,Ti,pi]);I_(()=>{ae===!1&&Mt.current.isPositioned&&(Mt.current.isPositioned=!1,oe(nt=>({...nt,isPositioned:!1})))},[ae]);const mi=be.useRef(!1);I_(()=>(mi.current=!0,()=>{mi.current=!1}),[]),I_(()=>{if(Ct&&(Nt.current=Ct),tt&&(jt.current=tt),Ct&&tt){if(Kn.current)return Kn.current(Ct,tt,dn);dn()}},[Ct,tt,dn,Kn,Rn]);const Hn=be.useMemo(()=>({reference:Nt,floating:jt,setReference:ot,setFloating:Ke}),[ot,Ke]),Wt=be.useMemo(()=>({reference:Ct,floating:tt}),[Ct,tt]),Jt=be.useMemo(()=>{const nt={position:z,left:0,top:0};if(!Wt.floating)return nt;const mn=eT(Wt.floating,Me.x),sn=eT(Wt.floating,Me.y);return s?{...nt,transform:"translate("+mn+"px, "+sn+"px)",...wS(Wt.floating)>=1.5&&{willChange:"transform"}}:{position:z,left:mn,top:sn}},[z,s,Wt.floating,Me.x,Me.y]);return be.useMemo(()=>({...Me,update:dn,refs:Hn,elements:Wt,floatingStyles:Jt}),[Me,dn,Hn,Wt,Jt])}const sz=T=>{function R(z){return{}.hasOwnProperty.call(z,"current")}return{name:"arrow",options:T,fn(z){const{element:N,padding:X}=typeof T=="function"?T(z):T;return N&&R(N)?N.current!=null?Qb({element:N.current,padding:X}).fn(z):{}:N?Qb({element:N,padding:X}).fn(z):{}}}},az=(T,R)=>({...Yk(T),options:[T,R]}),lz=(T,R)=>({...Kk(T),options:[T,R]}),cz=(T,R)=>({...tz(T),options:[T,R]}),uz=(T,R)=>({...Jk(T),options:[T,R]}),hz=(T,R)=>({...Qk(T),options:[T,R]}),dz=(T,R)=>({...ez(T),options:[T,R]}),fz=(T,R)=>({...sz(T),options:[T,R]});var pz="Arrow",bS=be.forwardRef((T,R)=>{const{children:z,width:N=10,height:X=5,...J}=T;return $.jsx(_o.svg,{...J,ref:R,width:N,height:X,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:T.asChild?z:$.jsx("polygon",{points:"0,0 30,0 15,10"})})});bS.displayName=pz;var mz=bS;function gz(T){const[R,z]=be.useState(void 0);return Us(()=>{if(T){z({width:T.offsetWidth,height:T.offsetHeight});const N=new ResizeObserver(X=>{if(!Array.isArray(X)||!X.length)return;const J=X[0];let re,s;if("borderBoxSize"in J){const he=J.borderBoxSize,ae=Array.isArray(he)?he[0]:he;re=ae.inlineSize,s=ae.blockSize}else re=T.offsetWidth,s=T.offsetHeight;z({width:re,height:s})});return N.observe(T,{box:"border-box"}),()=>N.unobserve(T)}else z(void 0)},[T]),R}var dx="Popper",[TS,SS]=mg(dx),[_z,ES]=TS(dx),IS=T=>{const{__scopePopper:R,children:z}=T,[N,X]=be.useState(null);return $.jsx(_z,{scope:R,anchor:N,onAnchorChange:X,children:z})};IS.displayName=dx;var AS="PopperAnchor",CS=be.forwardRef((T,R)=>{const{__scopePopper:z,virtualRef:N,...X}=T,J=ES(AS,z),re=be.useRef(null),s=Vs(R,re),he=be.useRef(null);return be.useEffect(()=>{const ae=he.current;he.current=N?.current||re.current,ae!==he.current&&J.onAnchorChange(he.current)}),N?null:$.jsx(_o.div,{...X,ref:s})});CS.displayName=AS;var fx="PopperContent",[yz,vz]=TS(fx),MS=be.forwardRef((T,R)=>{const{__scopePopper:z,side:N="bottom",sideOffset:X=0,align:J="center",alignOffset:re=0,arrowPadding:s=0,avoidCollisions:he=!0,collisionBoundary:ae=[],collisionPadding:Me=0,sticky:oe="partial",hideWhenDetached:Oe=!1,updatePositionStrategy:je="optimized",onPlaced:st,...Ce}=T,Be=ES(fx,z),[Xe,ot]=be.useState(null),Ke=Vs(R,cn=>ot(cn)),[Ct,tt]=be.useState(null),Nt=gz(Ct),jt=Nt?.width??0,Mt=Nt?.height??0,Rn=N+(J!=="center"?"-"+J:""),Kn=typeof Me=="number"?Me:{top:0,right:0,bottom:0,left:0,...Me},Ti=Array.isArray(ae)?ae:[ae],pi=Ti.length>0,dn={padding:Kn,boundary:Ti.filter(wz),altBoundary:pi},{refs:mi,floatingStyles:Hn,placement:Wt,isPositioned:Jt,middlewareData:nt}=oz({strategy:"fixed",placement:Rn,whileElementsMounted:(...cn)=>Xk(...cn,{animationFrame:je==="always"}),elements:{reference:Be.anchor},middleware:[az({mainAxis:X+Mt,alignmentAxis:re}),he&&lz({mainAxis:!0,crossAxis:!1,limiter:oe==="partial"?cz():void 0,...dn}),he&&uz({...dn}),hz({...dn,apply:({elements:cn,rects:wn,availableWidth:xn,availableHeight:kn})=>{const{width:_i,height:Ji}=wn.reference,Gi=cn.floating.style;Gi.setProperty("--radix-popper-available-width",`${xn}px`),Gi.setProperty("--radix-popper-available-height",`${kn}px`),Gi.setProperty("--radix-popper-anchor-width",`${_i}px`),Gi.setProperty("--radix-popper-anchor-height",`${Ji}px`)}}),Ct&&fz({element:Ct,padding:s}),bz({arrowWidth:jt,arrowHeight:Mt}),Oe&&dz({strategy:"referenceHidden",...dn})]}),[mn,sn]=kS(Wt),rt=Ed(st);Us(()=>{Jt&&rt?.()},[Jt,rt]);const Ut=nt.arrow?.x,Gt=nt.arrow?.y,gn=nt.arrow?.centerOffset!==0,[jn,oi]=be.useState();return Us(()=>{Xe&&oi(window.getComputedStyle(Xe).zIndex)},[Xe]),$.jsx("div",{ref:mi.setFloating,"data-radix-popper-content-wrapper":"",style:{...Hn,transform:Jt?Hn.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:jn,"--radix-popper-transform-origin":[nt.transformOrigin?.x,nt.transformOrigin?.y].join(" "),...nt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:T.dir,children:$.jsx(yz,{scope:z,placedSide:mn,onArrowChange:tt,arrowX:Ut,arrowY:Gt,shouldHideArrow:gn,children:$.jsx(_o.div,{"data-side":mn,"data-align":sn,...Ce,ref:Ke,style:{...Ce.style,animation:Jt?void 0:"none"}})})})});MS.displayName=fx;var PS="PopperArrow",xz={top:"bottom",right:"left",bottom:"top",left:"right"},RS=be.forwardRef(function(R,z){const{__scopePopper:N,...X}=R,J=vz(PS,N),re=xz[J.placedSide];return $.jsx("span",{ref:J.onArrowChange,style:{position:"absolute",left:J.arrowX,top:J.arrowY,[re]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[J.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[J.placedSide],visibility:J.shouldHideArrow?"hidden":void 0},children:$.jsx(mz,{...X,ref:z,style:{...X.style,display:"block"}})})});RS.displayName=PS;function wz(T){return T!==null}var bz=T=>({name:"transformOrigin",options:T,fn(R){const{placement:z,rects:N,middlewareData:X}=R,re=X.arrow?.centerOffset!==0,s=re?0:T.arrowWidth,he=re?0:T.arrowHeight,[ae,Me]=kS(z),oe={start:"0%",center:"50%",end:"100%"}[Me],Oe=(X.arrow?.x??0)+s/2,je=(X.arrow?.y??0)+he/2;let st="",Ce="";return ae==="bottom"?(st=re?oe:`${Oe}px`,Ce=`${-he}px`):ae==="top"?(st=re?oe:`${Oe}px`,Ce=`${N.floating.height+he}px`):ae==="right"?(st=`${-he}px`,Ce=re?oe:`${je}px`):ae==="left"&&(st=`${N.floating.width+he}px`,Ce=re?oe:`${je}px`),{data:{x:st,y:Ce}}}});function kS(T){const[R,z="center"]=T.split("-");return[R,z]}var Tz=IS,Sz=CS,Ez=MS,Iz=RS,Az="Portal",zS=be.forwardRef((T,R)=>{const{container:z,...N}=T,[X,J]=be.useState(!1);Us(()=>J(!0),[]);const re=z||X&&globalThis?.document?.body;return re?lT.createPortal($.jsx(_o.div,{...N,ref:R}),re):null});zS.displayName=Az;function Cz(T){const R=Mz(T),z=be.forwardRef((N,X)=>{const{children:J,...re}=N,s=be.Children.toArray(J),he=s.find(Rz);if(he){const ae=he.props.children,Me=s.map(oe=>oe===he?be.Children.count(ae)>1?be.Children.only(null):be.isValidElement(ae)?ae.props.children:null:oe);return $.jsx(R,{...re,ref:X,children:be.isValidElement(ae)?be.cloneElement(ae,void 0,Me):null})}return $.jsx(R,{...re,ref:X,children:J})});return z.displayName=`${T}.Slot`,z}function Mz(T){const R=be.forwardRef((z,N)=>{const{children:X,...J}=z;if(be.isValidElement(X)){const re=zz(X),s=kz(J,X.props);return X.type!==be.Fragment&&(s.ref=N?gg(N,re):re),be.cloneElement(X,s)}return be.Children.count(X)>1?be.Children.only(null):null});return R.displayName=`${T}.SlotClone`,R}var Pz=Symbol("radix.slottable");function Rz(T){return be.isValidElement(T)&&typeof T.type=="function"&&"__radixId"in T.type&&T.type.__radixId===Pz}function kz(T,R){const z={...R};for(const N in R){const X=T[N],J=R[N];/^on[A-Z]/.test(N)?X&&J?z[N]=(...s)=>{const he=J(...s);return X(...s),he}:X&&(z[N]=X):N==="style"?z[N]={...X,...J}:N==="className"&&(z[N]=[X,J].filter(Boolean).join(" "))}return{...T,...z}}function zz(T){let R=Object.getOwnPropertyDescriptor(T.props,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning;return z?T.ref:(R=Object.getOwnPropertyDescriptor(T,"ref")?.get,z=R&&"isReactWarning"in R&&R.isReactWarning,z?T.props.ref:T.props.ref||T.ref)}function Lz(T){const R=be.useRef({value:T,previous:T});return be.useMemo(()=>(R.current.value!==T&&(R.current.previous=R.current.value,R.current.value=T),R.current.previous),[T])}var LS=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Dz="VisuallyHidden",Oz=be.forwardRef((T,R)=>$.jsx(_o.span,{...T,ref:R,style:{...LS,...T.style}}));Oz.displayName=Dz;var Fz=function(T){if(typeof document>"u")return null;var R=Array.isArray(T)?T[0]:T;return R.ownerDocument.body},om=new WeakMap,x_=new WeakMap,w_={},Cv=0,DS=function(T){return T&&(T.host||DS(T.parentNode))},Bz=function(T,R){return R.map(function(z){if(T.contains(z))return z;var N=DS(z);return N&&T.contains(N)?N:(console.error("aria-hidden",z,"in not contained inside",T,". Doing nothing"),null)}).filter(function(z){return!!z})},Nz=function(T,R,z,N){var X=Bz(R,Array.isArray(T)?T:[T]);w_[z]||(w_[z]=new WeakMap);var J=w_[z],re=[],s=new Set,he=new Set(X),ae=function(oe){!oe||s.has(oe)||(s.add(oe),ae(oe.parentNode))};X.forEach(ae);var Me=function(oe){!oe||he.has(oe)||Array.prototype.forEach.call(oe.children,function(Oe){if(s.has(Oe))Me(Oe);else try{var je=Oe.getAttribute(N),st=je!==null&&je!=="false",Ce=(om.get(Oe)||0)+1,Be=(J.get(Oe)||0)+1;om.set(Oe,Ce),J.set(Oe,Be),re.push(Oe),Ce===1&&st&&x_.set(Oe,!0),Be===1&&Oe.setAttribute(z,"true"),st||Oe.setAttribute(N,"true")}catch(Xe){console.error("aria-hidden: cannot operate on ",Oe,Xe)}})};return Me(R),s.clear(),Cv++,function(){re.forEach(function(oe){var Oe=om.get(oe)-1,je=J.get(oe)-1;om.set(oe,Oe),J.set(oe,je),Oe||(x_.has(oe)||oe.removeAttribute(N),x_.delete(oe)),je||oe.removeAttribute(z)}),Cv--,Cv||(om=new WeakMap,om=new WeakMap,x_=new WeakMap,w_={})}},jz=function(T,R,z){z===void 0&&(z="data-aria-hidden");var N=Array.from(Array.isArray(T)?T:[T]),X=Fz(T);return X?(N.push.apply(N,Array.from(X.querySelectorAll("[aria-live], script"))),Nz(N,X,z,"aria-hidden")):function(){return null}},mh=function(){return mh=Object.assign||function(R){for(var z,N=1,X=arguments.length;N<X;N++){z=arguments[N];for(var J in z)Object.prototype.hasOwnProperty.call(z,J)&&(R[J]=z[J])}return R},mh.apply(this,arguments)};function OS(T,R){var z={};for(var N in T)Object.prototype.hasOwnProperty.call(T,N)&&R.indexOf(N)<0&&(z[N]=T[N]);if(T!=null&&typeof Object.getOwnPropertySymbols=="function")for(var X=0,N=Object.getOwnPropertySymbols(T);X<N.length;X++)R.indexOf(N[X])<0&&Object.prototype.propertyIsEnumerable.call(T,N[X])&&(z[N[X]]=T[N[X]]);return z}function Vz(T,R,z){if(z||arguments.length===2)for(var N=0,X=R.length,J;N<X;N++)(J||!(N in R))&&(J||(J=Array.prototype.slice.call(R,0,N)),J[N]=R[N]);return T.concat(J||Array.prototype.slice.call(R))}var A_="right-scroll-bar-position",C_="width-before-scroll-bar",Uz="with-scroll-bars-hidden",Gz="--removed-body-scroll-bar-size";function Mv(T,R){return typeof T=="function"?T(R):T&&(T.current=R),T}function $z(T,R){var z=be.useState(function(){return{value:T,callback:R,facade:{get current(){return z.value},set current(N){var X=z.value;X!==N&&(z.value=N,z.callback(N,X))}}}})[0];return z.callback=R,z.facade}var Hz=typeof window<"u"?be.useLayoutEffect:be.useEffect,tT=new WeakMap;function Wz(T,R){var z=$z(null,function(N){return T.forEach(function(X){return Mv(X,N)})});return Hz(function(){var N=tT.get(z);if(N){var X=new Set(N),J=new Set(T),re=z.current;X.forEach(function(s){J.has(s)||Mv(s,null)}),J.forEach(function(s){X.has(s)||Mv(s,re)})}tT.set(z,T)},[T]),z}function qz(T){return T}function Zz(T,R){R===void 0&&(R=qz);var z=[],N=!1,X={read:function(){if(N)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return z.length?z[z.length-1]:T},useMedium:function(J){var re=R(J,N);return z.push(re),function(){z=z.filter(function(s){return s!==re})}},assignSyncMedium:function(J){for(N=!0;z.length;){var re=z;z=[],re.forEach(J)}z={push:function(s){return J(s)},filter:function(){return z}}},assignMedium:function(J){N=!0;var re=[];if(z.length){var s=z;z=[],s.forEach(J),re=z}var he=function(){var Me=re;re=[],Me.forEach(J)},ae=function(){return Promise.resolve().then(he)};ae(),z={push:function(Me){re.push(Me),ae()},filter:function(Me){return re=re.filter(Me),z}}}};return X}function Xz(T){T===void 0&&(T={});var R=Zz(null);return R.options=mh({async:!0,ssr:!1},T),R}var FS=function(T){var R=T.sideCar,z=OS(T,["sideCar"]);if(!R)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var N=R.read();if(!N)throw new Error("Sidecar medium not found");return be.createElement(N,mh({},z))};FS.isSideCarExport=!0;function Yz(T,R){return T.useMedium(R),FS}var BS=Xz(),Pv=function(){},W_=be.forwardRef(function(T,R){var z=be.useRef(null),N=be.useState({onScrollCapture:Pv,onWheelCapture:Pv,onTouchMoveCapture:Pv}),X=N[0],J=N[1],re=T.forwardProps,s=T.children,he=T.className,ae=T.removeScrollBar,Me=T.enabled,oe=T.shards,Oe=T.sideCar,je=T.noRelative,st=T.noIsolation,Ce=T.inert,Be=T.allowPinchZoom,Xe=T.as,ot=Xe===void 0?"div":Xe,Ke=T.gapMode,Ct=OS(T,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),tt=Oe,Nt=Wz([z,R]),jt=mh(mh({},Ct),X);return be.createElement(be.Fragment,null,Me&&be.createElement(tt,{sideCar:BS,removeScrollBar:ae,shards:oe,noRelative:je,noIsolation:st,inert:Ce,setCallbacks:J,allowPinchZoom:!!Be,lockRef:z,gapMode:Ke}),re?be.cloneElement(be.Children.only(s),mh(mh({},jt),{ref:Nt})):be.createElement(ot,mh({},jt,{className:he,ref:Nt}),s))});W_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};W_.classNames={fullWidth:C_,zeroRight:A_};var Kz=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Jz(){if(!document)return null;var T=document.createElement("style");T.type="text/css";var R=Kz();return R&&T.setAttribute("nonce",R),T}function Qz(T,R){T.styleSheet?T.styleSheet.cssText=R:T.appendChild(document.createTextNode(R))}function eL(T){var R=document.head||document.getElementsByTagName("head")[0];R.appendChild(T)}var tL=function(){var T=0,R=null;return{add:function(z){T==0&&(R=Jz())&&(Qz(R,z),eL(R)),T++},remove:function(){T--,!T&&R&&(R.parentNode&&R.parentNode.removeChild(R),R=null)}}},nL=function(){var T=tL();return function(R,z){be.useEffect(function(){return T.add(R),function(){T.remove()}},[R&&z])}},NS=function(){var T=nL(),R=function(z){var N=z.styles,X=z.dynamic;return T(N,X),null};return R},iL={left:0,top:0,right:0,gap:0},Rv=function(T){return parseInt(T||"",10)||0},rL=function(T){var R=window.getComputedStyle(document.body),z=R[T==="padding"?"paddingLeft":"marginLeft"],N=R[T==="padding"?"paddingTop":"marginTop"],X=R[T==="padding"?"paddingRight":"marginRight"];return[Rv(z),Rv(N),Rv(X)]},oL=function(T){if(T===void 0&&(T="margin"),typeof window>"u")return iL;var R=rL(T),z=document.documentElement.clientWidth,N=window.innerWidth;return{left:R[0],top:R[1],right:R[2],gap:Math.max(0,N-z+R[2]-R[0])}},sL=NS(),cm="data-scroll-locked",aL=function(T,R,z,N){var X=T.left,J=T.top,re=T.right,s=T.gap;return z===void 0&&(z="margin"),`
  .`.concat(Uz,` {
   overflow: hidden `).concat(N,`;
   padding-right: `).concat(s,"px ").concat(N,`;
  }
  body[`).concat(cm,`] {
    overflow: hidden `).concat(N,`;
    overscroll-behavior: contain;
    `).concat([R&&"position: relative ".concat(N,";"),z==="margin"&&`
    padding-left: `.concat(X,`px;
    padding-top: `).concat(J,`px;
    padding-right: `).concat(re,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(N,`;
    `),z==="padding"&&"padding-right: ".concat(s,"px ").concat(N,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(A_,` {
    right: `).concat(s,"px ").concat(N,`;
  }
  
  .`).concat(C_,` {
    margin-right: `).concat(s,"px ").concat(N,`;
  }
  
  .`).concat(A_," .").concat(A_,` {
    right: 0 `).concat(N,`;
  }
  
  .`).concat(C_," .").concat(C_,` {
    margin-right: 0 `).concat(N,`;
  }
  
  body[`).concat(cm,`] {
    `).concat(Gz,": ").concat(s,`px;
  }
`)},nT=function(){var T=parseInt(document.body.getAttribute(cm)||"0",10);return isFinite(T)?T:0},lL=function(){be.useEffect(function(){return document.body.setAttribute(cm,(nT()+1).toString()),function(){var T=nT()-1;T<=0?document.body.removeAttribute(cm):document.body.setAttribute(cm,T.toString())}},[])},cL=function(T){var R=T.noRelative,z=T.noImportant,N=T.gapMode,X=N===void 0?"margin":N;lL();var J=be.useMemo(function(){return oL(X)},[X]);return be.createElement(sL,{styles:aL(J,!R,X,z?"":"!important")})},$v=!1;if(typeof window<"u")try{var b_=Object.defineProperty({},"passive",{get:function(){return $v=!0,!0}});window.addEventListener("test",b_,b_),window.removeEventListener("test",b_,b_)}catch{$v=!1}var sm=$v?{passive:!1}:!1,uL=function(T){return T.tagName==="TEXTAREA"},jS=function(T,R){if(!(T instanceof Element))return!1;var z=window.getComputedStyle(T);return z[R]!=="hidden"&&!(z.overflowY===z.overflowX&&!uL(T)&&z[R]==="visible")},hL=function(T){return jS(T,"overflowY")},dL=function(T){return jS(T,"overflowX")},iT=function(T,R){var z=R.ownerDocument,N=R;do{typeof ShadowRoot<"u"&&N instanceof ShadowRoot&&(N=N.host);var X=VS(T,N);if(X){var J=US(T,N),re=J[1],s=J[2];if(re>s)return!0}N=N.parentNode}while(N&&N!==z.body);return!1},fL=function(T){var R=T.scrollTop,z=T.scrollHeight,N=T.clientHeight;return[R,z,N]},pL=function(T){var R=T.scrollLeft,z=T.scrollWidth,N=T.clientWidth;return[R,z,N]},VS=function(T,R){return T==="v"?hL(R):dL(R)},US=function(T,R){return T==="v"?fL(R):pL(R)},mL=function(T,R){return T==="h"&&R==="rtl"?-1:1},gL=function(T,R,z,N,X){var J=mL(T,window.getComputedStyle(R).direction),re=J*N,s=z.target,he=R.contains(s),ae=!1,Me=re>0,oe=0,Oe=0;do{if(!s)break;var je=US(T,s),st=je[0],Ce=je[1],Be=je[2],Xe=Ce-Be-J*st;(st||Xe)&&VS(T,s)&&(oe+=Xe,Oe+=st);var ot=s.parentNode;s=ot&&ot.nodeType===Node.DOCUMENT_FRAGMENT_NODE?ot.host:ot}while(!he&&s!==document.body||he&&(R.contains(s)||R===s));return(Me&&Math.abs(oe)<1||!Me&&Math.abs(Oe)<1)&&(ae=!0),ae},T_=function(T){return"changedTouches"in T?[T.changedTouches[0].clientX,T.changedTouches[0].clientY]:[0,0]},rT=function(T){return[T.deltaX,T.deltaY]},oT=function(T){return T&&"current"in T?T.current:T},_L=function(T,R){return T[0]===R[0]&&T[1]===R[1]},yL=function(T){return`
  .block-interactivity-`.concat(T,` {pointer-events: none;}
  .allow-interactivity-`).concat(T,` {pointer-events: all;}
`)},vL=0,am=[];function xL(T){var R=be.useRef([]),z=be.useRef([0,0]),N=be.useRef(),X=be.useState(vL++)[0],J=be.useState(NS)[0],re=be.useRef(T);be.useEffect(function(){re.current=T},[T]),be.useEffect(function(){if(T.inert){document.body.classList.add("block-interactivity-".concat(X));var Ce=Vz([T.lockRef.current],(T.shards||[]).map(oT),!0).filter(Boolean);return Ce.forEach(function(Be){return Be.classList.add("allow-interactivity-".concat(X))}),function(){document.body.classList.remove("block-interactivity-".concat(X)),Ce.forEach(function(Be){return Be.classList.remove("allow-interactivity-".concat(X))})}}},[T.inert,T.lockRef.current,T.shards]);var s=be.useCallback(function(Ce,Be){if("touches"in Ce&&Ce.touches.length===2||Ce.type==="wheel"&&Ce.ctrlKey)return!re.current.allowPinchZoom;var Xe=T_(Ce),ot=z.current,Ke="deltaX"in Ce?Ce.deltaX:ot[0]-Xe[0],Ct="deltaY"in Ce?Ce.deltaY:ot[1]-Xe[1],tt,Nt=Ce.target,jt=Math.abs(Ke)>Math.abs(Ct)?"h":"v";if("touches"in Ce&&jt==="h"&&Nt.type==="range")return!1;var Mt=window.getSelection(),Rn=Mt&&Mt.anchorNode,Kn=Rn?Rn===Nt||Rn.contains(Nt):!1;if(Kn)return!1;var Ti=iT(jt,Nt);if(!Ti)return!0;if(Ti?tt=jt:(tt=jt==="v"?"h":"v",Ti=iT(jt,Nt)),!Ti)return!1;if(!N.current&&"changedTouches"in Ce&&(Ke||Ct)&&(N.current=tt),!tt)return!0;var pi=N.current||tt;return gL(pi,Be,Ce,pi==="h"?Ke:Ct)},[]),he=be.useCallback(function(Ce){var Be=Ce;if(!(!am.length||am[am.length-1]!==J)){var Xe="deltaY"in Be?rT(Be):T_(Be),ot=R.current.filter(function(tt){return tt.name===Be.type&&(tt.target===Be.target||Be.target===tt.shadowParent)&&_L(tt.delta,Xe)})[0];if(ot&&ot.should){Be.cancelable&&Be.preventDefault();return}if(!ot){var Ke=(re.current.shards||[]).map(oT).filter(Boolean).filter(function(tt){return tt.contains(Be.target)}),Ct=Ke.length>0?s(Be,Ke[0]):!re.current.noIsolation;Ct&&Be.cancelable&&Be.preventDefault()}}},[]),ae=be.useCallback(function(Ce,Be,Xe,ot){var Ke={name:Ce,delta:Be,target:Xe,should:ot,shadowParent:wL(Xe)};R.current.push(Ke),setTimeout(function(){R.current=R.current.filter(function(Ct){return Ct!==Ke})},1)},[]),Me=be.useCallback(function(Ce){z.current=T_(Ce),N.current=void 0},[]),oe=be.useCallback(function(Ce){ae(Ce.type,rT(Ce),Ce.target,s(Ce,T.lockRef.current))},[]),Oe=be.useCallback(function(Ce){ae(Ce.type,T_(Ce),Ce.target,s(Ce,T.lockRef.current))},[]);be.useEffect(function(){return am.push(J),T.setCallbacks({onScrollCapture:oe,onWheelCapture:oe,onTouchMoveCapture:Oe}),document.addEventListener("wheel",he,sm),document.addEventListener("touchmove",he,sm),document.addEventListener("touchstart",Me,sm),function(){am=am.filter(function(Ce){return Ce!==J}),document.removeEventListener("wheel",he,sm),document.removeEventListener("touchmove",he,sm),document.removeEventListener("touchstart",Me,sm)}},[]);var je=T.removeScrollBar,st=T.inert;return be.createElement(be.Fragment,null,st?be.createElement(J,{styles:yL(X)}):null,je?be.createElement(cL,{noRelative:T.noRelative,gapMode:T.gapMode}):null)}function wL(T){for(var R=null;T!==null;)T instanceof ShadowRoot&&(R=T.host,T=T.host),T=T.parentNode;return R}const bL=Yz(BS,xL);var GS=be.forwardRef(function(T,R){return be.createElement(W_,mh({},T,{ref:R,sideCar:bL}))});GS.classNames=W_.classNames;var TL=[" ","Enter","ArrowUp","ArrowDown"],SL=[" ","Enter"],wp="Select",[q_,Z_,EL]=aT(wp),[gm]=mg(wp,[EL,SS]),X_=SS(),[IL,Pf]=gm(wp),[AL,CL]=gm(wp),$S=T=>{const{__scopeSelect:R,children:z,open:N,defaultOpen:X,onOpenChange:J,value:re,defaultValue:s,onValueChange:he,dir:ae,name:Me,autoComplete:oe,disabled:Oe,required:je,form:st}=T,Ce=X_(R),[Be,Xe]=be.useState(null),[ot,Ke]=be.useState(null),[Ct,tt]=be.useState(!1),Nt=Jv(ae),[jt,Mt]=M_({prop:N,defaultProp:X??!1,onChange:J,caller:wp}),[Rn,Kn]=M_({prop:re,defaultProp:s,onChange:he,caller:wp}),Ti=be.useRef(null),pi=Be?st||!!Be.closest("form"):!0,[dn,mi]=be.useState(new Set),Hn=Array.from(dn).map(Wt=>Wt.props.value).join(";");return $.jsx(Tz,{...Ce,children:$.jsxs(IL,{required:je,scope:R,trigger:Be,onTriggerChange:Xe,valueNode:ot,onValueNodeChange:Ke,valueNodeHasChildren:Ct,onValueNodeHasChildrenChange:tt,contentId:_g(),value:Rn,onValueChange:Kn,open:jt,onOpenChange:Mt,dir:Nt,triggerPointerDownPosRef:Ti,disabled:Oe,children:[$.jsx(q_.Provider,{scope:R,children:$.jsx(AL,{scope:T.__scopeSelect,onNativeOptionAdd:be.useCallback(Wt=>{mi(Jt=>new Set(Jt).add(Wt))},[]),onNativeOptionRemove:be.useCallback(Wt=>{mi(Jt=>{const nt=new Set(Jt);return nt.delete(Wt),nt})},[]),children:z})}),pi?$.jsxs(d2,{"aria-hidden":!0,required:je,tabIndex:-1,name:Me,autoComplete:oe,value:Rn,onChange:Wt=>Kn(Wt.target.value),disabled:Oe,form:st,children:[Rn===void 0?$.jsx("option",{value:""}):null,Array.from(dn)]},Hn):null]})})};$S.displayName=wp;var HS="SelectTrigger",WS=be.forwardRef((T,R)=>{const{__scopeSelect:z,disabled:N=!1,...X}=T,J=X_(z),re=Pf(HS,z),s=re.disabled||N,he=Vs(R,re.onTriggerChange),ae=Z_(z),Me=be.useRef("touch"),[oe,Oe,je]=p2(Ce=>{const Be=ae().filter(Ke=>!Ke.disabled),Xe=Be.find(Ke=>Ke.value===re.value),ot=m2(Be,Ce,Xe);ot!==void 0&&re.onValueChange(ot.value)}),st=Ce=>{s||(re.onOpenChange(!0),je()),Ce&&(re.triggerPointerDownPosRef.current={x:Math.round(Ce.pageX),y:Math.round(Ce.pageY)})};return $.jsx(Sz,{asChild:!0,...J,children:$.jsx(_o.button,{type:"button",role:"combobox","aria-controls":re.contentId,"aria-expanded":re.open,"aria-required":re.required,"aria-autocomplete":"none",dir:re.dir,"data-state":re.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":f2(re.value)?"":void 0,...X,ref:he,onClick:eo(X.onClick,Ce=>{Ce.currentTarget.focus(),Me.current!=="mouse"&&st(Ce)}),onPointerDown:eo(X.onPointerDown,Ce=>{Me.current=Ce.pointerType;const Be=Ce.target;Be.hasPointerCapture(Ce.pointerId)&&Be.releasePointerCapture(Ce.pointerId),Ce.button===0&&Ce.ctrlKey===!1&&Ce.pointerType==="mouse"&&(st(Ce),Ce.preventDefault())}),onKeyDown:eo(X.onKeyDown,Ce=>{const Be=oe.current!=="";!(Ce.ctrlKey||Ce.altKey||Ce.metaKey)&&Ce.key.length===1&&Oe(Ce.key),!(Be&&Ce.key===" ")&&TL.includes(Ce.key)&&(st(),Ce.preventDefault())})})})});WS.displayName=HS;var qS="SelectValue",ZS=be.forwardRef((T,R)=>{const{__scopeSelect:z,className:N,style:X,children:J,placeholder:re="",...s}=T,he=Pf(qS,z),{onValueNodeHasChildrenChange:ae}=he,Me=J!==void 0,oe=Vs(R,he.onValueNodeChange);return Us(()=>{ae(Me)},[ae,Me]),$.jsx(_o.span,{...s,ref:oe,style:{pointerEvents:"none"},children:f2(he.value)?$.jsx($.Fragment,{children:re}):J})});ZS.displayName=qS;var ML="SelectIcon",XS=be.forwardRef((T,R)=>{const{__scopeSelect:z,children:N,...X}=T;return $.jsx(_o.span,{"aria-hidden":!0,...X,ref:R,children:N||""})});XS.displayName=ML;var PL="SelectPortal",YS=T=>$.jsx(zS,{asChild:!0,...T});YS.displayName=PL;var bp="SelectContent",KS=be.forwardRef((T,R)=>{const z=Pf(bp,T.__scopeSelect),[N,X]=be.useState();if(Us(()=>{X(new DocumentFragment)},[]),!z.open){const J=N;return J?yg.createPortal($.jsx(JS,{scope:T.__scopeSelect,children:$.jsx(q_.Slot,{scope:T.__scopeSelect,children:$.jsx("div",{children:T.children})})}),J):null}return $.jsx(QS,{...T,ref:R})});KS.displayName=bp;var gu=10,[JS,Rf]=gm(bp),RL="SelectContentImpl",kL=Cz("SelectContent.RemoveScroll"),QS=be.forwardRef((T,R)=>{const{__scopeSelect:z,position:N="item-aligned",onCloseAutoFocus:X,onEscapeKeyDown:J,onPointerDownOutside:re,side:s,sideOffset:he,align:ae,alignOffset:Me,arrowPadding:oe,collisionBoundary:Oe,collisionPadding:je,sticky:st,hideWhenDetached:Ce,avoidCollisions:Be,...Xe}=T,ot=Pf(bp,z),[Ke,Ct]=be.useState(null),[tt,Nt]=be.useState(null),jt=Vs(R,cn=>Ct(cn)),[Mt,Rn]=be.useState(null),[Kn,Ti]=be.useState(null),pi=Z_(z),[dn,mi]=be.useState(!1),Hn=be.useRef(!1);be.useEffect(()=>{if(Ke)return jz(Ke)},[Ke]),YR();const Wt=be.useCallback(cn=>{const[wn,...xn]=pi().map(Ji=>Ji.ref.current),[kn]=xn.slice(-1),_i=document.activeElement;for(const Ji of cn)if(Ji===_i||(Ji?.scrollIntoView({block:"nearest"}),Ji===wn&&tt&&(tt.scrollTop=0),Ji===kn&&tt&&(tt.scrollTop=tt.scrollHeight),Ji?.focus(),document.activeElement!==_i))return},[pi,tt]),Jt=be.useCallback(()=>Wt([Mt,Ke]),[Wt,Mt,Ke]);be.useEffect(()=>{dn&&Jt()},[dn,Jt]);const{onOpenChange:nt,triggerPointerDownPosRef:mn}=ot;be.useEffect(()=>{if(Ke){let cn={x:0,y:0};const wn=kn=>{cn={x:Math.abs(Math.round(kn.pageX)-(mn.current?.x??0)),y:Math.abs(Math.round(kn.pageY)-(mn.current?.y??0))}},xn=kn=>{cn.x<=10&&cn.y<=10?kn.preventDefault():Ke.contains(kn.target)||nt(!1),document.removeEventListener("pointermove",wn),mn.current=null};return mn.current!==null&&(document.addEventListener("pointermove",wn),document.addEventListener("pointerup",xn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",wn),document.removeEventListener("pointerup",xn,{capture:!0})}}},[Ke,nt,mn]),be.useEffect(()=>{const cn=()=>nt(!1);return window.addEventListener("blur",cn),window.addEventListener("resize",cn),()=>{window.removeEventListener("blur",cn),window.removeEventListener("resize",cn)}},[nt]);const[sn,rt]=p2(cn=>{const wn=pi().filter(_i=>!_i.disabled),xn=wn.find(_i=>_i.ref.current===document.activeElement),kn=m2(wn,cn,xn);kn&&setTimeout(()=>kn.ref.current.focus())}),Ut=be.useCallback((cn,wn,xn)=>{const kn=!Hn.current&&!xn;(ot.value!==void 0&&ot.value===wn||kn)&&(Rn(cn),kn&&(Hn.current=!0))},[ot.value]),Gt=be.useCallback(()=>Ke?.focus(),[Ke]),gn=be.useCallback((cn,wn,xn)=>{const kn=!Hn.current&&!xn;(ot.value!==void 0&&ot.value===wn||kn)&&Ti(cn)},[ot.value]),jn=N==="popper"?Hv:e2,oi=jn===Hv?{side:s,sideOffset:he,align:ae,alignOffset:Me,arrowPadding:oe,collisionBoundary:Oe,collisionPadding:je,sticky:st,hideWhenDetached:Ce,avoidCollisions:Be}:{};return $.jsx(JS,{scope:z,content:Ke,viewport:tt,onViewportChange:Nt,itemRefCallback:Ut,selectedItem:Mt,onItemLeave:Gt,itemTextRefCallback:gn,focusSelectedItem:Jt,selectedItemText:Kn,position:N,isPositioned:dn,searchRef:sn,children:$.jsx(GS,{as:kL,allowPinchZoom:!0,children:$.jsx(cS,{asChild:!0,trapped:ot.open,onMountAutoFocus:cn=>{cn.preventDefault()},onUnmountAutoFocus:eo(X,cn=>{ot.trigger?.focus({preventScroll:!0}),cn.preventDefault()}),children:$.jsx(aS,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:J,onPointerDownOutside:re,onFocusOutside:cn=>cn.preventDefault(),onDismiss:()=>ot.onOpenChange(!1),children:$.jsx(jn,{role:"listbox",id:ot.contentId,"data-state":ot.open?"open":"closed",dir:ot.dir,onContextMenu:cn=>cn.preventDefault(),...Xe,...oi,onPlaced:()=>mi(!0),ref:jt,style:{display:"flex",flexDirection:"column",outline:"none",...Xe.style},onKeyDown:eo(Xe.onKeyDown,cn=>{const wn=cn.ctrlKey||cn.altKey||cn.metaKey;if(cn.key==="Tab"&&cn.preventDefault(),!wn&&cn.key.length===1&&rt(cn.key),["ArrowUp","ArrowDown","Home","End"].includes(cn.key)){let kn=pi().filter(_i=>!_i.disabled).map(_i=>_i.ref.current);if(["ArrowUp","End"].includes(cn.key)&&(kn=kn.slice().reverse()),["ArrowUp","ArrowDown"].includes(cn.key)){const _i=cn.target,Ji=kn.indexOf(_i);kn=kn.slice(Ji+1)}setTimeout(()=>Wt(kn)),cn.preventDefault()}})})})})})})});QS.displayName=RL;var zL="SelectItemAlignedPosition",e2=be.forwardRef((T,R)=>{const{__scopeSelect:z,onPlaced:N,...X}=T,J=Pf(bp,z),re=Rf(bp,z),[s,he]=be.useState(null),[ae,Me]=be.useState(null),oe=Vs(R,jt=>Me(jt)),Oe=Z_(z),je=be.useRef(!1),st=be.useRef(!0),{viewport:Ce,selectedItem:Be,selectedItemText:Xe,focusSelectedItem:ot}=re,Ke=be.useCallback(()=>{if(J.trigger&&J.valueNode&&s&&ae&&Ce&&Be&&Xe){const jt=J.trigger.getBoundingClientRect(),Mt=ae.getBoundingClientRect(),Rn=J.valueNode.getBoundingClientRect(),Kn=Xe.getBoundingClientRect();if(J.dir!=="rtl"){const _i=Kn.left-Mt.left,Ji=Rn.left-_i,Gi=jt.left-Ji,yo=jt.width+Gi,Es=Math.max(yo,Mt.width),vo=window.innerWidth-gu,Pr=Ob(Ji,[gu,Math.max(gu,vo-Es)]);s.style.minWidth=yo+"px",s.style.left=Pr+"px"}else{const _i=Mt.right-Kn.right,Ji=window.innerWidth-Rn.right-_i,Gi=window.innerWidth-jt.right-Ji,yo=jt.width+Gi,Es=Math.max(yo,Mt.width),vo=window.innerWidth-gu,Pr=Ob(Ji,[gu,Math.max(gu,vo-Es)]);s.style.minWidth=yo+"px",s.style.right=Pr+"px"}const Ti=Oe(),pi=window.innerHeight-gu*2,dn=Ce.scrollHeight,mi=window.getComputedStyle(ae),Hn=parseInt(mi.borderTopWidth,10),Wt=parseInt(mi.paddingTop,10),Jt=parseInt(mi.borderBottomWidth,10),nt=parseInt(mi.paddingBottom,10),mn=Hn+Wt+dn+nt+Jt,sn=Math.min(Be.offsetHeight*5,mn),rt=window.getComputedStyle(Ce),Ut=parseInt(rt.paddingTop,10),Gt=parseInt(rt.paddingBottom,10),gn=jt.top+jt.height/2-gu,jn=pi-gn,oi=Be.offsetHeight/2,cn=Be.offsetTop+oi,wn=Hn+Wt+cn,xn=mn-wn;if(wn<=gn){const _i=Ti.length>0&&Be===Ti[Ti.length-1].ref.current;s.style.bottom="0px";const Ji=ae.clientHeight-Ce.offsetTop-Ce.offsetHeight,Gi=Math.max(jn,oi+(_i?Gt:0)+Ji+Jt),yo=wn+Gi;s.style.height=yo+"px"}else{const _i=Ti.length>0&&Be===Ti[0].ref.current;s.style.top="0px";const Gi=Math.max(gn,Hn+Ce.offsetTop+(_i?Ut:0)+oi)+xn;s.style.height=Gi+"px",Ce.scrollTop=wn-gn+Ce.offsetTop}s.style.margin=`${gu}px 0`,s.style.minHeight=sn+"px",s.style.maxHeight=pi+"px",N?.(),requestAnimationFrame(()=>je.current=!0)}},[Oe,J.trigger,J.valueNode,s,ae,Ce,Be,Xe,J.dir,N]);Us(()=>Ke(),[Ke]);const[Ct,tt]=be.useState();Us(()=>{ae&&tt(window.getComputedStyle(ae).zIndex)},[ae]);const Nt=be.useCallback(jt=>{jt&&st.current===!0&&(Ke(),ot?.(),st.current=!1)},[Ke,ot]);return $.jsx(DL,{scope:z,contentWrapper:s,shouldExpandOnScrollRef:je,onScrollButtonChange:Nt,children:$.jsx("div",{ref:he,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Ct},children:$.jsx(_o.div,{...X,ref:oe,style:{boxSizing:"border-box",maxHeight:"100%",...X.style}})})})});e2.displayName=zL;var LL="SelectPopperPosition",Hv=be.forwardRef((T,R)=>{const{__scopeSelect:z,align:N="start",collisionPadding:X=gu,...J}=T,re=X_(z);return $.jsx(Ez,{...re,...J,ref:R,align:N,collisionPadding:X,style:{boxSizing:"border-box",...J.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Hv.displayName=LL;var[DL,px]=gm(bp,{}),Wv="SelectViewport",t2=be.forwardRef((T,R)=>{const{__scopeSelect:z,nonce:N,...X}=T,J=Rf(Wv,z),re=px(Wv,z),s=Vs(R,J.onViewportChange),he=be.useRef(0);return $.jsxs($.Fragment,{children:[$.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:N}),$.jsx(q_.Slot,{scope:z,children:$.jsx(_o.div,{"data-radix-select-viewport":"",role:"presentation",...X,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...X.style},onScroll:eo(X.onScroll,ae=>{const Me=ae.currentTarget,{contentWrapper:oe,shouldExpandOnScrollRef:Oe}=re;if(Oe?.current&&oe){const je=Math.abs(he.current-Me.scrollTop);if(je>0){const st=window.innerHeight-gu*2,Ce=parseFloat(oe.style.minHeight),Be=parseFloat(oe.style.height),Xe=Math.max(Ce,Be);if(Xe<st){const ot=Xe+je,Ke=Math.min(st,ot),Ct=ot-Ke;oe.style.height=Ke+"px",oe.style.bottom==="0px"&&(Me.scrollTop=Ct>0?Ct:0,oe.style.justifyContent="flex-end")}}}he.current=Me.scrollTop})})})]})});t2.displayName=Wv;var n2="SelectGroup",[OL,FL]=gm(n2),BL=be.forwardRef((T,R)=>{const{__scopeSelect:z,...N}=T,X=_g();return $.jsx(OL,{scope:z,id:X,children:$.jsx(_o.div,{role:"group","aria-labelledby":X,...N,ref:R})})});BL.displayName=n2;var i2="SelectLabel",NL=be.forwardRef((T,R)=>{const{__scopeSelect:z,...N}=T,X=FL(i2,z);return $.jsx(_o.div,{id:X.id,...N,ref:R})});NL.displayName=i2;var N_="SelectItem",[jL,r2]=gm(N_),o2=be.forwardRef((T,R)=>{const{__scopeSelect:z,value:N,disabled:X=!1,textValue:J,...re}=T,s=Pf(N_,z),he=Rf(N_,z),ae=s.value===N,[Me,oe]=be.useState(J??""),[Oe,je]=be.useState(!1),st=Vs(R,ot=>he.itemRefCallback?.(ot,N,X)),Ce=_g(),Be=be.useRef("touch"),Xe=()=>{X||(s.onValueChange(N),s.onOpenChange(!1))};if(N==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return $.jsx(jL,{scope:z,value:N,disabled:X,textId:Ce,isSelected:ae,onItemTextChange:be.useCallback(ot=>{oe(Ke=>Ke||(ot?.textContent??"").trim())},[]),children:$.jsx(q_.ItemSlot,{scope:z,value:N,disabled:X,textValue:Me,children:$.jsx(_o.div,{role:"option","aria-labelledby":Ce,"data-highlighted":Oe?"":void 0,"aria-selected":ae&&Oe,"data-state":ae?"checked":"unchecked","aria-disabled":X||void 0,"data-disabled":X?"":void 0,tabIndex:X?void 0:-1,...re,ref:st,onFocus:eo(re.onFocus,()=>je(!0)),onBlur:eo(re.onBlur,()=>je(!1)),onClick:eo(re.onClick,()=>{Be.current!=="mouse"&&Xe()}),onPointerUp:eo(re.onPointerUp,()=>{Be.current==="mouse"&&Xe()}),onPointerDown:eo(re.onPointerDown,ot=>{Be.current=ot.pointerType}),onPointerMove:eo(re.onPointerMove,ot=>{Be.current=ot.pointerType,X?he.onItemLeave?.():Be.current==="mouse"&&ot.currentTarget.focus({preventScroll:!0})}),onPointerLeave:eo(re.onPointerLeave,ot=>{ot.currentTarget===document.activeElement&&he.onItemLeave?.()}),onKeyDown:eo(re.onKeyDown,ot=>{he.searchRef?.current!==""&&ot.key===" "||(SL.includes(ot.key)&&Xe(),ot.key===" "&&ot.preventDefault())})})})})});o2.displayName=N_;var dg="SelectItemText",s2=be.forwardRef((T,R)=>{const{__scopeSelect:z,className:N,style:X,...J}=T,re=Pf(dg,z),s=Rf(dg,z),he=r2(dg,z),ae=CL(dg,z),[Me,oe]=be.useState(null),Oe=Vs(R,Xe=>oe(Xe),he.onItemTextChange,Xe=>s.itemTextRefCallback?.(Xe,he.value,he.disabled)),je=Me?.textContent,st=be.useMemo(()=>$.jsx("option",{value:he.value,disabled:he.disabled,children:je},he.value),[he.disabled,he.value,je]),{onNativeOptionAdd:Ce,onNativeOptionRemove:Be}=ae;return Us(()=>(Ce(st),()=>Be(st)),[Ce,Be,st]),$.jsxs($.Fragment,{children:[$.jsx(_o.span,{id:he.textId,...J,ref:Oe}),he.isSelected&&re.valueNode&&!re.valueNodeHasChildren?yg.createPortal(J.children,re.valueNode):null]})});s2.displayName=dg;var a2="SelectItemIndicator",l2=be.forwardRef((T,R)=>{const{__scopeSelect:z,...N}=T;return r2(a2,z).isSelected?$.jsx(_o.span,{"aria-hidden":!0,...N,ref:R}):null});l2.displayName=a2;var qv="SelectScrollUpButton",c2=be.forwardRef((T,R)=>{const z=Rf(qv,T.__scopeSelect),N=px(qv,T.__scopeSelect),[X,J]=be.useState(!1),re=Vs(R,N.onScrollButtonChange);return Us(()=>{if(z.viewport&&z.isPositioned){let s=function(){const ae=he.scrollTop>0;J(ae)};const he=z.viewport;return s(),he.addEventListener("scroll",s),()=>he.removeEventListener("scroll",s)}},[z.viewport,z.isPositioned]),X?$.jsx(h2,{...T,ref:re,onAutoScroll:()=>{const{viewport:s,selectedItem:he}=z;s&&he&&(s.scrollTop=s.scrollTop-he.offsetHeight)}}):null});c2.displayName=qv;var Zv="SelectScrollDownButton",u2=be.forwardRef((T,R)=>{const z=Rf(Zv,T.__scopeSelect),N=px(Zv,T.__scopeSelect),[X,J]=be.useState(!1),re=Vs(R,N.onScrollButtonChange);return Us(()=>{if(z.viewport&&z.isPositioned){let s=function(){const ae=he.scrollHeight-he.clientHeight,Me=Math.ceil(he.scrollTop)<ae;J(Me)};const he=z.viewport;return s(),he.addEventListener("scroll",s),()=>he.removeEventListener("scroll",s)}},[z.viewport,z.isPositioned]),X?$.jsx(h2,{...T,ref:re,onAutoScroll:()=>{const{viewport:s,selectedItem:he}=z;s&&he&&(s.scrollTop=s.scrollTop+he.offsetHeight)}}):null});u2.displayName=Zv;var h2=be.forwardRef((T,R)=>{const{__scopeSelect:z,onAutoScroll:N,...X}=T,J=Rf("SelectScrollButton",z),re=be.useRef(null),s=Z_(z),he=be.useCallback(()=>{re.current!==null&&(window.clearInterval(re.current),re.current=null)},[]);return be.useEffect(()=>()=>he(),[he]),Us(()=>{s().find(Me=>Me.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[s]),$.jsx(_o.div,{"aria-hidden":!0,...X,ref:R,style:{flexShrink:0,...X.style},onPointerDown:eo(X.onPointerDown,()=>{re.current===null&&(re.current=window.setInterval(N,50))}),onPointerMove:eo(X.onPointerMove,()=>{J.onItemLeave?.(),re.current===null&&(re.current=window.setInterval(N,50))}),onPointerLeave:eo(X.onPointerLeave,()=>{he()})})}),VL="SelectSeparator",UL=be.forwardRef((T,R)=>{const{__scopeSelect:z,...N}=T;return $.jsx(_o.div,{"aria-hidden":!0,...N,ref:R})});UL.displayName=VL;var Xv="SelectArrow",GL=be.forwardRef((T,R)=>{const{__scopeSelect:z,...N}=T,X=X_(z),J=Pf(Xv,z),re=Rf(Xv,z);return J.open&&re.position==="popper"?$.jsx(Iz,{...X,...N,ref:R}):null});GL.displayName=Xv;var $L="SelectBubbleInput",d2=be.forwardRef(({__scopeSelect:T,value:R,...z},N)=>{const X=be.useRef(null),J=Vs(N,X),re=Lz(R);return be.useEffect(()=>{const s=X.current;if(!s)return;const he=window.HTMLSelectElement.prototype,Me=Object.getOwnPropertyDescriptor(he,"value").set;if(re!==R&&Me){const oe=new Event("change",{bubbles:!0});Me.call(s,R),s.dispatchEvent(oe)}},[re,R]),$.jsx(_o.select,{...z,style:{...LS,...z.style},ref:J,defaultValue:R})});d2.displayName=$L;function f2(T){return T===""||T===void 0}function p2(T){const R=Ed(T),z=be.useRef(""),N=be.useRef(0),X=be.useCallback(re=>{const s=z.current+re;R(s),(function he(ae){z.current=ae,window.clearTimeout(N.current),ae!==""&&(N.current=window.setTimeout(()=>he(""),1e3))})(s)},[R]),J=be.useCallback(()=>{z.current="",window.clearTimeout(N.current)},[]);return be.useEffect(()=>()=>window.clearTimeout(N.current),[]),[z,X,J]}function m2(T,R,z){const X=R.length>1&&Array.from(R).every(ae=>ae===R[0])?R[0]:R,J=z?T.indexOf(z):-1;let re=HL(T,Math.max(J,0));X.length===1&&(re=re.filter(ae=>ae!==z));const he=re.find(ae=>ae.textValue.toLowerCase().startsWith(X.toLowerCase()));return he!==z?he:void 0}function HL(T,R){return T.map((z,N)=>T[(R+N)%T.length])}var WL=$S,qL=WS,ZL=ZS,XL=XS,YL=YS,KL=KS,JL=t2,QL=o2,eD=s2,tD=l2,nD=c2,iD=u2;function rD({...T}){return $.jsx(WL,{"data-slot":"select",...T})}function oD({...T}){return $.jsx(ZL,{"data-slot":"select-value",...T})}function sD({className:T,size:R="default",children:z,...N}){return $.jsxs(qL,{"data-slot":"select-trigger","data-size":R,className:Wo("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",T),...N,children:[z,$.jsx(XL,{asChild:!0,children:$.jsx(qT,{className:"size-4 opacity-50"})})]})}function aD({className:T,children:R,position:z="popper",...N}){return $.jsx(YL,{children:$.jsxs(KL,{"data-slot":"select-content",className:Wo("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",z==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",T),position:z,...N,children:[$.jsx(cD,{}),$.jsx(JL,{className:Wo("p-1",z==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:R}),$.jsx(uD,{})]})})}function lD({className:T,children:R,...z}){return $.jsxs(QL,{"data-slot":"select-item",className:Wo("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",T),...z,children:[$.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:$.jsx(tD,{children:$.jsx(LP,{className:"size-4"})})}),$.jsx(eD,{children:R})]})}function cD({className:T,...R}){return $.jsx(nD,{"data-slot":"select-scroll-up-button",className:Wo("flex cursor-default items-center justify-center py-1",T),...R,children:$.jsx(FP,{className:"size-4"})})}function uD({className:T,...R}){return $.jsx(iD,{"data-slot":"select-scroll-down-button",className:Wo("flex cursor-default items-center justify-center py-1",T),...R,children:$.jsx(qT,{className:"size-4"})})}function hD(){const[T,R]=be.useState("manila"),[z,N]=be.useState(!1),[X,J]=be.useState(null),re=[{id:"manila",name:"Manila",lat:14.5995,lon:120.9842},{id:"cebu",name:"Cebu City",lat:10.3157,lon:123.8854},{id:"davao",name:"Davao City",lat:7.1907,lon:125.4553},{id:"iloilo",name:"Iloilo City",lat:10.7202,lon:122.5621},{id:"cagayan",name:"Cagayan de Oro",lat:8.4542,lon:124.6319},{id:"zamboanga",name:"Zamboanga City",lat:6.9214,lon:122.079},{id:"baguio",name:"Baguio City",lat:16.4023,lon:120.596},{id:"tacloban",name:"Tacloban City",lat:11.2421,lon:125.0066}],s=Oe=>{if(!Oe)return{hourly:[],weekly:[]};const je={manila:{temp:28,humidity:75,windSpeed:12,condition:"Thunderstorm"},cebu:{temp:30,humidity:70,windSpeed:8,condition:"Partly Cloudy"},davao:{temp:29,humidity:78,windSpeed:6,condition:"Rainy"},iloilo:{temp:27,humidity:80,windSpeed:10,condition:"Cloudy"},cagayan:{temp:26,humidity:82,windSpeed:14,condition:"Heavy Rain"},zamboanga:{temp:31,humidity:68,windSpeed:7,condition:"Sunny"},baguio:{temp:22,humidity:85,windSpeed:5,condition:"Light Rain"},tacloban:{temp:28,humidity:76,windSpeed:16,condition:"Windy"}},st=je[Oe]||je.manila;return{hourly:Array.from({length:24},(Ce,Be)=>({time:`${(new Date().getHours()+Be)%24}:00`,temp:st.temp+Math.floor(Math.random()*6)-3,condition:["Sunny","Partly Cloudy","Cloudy","Light Rain","Rain"][Math.floor(Math.random()*5)],icon:["sun","cloud","cloud","rain","rain"][Math.floor(Math.random()*5)],humidity:st.humidity+Math.floor(Math.random()*10)-5,windSpeed:st.windSpeed+Math.floor(Math.random()*4)-2})),weekly:Array.from({length:7},(Ce,Be)=>{const Xe=new Date;return Xe.setDate(Xe.getDate()+Be),{day:Be===0?"Today":Xe.toLocaleDateString("en-US",{weekday:"short"}),date:Xe.toLocaleDateString("en-US",{month:"short",day:"numeric"}),high:st.temp+Math.floor(Math.random()*8)-2,low:st.temp-Math.floor(Math.random()*8)-2,condition:["Sunny","Partly Cloudy","Cloudy","Light Rain","Thunderstorm"][Math.floor(Math.random()*5)],icon:["sun","cloud","cloud","rain","thunder"][Math.floor(Math.random()*5)],chance:Math.floor(Math.random()*90)+10,uvIndex:Math.floor(Math.random()*10)+1,humidity:st.humidity+Math.floor(Math.random()*10)-5}})}};be.useEffect(()=>{let Oe=!0;return(async()=>{if(Oe){N(!0);try{if(await new Promise(Ce=>setTimeout(Ce,1e3)),!Oe)return;const st=s(T);J(st)}catch(st){console.error("Error fetching weather data:",st)}finally{Oe&&N(!1)}}})(),()=>{Oe=!1}},[T]);const he=X?.hourly.slice(0,8)||[],ae=X?.weekly||[],Me=Oe=>{const je="h-6 w-6";switch(Oe){case"sun":return $.jsx(z_,{className:`${je} text-yellow-500`});case"cloud":return $.jsx(Td,{className:`${je} text-gray-500`});case"rain":return $.jsx(Dv,{className:`${je} text-blue-500`});case"snow":return $.jsx(Ov,{className:`${je} text-blue-300`});case"thunder":return $.jsx(S_,{className:`${je} text-purple-500`});default:return $.jsx(Td,{className:`${je} text-gray-500`})}},oe=Oe=>{const je="h-4 w-4";switch(Oe){case"sun":return $.jsx(z_,{className:`${je} text-yellow-500`});case"cloud":return $.jsx(Td,{className:`${je} text-gray-500`});case"rain":return $.jsx(Dv,{className:`${je} text-blue-500`});case"snow":return $.jsx(Ov,{className:`${je} text-blue-300`});case"thunder":return $.jsx(S_,{className:`${je} text-purple-500`});default:return $.jsx(Td,{className:`${je} text-gray-500`})}};return $.jsxs("div",{className:"p-4 space-y-4",children:[$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(vp,{className:"h-5 w-5"}),$.jsx("span",{children:"Select Location"})]})}),$.jsxs(jr,{children:[$.jsxs(rD,{value:T,onValueChange:R,children:[$.jsx(sD,{children:$.jsx(oD,{placeholder:"Choose a city"})}),$.jsx(aD,{children:re.map(Oe=>$.jsx(lD,{value:Oe.id,children:Oe.name},Oe.id))})]}),$.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:"Using OpenWeatherMap API  Updates every 30 minutes"})]})]}),$.jsxs(jT,{defaultValue:"24hour",className:"w-full",children:[$.jsxs(VT,{className:"grid w-full grid-cols-2",children:[$.jsx(wd,{value:"24hour",children:"24-Hour"}),$.jsx(wd,{value:"weekly",children:"7-Day"})]}),$.jsxs(bd,{value:"24hour",className:"mt-4 space-y-4",children:[$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsx(Aa,{children:"24-Hour Forecast"})}),$.jsx(jr,{children:z?$.jsx("div",{className:"grid grid-cols-4 gap-4",children:Array.from({length:8}).map((Oe,je)=>$.jsxs("div",{className:"text-center space-y-2",children:[$.jsx(_u,{className:"h-3 w-8 mx-auto"}),$.jsx(_u,{className:"h-6 w-6 mx-auto rounded-full"}),$.jsx(_u,{className:"h-4 w-6 mx-auto"})]},je))}):$.jsx("div",{className:"space-y-4",children:$.jsx("div",{className:"grid grid-cols-4 gap-4",children:he.map((Oe,je)=>$.jsxs("div",{className:"text-center space-y-2",children:[$.jsx("p",{className:"text-xs text-muted-foreground",children:Oe.time}),$.jsx("div",{className:"flex justify-center",children:oe(Oe.icon)}),$.jsxs("p",{className:"text-sm",children:[Oe.temp,""]}),$.jsx("div",{className:"text-xs text-muted-foreground space-y-1",children:$.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[$.jsx(L_,{className:"h-2 w-2"}),$.jsxs("span",{children:[Oe.humidity,"%"]})]})})]},je))})})})]}),$.jsx(Nr,{className:"bg-orange-50 border-orange-200",children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-start space-x-2",children:[$.jsx(S_,{className:"h-5 w-5 text-orange-600 mt-0.5"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-orange-800",children:"Weather Alert"}),$.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Thunderstorm expected at 7:00 PM. Seek shelter and avoid outdoor activities."})]})]})})})]}),$.jsx(bd,{value:"weekly",className:"mt-4",children:$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsx(Aa,{children:"7-Day Forecast"})}),$.jsx(jr,{children:z?$.jsx("div",{className:"space-y-3",children:Array.from({length:7}).map((Oe,je)=>$.jsxs("div",{className:"flex items-center justify-between p-2",children:[$.jsxs("div",{className:"flex items-center space-x-3",children:[$.jsx(_u,{className:"h-8 w-12"}),$.jsx(_u,{className:"h-6 w-6 rounded-full"}),$.jsx(_u,{className:"h-4 w-20"})]}),$.jsxs("div",{className:"flex items-center space-x-4",children:[$.jsx(_u,{className:"h-5 w-8"}),$.jsx(_u,{className:"h-4 w-12"})]})]},je))}):$.jsx("div",{className:"space-y-3",children:ae.map((Oe,je)=>$.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border",children:[$.jsxs("div",{className:"flex items-center space-x-3",children:[$.jsxs("div",{className:"w-12 text-left",children:[$.jsx("p",{className:"text-sm",children:Oe.day}),$.jsx("p",{className:"text-xs text-muted-foreground",children:Oe.date})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[Me(Oe.icon),$.jsx("span",{className:"text-sm",children:Oe.condition})]})]}),$.jsxs("div",{className:"flex items-center space-x-4",children:[$.jsxs("div",{className:"text-center",children:[$.jsxs(vu,{variant:"outline",className:"text-xs mb-1",children:[Oe.chance,"%"]}),$.jsxs("div",{className:"text-xs text-muted-foreground",children:["UV: ",Oe.uvIndex]})]}),$.jsxs("div",{className:"text-right",children:[$.jsxs("span",{className:"text-sm",children:[Oe.high,""]}),$.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["/",Oe.low,""]}),$.jsxs("div",{className:"text-xs text-muted-foreground",children:[Oe.humidity,"% humidity"]})]})]})]},je))})})]})})]})]})}const dD="pk.eyJ1IjoidGFtYWtpaWkiLCJhIjoiY21qemtjMWp5MDBobDNwb3F1emFsNDV3NSJ9.JdlzkWCF5oyOLUdBV9Illg",hg="a96c621bdb7a200005963f01601a9020";function fD(){const T=be.useRef(null),R=be.useRef(null),z=be.useRef([]),[N,X]=be.useState(!0),[J,re]=be.useState(!1),[s,he]=be.useState(new Date),[ae,Me]=be.useState([]),[oe,Oe]=be.useState([{name:"Manila Observatory",location:"Quezon City",latitude:14.64,longitude:121.0776,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"PAGASA Science Garden",location:"Quezon City",latitude:14.6507,longitude:121.0494,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Subic Bay",location:"Zambales",latitude:14.82,longitude:120.272,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Tanay",location:"Rizal",latitude:14.5008,longitude:121.2867,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Puerto Princesa",location:"Palawan",latitude:9.7392,longitude:118.7353,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Mactan",location:"Cebu",latitude:10.3091,longitude:123.9794,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Davao Airport",location:"Davao City",latitude:7.1253,longitude:125.6456,status:"Active",windSpeed:0,rainfall:0,pressure:1012},{name:"Laoag",location:"Ilocos Norte",latitude:18.1782,longitude:120.5931,status:"Active",windSpeed:0,rainfall:0,pressure:1012}]),je=async()=>{try{const Ke=[{lat:15.5,lon:125.2,name:"Eastern Luzon"},{lat:12,lon:125,name:"Eastern Visayas"},{lat:8.5,lon:126.5,name:"Eastern Mindanao"},{lat:18,lon:122,name:"Northern Luzon"},{lat:10,lon:119,name:"Western Palawan"}],Ct=[];for(const tt of Ke)try{const Nt=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${tt.lat}&lon=${tt.lon}&appid=${hg}&units=metric`);if(Nt.ok){const jt=await Nt.json(),Mt=Math.round(jt.wind.speed*3.6);if(Mt>60){let Rn="Tropical Depression",Kn="low";Mt>118?(Rn="Typhoon",Kn="high"):Mt>88?(Rn="Severe Tropical Storm",Kn="high"):Mt>62&&(Rn="Tropical Storm",Kn="medium"),Ct.push({id:`storm_${tt.name.replace(/\s+/g,"_")}`,name:`System ${tt.name}`,category:Rn,status:"Active",windSpeed:Mt,location:{lat:tt.lat,lon:tt.lon,area:tt.name},movement:jt.wind.deg?`${Ce(jt.wind.deg)} at ${Mt} km/h`:"Stationary",pressure:jt.main.pressure,warnings:Kn==="high"?["Storm Warning","Heavy Rain"]:["Storm Watch"],affectedAreas:[tt.name],nextUpdate:"3 hours",severity:Kn})}}}catch(Nt){console.error(`Error fetching data for ${tt.name}:`,Nt)}Me(Ct)}catch(Ke){console.error("Error fetching storm data:",Ke)}},st=async()=>{const Ke=await Promise.all(oe.map(async Ct=>{try{const tt=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${Ct.latitude}&lon=${Ct.longitude}&appid=${hg}&units=metric`);if(tt.ok){const Nt=await tt.json();return{...Ct,windSpeed:Math.round(Nt.wind.speed*3.6),rainfall:Nt.rain&&Nt.rain["1h"]||0,pressure:Nt.main.pressure}}}catch(tt){console.error(`Error fetching data for ${Ct.name}:`,tt)}return Ct}));Oe(Ke)},Ce=Ke=>{const Ct=["N","NE","E","SE","S","SW","W","NW"],tt=Math.round(Ke/45)%8;return Ct[tt]},Be=async()=>{re(!0),await Promise.all([je(),st()]),he(new Date),re(!1)};be.useEffect(()=>{if(!(!T.current||R.current))return gl.accessToken=dD,R.current=new gl.Map({container:T.current,style:"mapbox://styles/mapbox/dark-v11",center:[122,12],zoom:5,pitch:0,bearing:0}),R.current.on("load",()=>{X(!1),R.current&&(R.current.addLayer({id:"precipitation-layer",type:"raster",source:{type:"raster",tiles:[`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${hg}`],tileSize:256},paint:{"raster-opacity":.6}}),R.current.addLayer({id:"wind-layer",type:"raster",source:{type:"raster",tiles:[`https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${hg}`],tileSize:256},paint:{"raster-opacity":.4}}),R.current.addLayer({id:"clouds-layer",type:"raster",source:{type:"raster",tiles:[`https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${hg}`],tileSize:256},paint:{"raster-opacity":.3}}))}),R.current.addControl(new gl.NavigationControl,"top-right"),R.current.addControl(new gl.ScaleControl({maxWidth:100,unit:"metric"}),"bottom-left"),()=>{R.current?.remove(),R.current=null}},[]),be.useEffect(()=>{!R.current||N||(z.current.forEach(Ke=>Ke.remove()),z.current=[],ae.forEach(Ke=>{const Ct=document.createElement("div");Ct.className="storm-marker";const tt=Ke.severity==="high"?50:Ke.severity==="medium"?40:30,Nt=Ke.severity==="high"?"#ef4444":Ke.severity==="medium"?"#f59e0b":"#3b82f6";Ct.style.cssText=`
        width: ${tt}px;
        height: ${tt}px;
        border-radius: 50%;
        background: radial-gradient(circle, ${Nt} 0%, transparent 70%);
        border: 2px solid ${Nt};
        cursor: pointer;
        animation: pulse 2s infinite;
      `;const jt=new gl.Marker(Ct).setLngLat([Ke.location.lon,Ke.location.lat]).setPopup(new gl.Popup({offset:25}).setHTML(`
          <div style="padding: 12px; min-width: 250px;">
            <div style="font-weight: bold; font-size: 16px; margin-bottom: 4px;">${Ke.name}</div>
            <div style="color: #6b7280; margin-bottom: 8px;">${Ke.category}</div>
            <div style="border-top: 1px solid #e5e7eb; padding-top: 8px; margin-top: 8px;">
              <div style="margin-bottom: 6px;">
                <strong>Wind:</strong> ${Ke.windSpeed} km/h
              </div>
              <div style="margin-bottom: 6px;">
                <strong>Pressure:</strong> ${Ke.pressure} hPa
              </div>
              <div style="margin-bottom: 6px;">
                <strong>Movement:</strong> ${Ke.movement}
              </div>
              <div style="margin-bottom: 6px;">
                <strong>Location:</strong> ${Ke.location.area}
              </div>
              ${Ke.warnings.length>0?`
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                  <strong style="color: #ef4444;">Warnings:</strong>
                  <div style="color: #dc2626; margin-top: 4px;">${Ke.warnings.join(", ")}</div>
                </div>
              `:""}
            </div>
          </div>
        `)).addTo(R.current);z.current.push(jt)}),oe.forEach(Ke=>{const Ct=document.createElement("div");Ct.style.cssText=`
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #3b82f6;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        cursor: pointer;
      `;const tt=new gl.Marker(Ct).setLngLat([Ke.longitude,Ke.latitude]).setPopup(new gl.Popup({offset:15}).setHTML(`
          <div style="padding: 8px;">
            <div style="font-weight: bold; margin-bottom: 4px;">${Ke.name}</div>
            <div style="font-size: 12px; color: #6b7280; margin-bottom: 6px;">${Ke.location}</div>
            <div style="font-size: 12px;">
              <div> Wind: ${Ke.windSpeed} km/h</div>
              <div> Rain: ${Ke.rainfall} mm</div>
              <div> Pressure: ${Ke.pressure} hPa</div>
            </div>
          </div>
        `)).addTo(R.current);z.current.push(tt)}))},[ae,oe,N]),be.useEffect(()=>{Be();const Ke=setInterval(Be,600*1e3);return()=>clearInterval(Ke)},[]);const Xe=Ke=>{switch(Ke){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ot=Ke=>{switch(Ke.toLowerCase()){case"active":return"bg-green-500";case"maintenance":return"bg-yellow-500";case"offline":return"bg-red-500";default:return"bg-gray-500"}};return $.jsxs("div",{className:"space-y-4 p-4",children:[$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(Fv,{className:"h-5 w-5 text-blue-600"}),$.jsx("span",{children:"Live Storm Tracking"})]}),$.jsxs(yu,{variant:"outline",size:"sm",onClick:Be,disabled:J,className:"flex items-center space-x-2",children:[$.jsx(k_,{className:`h-4 w-4 ${J?"animate-spin":""}`}),$.jsx("span",{children:"Refresh"})]})]})}),$.jsx(jr,{children:$.jsxs("div",{className:"flex items-center justify-between text-sm",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),$.jsx("span",{children:"Live Updates"})]}),$.jsxs("span",{className:"text-muted-foreground",children:["Last updated: ",s.toLocaleTimeString()]})]})})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(vp,{className:"h-5 w-5"}),$.jsx("span",{children:"Real-time Weather Radar"})]})}),$.jsxs(jr,{className:"p-0",children:[N&&$.jsx("div",{className:"h-96 flex items-center justify-center",children:$.jsx(_u,{className:"h-full w-full"})}),$.jsx("div",{ref:T,className:"h-96 rounded-b-lg overflow-hidden",style:{display:N?"none":"block"}}),$.jsx("div",{className:"p-4 border-t",children:$.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[$.jsxs("div",{className:"flex items-center space-x-4",children:[$.jsxs("div",{className:"flex items-center space-x-1",children:[$.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),$.jsx("span",{children:"High Alert"})]}),$.jsxs("div",{className:"flex items-center space-x-1",children:[$.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),$.jsx("span",{children:"Medium Alert"})]}),$.jsxs("div",{className:"flex items-center space-x-1",children:[$.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),$.jsx("span",{children:"Weather Station"})]})]}),$.jsx("span",{children:"Data from OpenWeatherMap & PAGASA"})]})})]})]}),ae.length>0&&$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(S_,{className:"h-5 w-5 text-orange-600"}),$.jsxs("span",{children:["Active Storm Systems (",ae.length,")"]})]})}),$.jsx(jr,{children:$.jsx("div",{className:"space-y-4",children:ae.map(Ke=>$.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("div",{children:[$.jsx("h4",{className:"text-base",children:Ke.name}),$.jsx("p",{className:"text-sm text-muted-foreground",children:Ke.category})]}),$.jsx(vu,{className:Xe(Ke.severity),children:Ke.status})]}),$.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(um,{className:"h-4 w-4 text-blue-500"}),$.jsxs("span",{children:[Ke.windSpeed," km/h"]})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(XP,{className:"h-4 w-4 text-gray-500"}),$.jsxs("span",{children:[Ke.pressure," hPa"]})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(YT,{className:"h-4 w-4 text-green-500"}),$.jsx("span",{children:Ke.movement})]}),$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(vp,{className:"h-4 w-4 text-red-500"}),$.jsx("span",{children:Ke.location.area})]})]}),Ke.warnings.length>0&&$.jsxs(xg,{className:"bg-red-50 border-red-200",children:[$.jsx(Sd,{className:"h-4 w-4 text-red-600"}),$.jsx(oS,{className:"text-red-800",children:"Active Warnings"}),$.jsx(wg,{className:"text-red-700",children:Ke.warnings.join(", ")})]})]},Ke.id))})})]}),ae.length===0&&$.jsx(Nr,{className:"bg-green-50 border-green-200",children:$.jsxs(jr,{className:"p-8 text-center",children:[$.jsx(ZT,{className:"h-12 w-12 mx-auto mb-2 text-green-600"}),$.jsx("p",{className:"text-green-800",children:"No active storm systems detected"}),$.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Philippines region is currently clear of major weather disturbances"})]})}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{children:["Weather Station Network (",oe.length," ","stations)"]})}),$.jsx(jr,{children:$.jsxs("div",{className:"space-y-3",children:[oe.slice(0,5).map((Ke,Ct)=>$.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[$.jsxs("div",{className:"flex items-center space-x-3",children:[$.jsx("div",{className:`w-3 h-3 rounded-full ${ot(Ke.status)}`}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm",children:Ke.name}),$.jsx("p",{className:"text-xs text-muted-foreground",children:Ke.location})]})]}),Ke.status==="Active"&&$.jsxs("div",{className:"text-right text-xs space-y-1",children:[$.jsxs("div",{className:"flex items-center space-x-1",children:[$.jsx(um,{className:"h-3 w-3"}),$.jsxs("span",{children:[Ke.windSpeed," km/h"]})]}),$.jsxs("div",{className:"flex items-center space-x-1",children:[$.jsx(nx,{className:"h-3 w-3"}),$.jsxs("span",{children:[Ke.rainfall," mm"]})]})]})]},Ct)),oe.length>5&&$.jsxs("p",{className:"text-xs text-center text-muted-foreground pt-2",children:["+ ",oe.length-5," more stations"]})]})})]}),$.jsx(Nr,{className:"bg-indigo-50 border-indigo-200",children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-start space-x-2",children:[$.jsx(Fv,{className:"h-5 w-5 text-indigo-600 mt-0.5"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-indigo-800",children:"Live Weather Data"}),$.jsx("p",{className:"text-xs text-indigo-600 mt-1",children:"Real-time storm tracking with precipitation, wind, and cloud layers. Data updates every 10 minutes from OpenWeatherMap API. Click markers for details."})]})]})})}),$.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes pulse {
          0%,
          100% {
            opacity: 1;
            transform: scale(1);
          }
          50% {
            opacity: 0.7;
            transform: scale(1.1);
          }
        }
      `})]})}function pD(){const T=[{id:1,type:"Thunderstorm",severity:"High",title:"Severe Thunderstorm Warning",description:"Heavy rain and strong winds expected in Metro Manila area",timeRemaining:"Active for next 4 hours",icon:"thunder"},{id:2,type:"Flood",severity:"Medium",title:"Flood Watch",description:"Potential flooding in low-lying areas due to heavy rainfall",timeRemaining:"Valid until midnight",icon:"flood"}],R=[{type:"Thunderstorm",icon:"thunder",title:"Thunderstorm Safety",tips:["Stay indoors and avoid using electrical appliances","Avoid taking baths or showers during storms","Stay away from windows and doors","If outdoors, seek shelter immediately","Don't use phones connected to landlines"]},{type:"Flood",icon:"flood",title:"Flood Preparedness",tips:["Move to higher ground immediately","Avoid walking or driving through flood waters","Keep emergency supplies ready","Listen to local emergency broadcasts","Have an evacuation plan ready"]},{type:"Heat Wave",icon:"heat",title:"Heat Wave Protection",tips:["Stay hydrated - drink plenty of water","Stay indoors during peak hours (10 AM - 4 PM)","Wear light-colored, loose-fitting clothing","Never leave children or pets in vehicles","Use fans or air conditioning if available"]},{type:"Strong Winds",icon:"wind",title:"Wind Storm Safety",tips:["Secure loose outdoor objects","Stay away from trees and power lines","Avoid driving high-profile vehicles","Close and secure all doors and windows","Have backup power sources ready"]}],z=J=>{switch(J){case"thunder":return $.jsx(Sd,{className:"h-5 w-5"});case"flood":return $.jsx(Pb,{className:"h-5 w-5"});case"heat":return $.jsx(L_,{className:"h-5 w-5"});case"wind":return $.jsx(um,{className:"h-5 w-5"});default:return $.jsx(Sd,{className:"h-5 w-5"})}},N=J=>{const re="h-6 w-6";switch(J){case"thunder":return $.jsx(Sd,{className:`${re} text-yellow-600`});case"flood":return $.jsx(Pb,{className:`${re} text-blue-600`});case"heat":return $.jsx(L_,{className:`${re} text-red-600`});case"wind":return $.jsx(um,{className:`${re} text-gray-600`});default:return $.jsx(XT,{className:`${re} text-blue-600`})}},X=J=>{switch(J.toLowerCase()){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return $.jsxs("div",{className:"space-y-4 p-4",children:[$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center space-x-2",children:[$.jsx(Bv,{className:"h-5 w-5 text-red-500"}),$.jsx("span",{children:"Active Weather Alerts"})]})}),$.jsx(jr,{className:"space-y-3",children:T.length>0?T.map(J=>$.jsx(xg,{className:"border-red-200 bg-red-50",children:$.jsxs("div",{className:"flex items-start space-x-3",children:[z(J.icon),$.jsxs("div",{className:"flex-1",children:[$.jsxs("div",{className:"flex items-center justify-between mb-2",children:[$.jsx(oS,{className:"text-red-800",children:J.title}),$.jsx(vu,{className:X(J.severity),children:J.severity})]}),$.jsx(wg,{className:"text-red-700",children:J.description}),$.jsx("p",{className:"text-xs text-red-600 mt-2",children:J.timeRemaining})]})]})},J.id)):$.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[$.jsx(Bv,{className:"h-12 w-12 mx-auto mb-2 text-green-500"}),$.jsx("p",{children:"No active weather alerts"}),$.jsx("p",{className:"text-xs mt-1",children:"Stay safe and check back regularly"})]})})]}),$.jsxs(Nr,{className:"relative overflow-hidden",children:[$.jsx("div",{className:"absolute inset-0 opacity-20",children:$.jsx(HT,{src:"https://images.unsplash.com/photo-1531132089310-f0e1e64bf85d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHxlbWVyZ2VuY3klMjBhbGVydCUyMHdhcm5pbmd8ZW58MXx8fHwxNzU5NjU1MzYwfDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral",alt:"Emergency background",className:"w-full h-full object-cover"})}),$.jsxs(jr,{className:"relative p-6 text-center",children:[$.jsx(Sd,{className:"h-12 w-12 mx-auto mb-3 text-orange-600"}),$.jsx("h3",{className:"text-lg mb-2",children:"Emergency Preparedness"}),$.jsx("p",{className:"text-sm text-muted-foreground",children:"Stay informed about weather conditions and follow safety guidelines"})]})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsx(Aa,{children:"Safety Tips & Guidelines"})}),$.jsx(jr,{className:"space-y-4",children:R.map((J,re)=>$.jsxs("div",{className:"border rounded-lg p-4",children:[$.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[N(J.icon),$.jsx("h4",{className:"text-sm",children:J.title})]}),$.jsx("ul",{className:"space-y-1",children:J.tips.map((s,he)=>$.jsxs("li",{className:"text-xs text-muted-foreground flex items-start space-x-2",children:[$.jsx("span",{className:"text-blue-500 mt-1",children:""}),$.jsx("span",{children:s})]},he))})]},re))})]}),$.jsxs(Nr,{className:"bg-blue-50 border-blue-200",children:[$.jsx(Ia,{children:$.jsx(Aa,{className:"text-blue-800",children:"Emergency Contacts"})}),$.jsx(jr,{children:$.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[$.jsxs("div",{children:[$.jsx("p",{className:"text-blue-700",children:"Emergency Hotline"}),$.jsx("p",{className:"text-blue-900",children:"911"})]}),$.jsxs("div",{children:[$.jsx("p",{className:"text-blue-700",children:"Weather Bureau"}),$.jsx("p",{className:"text-blue-900",children:"(02) 8284-0800"})]}),$.jsxs("div",{children:[$.jsx("p",{className:"text-blue-700",children:"Disaster Risk Reduction"}),$.jsx("p",{className:"text-blue-900",children:"(02) 8911-1406"})]}),$.jsxs("div",{children:[$.jsx("p",{className:"text-blue-700",children:"Red Cross"}),$.jsx("p",{className:"text-blue-900",children:"(02) 8527-0000"})]})]})})]})]})}function mD(){const[T,R]=be.useState(!1),[z,N]=be.useState(0),X=[{name:"Alex Chen",phone:"+63 917 123 4567",status:"notified"},{name:"Maria Santos",phone:"+63 917 234 5678",status:"delivered"},{name:"John Reyes",phone:"+63 917 345 6789",status:"seen"}],J=[{name:"Emergency Hotline",phone:"911",type:"emergency"},{name:"Local Police",phone:"(02) 8722-0650",type:"police"},{name:"Fire Department",phone:"(02) 8426-0246",type:"fire"},{name:"Medical Emergency",phone:"(02) 8789-7700",type:"medical"}],re=()=>{T?(R(!1),N(0),xv.success("SOS Alert Deactivated")):(R(!0),N(Date.now()),xv.error("SOS Alert Activated!",{description:"Emergency message sent to your friends and emergency contacts.",duration:5e3}),setTimeout(()=>{R(!1),N(0)},3e5))},s=ae=>{switch(ae){case"delivered":return"bg-blue-100 text-blue-800 border-blue-200";case"seen":return"bg-green-100 text-green-800 border-green-200";case"notified":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},he=()=>{if(!z)return"00:00";const ae=Math.floor((Date.now()-z)/1e3),Me=Math.floor(ae/60),oe=ae%60;return`${Me.toString().padStart(2,"0")}:${oe.toString().padStart(2,"0")}`};return $.jsxs("div",{className:"space-y-4 p-4",children:[$.jsx(Nr,{className:`text-center ${T?"bg-red-50 border-red-200":""}`,children:$.jsx(jr,{className:"p-6",children:$.jsxs("div",{className:"space-y-4",children:[$.jsx(Sd,{className:`h-16 w-16 mx-auto ${T?"text-red-600 animate-pulse":"text-gray-400"}`}),$.jsxs("div",{children:[$.jsx("h2",{className:`text-lg mb-2 ${T?"text-red-800":""}`,children:"Emergency SOS"}),$.jsx("p",{className:`text-sm mb-4 ${T?"text-red-600":"text-muted-foreground"}`,children:T?"SOS Alert is active. Your location and emergency message have been sent.":"Press and hold to send emergency alert to friends and emergency services"})]}),T&&$.jsxs("div",{className:"flex items-center justify-center space-x-2 text-red-600",children:[$.jsx(UP,{className:"h-4 w-4"}),$.jsxs("span",{className:"text-sm",children:["Active for: ",he()]})]}),$.jsx(yu,{size:"lg",variant:T?"destructive":"outline",className:`w-full h-16 text-lg ${T?"bg-red-600 hover:bg-red-700 animate-pulse":"border-red-200 text-red-600 hover:bg-red-50"}`,onClick:re,children:T?"STOP SOS ALERT":"EMERGENCY SOS"})]})})}),T&&$.jsxs(xg,{className:"border-red-200 bg-red-50",children:[$.jsx(Sd,{className:"h-4 w-4"}),$.jsxs(wg,{className:"text-red-800",children:[$.jsx("strong",{children:"Emergency Alert Active"}),$.jsx("br",{}),"Your current location (Manila, Philippines) and emergency message have been sent to your emergency contacts."]})]}),$.jsx(Nr,{children:$.jsxs(jr,{className:"p-4",children:[$.jsxs("h3",{className:"mb-3 flex items-center space-x-2",children:[$.jsx(Mb,{className:"h-4 w-4"}),$.jsx("span",{children:"Friends Alert Status"})]}),$.jsx("div",{className:"space-y-2",children:X.map((ae,Me)=>$.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[$.jsxs("div",{children:[$.jsx("p",{className:"text-sm",children:ae.name}),$.jsx("p",{className:"text-xs text-muted-foreground",children:ae.phone})]}),$.jsx(vu,{className:s(ae.status),children:ae.status})]},Me))})]})}),$.jsx(Nr,{children:$.jsxs(jr,{className:"p-4",children:[$.jsxs("h3",{className:"mb-3 flex items-center space-x-2",children:[$.jsx(Sd,{className:"h-4 w-4"}),$.jsx("span",{children:"Emergency Contacts"})]}),$.jsx("div",{className:"grid grid-cols-1 gap-2",children:J.map((ae,Me)=>$.jsxs(yu,{variant:"outline",className:"justify-between h-auto p-3",onClick:()=>{xv.success(`Calling ${ae.name}...`,{description:`Dialing ${ae.phone}`})},children:[$.jsxs("div",{className:"text-left",children:[$.jsx("p",{className:"text-sm",children:ae.name}),$.jsx("p",{className:"text-xs text-muted-foreground",children:ae.phone})]}),$.jsx(Mb,{className:"h-4 w-4"})]},Me))})]})}),$.jsx(Nr,{className:"bg-blue-50 border-blue-200",children:$.jsx(jr,{className:"p-4",children:$.jsxs("div",{className:"flex items-start space-x-2",children:[$.jsx(vp,{className:"h-5 w-5 text-blue-600 mt-0.5"}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-blue-800",children:"Current Location Sharing"}),$.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Location: Manila, Philippines (14.5995 N, 120.9842 E)"}),$.jsx("p",{className:"text-xs text-blue-600",children:"Last updated: Just now  Accuracy: 5 meters"})]})]})})}),$.jsx(Nr,{children:$.jsxs(jr,{className:"p-4",children:[$.jsx("h3",{className:"mb-2",children:"SOS Message Template"}),$.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:$.jsxs("p",{className:"text-muted-foreground",children:['" EMERGENCY ALERT ',$.jsx("br",{}),'I need immediate assistance. My current location is Manila, Philippines (14.5995 N, 120.9842 E). Please contact emergency services or come to my location if possible. This message was sent automatically via Weather Advisory App."']})})]})})]})}const g2=`https://${ox}.supabase.co/functions/v1/make-server-aedf23c8`,mx=async T=>{try{const R=await fetch(`${g2}/friends/location`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${yp}`},body:JSON.stringify(T)});if(!R.ok)throw new Error("Failed to update location");return await R.json()}catch(R){throw console.error("Error updating friend location:",R),R}},_2=async()=>{try{const T=await fetch(`${g2}/friends/locations`,{headers:{Authorization:`Bearer ${yp}`}});if(!T.ok)throw new Error("Failed to fetch locations");return(await T.json()).friends||[]}catch(T){throw console.error("Error fetching friend locations:",T),T}},gD=async(T,R,z,N,X,J=60)=>{const s=J*1e3/20,he=(N-R)/20,ae=(X-z)/20;for(let Me=0;Me<=20;Me++){const oe=R+he*Me,Oe=z+ae*Me,je=Math.atan2(ae,he)*(180/Math.PI),Ce=Math.sqrt(Math.pow(he,2)+Math.pow(ae,2))*111/s*36e5;await mx({friendId:T,latitude:oe,longitude:Oe,heading:(je+360)%360,speed:Math.round(Ce)}),await new Promise(Be=>setTimeout(Be,s))}},_D=async()=>{console.log(" Testing friend tracking system...");const T=[{friendId:"1",latitude:14.676,longitude:121.0437,location:"Quezon City"},{friendId:"2",latitude:14.5547,longitude:121.0244,location:"Makati"},{friendId:"3",latitude:14.5764,longitude:121.0851,location:"Pasig"}];for(const R of T)try{await mx(R),console.log(` Updated location for friend ${R.friendId}`)}catch(z){console.error(` Failed to update friend ${R.friendId}:`,z)}try{const R=await _2();console.log(` Fetched ${R.length} friend locations`)}catch(R){console.error(" Failed to fetch locations:",R)}console.log(" Test complete!")};function yD(){const[T,R]=be.useState({backend:"checking",mapbox:"checking",openweather:"checking"}),[z,N]=be.useState([]),[X,J]=be.useState(!1),re=`https://${ox}.supabase.co/functions/v1/make-server-aedf23c8`,s=Xe=>{N(ot=>[...ot,`[${new Date().toLocaleTimeString()}] ${Xe}`])},he=async()=>{s(" Checking backend connection...");try{if((await fetch(`${re}/health`,{headers:{Authorization:`Bearer ${yp}`}})).ok)return R(ot=>({...ot,backend:"online"})),s(" Backend is online!"),!0}catch(Xe){s(` Backend offline: ${Xe}`)}return R(Xe=>({...Xe,backend:"offline"})),!1},ae=()=>{s(" Checking Mapbox token...");const Xe=!window.location.href.includes("YOUR_TOKEN_HERE");R(ot=>({...ot,mapbox:Xe?"valid":"invalid"})),s(Xe?" Mapbox token appears set":" Mapbox token not set")},Me=async()=>{s(" Checking OpenWeatherMap API...");try{const ot=(await fetch("https://api.openweathermap.org/data/2.5/weather?q=Manila&appid=YOUR_KEY&units=metric")).ok;R(Ke=>({...Ke,openweather:ot?"valid":"invalid"})),s(ot?" OpenWeather API working":" OpenWeather API key invalid")}catch(Xe){s(` OpenWeather check failed: ${Xe}`),R(ot=>({...ot,openweather:"invalid"}))}},oe=async()=>{N([]),s(" Starting system check..."),await he(),ae(),await Me(),s(" System check complete!")},Oe=async()=>{J(!0),s(" Adding test friend at Rizal Park...");try{await mx({friendId:"test_user_1",latitude:14.5833,longitude:120.9833,location:"Rizal Park, Manila",heading:0,speed:0}),s(" Test friend added successfully!"),s(" Switch to Friends tab to see the marker")}catch(Xe){s(` Failed to add friend: ${Xe}`)}J(!1)},je=async()=>{J(!0),s(" Fetching all friend locations...");try{const Xe=await _2();s(` Found ${Xe.length} friends:`),Xe.forEach(ot=>{s(`    ${ot.friendId} at (${ot.latitude}, ${ot.longitude})`)})}catch(Xe){s(` Failed to fetch friends: ${Xe}`)}J(!1)},st=async()=>{J(!0),s(" Starting simulated journey (60 seconds)..."),s("   From: Rizal Park, Manila"),s("   To: Quezon Memorial Circle");try{await gD("traveler_1",14.5833,120.9833,14.676,121.0437,60),s(" Journey simulation complete!")}catch(Xe){s(` Simulation failed: ${Xe}`)}J(!1)},Ce=async()=>{J(!0),N([]),s(" Running comprehensive test suite...");try{await _D(),s(" All tests passed!")}catch(Xe){s(` Test suite failed: ${Xe}`)}J(!1)},Be=Xe=>{switch(Xe){case"checking":return $.jsxs(vu,{variant:"outline",children:[$.jsx(JP,{className:"h-3 w-3 animate-spin mr-1"})," Checking"]});case"online":case"valid":return $.jsxs(vu,{className:"bg-green-100 text-green-800 border-green-300",children:[$.jsx(Cb,{className:"h-3 w-3 mr-1"})," Ready"]});case"offline":case"invalid":return $.jsxs(vu,{variant:"destructive",children:[$.jsx(jP,{className:"h-3 w-3 mr-1"})," Error"]})}};return $.jsxs("div",{className:"space-y-4 p-4",children:[$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center justify-between",children:[$.jsxs("span",{className:"flex items-center space-x-2",children:[$.jsx(Nv,{className:"h-5 w-5"}),$.jsx("span",{children:"System Status"})]}),$.jsxs(yu,{size:"sm",onClick:oe,disabled:X,children:[$.jsx(k_,{className:`h-4 w-4 mr-2 ${X?"animate-spin":""}`}),"Check All"]})]})}),$.jsxs(jr,{className:"space-y-3",children:[$.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[$.jsx("span",{className:"text-sm",children:"Supabase Backend"}),Be(T.backend)]}),$.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[$.jsx("span",{className:"text-sm",children:"Mapbox GL JS"}),Be(T.mapbox)]}),$.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[$.jsx("span",{className:"text-sm",children:"OpenWeatherMap"}),Be(T.openweather)]})]})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsx(Aa,{children:"Quick Tests"})}),$.jsxs(jr,{className:"space-y-2",children:[$.jsxs(yu,{className:"w-full",variant:"outline",onClick:Oe,disabled:X,children:[$.jsx(vp,{className:"h-4 w-4 mr-2"}),"Add Test Friend at Rizal Park"]}),$.jsxs(yu,{className:"w-full",variant:"outline",onClick:je,disabled:X,children:[$.jsx(k_,{className:"h-4 w-4 mr-2"}),"Fetch All Friend Locations"]}),$.jsxs(yu,{className:"w-full",variant:"outline",onClick:st,disabled:X,children:[$.jsx(iR,{className:"h-4 w-4 mr-2"}),"Simulate Friend Movement (60s)"]}),$.jsxs(yu,{className:"w-full",onClick:Ce,disabled:X,children:[$.jsx(Cb,{className:"h-4 w-4 mr-2"}),"Run Full Test Suite"]})]})]}),$.jsxs(Nr,{children:[$.jsx(Ia,{children:$.jsxs(Aa,{className:"flex items-center justify-between",children:[$.jsx("span",{children:"Console Output"}),$.jsx(yu,{size:"sm",variant:"ghost",onClick:()=>N([]),children:"Clear"})]})}),$.jsx(jr,{children:$.jsx("div",{className:"bg-slate-900 text-green-400 p-4 rounded-lg h-64 overflow-y-auto font-mono text-xs",children:z.length===0?$.jsx("div",{className:"text-slate-500",children:"Run a test to see output..."}):z.map((Xe,ot)=>$.jsx("div",{className:"mb-1",children:Xe},ot))})})]}),$.jsxs(xg,{children:[$.jsx(Nv,{className:"h-4 w-4"}),$.jsxs(wg,{children:[$.jsx("strong",{children:"Debug Panel"})," - Use this panel to test the friend tracking system. All tests use the Supabase backend and real APIs.",$.jsxs("div",{className:"mt-2 text-xs",children:["Backend URL: ",$.jsx("code",{className:"bg-muted px-1 py-0.5 rounded",children:re})]})]})]})]})}function vD(){const[T,R]=be.useState("weather");return $.jsxs("div",{className:"h-screen bg-background flex flex-col app-safe",children:[$.jsx("div",{className:"sticky z-10 bg-background/95 backdrop-blur border-b px-4 py-3 flex-shrink-0",style:{top:"var(--safe-top)"},children:$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("div",{className:"flex items-center space-x-2",children:[$.jsx(Td,{className:"h-6 w-6 text-blue-600"}),$.jsx("h1",{children:"AVISO v1.2"})]}),$.jsx("div",{className:"text-xs text-muted-foreground",children:"Manila, PH"})]})}),$.jsx("div",{className:"flex-1 overflow-hidden",children:$.jsxs(jT,{value:T,onValueChange:R,className:"h-full flex flex-col",children:[$.jsx(bd,{value:"weather",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(_R,{})}),$.jsx(bd,{value:"friends",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(VR,{})}),$.jsx(bd,{value:"forecast",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(hD,{})}),$.jsx(bd,{value:"storms",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(fD,{})}),$.jsx(bd,{value:"alerts",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(pD,{})}),$.jsx(bd,{value:"sos",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(mD,{})}),$.jsx(bd,{value:"debug",className:"mt-0 flex-1 overflow-y-auto",children:$.jsx(yD,{})}),$.jsx("div",{className:"flex-shrink-0 bg-background/95 backdrop-blur border-t bottom-nav",children:$.jsxs(VT,{className:"grid w-full grid-cols-7 h-16 bg-transparent",children:[$.jsxs(wd,{value:"weather",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600",children:[$.jsx(Td,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Weather"})]}),$.jsxs(wd,{value:"friends",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600",children:[$.jsx(KT,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Friends"})]}),$.jsxs(wd,{value:"forecast",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-blue-50 data-[state=active]:text-blue-600",children:[$.jsx(kP,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Forecast"})]}),$.jsxs(wd,{value:"storms",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-indigo-50 data-[state=active]:text-indigo-600",children:[$.jsx(Fv,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Storms"})]}),$.jsxs(wd,{value:"alerts",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-orange-50 data-[state=active]:text-orange-600",children:[$.jsx(Bv,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Alerts"})]}),$.jsxs(wd,{value:"sos",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-red-50 data-[state=active]:text-red-600",children:[$.jsx(Sd,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"SOS"})]}),$.jsxs(wd,{value:"debug",className:"flex flex-col space-y-1 h-full data-[state=active]:bg-purple-50 data-[state=active]:text-purple-600",children:[$.jsx(Nv,{className:"h-4 w-4"}),$.jsx("span",{className:"text-xs",children:"Debug"})]})]})})]})}),$.jsx(_P,{})]})}uC.createRoot(document.getElementById("root")).render($.jsx(vD,{}));
